<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$spcdf965, $sp71e916, $sp901fa8, $sp87902c, $sp4ec02e = false) { $spcdf965[$sp901fa8] = substr_replace($spcdf965[$sp901fa8], $sp4ec02e !== false ? substr($sp87902c, 0, $sp4ec02e) : $sp87902c, $sp71e916, $sp4ec02e !== false ? $sp4ec02e : strlen($sp87902c)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($spad561d) { $spabcd03 = count($spad561d); foreach ($spad561d as &$sp29c872) { for ($sp1b7341 = 0; $sp1b7341 < $spabcd03; $sp1b7341++) { $sp29c872[$sp1b7341] = ord($sp29c872[$sp1b7341]) & 1 ? '1' : '0'; } } return $spad561d; } public static function tcpdfBarcodeArray($spd0703e, $sp3206f6 = 'QR,L', $spe79efe = '4.5.037') { $sp2f7093 = array(); if (!is_array($sp3206f6)) { $sp3206f6 = explode(',', $sp3206f6); } $sp58dd17 = 'L'; if (count($sp3206f6) > 1) { $sp58dd17 = $sp3206f6[1]; } $sp5a47d9 = QRcode::text($spd0703e, false, $sp58dd17); $sp434ee2 = count($sp5a47d9); $sp2f7093['num_rows'] = $sp434ee2; $sp2f7093['num_cols'] = $sp434ee2; $sp2f7093['bcode'] = array(); foreach ($sp5a47d9 as $sp9ee6fd) { $sp041f0b = array(); foreach (str_split($sp9ee6fd) as $spb0938a) { $sp041f0b[] = $spb0938a == '1' ? 1 : 0; } $sp2f7093['bcode'][] = $sp041f0b; } return $sp2f7093; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp6c0ebb = new QRmask(); for ($sp485e2d = 1; $sp485e2d <= QRSPEC_VERSION_MAX; $sp485e2d++) { $spad561d = QRspec::newFrame($sp485e2d); if (QR_IMAGE) { $sp4687d5 = QR_CACHE_DIR . 'frame_' . $sp485e2d . '.png'; QRimage::png(self::binarize($spad561d), $sp4687d5, 1, 0); } $sp0777ed = count($spad561d); $spe54a1b = array_fill(0, $sp0777ed, array_fill(0, $sp0777ed, 0)); for ($spb939dd = 0; $spb939dd < 8; $spb939dd++) { $sp6c0ebb->makeMaskNo($spb939dd, $sp0777ed, $spad561d, $spe54a1b, true); } } QRtools::markTime('after_build_cache'); } public static function log($sp1bcba8, $sp670748) { if (QR_LOG_DIR !== false) { if ($sp670748 != '') { if ($sp1bcba8 !== false) { file_put_contents(QR_LOG_DIR . basename($sp1bcba8) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $sp670748, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $sp670748, FILE_APPEND); } } } } public static function dumpMask($spad561d) { $sp0777ed = count($spad561d); for ($sp901fa8 = 0; $sp901fa8 < $sp0777ed; $sp901fa8++) { for ($sp71e916 = 0; $sp71e916 < $sp0777ed; $sp71e916++) { echo ord($spad561d[$sp901fa8][$sp71e916]) . ','; } } } public static function markTime($spd79e2f) { list($spf1a0b1, $sp7be6a0) = explode(' ', microtime()); $spd2330d = (double) $spf1a0b1 + (double) $sp7be6a0; if (!isset($sp3f67c0['qr_time_bench'])) { $sp3f67c0['qr_time_bench'] = array(); } $sp3f67c0['qr_time_bench'][$spd79e2f] = $spd2330d; } public static function timeBenchmark() { self::markTime('finish'); $sp5c8ebf = 0; $sp16cfea = 0; $sp6ee56f = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($sp3f67c0['qr_time_bench'] as $spd79e2f => $sp636360) { if ($sp6ee56f > 0) { echo '<tr><th style="text-align:right">till ' . $spd79e2f . ': </th><td>' . number_format($sp636360 - $sp5c8ebf, 6) . 's</td></tr>'; } else { $sp16cfea = $sp636360; } $sp6ee56f++; $sp5c8ebf = $sp636360; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp5c8ebf - $sp16cfea, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($spb091dd, $spa4e63d) { return self::$capacity[$spb091dd][QRCAP_WORDS] - self::$capacity[$spb091dd][QRCAP_EC][$spa4e63d]; } public static function getECCLength($spb091dd, $spa4e63d) { return self::$capacity[$spb091dd][QRCAP_EC][$spa4e63d]; } public static function getWidth($spb091dd) { return self::$capacity[$spb091dd][QRCAP_WIDTH]; } public static function getRemainder($spb091dd) { return self::$capacity[$spb091dd][QRCAP_REMINDER]; } public static function getMinimumVersion($sp434ee2, $spa4e63d) { for ($sp1b7341 = 1; $sp1b7341 <= QRSPEC_VERSION_MAX; $sp1b7341++) { $sp4778c1 = self::$capacity[$sp1b7341][QRCAP_WORDS] - self::$capacity[$sp1b7341][QRCAP_EC][$spa4e63d]; if ($sp4778c1 >= $sp434ee2) { return $sp1b7341; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp3206f6, $spb091dd) { if ($sp3206f6 == QR_MODE_STRUCTURE) { return 0; } if ($spb091dd <= 9) { $spc7b1f2 = 0; } else { if ($spb091dd <= 26) { $spc7b1f2 = 1; } else { $spc7b1f2 = 2; } } return self::$lengthTableBits[$sp3206f6][$spc7b1f2]; } public static function maximumWords($sp3206f6, $spb091dd) { if ($sp3206f6 == QR_MODE_STRUCTURE) { return 3; } if ($spb091dd <= 9) { $spc7b1f2 = 0; } else { if ($spb091dd <= 26) { $spc7b1f2 = 1; } else { $spc7b1f2 = 2; } } $spbc76fa = self::$lengthTableBits[$sp3206f6][$spc7b1f2]; $sp4778c1 = (1 << $spbc76fa) - 1; if ($sp3206f6 == QR_MODE_KANJI) { $sp4778c1 *= 2; } return $sp4778c1; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($spb091dd, $spa4e63d, array &$spa23afb) { if (count($spa23afb) < 5) { $spa23afb = array(0, 0, 0, 0, 0); } $sp3c103f = self::$eccTable[$spb091dd][$spa4e63d][0]; $sp230632 = self::$eccTable[$spb091dd][$spa4e63d][1]; $sp1835de = self::getDataLength($spb091dd, $spa4e63d); $sp546fa8 = self::getECCLength($spb091dd, $spa4e63d); if ($sp230632 == 0) { $spa23afb[0] = $sp3c103f; $spa23afb[1] = (int) ($sp1835de / $sp3c103f); $spa23afb[2] = (int) ($sp546fa8 / $sp3c103f); $spa23afb[3] = 0; $spa23afb[4] = 0; } else { $spa23afb[0] = $sp3c103f; $spa23afb[1] = (int) ($sp1835de / ($sp3c103f + $sp230632)); $spa23afb[2] = (int) ($sp546fa8 / ($sp3c103f + $sp230632)); $spa23afb[3] = $sp230632; $spa23afb[4] = $spa23afb[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$spad561d, $spaeb905, $spaed27b) { $spb815e7 = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp309954 = $spaed27b - 2; $sp1ea251 = $spaeb905 - 2; for ($sp901fa8 = 0; $sp901fa8 < 5; $sp901fa8++) { QRstr::set($spad561d, $sp1ea251, $sp309954 + $sp901fa8, $spb815e7[$sp901fa8]); } } public static function putAlignmentPattern($spb091dd, &$spad561d, $sp0777ed) { if ($spb091dd < 2) { return; } $sp494d81 = self::$alignmentPattern[$spb091dd][1] - self::$alignmentPattern[$spb091dd][0]; if ($sp494d81 < 0) { $spa45800 = 2; } else { $spa45800 = (int) (($sp0777ed - self::$alignmentPattern[$spb091dd][0]) / $sp494d81 + 2); } if ($spa45800 * $spa45800 - 3 == 1) { $sp71e916 = self::$alignmentPattern[$spb091dd][0]; $sp901fa8 = self::$alignmentPattern[$spb091dd][0]; self::putAlignmentMarker($spad561d, $sp71e916, $sp901fa8); return; } $sp82966b = self::$alignmentPattern[$spb091dd][0]; for ($sp71e916 = 1; $sp71e916 < $spa45800 - 1; $sp71e916++) { self::putAlignmentMarker($spad561d, 6, $sp82966b); self::putAlignmentMarker($spad561d, $sp82966b, 6); $sp82966b += $sp494d81; } $spe4ed3b = self::$alignmentPattern[$spb091dd][0]; for ($sp901fa8 = 0; $sp901fa8 < $spa45800 - 1; $sp901fa8++) { $sp82966b = self::$alignmentPattern[$spb091dd][0]; for ($sp71e916 = 0; $sp71e916 < $spa45800 - 1; $sp71e916++) { self::putAlignmentMarker($spad561d, $sp82966b, $spe4ed3b); $sp82966b += $sp494d81; } $spe4ed3b += $sp494d81; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($spb091dd) { if ($spb091dd < 7 || $spb091dd > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$spb091dd - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp6c0ebb, $spa4e63d) { if ($sp6c0ebb < 0 || $sp6c0ebb > 7) { return 0; } if ($spa4e63d < 0 || $spa4e63d > 3) { return 0; } return self::$formatInfo[$spa4e63d][$sp6c0ebb]; } public static $frames = array(); public static function putFinderPattern(&$spad561d, $spaeb905, $spaed27b) { $spb815e7 = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($sp901fa8 = 0; $sp901fa8 < 7; $sp901fa8++) { QRstr::set($spad561d, $spaeb905, $spaed27b + $sp901fa8, $spb815e7[$sp901fa8]); } } public static function createFrame($spb091dd) { $sp0777ed = self::$capacity[$spb091dd][QRCAP_WIDTH]; $sp29c872 = str_repeat(' ', $sp0777ed); $spad561d = array_fill(0, $sp0777ed, $sp29c872); self::putFinderPattern($spad561d, 0, 0); self::putFinderPattern($spad561d, $sp0777ed - 7, 0); self::putFinderPattern($spad561d, 0, $sp0777ed - 7); $sp34d2bf = $sp0777ed - 7; for ($sp901fa8 = 0; $sp901fa8 < 7; $sp901fa8++) { $spad561d[$sp901fa8][7] = '¿'; $spad561d[$sp901fa8][$sp0777ed - 8] = '¿'; $spad561d[$sp34d2bf][7] = '¿'; $sp34d2bf++; } $spd19c7b = str_repeat('¿', 8); QRstr::set($spad561d, 0, 7, $spd19c7b); QRstr::set($spad561d, $sp0777ed - 8, 7, $spd19c7b); QRstr::set($spad561d, 0, $sp0777ed - 8, $spd19c7b); $spd19c7b = str_repeat('Ñ', 9); QRstr::set($spad561d, 0, 8, $spd19c7b); QRstr::set($spad561d, $sp0777ed - 8, 8, $spd19c7b, 8); $sp34d2bf = $sp0777ed - 8; for ($sp901fa8 = 0; $sp901fa8 < 8; $sp901fa8++, $sp34d2bf++) { $spad561d[$sp901fa8][8] = 'Ñ'; $spad561d[$sp34d2bf][8] = 'Ñ'; } for ($sp1b7341 = 1; $sp1b7341 < $sp0777ed - 15; $sp1b7341++) { $spad561d[6][7 + $sp1b7341] = chr(144 | $sp1b7341 & 1); $spad561d[7 + $sp1b7341][6] = chr(144 | $sp1b7341 & 1); } self::putAlignmentPattern($spb091dd, $spad561d, $sp0777ed); if ($spb091dd >= 7) { $speff895 = self::getVersionPattern($spb091dd); $sp651922 = $speff895; for ($sp71e916 = 0; $sp71e916 < 6; $sp71e916++) { for ($sp901fa8 = 0; $sp901fa8 < 3; $sp901fa8++) { $spad561d[$sp0777ed - 11 + $sp901fa8][$sp71e916] = chr(136 | $sp651922 & 1); $sp651922 = $sp651922 >> 1; } } $sp651922 = $speff895; for ($sp901fa8 = 0; $sp901fa8 < 6; $sp901fa8++) { for ($sp71e916 = 0; $sp71e916 < 3; $sp71e916++) { $spad561d[$sp901fa8][$sp71e916 + ($sp0777ed - 11)] = chr(136 | $sp651922 & 1); $sp651922 = $sp651922 >> 1; } } } $spad561d[$sp0777ed - 8][8] = 'Å'; return $spad561d; } public static function debug($spad561d, $spb32144 = false) { if ($spb32144) { foreach ($spad561d as &$sp29c872) { $sp29c872 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $sp29c872)); $sp29c872 = join('&#9608;&#9608;', explode('1', $sp29c872)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $spad561d); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($spad561d as &$sp29c872) { $sp29c872 = join('<span class="m">&nbsp;</span>', explode('¿', $sp29c872)); $sp29c872 = join('<span class="m">&#9618;</span>', explode('¡', $sp29c872)); $sp29c872 = join('<span class="p">&nbsp;</span>', explode('†', $sp29c872)); $sp29c872 = join('<span class="p">&#9618;</span>', explode('°', $sp29c872)); $sp29c872 = join('<span class="s">&#9671;</span>', explode('Ñ', $sp29c872)); $sp29c872 = join('<span class="s">&#9670;</span>', explode('Ö', $sp29c872)); $sp29c872 = join('<span class="x">&#9762;</span>', explode('Å', $sp29c872)); $sp29c872 = join('<span class="c">&nbsp;</span>', explode('ê', $sp29c872)); $sp29c872 = join('<span class="c">&#9719;</span>', explode('ë', $sp29c872)); $sp29c872 = join('<span class="f">&nbsp;</span>', explode('à', $sp29c872)); $sp29c872 = join('<span class="f">&#9618;</span>', explode('â', $sp29c872)); $sp29c872 = join('&#9830;', explode('', $sp29c872)); $sp29c872 = join('&#8901;', explode(' ', $sp29c872)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $spad561d); echo '</tt></pre>'; } } public static function serial($spad561d) { return gzcompress(join('
', $spad561d), 9); } public static function unserial($spd0703e) { return explode('
', gzuncompress($spd0703e)); } public static function newFrame($spb091dd) { if ($spb091dd < 1 || $spb091dd > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$spb091dd])) { $sp4687d5 = QR_CACHE_DIR . 'frame_' . $spb091dd . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp4687d5)) { self::$frames[$spb091dd] = self::unserial(file_get_contents($sp4687d5)); } else { self::$frames[$spb091dd] = self::createFrame($spb091dd); file_put_contents($sp4687d5, self::serial(self::$frames[$spb091dd])); } } else { self::$frames[$spb091dd] = self::createFrame($spb091dd); } } if (is_null(self::$frames[$spb091dd])) { return null; } return self::$frames[$spb091dd]; } public static function rsBlockNum($spa23afb) { return $spa23afb[0] + $spa23afb[3]; } public static function rsBlockNum1($spa23afb) { return $spa23afb[0]; } public static function rsDataCodes1($spa23afb) { return $spa23afb[1]; } public static function rsEccCodes1($spa23afb) { return $spa23afb[2]; } public static function rsBlockNum2($spa23afb) { return $spa23afb[3]; } public static function rsDataCodes2($spa23afb) { return $spa23afb[4]; } public static function rsEccCodes2($spa23afb) { return $spa23afb[2]; } public static function rsDataLength($spa23afb) { return $spa23afb[0] * $spa23afb[1] + $spa23afb[3] * $spa23afb[4]; } public static function rsEccLength($spa23afb) { return ($spa23afb[0] + $spa23afb[3]) * $spa23afb[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($spad561d, $sp7dcebb = false, $sp368a3a = 4, $spe65b4b = 4, $sp2a5800 = FALSE) { $sp49c25f = self::image($spad561d, $sp368a3a, $spe65b4b); if ($sp7dcebb === false) { Header('Content-type: image/png'); ImagePng($sp49c25f); } else { if ($sp2a5800 === TRUE) { ImagePng($sp49c25f, $sp7dcebb); header('Content-type: image/png'); ImagePng($sp49c25f); } else { ImagePng($sp49c25f, $sp7dcebb); } } ImageDestroy($sp49c25f); } public static function jpg($spad561d, $sp7dcebb = false, $sp368a3a = 8, $spe65b4b = 4, $spdda5a9 = 85) { $sp49c25f = self::image($spad561d, $sp368a3a, $spe65b4b); if ($sp7dcebb === false) { Header('Content-type: image/jpeg'); ImageJpeg($sp49c25f, null, $spdda5a9); } else { ImageJpeg($sp49c25f, $sp7dcebb, $spdda5a9); } ImageDestroy($sp49c25f); } private static function image($spad561d, $sp368a3a = 4, $spe65b4b = 4) { $sp988a0c = count($spad561d); $spa45800 = strlen($spad561d[0]); $sp8fd80e = $spa45800 + 2 * $spe65b4b; $sp6db63f = $sp988a0c + 2 * $spe65b4b; $spf31518 = ImageCreate($sp8fd80e, $sp6db63f); $sp53cc4e[0] = ImageColorAllocate($spf31518, 255, 255, 255); $sp53cc4e[1] = ImageColorAllocate($spf31518, 0, 0, 0); imagefill($spf31518, 0, 0, $sp53cc4e[0]); for ($sp901fa8 = 0; $sp901fa8 < $sp988a0c; $sp901fa8++) { for ($sp71e916 = 0; $sp71e916 < $spa45800; $sp71e916++) { if ($spad561d[$sp901fa8][$sp71e916] == '1') { ImageSetPixel($spf31518, $sp71e916 + $spe65b4b, $sp901fa8 + $spe65b4b, $sp53cc4e[1]); } } } $sp30b5b8 = ImageCreate($sp8fd80e * $sp368a3a, $sp6db63f * $sp368a3a); ImageCopyResized($sp30b5b8, $spf31518, 0, 0, 0, 0, $sp8fd80e * $sp368a3a, $sp6db63f * $sp368a3a, $sp8fd80e, $sp6db63f); ImageDestroy($spf31518); return $sp30b5b8; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp3206f6, $sp434ee2, $sp1835de, $spd88884 = null) { $spc2a8e0 = array_slice($sp1835de, 0, $sp434ee2); if (count($spc2a8e0) < $sp434ee2) { $spc2a8e0 = array_merge($spc2a8e0, array_fill(0, $sp434ee2 - count($spc2a8e0), 0)); } if (!QRinput::check($sp3206f6, $sp434ee2, $spc2a8e0)) { throw new Exception('Error m:' . $sp3206f6 . ',s:' . $sp434ee2 . ',d:' . join(',', $spc2a8e0)); return null; } $this->mode = $sp3206f6; $this->size = $sp434ee2; $this->data = $spc2a8e0; $this->bstream = $spd88884; } public function encodeModeNum($spb091dd) { try { $sp4778c1 = (int) ($this->size / 3); $spc6d0fb = new QRbitstream(); $spc28c86 = 1; $spc6d0fb->appendNum(4, $spc28c86); $spc6d0fb->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $spb091dd), $this->size); for ($sp1b7341 = 0; $sp1b7341 < $sp4778c1; $sp1b7341++) { $spc28c86 = (ord($this->data[$sp1b7341 * 3]) - ord('0')) * 100; $spc28c86 += (ord($this->data[$sp1b7341 * 3 + 1]) - ord('0')) * 10; $spc28c86 += ord($this->data[$sp1b7341 * 3 + 2]) - ord('0'); $spc6d0fb->appendNum(10, $spc28c86); } if ($this->size - $sp4778c1 * 3 == 1) { $spc28c86 = ord($this->data[$sp4778c1 * 3]) - ord('0'); $spc6d0fb->appendNum(4, $spc28c86); } else { if ($this->size - $sp4778c1 * 3 == 2) { $spc28c86 = (ord($this->data[$sp4778c1 * 3]) - ord('0')) * 10; $spc28c86 += ord($this->data[$sp4778c1 * 3 + 1]) - ord('0'); $spc6d0fb->appendNum(7, $spc28c86); } } $this->bstream = $spc6d0fb; return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function encodeModeAn($spb091dd) { try { $sp4778c1 = (int) ($this->size / 2); $spc6d0fb = new QRbitstream(); $spc6d0fb->appendNum(4, 2); $spc6d0fb->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $spb091dd), $this->size); for ($sp1b7341 = 0; $sp1b7341 < $sp4778c1; $sp1b7341++) { $spc28c86 = (int) QRinput::lookAnTable(ord($this->data[$sp1b7341 * 2])) * 45; $spc28c86 += (int) QRinput::lookAnTable(ord($this->data[$sp1b7341 * 2 + 1])); $spc6d0fb->appendNum(11, $spc28c86); } if ($this->size & 1) { $spc28c86 = QRinput::lookAnTable(ord($this->data[$sp4778c1 * 2])); $spc6d0fb->appendNum(6, $spc28c86); } $this->bstream = $spc6d0fb; return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function encodeMode8($spb091dd) { try { $spc6d0fb = new QRbitstream(); $spc6d0fb->appendNum(4, 4); $spc6d0fb->appendNum(QRspec::lengthIndicator(QR_MODE_8, $spb091dd), $this->size); for ($sp1b7341 = 0; $sp1b7341 < $this->size; $sp1b7341++) { $spc6d0fb->appendNum(8, ord($this->data[$sp1b7341])); } $this->bstream = $spc6d0fb; return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function encodeModeKanji($spb091dd) { try { $spc6d0fb = new QRbitrtream(); $spc6d0fb->appendNum(4, 8); $spc6d0fb->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $spb091dd), (int) ($this->size / 2)); for ($sp1b7341 = 0; $sp1b7341 < $this->size; $sp1b7341 += 2) { $spc28c86 = ord($this->data[$sp1b7341]) << 8 | ord($this->data[$sp1b7341 + 1]); if ($spc28c86 <= 40956) { $spc28c86 -= 33088; } else { $spc28c86 -= 49472; } $sp988a0c = ($spc28c86 >> 8) * 192; $spc28c86 = ($spc28c86 & 255) + $sp988a0c; $spc6d0fb->appendNum(13, $spc28c86); } $this->bstream = $spc6d0fb; return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function encodeModeStructure() { try { $spc6d0fb = new QRbitstream(); $spc6d0fb->appendNum(4, 3); $spc6d0fb->appendNum(4, ord($this->data[1]) - 1); $spc6d0fb->appendNum(4, ord($this->data[0]) - 1); $spc6d0fb->appendNum(8, ord($this->data[2])); $this->bstream = $spc6d0fb; return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function estimateBitStreamSizeOfEntry($spb091dd) { $spbc76fa = 0; if ($spb091dd == 0) { $spb091dd = 1; } switch ($this->mode) { case QR_MODE_NUM: $spbc76fa = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $spbc76fa = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $spbc76fa = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $spbc76fa = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $spc7b1f2 = QRspec::lengthIndicator($this->mode, $spb091dd); $spb2225f = 1 << $spc7b1f2; $sp3b0bf9 = (int) (($this->size + $spb2225f - 1) / $spb2225f); $spbc76fa += $sp3b0bf9 * (4 + $spc7b1f2); return $spbc76fa; } public function encodeBitStream($spb091dd) { try { unset($this->bstream); $sp4778c1 = QRspec::maximumWords($this->mode, $spb091dd); if ($this->size > $sp4778c1) { $sp60b62c = new QRinputItem($this->mode, $sp4778c1, $this->data); $spffb423 = new QRinputItem($this->mode, $this->size - $sp4778c1, array_slice($this->data, $sp4778c1)); $sp60b62c->encodeBitStream($spb091dd); $spffb423->encodeBitStream($spb091dd); $this->bstream = new QRbitstream(); $this->bstream->append($sp60b62c->bstream); $this->bstream->append($spffb423->bstream); unset($sp60b62c); unset($spffb423); } else { $spc8aebe = 0; switch ($this->mode) { case QR_MODE_NUM: $spc8aebe = $this->encodeModeNum($spb091dd); break; case QR_MODE_AN: $spc8aebe = $this->encodeModeAn($spb091dd); break; case QR_MODE_8: $spc8aebe = $this->encodeMode8($spb091dd); break; case QR_MODE_KANJI: $spc8aebe = $this->encodeModeKanji($spb091dd); break; case QR_MODE_STRUCTURE: $spc8aebe = $this->encodeModeStructure(); break; default: break; } if ($spc8aebe < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $sp2a4a9a) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($spb091dd = 0, $spa4e63d = QR_ECLEVEL_L) { if ($spb091dd < 0 || $spb091dd > QRSPEC_VERSION_MAX || $spa4e63d > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $spb091dd; $this->level = $spa4e63d; } public function getVersion() { return $this->version; } public function setVersion($spb091dd) { if ($spb091dd < 0 || $spb091dd > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $spb091dd; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($spa4e63d) { if ($spa4e63d > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $spa4e63d; return 0; } public function appendEntry(QRinputItem $spc7243d) { $this->items[] = $spc7243d; } public function append($sp3206f6, $sp434ee2, $sp1835de) { try { $spc7243d = new QRinputItem($sp3206f6, $sp434ee2, $sp1835de); $this->items[] = $spc7243d; return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function insertStructuredAppendHeader($sp434ee2, $spbe447c, $sp121bb1) { if ($sp434ee2 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($spbe447c <= 0 || $spbe447c > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $spc2ff58 = array($sp434ee2, $spbe447c, $sp121bb1); try { $spc7243d = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $spc7243d); return 0; } catch (Exception $sp2a4a9a) { return -1; } } public function calcParity() { $sp121bb1 = 0; foreach ($this->items as $spf427c6) { if ($spf427c6->mode != QR_MODE_STRUCTURE) { for ($sp1b7341 = $spf427c6->size - 1; $sp1b7341 >= 0; $sp1b7341--) { $sp121bb1 ^= $spf427c6->data[$sp1b7341]; } } } return $sp121bb1; } public static function checkModeNum($sp434ee2, $sp1835de) { for ($sp1b7341 = 0; $sp1b7341 < $sp434ee2; $sp1b7341++) { if (ord($sp1835de[$sp1b7341]) < ord('0') || ord($sp1835de[$sp1b7341]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($sp434ee2) { $spa45800 = (int) $sp434ee2 / 3; $spbc76fa = $spa45800 * 10; switch ($sp434ee2 - $spa45800 * 3) { case 1: $spbc76fa += 4; break; case 2: $spbc76fa += 7; break; default: break; } return $spbc76fa; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($sp356855) { return $sp356855 > 127 ? -1 : self::$anTable[$sp356855]; } public static function checkModeAn($sp434ee2, $sp1835de) { for ($sp1b7341 = 0; $sp1b7341 < $sp434ee2; $sp1b7341++) { if (self::lookAnTable(ord($sp1835de[$sp1b7341])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($sp434ee2) { $spa45800 = (int) ($sp434ee2 / 2); $spbc76fa = $spa45800 * 11; if ($sp434ee2 & 1) { $spbc76fa += 6; } return $spbc76fa; } public static function estimateBitsMode8($sp434ee2) { return $sp434ee2 * 8; } public function estimateBitsModeKanji($sp434ee2) { return (int) ($sp434ee2 / 2 * 13); } public static function checkModeKanji($sp434ee2, $sp1835de) { if ($sp434ee2 & 1) { return false; } for ($sp1b7341 = 0; $sp1b7341 < $sp434ee2; $sp1b7341 += 2) { $spc28c86 = ord($sp1835de[$sp1b7341]) << 8 | ord($sp1835de[$sp1b7341 + 1]); if ($spc28c86 < 33088 || $spc28c86 > 40956 && $spc28c86 < 57408 || $spc28c86 > 60351) { return false; } } return true; } public static function check($sp3206f6, $sp434ee2, $sp1835de) { if ($sp434ee2 <= 0) { return false; } switch ($sp3206f6) { case QR_MODE_NUM: return self::checkModeNum($sp434ee2, $sp1835de); break; case QR_MODE_AN: return self::checkModeAn($sp434ee2, $sp1835de); break; case QR_MODE_KANJI: return self::checkModeKanji($sp434ee2, $sp1835de); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($spb091dd) { $spbc76fa = 0; foreach ($this->items as $spf427c6) { $spbc76fa += $spf427c6->estimateBitStreamSizeOfEntry($spb091dd); } return $spbc76fa; } public function estimateVersion() { $spb091dd = 0; $sp2ff636 = 0; do { $sp2ff636 = $spb091dd; $spbc76fa = $this->estimateBitStreamSize($sp2ff636); $spb091dd = QRspec::getMinimumVersion((int) (($spbc76fa + 7) / 8), $this->level); if ($spb091dd < 0) { return -1; } } while ($spb091dd > $sp2ff636); return $spb091dd; } public static function lengthOfCode($sp3206f6, $spb091dd, $spbc76fa) { $sp90274e = $spbc76fa - 4 - QRspec::lengthIndicator($sp3206f6, $spb091dd); switch ($sp3206f6) { case QR_MODE_NUM: $sp7e5ac1 = (int) ($sp90274e / 10); $sp5fcc5c = $sp90274e - $sp7e5ac1 * 10; $sp434ee2 = $sp7e5ac1 * 3; if ($sp5fcc5c >= 7) { $sp434ee2 += 2; } else { if ($sp5fcc5c >= 4) { $sp434ee2 += 1; } } break; case QR_MODE_AN: $sp7e5ac1 = (int) ($sp90274e / 11); $sp5fcc5c = $sp90274e - $sp7e5ac1 * 11; $sp434ee2 = $sp7e5ac1 * 2; if ($sp5fcc5c >= 6) { $sp434ee2++; } break; case QR_MODE_8: $sp434ee2 = (int) ($sp90274e / 8); break; case QR_MODE_KANJI: $sp434ee2 = (int) ($sp90274e / 13 * 2); break; case QR_MODE_STRUCTURE: $sp434ee2 = (int) ($sp90274e / 8); break; default: $sp434ee2 = 0; break; } $sp3e0789 = QRspec::maximumWords($sp3206f6, $spb091dd); if ($sp434ee2 < 0) { $sp434ee2 = 0; } if ($sp434ee2 > $sp3e0789) { $sp434ee2 = $sp3e0789; } return $sp434ee2; } public function createBitStream() { $spbb8e98 = 0; foreach ($this->items as $spf427c6) { $spbc76fa = $spf427c6->encodeBitStream($this->version); if ($spbc76fa < 0) { return -1; } $spbb8e98 += $spbc76fa; } return $spbb8e98; } public function convertData() { $sp4a0ebd = $this->estimateVersion(); if ($sp4a0ebd > $this->getVersion()) { $this->setVersion($sp4a0ebd); } for (;;) { $spbc76fa = $this->createBitStream(); if ($spbc76fa < 0) { return -1; } $sp4a0ebd = QRspec::getMinimumVersion((int) (($spbc76fa + 7) / 8), $this->level); if ($sp4a0ebd < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($sp4a0ebd > $this->getVersion()) { $this->setVersion($sp4a0ebd); } else { break; } } } return 0; } public function appendPaddingBit(&$spd88884) { $spbc76fa = $spd88884->size(); $spff6ed9 = QRspec::getDataLength($this->version, $this->level); $spb8b1fb = $spff6ed9 * 8; if ($spb8b1fb == $spbc76fa) { return 0; } if ($spb8b1fb - $spbc76fa < 5) { return $spd88884->appendNum($spb8b1fb - $spbc76fa, 0); } $spbc76fa += 4; $sp4778c1 = (int) (($spbc76fa + 7) / 8); $spf303e4 = new QRbitstream(); $spc8aebe = $spf303e4->appendNum($sp4778c1 * 8 - $spbc76fa + 4, 0); if ($spc8aebe < 0) { return $spc8aebe; } $sp55c877 = $spff6ed9 - $sp4778c1; if ($sp55c877 > 0) { $sp211fe3 = array(); for ($sp1b7341 = 0; $sp1b7341 < $sp55c877; $sp1b7341++) { $sp211fe3[$sp1b7341] = $sp1b7341 & 1 ? 17 : 236; } $spc8aebe = $spf303e4->appendBytes($sp55c877, $sp211fe3); if ($spc8aebe < 0) { return $spc8aebe; } } $spc8aebe = $spd88884->append($spf303e4); return $spc8aebe; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $spd88884 = new QRbitstream(); foreach ($this->items as $spf427c6) { $spc8aebe = $spd88884->append($spf427c6->bstream); if ($spc8aebe < 0) { return null; } } return $spd88884; } public function getBitStream() { $spd88884 = $this->mergeBitStream(); if ($spd88884 == null) { return null; } $spc8aebe = $this->appendPaddingBit($spd88884); if ($spc8aebe < 0) { return null; } return $spd88884; } public function getByteStream() { $spd88884 = $this->getBitStream(); if ($spd88884 == null) { return null; } return $spd88884->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($spf9309e) { $this->data = array_fill(0, $spf9309e, 0); return 0; } public static function newFromNum($spbc76fa, $sp3b0bf9) { $spd88884 = new QRbitstream(); $spd88884->allocate($spbc76fa); $sp6c0ebb = 1 << $spbc76fa - 1; for ($sp1b7341 = 0; $sp1b7341 < $spbc76fa; $sp1b7341++) { if ($sp3b0bf9 & $sp6c0ebb) { $spd88884->data[$sp1b7341] = 1; } else { $spd88884->data[$sp1b7341] = 0; } $sp6c0ebb = $sp6c0ebb >> 1; } return $spd88884; } public static function newFromBytes($sp434ee2, $sp1835de) { $spd88884 = new QRbitstream(); $spd88884->allocate($sp434ee2 * 8); $sp6ee56f = 0; for ($sp1b7341 = 0; $sp1b7341 < $sp434ee2; $sp1b7341++) { $sp6c0ebb = 128; for ($sp4502fa = 0; $sp4502fa < 8; $sp4502fa++) { if ($sp1835de[$sp1b7341] & $sp6c0ebb) { $spd88884->data[$sp6ee56f] = 1; } else { $spd88884->data[$sp6ee56f] = 0; } $sp6ee56f++; $sp6c0ebb = $sp6c0ebb >> 1; } } return $spd88884; } public function append(QRbitstream $spea5491) { if (is_null($spea5491)) { return -1; } if ($spea5491->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $spea5491->data; return 0; } $this->data = array_values(array_merge($this->data, $spea5491->data)); return 0; } public function appendNum($spbc76fa, $sp3b0bf9) { if ($spbc76fa == 0) { return 0; } $sp1c0919 = QRbitstream::newFromNum($spbc76fa, $sp3b0bf9); if (is_null($sp1c0919)) { return -1; } $spc8aebe = $this->append($sp1c0919); unset($sp1c0919); return $spc8aebe; } public function appendBytes($sp434ee2, $sp1835de) { if ($sp434ee2 == 0) { return 0; } $sp1c0919 = QRbitstream::newFromBytes($sp434ee2, $sp1835de); if (is_null($sp1c0919)) { return -1; } $spc8aebe = $this->append($sp1c0919); unset($sp1c0919); return $spc8aebe; } public function toByte() { $sp434ee2 = $this->size(); if ($sp434ee2 == 0) { return array(); } $sp1835de = array_fill(0, (int) (($sp434ee2 + 7) / 8), 0); $spe739fb = (int) ($sp434ee2 / 8); $sp6ee56f = 0; for ($sp1b7341 = 0; $sp1b7341 < $spe739fb; $sp1b7341++) { $sp651922 = 0; for ($sp4502fa = 0; $sp4502fa < 8; $sp4502fa++) { $sp651922 = $sp651922 << 1; $sp651922 |= $this->data[$sp6ee56f]; $sp6ee56f++; } $sp1835de[$sp1b7341] = $sp651922; } if ($sp434ee2 & 7) { $sp651922 = 0; for ($sp4502fa = 0; $sp4502fa < ($sp434ee2 & 7); $sp4502fa++) { $sp651922 = $sp651922 << 1; $sp651922 |= $this->data[$sp6ee56f]; $sp6ee56f++; } $sp1835de[$spe739fb] = $sp651922; } return $sp1835de; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($spc1a7a2, $sp51043b, $spb25909) { $this->dataStr = $spc1a7a2; $this->input = $sp51043b; $this->modeHint = $spb25909; } public static function isdigitat($spb67857, $sp913e13) { if ($sp913e13 >= strlen($spb67857)) { return false; } return ord($spb67857[$sp913e13]) >= ord('0') && ord($spb67857[$sp913e13]) <= ord('9'); } public static function isalnumat($spb67857, $sp913e13) { if ($sp913e13 >= strlen($spb67857)) { return false; } return QRinput::lookAnTable(ord($spb67857[$sp913e13])) >= 0; } public function identifyMode($sp913e13) { if ($sp913e13 >= strlen($this->dataStr)) { return QR_MODE_NUL; } $sp356855 = $this->dataStr[$sp913e13]; if (self::isdigitat($this->dataStr, $sp913e13)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $sp913e13)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($sp913e13 + 1 < strlen($this->dataStr)) { $sp494d81 = $this->dataStr[$sp913e13 + 1]; $sp9b7fd6 = ord($sp356855) << 8 | ord($sp494d81); if ($sp9b7fd6 >= 33088 && $sp9b7fd6 <= 40956 || $sp9b7fd6 >= 57408 && $sp9b7fd6 <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp394d52 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp6ee56f = 0; while (self::isdigitat($this->dataStr, $sp6ee56f)) { $sp6ee56f++; } $sp9ba81a = $sp6ee56f; $sp3206f6 = $this->identifyMode($sp6ee56f); if ($sp3206f6 == QR_MODE_8) { $sp6d90d8 = QRinput::estimateBitsModeNum($sp9ba81a) + 4 + $sp394d52 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp9ba81a + 1); if ($sp6d90d8 > 0) { return $this->eat8(); } } if ($sp3206f6 == QR_MODE_AN) { $sp6d90d8 = QRinput::estimateBitsModeNum($sp9ba81a) + 4 + $sp394d52 + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($sp9ba81a + 1); if ($sp6d90d8 > 0) { return $this->eatAn(); } } $spc8aebe = $this->input->append(QR_MODE_NUM, $sp9ba81a, str_split($this->dataStr)); if ($spc8aebe < 0) { return -1; } return $sp9ba81a; } public function eatAn() { $sp19b430 = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp394d52 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp6ee56f = 0; while (self::isalnumat($this->dataStr, $sp6ee56f)) { if (self::isdigitat($this->dataStr, $sp6ee56f)) { $spdda5a9 = $sp6ee56f; while (self::isdigitat($this->dataStr, $spdda5a9)) { $spdda5a9++; } $sp6d90d8 = QRinput::estimateBitsModeAn($sp6ee56f) + QRinput::estimateBitsModeNum($spdda5a9 - $sp6ee56f) + 4 + $sp394d52 - QRinput::estimateBitsModeAn($spdda5a9); if ($sp6d90d8 < 0) { break; } else { $sp6ee56f = $spdda5a9; } } else { $sp6ee56f++; } } $sp9ba81a = $sp6ee56f; if (!self::isalnumat($this->dataStr, $sp6ee56f)) { $sp6d90d8 = QRinput::estimateBitsModeAn($sp9ba81a) + 4 + $sp19b430 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp9ba81a + 1); if ($sp6d90d8 > 0) { return $this->eat8(); } } $spc8aebe = $this->input->append(QR_MODE_AN, $sp9ba81a, str_split($this->dataStr)); if ($spc8aebe < 0) { return -1; } return $sp9ba81a; } public function eatKanji() { $sp6ee56f = 0; while ($this->identifyMode($sp6ee56f) == QR_MODE_KANJI) { $sp6ee56f += 2; } $spc8aebe = $this->input->append(QR_MODE_KANJI, $sp6ee56f, str_split($this->dataStr)); if ($spc8aebe < 0) { return -1; } return $sp9ba81a; } public function eat8() { $sp19b430 = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp394d52 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp6ee56f = 1; $sp596f0a = strlen($this->dataStr); while ($sp6ee56f < $sp596f0a) { $sp3206f6 = $this->identifyMode($sp6ee56f); if ($sp3206f6 == QR_MODE_KANJI) { break; } if ($sp3206f6 == QR_MODE_NUM) { $spdda5a9 = $sp6ee56f; while (self::isdigitat($this->dataStr, $spdda5a9)) { $spdda5a9++; } $sp6d90d8 = QRinput::estimateBitsMode8($sp6ee56f) + QRinput::estimateBitsModeNum($spdda5a9 - $sp6ee56f) + 4 + $sp394d52 - QRinput::estimateBitsMode8($spdda5a9); if ($sp6d90d8 < 0) { break; } else { $sp6ee56f = $spdda5a9; } } else { if ($sp3206f6 == QR_MODE_AN) { $spdda5a9 = $sp6ee56f; while (self::isalnumat($this->dataStr, $spdda5a9)) { $spdda5a9++; } $sp6d90d8 = QRinput::estimateBitsMode8($sp6ee56f) + QRinput::estimateBitsModeAn($spdda5a9 - $sp6ee56f) + 4 + $sp19b430 - QRinput::estimateBitsMode8($spdda5a9); if ($sp6d90d8 < 0) { break; } else { $sp6ee56f = $spdda5a9; } } else { $sp6ee56f++; } } } $sp9ba81a = $sp6ee56f; $spc8aebe = $this->input->append(QR_MODE_8, $sp9ba81a, str_split($this->dataStr)); if ($spc8aebe < 0) { return -1; } return $sp9ba81a; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp3206f6 = $this->identifyMode(0); switch ($sp3206f6) { case QR_MODE_NUM: $sp58d92e = $this->eatNum(); break; case QR_MODE_AN: $sp58d92e = $this->eatAn(); break; case QR_MODE_KANJI: if ($spf47859 == QR_MODE_KANJI) { $sp58d92e = $this->eatKanji(); } else { $sp58d92e = $this->eat8(); } break; default: $sp58d92e = $this->eat8(); break; } if ($sp58d92e == 0) { return 0; } if ($sp58d92e < 0) { return -1; } $this->dataStr = substr($this->dataStr, $sp58d92e); } } public function toUpper() { $sp41f024 = strlen($this->dataStr); $sp6ee56f = 0; while ($sp6ee56f < $sp41f024) { $sp3206f6 = self::identifyMode(substr($this->dataStr, $sp6ee56f), $this->modeHint); if ($sp3206f6 == QR_MODE_KANJI) { $sp6ee56f += 2; } else { if (ord($this->dataStr[$sp6ee56f]) >= ord('a') && ord($this->dataStr[$sp6ee56f]) <= ord('z')) { $this->dataStr[$sp6ee56f] = chr(ord($this->dataStr[$sp6ee56f]) - 32); } $sp6ee56f++; } } return $this->dataStr; } public static function splitStringToQRinput($sp43dfb1, QRinput $sp51043b, $spb25909, $spe044e9 = true) { if (is_null($sp43dfb1) || $sp43dfb1 == '\\0' || $sp43dfb1 == '') { throw new Exception('empty string!!!'); } $sp2a84d5 = new QRsplit($sp43dfb1, $sp51043b, $spb25909); if (!$spe044e9) { $sp2a84d5->toUpper(); } return $sp2a84d5->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($sp71e916) { while ($sp71e916 >= $this->nn) { $sp71e916 -= $this->nn; $sp71e916 = ($sp71e916 >> $this->mm) + ($sp71e916 & $this->nn); } return $sp71e916; } public static function init_rs_char($spe356f9, $sp651773, $spe65193, $sp5e6e2c, $sp4ebb41, $spdf710a) { $sp08b3ba = null; if ($spe356f9 < 0 || $spe356f9 > 8) { return $sp08b3ba; } if ($spe65193 < 0 || $spe65193 >= 1 << $spe356f9) { return $sp08b3ba; } if ($sp5e6e2c <= 0 || $sp5e6e2c >= 1 << $spe356f9) { return $sp08b3ba; } if ($sp4ebb41 < 0 || $sp4ebb41 >= 1 << $spe356f9) { return $sp08b3ba; } if ($spdf710a < 0 || $spdf710a >= (1 << $spe356f9) - 1 - $sp4ebb41) { return $sp08b3ba; } $sp08b3ba = new QRrsItem(); $sp08b3ba->mm = $spe356f9; $sp08b3ba->nn = (1 << $spe356f9) - 1; $sp08b3ba->pad = $spdf710a; $sp08b3ba->alpha_to = array_fill(0, $sp08b3ba->nn + 1, 0); $sp08b3ba->index_of = array_fill(0, $sp08b3ba->nn + 1, 0); $spca4a14 =& $sp08b3ba->nn; $spa977d1 =& $spca4a14; $sp08b3ba->index_of[0] = $spa977d1; $sp08b3ba->alpha_to[$spa977d1] = 0; $spfa020d = 1; for ($sp1b7341 = 0; $sp1b7341 < $sp08b3ba->nn; $sp1b7341++) { $sp08b3ba->index_of[$spfa020d] = $sp1b7341; $sp08b3ba->alpha_to[$sp1b7341] = $spfa020d; $spfa020d <<= 1; if ($spfa020d & 1 << $spe356f9) { $spfa020d ^= $sp651773; } $spfa020d &= $sp08b3ba->nn; } if ($spfa020d != 1) { $sp08b3ba = NULL; return $sp08b3ba; } $sp08b3ba->genpoly = array_fill(0, $sp4ebb41 + 1, 0); $sp08b3ba->fcr = $spe65193; $sp08b3ba->prim = $sp5e6e2c; $sp08b3ba->nroots = $sp4ebb41; $sp08b3ba->gfpoly = $sp651773; for ($sp77665c = 1; $sp77665c % $sp5e6e2c != 0; $sp77665c += $sp08b3ba->nn) { } $sp08b3ba->iprim = (int) ($sp77665c / $sp5e6e2c); $sp08b3ba->genpoly[0] = 1; for ($sp1b7341 = 0, $sp98e010 = $spe65193 * $sp5e6e2c; $sp1b7341 < $sp4ebb41; $sp1b7341++, $sp98e010 += $sp5e6e2c) { $sp08b3ba->genpoly[$sp1b7341 + 1] = 1; for ($sp4502fa = $sp1b7341; $sp4502fa > 0; $sp4502fa--) { if ($sp08b3ba->genpoly[$sp4502fa] != 0) { $sp08b3ba->genpoly[$sp4502fa] = $sp08b3ba->genpoly[$sp4502fa - 1] ^ $sp08b3ba->alpha_to[$sp08b3ba->modnn($sp08b3ba->index_of[$sp08b3ba->genpoly[$sp4502fa]] + $sp98e010)]; } else { $sp08b3ba->genpoly[$sp4502fa] = $sp08b3ba->genpoly[$sp4502fa - 1]; } } $sp08b3ba->genpoly[0] = $sp08b3ba->alpha_to[$sp08b3ba->modnn($sp08b3ba->index_of[$sp08b3ba->genpoly[0]] + $sp98e010)]; } for ($sp1b7341 = 0; $sp1b7341 <= $sp4ebb41; $sp1b7341++) { $sp08b3ba->genpoly[$sp1b7341] = $sp08b3ba->index_of[$sp08b3ba->genpoly[$sp1b7341]]; } return $sp08b3ba; } public function encode_rs_char($sp1835de, &$sp121bb1) { $sp7fafbb =& $this->mm; $spca4a14 =& $this->nn; $spf7dcdc =& $this->alpha_to; $sp669504 =& $this->index_of; $spaee7e5 =& $this->genpoly; $spabbddf =& $this->nroots; $spedc64e =& $this->fcr; $spe43a64 =& $this->prim; $spcafffe =& $this->iprim; $sp94059b =& $this->pad; $spa977d1 =& $spca4a14; $sp121bb1 = array_fill(0, $spabbddf, 0); for ($sp1b7341 = 0; $sp1b7341 < $spca4a14 - $spabbddf - $sp94059b; $sp1b7341++) { $spb2c397 = $sp669504[$sp1835de[$sp1b7341] ^ $sp121bb1[0]]; if ($spb2c397 != $spa977d1) { $spb2c397 = $this->modnn($spca4a14 - $spaee7e5[$spabbddf] + $spb2c397); for ($sp4502fa = 1; $sp4502fa < $spabbddf; $sp4502fa++) { $sp121bb1[$sp4502fa] ^= $spf7dcdc[$this->modnn($spb2c397 + $spaee7e5[$spabbddf - $sp4502fa])]; } } array_shift($sp121bb1); if ($spb2c397 != $spa977d1) { array_push($sp121bb1, $spf7dcdc[$this->modnn($spb2c397 + $spaee7e5[0])]); } else { array_push($sp121bb1, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($spe356f9, $sp651773, $spe65193, $sp5e6e2c, $sp4ebb41, $spdf710a) { foreach (self::$items as $sp08b3ba) { if ($sp08b3ba->pad != $spdf710a) { continue; } if ($sp08b3ba->nroots != $sp4ebb41) { continue; } if ($sp08b3ba->mm != $spe356f9) { continue; } if ($sp08b3ba->gfpoly != $sp651773) { continue; } if ($sp08b3ba->fcr != $spe65193) { continue; } if ($sp08b3ba->prim != $sp5e6e2c) { continue; } return $sp08b3ba; } $sp08b3ba = QRrsItem::init_rs_char($spe356f9, $sp651773, $spe65193, $sp5e6e2c, $sp4ebb41, $spdf710a); array_unshift(self::$items, $sp08b3ba); return $sp08b3ba; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($sp0777ed, &$spad561d, $sp6c0ebb, $spa4e63d) { $spaf74b3 = 0; $spe9e29b = QRspec::getFormatInfo($sp6c0ebb, $spa4e63d); for ($sp1b7341 = 0; $sp1b7341 < 8; $sp1b7341++) { if ($spe9e29b & 1) { $spaf74b3 += 2; $sp651922 = 133; } else { $sp651922 = 132; } $spad561d[8][$sp0777ed - 1 - $sp1b7341] = chr($sp651922); if ($sp1b7341 < 6) { $spad561d[$sp1b7341][8] = chr($sp651922); } else { $spad561d[$sp1b7341 + 1][8] = chr($sp651922); } $spe9e29b = $spe9e29b >> 1; } for ($sp1b7341 = 0; $sp1b7341 < 7; $sp1b7341++) { if ($spe9e29b & 1) { $spaf74b3 += 2; $sp651922 = 133; } else { $sp651922 = 132; } $spad561d[$sp0777ed - 7 + $sp1b7341][8] = chr($sp651922); if ($sp1b7341 == 0) { $spad561d[8][7] = chr($sp651922); } else { $spad561d[8][6 - $sp1b7341] = chr($sp651922); } $spe9e29b = $spe9e29b >> 1; } return $spaf74b3; } public function mask0($sp71e916, $sp901fa8) { return $sp71e916 + $sp901fa8 & 1; } public function mask1($sp71e916, $sp901fa8) { return $sp901fa8 & 1; } public function mask2($sp71e916, $sp901fa8) { return $sp71e916 % 3; } public function mask3($sp71e916, $sp901fa8) { return ($sp71e916 + $sp901fa8) % 3; } public function mask4($sp71e916, $sp901fa8) { return (int) ($sp901fa8 / 2) + (int) ($sp71e916 / 3) & 1; } public function mask5($sp71e916, $sp901fa8) { return ($sp71e916 * $sp901fa8 & 1) + $sp71e916 * $sp901fa8 % 3; } public function mask6($sp71e916, $sp901fa8) { return ($sp71e916 * $sp901fa8 & 1) + $sp71e916 * $sp901fa8 % 3 & 1; } public function mask7($sp71e916, $sp901fa8) { return $sp71e916 * $sp901fa8 % 3 + ($sp71e916 + $sp901fa8 & 1) & 1; } private function generateMaskNo($spb939dd, $sp0777ed, $spad561d) { $spe54a1b = array_fill(0, $sp0777ed, array_fill(0, $sp0777ed, 0)); for ($sp901fa8 = 0; $sp901fa8 < $sp0777ed; $sp901fa8++) { for ($sp71e916 = 0; $sp71e916 < $sp0777ed; $sp71e916++) { if (ord($spad561d[$sp901fa8][$sp71e916]) & 128) { $spe54a1b[$sp901fa8][$sp71e916] = 0; } else { $sp639d78 = call_user_func(array($this, 'mask' . $spb939dd), $sp71e916, $sp901fa8); $spe54a1b[$sp901fa8][$sp71e916] = $sp639d78 == 0 ? 1 : 0; } } } return $spe54a1b; } public static function serial($sp574fcd) { $sp0acb55 = array(); foreach ($sp574fcd as $sp9ee6fd) { $sp0acb55[] = join('', $sp9ee6fd); } return gzcompress(join('
', $sp0acb55), 9); } public static function unserial($spd0703e) { $sp0acb55 = array(); $sp2a5453 = explode('
', gzuncompress($spd0703e)); foreach ($sp2a5453 as $sp9ee6fd) { $sp0acb55[] = str_split($sp9ee6fd); } return $sp0acb55; } public function makeMaskNo($spb939dd, $sp0777ed, $sp9da3e1, &$sp494d81, $spacbc55 = false) { $sp1c0919 = 0; $spe54a1b = array(); $sp4687d5 = QR_CACHE_DIR . 'mask_' . $spb939dd . DIRECTORY_SEPARATOR . 'mask_' . $sp0777ed . '_' . $spb939dd . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp4687d5)) { $spe54a1b = self::unserial(file_get_contents($sp4687d5)); } else { $spe54a1b = $this->generateMaskNo($spb939dd, $sp0777ed, $sp9da3e1, $sp494d81); if (!file_exists(QR_CACHE_DIR . 'mask_' . $spb939dd)) { mkdir(QR_CACHE_DIR . 'mask_' . $spb939dd); } file_put_contents($sp4687d5, self::serial($spe54a1b)); } } else { $spe54a1b = $this->generateMaskNo($spb939dd, $sp0777ed, $sp9da3e1, $sp494d81); } if ($spacbc55) { return; } $sp494d81 = $sp9da3e1; for ($sp901fa8 = 0; $sp901fa8 < $sp0777ed; $sp901fa8++) { for ($sp71e916 = 0; $sp71e916 < $sp0777ed; $sp71e916++) { if ($spe54a1b[$sp901fa8][$sp71e916] == 1) { $sp494d81[$sp901fa8][$sp71e916] = chr(ord($sp9da3e1[$sp901fa8][$sp71e916]) ^ (int) $spe54a1b[$sp901fa8][$sp71e916]); } $sp1c0919 += (int) (ord($sp494d81[$sp901fa8][$sp71e916]) & 1); } } return $sp1c0919; } public function makeMask($sp0777ed, $spad561d, $spb939dd, $spa4e63d) { $sp53553c = array_fill(0, $sp0777ed, str_repeat(' ', $sp0777ed)); $this->makeMaskNo($spb939dd, $sp0777ed, $spad561d, $sp53553c); $this->writeFormatInformation($sp0777ed, $sp53553c, $spb939dd, $spa4e63d); return $sp53553c; } public function calcN1N3($sp58d92e) { $sp949020 = 0; for ($sp1b7341 = 0; $sp1b7341 < $sp58d92e; $sp1b7341++) { if ($this->runLength[$sp1b7341] >= 5) { $sp949020 += N1 + ($this->runLength[$sp1b7341] - 5); } if ($sp1b7341 & 1) { if ($sp1b7341 >= 3 && $sp1b7341 < $sp58d92e - 2 && $this->runLength[$sp1b7341] % 3 == 0) { $spa89c98 = (int) ($this->runLength[$sp1b7341] / 3); if ($this->runLength[$sp1b7341 - 2] == $spa89c98 && $this->runLength[$sp1b7341 - 1] == $spa89c98 && $this->runLength[$sp1b7341 + 1] == $spa89c98 && $this->runLength[$sp1b7341 + 2] == $spa89c98) { if ($this->runLength[$sp1b7341 - 3] < 0 || $this->runLength[$sp1b7341 - 3] >= 4 * $spa89c98) { $sp949020 += N3; } else { if ($sp1b7341 + 3 >= $sp58d92e || $this->runLength[$sp1b7341 + 3] >= 4 * $spa89c98) { $sp949020 += N3; } } } } } } return $sp949020; } public function evaluateSymbol($sp0777ed, $spad561d) { $spc1ff2e = 0; $sp949020 = 0; for ($sp901fa8 = 0; $sp901fa8 < $sp0777ed; $sp901fa8++) { $spc1ff2e = 0; $this->runLength[0] = 1; $sp4ed925 = $spad561d[$sp901fa8]; if ($sp901fa8 > 0) { $sp168a96 = $spad561d[$sp901fa8 - 1]; } for ($sp71e916 = 0; $sp71e916 < $sp0777ed; $sp71e916++) { if ($sp71e916 > 0 && $sp901fa8 > 0) { $sp36965f = ord($sp4ed925[$sp71e916]) & ord($sp4ed925[$sp71e916 - 1]) & ord($sp168a96[$sp71e916]) & ord($sp168a96[$sp71e916 - 1]); $sp0b7f2f = ord($sp4ed925[$sp71e916]) | ord($sp4ed925[$sp71e916 - 1]) | ord($sp168a96[$sp71e916]) | ord($sp168a96[$sp71e916 - 1]); if (($sp36965f | $sp0b7f2f ^ 1) & 1) { $sp949020 += N2; } } if ($sp71e916 == 0 && ord($sp4ed925[$sp71e916]) & 1) { $this->runLength[0] = -1; $spc1ff2e = 1; $this->runLength[$spc1ff2e] = 1; } else { if ($sp71e916 > 0) { if ((ord($sp4ed925[$sp71e916]) ^ ord($sp4ed925[$sp71e916 - 1])) & 1) { $spc1ff2e++; $this->runLength[$spc1ff2e] = 1; } else { $this->runLength[$spc1ff2e]++; } } } } $sp949020 += $this->calcN1N3($spc1ff2e + 1); } for ($sp71e916 = 0; $sp71e916 < $sp0777ed; $sp71e916++) { $spc1ff2e = 0; $this->runLength[0] = 1; for ($sp901fa8 = 0; $sp901fa8 < $sp0777ed; $sp901fa8++) { if ($sp901fa8 == 0 && ord($spad561d[$sp901fa8][$sp71e916]) & 1) { $this->runLength[0] = -1; $spc1ff2e = 1; $this->runLength[$spc1ff2e] = 1; } else { if ($sp901fa8 > 0) { if ((ord($spad561d[$sp901fa8][$sp71e916]) ^ ord($spad561d[$sp901fa8 - 1][$sp71e916])) & 1) { $spc1ff2e++; $this->runLength[$spc1ff2e] = 1; } else { $this->runLength[$spc1ff2e]++; } } } } $sp949020 += $this->calcN1N3($spc1ff2e + 1); } return $sp949020; } public function mask($sp0777ed, $spad561d, $spa4e63d) { $sp868ab9 = PHP_INT_MAX; $sp245e47 = 0; $speeab22 = array(); $spc75e37 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp5012de = 8 - QR_FIND_FROM_RANDOM % 9; for ($sp1b7341 = 0; $sp1b7341 < $sp5012de; $sp1b7341++) { $spb879d9 = rand(0, count($spc75e37) - 1); unset($spc75e37[$spb879d9]); $spc75e37 = array_values($spc75e37); } } $speeab22 = $spad561d; foreach ($spc75e37 as $sp1b7341) { $sp6c0ebb = array_fill(0, $sp0777ed, str_repeat(' ', $sp0777ed)); $sp949020 = 0; $spaf74b3 = 0; $spaf74b3 = $this->makeMaskNo($sp1b7341, $sp0777ed, $spad561d, $sp6c0ebb); $spaf74b3 += $this->writeFormatInformation($sp0777ed, $sp6c0ebb, $sp1b7341, $spa4e63d); $spaf74b3 = (int) (100 * $spaf74b3 / ($sp0777ed * $sp0777ed)); $sp949020 = (int) ((int) (abs($spaf74b3 - 50) / 5) * N4); $sp949020 += $this->evaluateSymbol($sp0777ed, $sp6c0ebb); if ($sp949020 < $sp868ab9) { $sp868ab9 = $sp949020; $speeab22 = $sp6c0ebb; $sp245e47 = $sp1b7341; } } return $speeab22; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($spee16eb, $sp1835de, $spf58585, &$sp546fa8, QRrsItem $sp08b3ba) { $sp08b3ba->encode_rs_char($sp1835de, $sp546fa8); $this->dataLength = $spee16eb; $this->data = $sp1835de; $this->eccLength = $spf58585; $this->ecc = $sp546fa8; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp51043b) { $spa23afb = array(0, 0, 0, 0, 0); $this->datacode = $sp51043b->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp51043b->getVersion(), $sp51043b->getErrorCorrectionLevel(), $spa23afb); $this->version = $sp51043b->getVersion(); $this->b1 = QRspec::rsBlockNum1($spa23afb); $this->dataLength = QRspec::rsDataLength($spa23afb); $this->eccLength = QRspec::rsEccLength($spa23afb); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($spa23afb); $spc8aebe = $this->init($spa23afb); if ($spc8aebe < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $spa23afb) { $spee16eb = QRspec::rsDataCodes1($spa23afb); $spf58585 = QRspec::rsEccCodes1($spa23afb); $sp08b3ba = QRrs::init_rs(8, 285, 0, 1, $spf58585, 255 - $spee16eb - $spf58585); $sp55ab0c = 0; $sp592322 = 0; $sp571dce = 0; for ($sp1b7341 = 0; $sp1b7341 < QRspec::rsBlockNum1($spa23afb); $sp1b7341++) { $sp546fa8 = array_slice($this->ecccode, $sp571dce); $this->rsblocks[$sp55ab0c] = new QRrsblock($spee16eb, array_slice($this->datacode, $sp592322), $spf58585, $sp546fa8, $sp08b3ba); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp571dce), $sp546fa8); $sp592322 += $spee16eb; $sp571dce += $spf58585; $sp55ab0c++; } if (QRspec::rsBlockNum2($spa23afb) == 0) { return 0; } $spee16eb = QRspec::rsDataCodes2($spa23afb); $spf58585 = QRspec::rsEccCodes2($spa23afb); $sp08b3ba = QRrs::init_rs(8, 285, 0, 1, $spf58585, 255 - $spee16eb - $spf58585); if ($sp08b3ba == NULL) { return -1; } for ($sp1b7341 = 0; $sp1b7341 < QRspec::rsBlockNum2($spa23afb); $sp1b7341++) { $sp546fa8 = array_slice($this->ecccode, $sp571dce); $this->rsblocks[$sp55ab0c] = new QRrsblock($spee16eb, array_slice($this->datacode, $sp592322), $spf58585, $sp546fa8, $sp08b3ba); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp571dce), $sp546fa8); $sp592322 += $spee16eb; $sp571dce += $spf58585; $sp55ab0c++; } return 0; } public function getCode() { $spc8aebe; if ($this->count < $this->dataLength) { $sp6a22f3 = $this->count % $this->blocks; $sp53cc4e = $this->count / $this->blocks; if ($sp53cc4e >= $this->rsblocks[0]->dataLength) { $sp6a22f3 += $this->b1; } $spc8aebe = $this->rsblocks[$sp6a22f3]->data[$sp53cc4e]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp6a22f3 = ($this->count - $this->dataLength) % $this->blocks; $sp53cc4e = ($this->count - $this->dataLength) / $this->blocks; $spc8aebe = $this->rsblocks[$sp6a22f3]->ecc[$sp53cc4e]; } else { return 0; } } $this->count++; return $spc8aebe; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp51043b, $sp6c0ebb) { if ($sp51043b->getVersion() < 0 || $sp51043b->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp51043b->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $spb80ca5 = new QRrawcode($sp51043b); QRtools::markTime('after_raw'); $spb091dd = $spb80ca5->version; $sp0777ed = QRspec::getWidth($spb091dd); $spad561d = QRspec::newFrame($spb091dd); $spde8f4b = new FrameFiller($sp0777ed, $spad561d); if (is_null($spde8f4b)) { return NULL; } for ($sp1b7341 = 0; $sp1b7341 < $spb80ca5->dataLength + $spb80ca5->eccLength; $sp1b7341++) { $spd0703e = $spb80ca5->getCode(); $sp72866e = 128; for ($sp4502fa = 0; $sp4502fa < 8; $sp4502fa++) { $sp4d0fa1 = $spde8f4b->next(); $spde8f4b->setFrameAt($sp4d0fa1, 2 | ($sp72866e & $spd0703e) != 0); $sp72866e = $sp72866e >> 1; } } QRtools::markTime('after_filler'); unset($spb80ca5); $sp4502fa = QRspec::getRemainder($spb091dd); for ($sp1b7341 = 0; $sp1b7341 < $sp4502fa; $sp1b7341++) { $sp4d0fa1 = $spde8f4b->next(); $spde8f4b->setFrameAt($sp4d0fa1, 2); } $spad561d = $spde8f4b->frame; unset($spde8f4b); $sp3c2f2d = new QRmask(); if ($sp6c0ebb < 0) { if (QR_FIND_BEST_MASK) { $sp53553c = $sp3c2f2d->mask($sp0777ed, $spad561d, $sp51043b->getErrorCorrectionLevel()); } else { $sp53553c = $sp3c2f2d->makeMask($sp0777ed, $spad561d, intval(QR_DEFAULT_MASK) % 8, $sp51043b->getErrorCorrectionLevel()); } } else { $sp53553c = $sp3c2f2d->makeMask($sp0777ed, $spad561d, $sp6c0ebb, $sp51043b->getErrorCorrectionLevel()); } if ($sp53553c == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $spb091dd; $this->width = $sp0777ed; $this->data = $sp53553c; return $this; } public function encodeInput(QRinput $sp51043b) { return $this->encodeMask($sp51043b, -1); } public function encodeString8bit($sp43dfb1, $spb091dd, $spa4e63d) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp51043b = new QRinput($spb091dd, $spa4e63d); if ($sp51043b == NULL) { return NULL; } $spc8aebe = $sp51043b->append($sp51043b, QR_MODE_8, strlen($sp43dfb1), str_split($sp43dfb1)); if ($spc8aebe < 0) { unset($sp51043b); return NULL; } return $this->encodeInput($sp51043b); } public function encodeString($sp43dfb1, $spb091dd, $spa4e63d, $spf47859, $spe044e9) { if ($spf47859 != QR_MODE_8 && $spf47859 != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp51043b = new QRinput($spb091dd, $spa4e63d); if ($sp51043b == NULL) { return NULL; } $spc8aebe = QRsplit::splitStringToQRinput($sp43dfb1, $sp51043b, $spf47859, $spe044e9); if ($spc8aebe < 0) { return NULL; } return $this->encodeInput($sp51043b); } public static function png($spd65dab, $sp1bcba8 = false, $spa4e63d = QR_ECLEVEL_L, $sp434ee2 = 3, $sp739904 = 4, $sp2a5800 = false) { $sp548486 = QRencode::factory($spa4e63d, $sp434ee2, $sp739904); return $sp548486->encodePNG($spd65dab, $sp1bcba8, $sp2a5800 = false); } public static function text($spd65dab, $sp1bcba8 = false, $spa4e63d = QR_ECLEVEL_L, $sp434ee2 = 3, $sp739904 = 4) { $sp548486 = QRencode::factory($spa4e63d, $sp434ee2, $sp739904); return $sp548486->encode($spd65dab, $sp1bcba8); } public static function raw($spd65dab, $sp1bcba8 = false, $spa4e63d = QR_ECLEVEL_L, $sp434ee2 = 3, $sp739904 = 4) { $sp548486 = QRencode::factory($spa4e63d, $sp434ee2, $sp739904); return $sp548486->encodeRAW($spd65dab, $sp1bcba8); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($sp0777ed, &$spad561d) { $this->width = $sp0777ed; $this->frame = $spad561d; $this->x = $sp0777ed - 1; $this->y = $sp0777ed - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp2bbf60, $spc28c86) { $this->frame[$sp2bbf60['y']][$sp2bbf60['x']] = chr($spc28c86); } public function getFrameAt($sp2bbf60) { return ord($this->frame[$sp2bbf60['y']][$sp2bbf60['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $sp71e916 = $this->x; $sp901fa8 = $this->y; $spa45800 = $this->width; if ($this->bit == 0) { $sp71e916--; $this->bit++; } else { $sp71e916++; $sp901fa8 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($sp901fa8 < 0) { $sp901fa8 = 0; $sp71e916 -= 2; $this->dir = 1; if ($sp71e916 == 6) { $sp71e916--; $sp901fa8 = 9; } } } else { if ($sp901fa8 == $spa45800) { $sp901fa8 = $spa45800 - 1; $sp71e916 -= 2; $this->dir = -1; if ($sp71e916 == 6) { $sp71e916--; $sp901fa8 -= 8; } } } if ($sp71e916 < 0 || $sp901fa8 < 0) { return null; } $this->x = $sp71e916; $this->y = $sp901fa8; } while (ord($this->frame[$sp901fa8][$sp71e916]) & 128); return array('x' => $sp71e916, 'y' => $sp901fa8); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($spa4e63d = QR_ECLEVEL_L, $sp434ee2 = 3, $sp739904 = 4) { $sp548486 = new QRencode(); $sp548486->size = $sp434ee2; $sp548486->margin = $sp739904; switch ($spa4e63d . '') { case '0': case '1': case '2': case '3': $sp548486->level = $spa4e63d; break; case 'l': case 'L': $sp548486->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp548486->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp548486->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp548486->level = QR_ECLEVEL_H; break; } return $sp548486; } public function encodeRAW($sp573b75, $sp1bcba8 = false) { $spd0703e = new QRcode(); if ($this->eightbit) { $spd0703e->encodeString8bit($sp573b75, $this->version, $this->level); } else { $spd0703e->encodeString($sp573b75, $this->version, $this->level, $this->hint, $this->casesensitive); } return $spd0703e->data; } public function encode($sp573b75, $sp1bcba8 = false) { $spd0703e = new QRcode(); if ($this->eightbit) { $spd0703e->encodeString8bit($sp573b75, $this->version, $this->level); } else { $spd0703e->encodeString($sp573b75, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($sp1bcba8 !== false) { file_put_contents($sp1bcba8, join('
', QRtools::binarize($spd0703e->data))); } else { return QRtools::binarize($spd0703e->data); } } public function encodePNG($sp573b75, $sp1bcba8 = false, $sp2a5800 = false) { try { ob_start(); $spf1b177 = $this->encode($sp573b75); $sp670748 = ob_get_contents(); ob_end_clean(); if ($sp670748 != '') { QRtools::log($sp1bcba8, $sp670748); } $sp24a44d = (int) (QR_PNG_MAXIMUM_SIZE / (count($spf1b177) + 2 * $this->margin)); QRimage::png($spf1b177, $sp1bcba8, min(max(1, $this->size), $sp24a44d), $this->margin, $sp2a5800); } catch (Exception $sp2a4a9a) { QRtools::log($sp1bcba8, $sp2a4a9a->getMessage()); } } }