<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$sp9d090a, $sp8bb6f8, $spa1efa3, $spb92953, $spdf9732 = false) { $sp9d090a[$spa1efa3] = substr_replace($sp9d090a[$spa1efa3], $spdf9732 !== false ? substr($spb92953, 0, $spdf9732) : $spb92953, $sp8bb6f8, $spdf9732 !== false ? $spdf9732 : strlen($spb92953)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp22ba36) { $spdb1861 = count($sp22ba36); foreach ($sp22ba36 as &$sp8e45a4) { for ($sp836a84 = 0; $sp836a84 < $spdb1861; $sp836a84++) { $sp8e45a4[$sp836a84] = ord($sp8e45a4[$sp836a84]) & 1 ? '1' : '0'; } } return $sp22ba36; } public static function tcpdfBarcodeArray($sp808526, $sp87d99e = 'QR,L', $sp48904d = '4.5.037') { $sp09ab6b = array(); if (!is_array($sp87d99e)) { $sp87d99e = explode(',', $sp87d99e); } $sp2c96f8 = 'L'; if (count($sp87d99e) > 1) { $sp2c96f8 = $sp87d99e[1]; } $sp9cbd7e = QRcode::text($sp808526, false, $sp2c96f8); $sp74dd26 = count($sp9cbd7e); $sp09ab6b['num_rows'] = $sp74dd26; $sp09ab6b['num_cols'] = $sp74dd26; $sp09ab6b['bcode'] = array(); foreach ($sp9cbd7e as $spa3d810) { $spc978ac = array(); foreach (str_split($spa3d810) as $spff3536) { $spc978ac[] = $spff3536 == '1' ? 1 : 0; } $sp09ab6b['bcode'][] = $spc978ac; } return $sp09ab6b; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp7d079f = new QRmask(); for ($spba89fc = 1; $spba89fc <= QRSPEC_VERSION_MAX; $spba89fc++) { $sp22ba36 = QRspec::newFrame($spba89fc); if (QR_IMAGE) { $spc63eef = QR_CACHE_DIR . 'frame_' . $spba89fc . '.png'; QRimage::png(self::binarize($sp22ba36), $spc63eef, 1, 0); } $spe3910d = count($sp22ba36); $sp69091c = array_fill(0, $spe3910d, array_fill(0, $spe3910d, 0)); for ($sp0570db = 0; $sp0570db < 8; $sp0570db++) { $sp7d079f->makeMaskNo($sp0570db, $spe3910d, $sp22ba36, $sp69091c, true); } } QRtools::markTime('after_build_cache'); } public static function log($sp345ad4, $sp9e0e41) { if (QR_LOG_DIR !== false) { if ($sp9e0e41 != '') { if ($sp345ad4 !== false) { file_put_contents(QR_LOG_DIR . basename($sp345ad4) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $sp9e0e41, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $sp9e0e41, FILE_APPEND); } } } } public static function dumpMask($sp22ba36) { $spe3910d = count($sp22ba36); for ($spa1efa3 = 0; $spa1efa3 < $spe3910d; $spa1efa3++) { for ($sp8bb6f8 = 0; $sp8bb6f8 < $spe3910d; $sp8bb6f8++) { echo ord($sp22ba36[$spa1efa3][$sp8bb6f8]) . ','; } } } public static function markTime($sp0dae72) { list($spac235b, $spf37f6b) = explode(' ', microtime()); $sp930fdf = (double) $spac235b + (double) $spf37f6b; if (!isset($sp1852bd['qr_time_bench'])) { $sp1852bd['qr_time_bench'] = array(); } $sp1852bd['qr_time_bench'][$sp0dae72] = $sp930fdf; } public static function timeBenchmark() { self::markTime('finish'); $sp4a2138 = 0; $spa0f865 = 0; $sp617759 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($sp1852bd['qr_time_bench'] as $sp0dae72 => $spd8be41) { if ($sp617759 > 0) { echo '<tr><th style="text-align:right">till ' . $sp0dae72 . ': </th><td>' . number_format($spd8be41 - $sp4a2138, 6) . 's</td></tr>'; } else { $spa0f865 = $spd8be41; } $sp617759++; $sp4a2138 = $spd8be41; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp4a2138 - $spa0f865, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($sp1fa9d0, $spde70db) { return self::$capacity[$sp1fa9d0][QRCAP_WORDS] - self::$capacity[$sp1fa9d0][QRCAP_EC][$spde70db]; } public static function getECCLength($sp1fa9d0, $spde70db) { return self::$capacity[$sp1fa9d0][QRCAP_EC][$spde70db]; } public static function getWidth($sp1fa9d0) { return self::$capacity[$sp1fa9d0][QRCAP_WIDTH]; } public static function getRemainder($sp1fa9d0) { return self::$capacity[$sp1fa9d0][QRCAP_REMINDER]; } public static function getMinimumVersion($sp74dd26, $spde70db) { for ($sp836a84 = 1; $sp836a84 <= QRSPEC_VERSION_MAX; $sp836a84++) { $sp20eee6 = self::$capacity[$sp836a84][QRCAP_WORDS] - self::$capacity[$sp836a84][QRCAP_EC][$spde70db]; if ($sp20eee6 >= $sp74dd26) { return $sp836a84; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp87d99e, $sp1fa9d0) { if ($sp87d99e == QR_MODE_STRUCTURE) { return 0; } if ($sp1fa9d0 <= 9) { $sp132363 = 0; } else { if ($sp1fa9d0 <= 26) { $sp132363 = 1; } else { $sp132363 = 2; } } return self::$lengthTableBits[$sp87d99e][$sp132363]; } public static function maximumWords($sp87d99e, $sp1fa9d0) { if ($sp87d99e == QR_MODE_STRUCTURE) { return 3; } if ($sp1fa9d0 <= 9) { $sp132363 = 0; } else { if ($sp1fa9d0 <= 26) { $sp132363 = 1; } else { $sp132363 = 2; } } $spebb2c3 = self::$lengthTableBits[$sp87d99e][$sp132363]; $sp20eee6 = (1 << $spebb2c3) - 1; if ($sp87d99e == QR_MODE_KANJI) { $sp20eee6 *= 2; } return $sp20eee6; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($sp1fa9d0, $spde70db, array &$sp4f9ad1) { if (count($sp4f9ad1) < 5) { $sp4f9ad1 = array(0, 0, 0, 0, 0); } $spb59c2d = self::$eccTable[$sp1fa9d0][$spde70db][0]; $spa25481 = self::$eccTable[$sp1fa9d0][$spde70db][1]; $sp38c5ae = self::getDataLength($sp1fa9d0, $spde70db); $sp195f11 = self::getECCLength($sp1fa9d0, $spde70db); if ($spa25481 == 0) { $sp4f9ad1[0] = $spb59c2d; $sp4f9ad1[1] = (int) ($sp38c5ae / $spb59c2d); $sp4f9ad1[2] = (int) ($sp195f11 / $spb59c2d); $sp4f9ad1[3] = 0; $sp4f9ad1[4] = 0; } else { $sp4f9ad1[0] = $spb59c2d; $sp4f9ad1[1] = (int) ($sp38c5ae / ($spb59c2d + $spa25481)); $sp4f9ad1[2] = (int) ($sp195f11 / ($spb59c2d + $spa25481)); $sp4f9ad1[3] = $spa25481; $sp4f9ad1[4] = $sp4f9ad1[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp22ba36, $spce7e1a, $spfb8912) { $sped049b = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp324bc0 = $spfb8912 - 2; $sp176291 = $spce7e1a - 2; for ($spa1efa3 = 0; $spa1efa3 < 5; $spa1efa3++) { QRstr::set($sp22ba36, $sp176291, $sp324bc0 + $spa1efa3, $sped049b[$spa1efa3]); } } public static function putAlignmentPattern($sp1fa9d0, &$sp22ba36, $spe3910d) { if ($sp1fa9d0 < 2) { return; } $sp8b7b9f = self::$alignmentPattern[$sp1fa9d0][1] - self::$alignmentPattern[$sp1fa9d0][0]; if ($sp8b7b9f < 0) { $spee7918 = 2; } else { $spee7918 = (int) (($spe3910d - self::$alignmentPattern[$sp1fa9d0][0]) / $sp8b7b9f + 2); } if ($spee7918 * $spee7918 - 3 == 1) { $sp8bb6f8 = self::$alignmentPattern[$sp1fa9d0][0]; $spa1efa3 = self::$alignmentPattern[$sp1fa9d0][0]; self::putAlignmentMarker($sp22ba36, $sp8bb6f8, $spa1efa3); return; } $spd38ce1 = self::$alignmentPattern[$sp1fa9d0][0]; for ($sp8bb6f8 = 1; $sp8bb6f8 < $spee7918 - 1; $sp8bb6f8++) { self::putAlignmentMarker($sp22ba36, 6, $spd38ce1); self::putAlignmentMarker($sp22ba36, $spd38ce1, 6); $spd38ce1 += $sp8b7b9f; } $spa098ab = self::$alignmentPattern[$sp1fa9d0][0]; for ($spa1efa3 = 0; $spa1efa3 < $spee7918 - 1; $spa1efa3++) { $spd38ce1 = self::$alignmentPattern[$sp1fa9d0][0]; for ($sp8bb6f8 = 0; $sp8bb6f8 < $spee7918 - 1; $sp8bb6f8++) { self::putAlignmentMarker($sp22ba36, $spd38ce1, $spa098ab); $spd38ce1 += $sp8b7b9f; } $spa098ab += $sp8b7b9f; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($sp1fa9d0) { if ($sp1fa9d0 < 7 || $sp1fa9d0 > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$sp1fa9d0 - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp7d079f, $spde70db) { if ($sp7d079f < 0 || $sp7d079f > 7) { return 0; } if ($spde70db < 0 || $spde70db > 3) { return 0; } return self::$formatInfo[$spde70db][$sp7d079f]; } public static $frames = array(); public static function putFinderPattern(&$sp22ba36, $spce7e1a, $spfb8912) { $sped049b = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($spa1efa3 = 0; $spa1efa3 < 7; $spa1efa3++) { QRstr::set($sp22ba36, $spce7e1a, $spfb8912 + $spa1efa3, $sped049b[$spa1efa3]); } } public static function createFrame($sp1fa9d0) { $spe3910d = self::$capacity[$sp1fa9d0][QRCAP_WIDTH]; $sp8e45a4 = str_repeat(' ', $spe3910d); $sp22ba36 = array_fill(0, $spe3910d, $sp8e45a4); self::putFinderPattern($sp22ba36, 0, 0); self::putFinderPattern($sp22ba36, $spe3910d - 7, 0); self::putFinderPattern($sp22ba36, 0, $spe3910d - 7); $sp973db5 = $spe3910d - 7; for ($spa1efa3 = 0; $spa1efa3 < 7; $spa1efa3++) { $sp22ba36[$spa1efa3][7] = '¿'; $sp22ba36[$spa1efa3][$spe3910d - 8] = '¿'; $sp22ba36[$sp973db5][7] = '¿'; $sp973db5++; } $sp19ab8a = str_repeat('¿', 8); QRstr::set($sp22ba36, 0, 7, $sp19ab8a); QRstr::set($sp22ba36, $spe3910d - 8, 7, $sp19ab8a); QRstr::set($sp22ba36, 0, $spe3910d - 8, $sp19ab8a); $sp19ab8a = str_repeat('Ñ', 9); QRstr::set($sp22ba36, 0, 8, $sp19ab8a); QRstr::set($sp22ba36, $spe3910d - 8, 8, $sp19ab8a, 8); $sp973db5 = $spe3910d - 8; for ($spa1efa3 = 0; $spa1efa3 < 8; $spa1efa3++, $sp973db5++) { $sp22ba36[$spa1efa3][8] = 'Ñ'; $sp22ba36[$sp973db5][8] = 'Ñ'; } for ($sp836a84 = 1; $sp836a84 < $spe3910d - 15; $sp836a84++) { $sp22ba36[6][7 + $sp836a84] = chr(144 | $sp836a84 & 1); $sp22ba36[7 + $sp836a84][6] = chr(144 | $sp836a84 & 1); } self::putAlignmentPattern($sp1fa9d0, $sp22ba36, $spe3910d); if ($sp1fa9d0 >= 7) { $sp98ebd3 = self::getVersionPattern($sp1fa9d0); $sp398610 = $sp98ebd3; for ($sp8bb6f8 = 0; $sp8bb6f8 < 6; $sp8bb6f8++) { for ($spa1efa3 = 0; $spa1efa3 < 3; $spa1efa3++) { $sp22ba36[$spe3910d - 11 + $spa1efa3][$sp8bb6f8] = chr(136 | $sp398610 & 1); $sp398610 = $sp398610 >> 1; } } $sp398610 = $sp98ebd3; for ($spa1efa3 = 0; $spa1efa3 < 6; $spa1efa3++) { for ($sp8bb6f8 = 0; $sp8bb6f8 < 3; $sp8bb6f8++) { $sp22ba36[$spa1efa3][$sp8bb6f8 + ($spe3910d - 11)] = chr(136 | $sp398610 & 1); $sp398610 = $sp398610 >> 1; } } } $sp22ba36[$spe3910d - 8][8] = 'Å'; return $sp22ba36; } public static function debug($sp22ba36, $sp506acb = false) { if ($sp506acb) { foreach ($sp22ba36 as &$sp8e45a4) { $sp8e45a4 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $sp8e45a4)); $sp8e45a4 = join('&#9608;&#9608;', explode('1', $sp8e45a4)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp22ba36); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp22ba36 as &$sp8e45a4) { $sp8e45a4 = join('<span class="m">&nbsp;</span>', explode('¿', $sp8e45a4)); $sp8e45a4 = join('<span class="m">&#9618;</span>', explode('¡', $sp8e45a4)); $sp8e45a4 = join('<span class="p">&nbsp;</span>', explode('†', $sp8e45a4)); $sp8e45a4 = join('<span class="p">&#9618;</span>', explode('°', $sp8e45a4)); $sp8e45a4 = join('<span class="s">&#9671;</span>', explode('Ñ', $sp8e45a4)); $sp8e45a4 = join('<span class="s">&#9670;</span>', explode('Ö', $sp8e45a4)); $sp8e45a4 = join('<span class="x">&#9762;</span>', explode('Å', $sp8e45a4)); $sp8e45a4 = join('<span class="c">&nbsp;</span>', explode('ê', $sp8e45a4)); $sp8e45a4 = join('<span class="c">&#9719;</span>', explode('ë', $sp8e45a4)); $sp8e45a4 = join('<span class="f">&nbsp;</span>', explode('à', $sp8e45a4)); $sp8e45a4 = join('<span class="f">&#9618;</span>', explode('â', $sp8e45a4)); $sp8e45a4 = join('&#9830;', explode('', $sp8e45a4)); $sp8e45a4 = join('&#8901;', explode(' ', $sp8e45a4)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp22ba36); echo '</tt></pre>'; } } public static function serial($sp22ba36) { return gzcompress(join('
', $sp22ba36), 9); } public static function unserial($sp808526) { return explode('
', gzuncompress($sp808526)); } public static function newFrame($sp1fa9d0) { if ($sp1fa9d0 < 1 || $sp1fa9d0 > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$sp1fa9d0])) { $spc63eef = QR_CACHE_DIR . 'frame_' . $sp1fa9d0 . '.dat'; if (QR_CACHEABLE) { if (file_exists($spc63eef)) { self::$frames[$sp1fa9d0] = self::unserial(file_get_contents($spc63eef)); } else { self::$frames[$sp1fa9d0] = self::createFrame($sp1fa9d0); file_put_contents($spc63eef, self::serial(self::$frames[$sp1fa9d0])); } } else { self::$frames[$sp1fa9d0] = self::createFrame($sp1fa9d0); } } if (is_null(self::$frames[$sp1fa9d0])) { return null; } return self::$frames[$sp1fa9d0]; } public static function rsBlockNum($sp4f9ad1) { return $sp4f9ad1[0] + $sp4f9ad1[3]; } public static function rsBlockNum1($sp4f9ad1) { return $sp4f9ad1[0]; } public static function rsDataCodes1($sp4f9ad1) { return $sp4f9ad1[1]; } public static function rsEccCodes1($sp4f9ad1) { return $sp4f9ad1[2]; } public static function rsBlockNum2($sp4f9ad1) { return $sp4f9ad1[3]; } public static function rsDataCodes2($sp4f9ad1) { return $sp4f9ad1[4]; } public static function rsEccCodes2($sp4f9ad1) { return $sp4f9ad1[2]; } public static function rsDataLength($sp4f9ad1) { return $sp4f9ad1[0] * $sp4f9ad1[1] + $sp4f9ad1[3] * $sp4f9ad1[4]; } public static function rsEccLength($sp4f9ad1) { return ($sp4f9ad1[0] + $sp4f9ad1[3]) * $sp4f9ad1[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp22ba36, $sp3aae7a = false, $spd8bef8 = 4, $spafbb47 = 4, $spcdd83a = FALSE) { $spdd1fb2 = self::image($sp22ba36, $spd8bef8, $spafbb47); if ($sp3aae7a === false) { Header('Content-type: image/png'); ImagePng($spdd1fb2); } else { if ($spcdd83a === TRUE) { ImagePng($spdd1fb2, $sp3aae7a); header('Content-type: image/png'); ImagePng($spdd1fb2); } else { ImagePng($spdd1fb2, $sp3aae7a); } } ImageDestroy($spdd1fb2); } public static function jpg($sp22ba36, $sp3aae7a = false, $spd8bef8 = 8, $spafbb47 = 4, $sp8ab1f4 = 85) { $spdd1fb2 = self::image($sp22ba36, $spd8bef8, $spafbb47); if ($sp3aae7a === false) { Header('Content-type: image/jpeg'); ImageJpeg($spdd1fb2, null, $sp8ab1f4); } else { ImageJpeg($spdd1fb2, $sp3aae7a, $sp8ab1f4); } ImageDestroy($spdd1fb2); } private static function image($sp22ba36, $spd8bef8 = 4, $spafbb47 = 4) { $sp2840dc = count($sp22ba36); $spee7918 = strlen($sp22ba36[0]); $sp5be1aa = $spee7918 + 2 * $spafbb47; $sp1a00c5 = $sp2840dc + 2 * $spafbb47; $spf12d3b = ImageCreate($sp5be1aa, $sp1a00c5); $sp071907[0] = ImageColorAllocate($spf12d3b, 255, 255, 255); $sp071907[1] = ImageColorAllocate($spf12d3b, 0, 0, 0); imagefill($spf12d3b, 0, 0, $sp071907[0]); for ($spa1efa3 = 0; $spa1efa3 < $sp2840dc; $spa1efa3++) { for ($sp8bb6f8 = 0; $sp8bb6f8 < $spee7918; $sp8bb6f8++) { if ($sp22ba36[$spa1efa3][$sp8bb6f8] == '1') { ImageSetPixel($spf12d3b, $sp8bb6f8 + $spafbb47, $spa1efa3 + $spafbb47, $sp071907[1]); } } } $sp40af70 = ImageCreate($sp5be1aa * $spd8bef8, $sp1a00c5 * $spd8bef8); ImageCopyResized($sp40af70, $spf12d3b, 0, 0, 0, 0, $sp5be1aa * $spd8bef8, $sp1a00c5 * $spd8bef8, $sp5be1aa, $sp1a00c5); ImageDestroy($spf12d3b); return $sp40af70; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp87d99e, $sp74dd26, $sp38c5ae, $sp6a8ed5 = null) { $sp2ff276 = array_slice($sp38c5ae, 0, $sp74dd26); if (count($sp2ff276) < $sp74dd26) { $sp2ff276 = array_merge($sp2ff276, array_fill(0, $sp74dd26 - count($sp2ff276), 0)); } if (!QRinput::check($sp87d99e, $sp74dd26, $sp2ff276)) { throw new Exception('Error m:' . $sp87d99e . ',s:' . $sp74dd26 . ',d:' . join(',', $sp2ff276)); return null; } $this->mode = $sp87d99e; $this->size = $sp74dd26; $this->data = $sp2ff276; $this->bstream = $sp6a8ed5; } public function encodeModeNum($sp1fa9d0) { try { $sp20eee6 = (int) ($this->size / 3); $spf58ab8 = new QRbitstream(); $sp3172ba = 1; $spf58ab8->appendNum(4, $sp3172ba); $spf58ab8->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $sp1fa9d0), $this->size); for ($sp836a84 = 0; $sp836a84 < $sp20eee6; $sp836a84++) { $sp3172ba = (ord($this->data[$sp836a84 * 3]) - ord('0')) * 100; $sp3172ba += (ord($this->data[$sp836a84 * 3 + 1]) - ord('0')) * 10; $sp3172ba += ord($this->data[$sp836a84 * 3 + 2]) - ord('0'); $spf58ab8->appendNum(10, $sp3172ba); } if ($this->size - $sp20eee6 * 3 == 1) { $sp3172ba = ord($this->data[$sp20eee6 * 3]) - ord('0'); $spf58ab8->appendNum(4, $sp3172ba); } else { if ($this->size - $sp20eee6 * 3 == 2) { $sp3172ba = (ord($this->data[$sp20eee6 * 3]) - ord('0')) * 10; $sp3172ba += ord($this->data[$sp20eee6 * 3 + 1]) - ord('0'); $spf58ab8->appendNum(7, $sp3172ba); } } $this->bstream = $spf58ab8; return 0; } catch (Exception $sp805d3e) { return -1; } } public function encodeModeAn($sp1fa9d0) { try { $sp20eee6 = (int) ($this->size / 2); $spf58ab8 = new QRbitstream(); $spf58ab8->appendNum(4, 2); $spf58ab8->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $sp1fa9d0), $this->size); for ($sp836a84 = 0; $sp836a84 < $sp20eee6; $sp836a84++) { $sp3172ba = (int) QRinput::lookAnTable(ord($this->data[$sp836a84 * 2])) * 45; $sp3172ba += (int) QRinput::lookAnTable(ord($this->data[$sp836a84 * 2 + 1])); $spf58ab8->appendNum(11, $sp3172ba); } if ($this->size & 1) { $sp3172ba = QRinput::lookAnTable(ord($this->data[$sp20eee6 * 2])); $spf58ab8->appendNum(6, $sp3172ba); } $this->bstream = $spf58ab8; return 0; } catch (Exception $sp805d3e) { return -1; } } public function encodeMode8($sp1fa9d0) { try { $spf58ab8 = new QRbitstream(); $spf58ab8->appendNum(4, 4); $spf58ab8->appendNum(QRspec::lengthIndicator(QR_MODE_8, $sp1fa9d0), $this->size); for ($sp836a84 = 0; $sp836a84 < $this->size; $sp836a84++) { $spf58ab8->appendNum(8, ord($this->data[$sp836a84])); } $this->bstream = $spf58ab8; return 0; } catch (Exception $sp805d3e) { return -1; } } public function encodeModeKanji($sp1fa9d0) { try { $spf58ab8 = new QRbitrtream(); $spf58ab8->appendNum(4, 8); $spf58ab8->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $sp1fa9d0), (int) ($this->size / 2)); for ($sp836a84 = 0; $sp836a84 < $this->size; $sp836a84 += 2) { $sp3172ba = ord($this->data[$sp836a84]) << 8 | ord($this->data[$sp836a84 + 1]); if ($sp3172ba <= 40956) { $sp3172ba -= 33088; } else { $sp3172ba -= 49472; } $sp2840dc = ($sp3172ba >> 8) * 192; $sp3172ba = ($sp3172ba & 255) + $sp2840dc; $spf58ab8->appendNum(13, $sp3172ba); } $this->bstream = $spf58ab8; return 0; } catch (Exception $sp805d3e) { return -1; } } public function encodeModeStructure() { try { $spf58ab8 = new QRbitstream(); $spf58ab8->appendNum(4, 3); $spf58ab8->appendNum(4, ord($this->data[1]) - 1); $spf58ab8->appendNum(4, ord($this->data[0]) - 1); $spf58ab8->appendNum(8, ord($this->data[2])); $this->bstream = $spf58ab8; return 0; } catch (Exception $sp805d3e) { return -1; } } public function estimateBitStreamSizeOfEntry($sp1fa9d0) { $spebb2c3 = 0; if ($sp1fa9d0 == 0) { $sp1fa9d0 = 1; } switch ($this->mode) { case QR_MODE_NUM: $spebb2c3 = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $spebb2c3 = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $spebb2c3 = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $spebb2c3 = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $sp132363 = QRspec::lengthIndicator($this->mode, $sp1fa9d0); $sp671d6d = 1 << $sp132363; $sp260870 = (int) (($this->size + $sp671d6d - 1) / $sp671d6d); $spebb2c3 += $sp260870 * (4 + $sp132363); return $spebb2c3; } public function encodeBitStream($sp1fa9d0) { try { unset($this->bstream); $sp20eee6 = QRspec::maximumWords($this->mode, $sp1fa9d0); if ($this->size > $sp20eee6) { $sp18e903 = new QRinputItem($this->mode, $sp20eee6, $this->data); $sp5b7c2c = new QRinputItem($this->mode, $this->size - $sp20eee6, array_slice($this->data, $sp20eee6)); $sp18e903->encodeBitStream($sp1fa9d0); $sp5b7c2c->encodeBitStream($sp1fa9d0); $this->bstream = new QRbitstream(); $this->bstream->append($sp18e903->bstream); $this->bstream->append($sp5b7c2c->bstream); unset($sp18e903); unset($sp5b7c2c); } else { $spec9b7c = 0; switch ($this->mode) { case QR_MODE_NUM: $spec9b7c = $this->encodeModeNum($sp1fa9d0); break; case QR_MODE_AN: $spec9b7c = $this->encodeModeAn($sp1fa9d0); break; case QR_MODE_8: $spec9b7c = $this->encodeMode8($sp1fa9d0); break; case QR_MODE_KANJI: $spec9b7c = $this->encodeModeKanji($sp1fa9d0); break; case QR_MODE_STRUCTURE: $spec9b7c = $this->encodeModeStructure(); break; default: break; } if ($spec9b7c < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $sp805d3e) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($sp1fa9d0 = 0, $spde70db = QR_ECLEVEL_L) { if ($sp1fa9d0 < 0 || $sp1fa9d0 > QRSPEC_VERSION_MAX || $spde70db > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $sp1fa9d0; $this->level = $spde70db; } public function getVersion() { return $this->version; } public function setVersion($sp1fa9d0) { if ($sp1fa9d0 < 0 || $sp1fa9d0 > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $sp1fa9d0; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($spde70db) { if ($spde70db > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $spde70db; return 0; } public function appendEntry(QRinputItem $sp08c9fc) { $this->items[] = $sp08c9fc; } public function append($sp87d99e, $sp74dd26, $sp38c5ae) { try { $sp08c9fc = new QRinputItem($sp87d99e, $sp74dd26, $sp38c5ae); $this->items[] = $sp08c9fc; return 0; } catch (Exception $sp805d3e) { return -1; } } public function insertStructuredAppendHeader($sp74dd26, $sp41a1aa, $sp70bef0) { if ($sp74dd26 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($sp41a1aa <= 0 || $sp41a1aa > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $sp823001 = array($sp74dd26, $sp41a1aa, $sp70bef0); try { $sp08c9fc = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $sp08c9fc); return 0; } catch (Exception $sp805d3e) { return -1; } } public function calcParity() { $sp70bef0 = 0; foreach ($this->items as $spb18bb2) { if ($spb18bb2->mode != QR_MODE_STRUCTURE) { for ($sp836a84 = $spb18bb2->size - 1; $sp836a84 >= 0; $sp836a84--) { $sp70bef0 ^= $spb18bb2->data[$sp836a84]; } } } return $sp70bef0; } public static function checkModeNum($sp74dd26, $sp38c5ae) { for ($sp836a84 = 0; $sp836a84 < $sp74dd26; $sp836a84++) { if (ord($sp38c5ae[$sp836a84]) < ord('0') || ord($sp38c5ae[$sp836a84]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($sp74dd26) { $spee7918 = (int) $sp74dd26 / 3; $spebb2c3 = $spee7918 * 10; switch ($sp74dd26 - $spee7918 * 3) { case 1: $spebb2c3 += 4; break; case 2: $spebb2c3 += 7; break; default: break; } return $spebb2c3; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($sp994dfa) { return $sp994dfa > 127 ? -1 : self::$anTable[$sp994dfa]; } public static function checkModeAn($sp74dd26, $sp38c5ae) { for ($sp836a84 = 0; $sp836a84 < $sp74dd26; $sp836a84++) { if (self::lookAnTable(ord($sp38c5ae[$sp836a84])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($sp74dd26) { $spee7918 = (int) ($sp74dd26 / 2); $spebb2c3 = $spee7918 * 11; if ($sp74dd26 & 1) { $spebb2c3 += 6; } return $spebb2c3; } public static function estimateBitsMode8($sp74dd26) { return $sp74dd26 * 8; } public function estimateBitsModeKanji($sp74dd26) { return (int) ($sp74dd26 / 2 * 13); } public static function checkModeKanji($sp74dd26, $sp38c5ae) { if ($sp74dd26 & 1) { return false; } for ($sp836a84 = 0; $sp836a84 < $sp74dd26; $sp836a84 += 2) { $sp3172ba = ord($sp38c5ae[$sp836a84]) << 8 | ord($sp38c5ae[$sp836a84 + 1]); if ($sp3172ba < 33088 || $sp3172ba > 40956 && $sp3172ba < 57408 || $sp3172ba > 60351) { return false; } } return true; } public static function check($sp87d99e, $sp74dd26, $sp38c5ae) { if ($sp74dd26 <= 0) { return false; } switch ($sp87d99e) { case QR_MODE_NUM: return self::checkModeNum($sp74dd26, $sp38c5ae); break; case QR_MODE_AN: return self::checkModeAn($sp74dd26, $sp38c5ae); break; case QR_MODE_KANJI: return self::checkModeKanji($sp74dd26, $sp38c5ae); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($sp1fa9d0) { $spebb2c3 = 0; foreach ($this->items as $spb18bb2) { $spebb2c3 += $spb18bb2->estimateBitStreamSizeOfEntry($sp1fa9d0); } return $spebb2c3; } public function estimateVersion() { $sp1fa9d0 = 0; $sp6bf145 = 0; do { $sp6bf145 = $sp1fa9d0; $spebb2c3 = $this->estimateBitStreamSize($sp6bf145); $sp1fa9d0 = QRspec::getMinimumVersion((int) (($spebb2c3 + 7) / 8), $this->level); if ($sp1fa9d0 < 0) { return -1; } } while ($sp1fa9d0 > $sp6bf145); return $sp1fa9d0; } public static function lengthOfCode($sp87d99e, $sp1fa9d0, $spebb2c3) { $sp0f8282 = $spebb2c3 - 4 - QRspec::lengthIndicator($sp87d99e, $sp1fa9d0); switch ($sp87d99e) { case QR_MODE_NUM: $sp0d741b = (int) ($sp0f8282 / 10); $sp92c2cb = $sp0f8282 - $sp0d741b * 10; $sp74dd26 = $sp0d741b * 3; if ($sp92c2cb >= 7) { $sp74dd26 += 2; } else { if ($sp92c2cb >= 4) { $sp74dd26 += 1; } } break; case QR_MODE_AN: $sp0d741b = (int) ($sp0f8282 / 11); $sp92c2cb = $sp0f8282 - $sp0d741b * 11; $sp74dd26 = $sp0d741b * 2; if ($sp92c2cb >= 6) { $sp74dd26++; } break; case QR_MODE_8: $sp74dd26 = (int) ($sp0f8282 / 8); break; case QR_MODE_KANJI: $sp74dd26 = (int) ($sp0f8282 / 13 * 2); break; case QR_MODE_STRUCTURE: $sp74dd26 = (int) ($sp0f8282 / 8); break; default: $sp74dd26 = 0; break; } $sp8774a2 = QRspec::maximumWords($sp87d99e, $sp1fa9d0); if ($sp74dd26 < 0) { $sp74dd26 = 0; } if ($sp74dd26 > $sp8774a2) { $sp74dd26 = $sp8774a2; } return $sp74dd26; } public function createBitStream() { $sp1843ca = 0; foreach ($this->items as $spb18bb2) { $spebb2c3 = $spb18bb2->encodeBitStream($this->version); if ($spebb2c3 < 0) { return -1; } $sp1843ca += $spebb2c3; } return $sp1843ca; } public function convertData() { $spfd4545 = $this->estimateVersion(); if ($spfd4545 > $this->getVersion()) { $this->setVersion($spfd4545); } for (;;) { $spebb2c3 = $this->createBitStream(); if ($spebb2c3 < 0) { return -1; } $spfd4545 = QRspec::getMinimumVersion((int) (($spebb2c3 + 7) / 8), $this->level); if ($spfd4545 < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spfd4545 > $this->getVersion()) { $this->setVersion($spfd4545); } else { break; } } } return 0; } public function appendPaddingBit(&$sp6a8ed5) { $spebb2c3 = $sp6a8ed5->size(); $sp843bb3 = QRspec::getDataLength($this->version, $this->level); $sp9252f9 = $sp843bb3 * 8; if ($sp9252f9 == $spebb2c3) { return 0; } if ($sp9252f9 - $spebb2c3 < 5) { return $sp6a8ed5->appendNum($sp9252f9 - $spebb2c3, 0); } $spebb2c3 += 4; $sp20eee6 = (int) (($spebb2c3 + 7) / 8); $sp1529e7 = new QRbitstream(); $spec9b7c = $sp1529e7->appendNum($sp20eee6 * 8 - $spebb2c3 + 4, 0); if ($spec9b7c < 0) { return $spec9b7c; } $spb09cb4 = $sp843bb3 - $sp20eee6; if ($spb09cb4 > 0) { $sp94ca05 = array(); for ($sp836a84 = 0; $sp836a84 < $spb09cb4; $sp836a84++) { $sp94ca05[$sp836a84] = $sp836a84 & 1 ? 17 : 236; } $spec9b7c = $sp1529e7->appendBytes($spb09cb4, $sp94ca05); if ($spec9b7c < 0) { return $spec9b7c; } } $spec9b7c = $sp6a8ed5->append($sp1529e7); return $spec9b7c; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $sp6a8ed5 = new QRbitstream(); foreach ($this->items as $spb18bb2) { $spec9b7c = $sp6a8ed5->append($spb18bb2->bstream); if ($spec9b7c < 0) { return null; } } return $sp6a8ed5; } public function getBitStream() { $sp6a8ed5 = $this->mergeBitStream(); if ($sp6a8ed5 == null) { return null; } $spec9b7c = $this->appendPaddingBit($sp6a8ed5); if ($spec9b7c < 0) { return null; } return $sp6a8ed5; } public function getByteStream() { $sp6a8ed5 = $this->getBitStream(); if ($sp6a8ed5 == null) { return null; } return $sp6a8ed5->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($sp8dbd59) { $this->data = array_fill(0, $sp8dbd59, 0); return 0; } public static function newFromNum($spebb2c3, $sp260870) { $sp6a8ed5 = new QRbitstream(); $sp6a8ed5->allocate($spebb2c3); $sp7d079f = 1 << $spebb2c3 - 1; for ($sp836a84 = 0; $sp836a84 < $spebb2c3; $sp836a84++) { if ($sp260870 & $sp7d079f) { $sp6a8ed5->data[$sp836a84] = 1; } else { $sp6a8ed5->data[$sp836a84] = 0; } $sp7d079f = $sp7d079f >> 1; } return $sp6a8ed5; } public static function newFromBytes($sp74dd26, $sp38c5ae) { $sp6a8ed5 = new QRbitstream(); $sp6a8ed5->allocate($sp74dd26 * 8); $sp617759 = 0; for ($sp836a84 = 0; $sp836a84 < $sp74dd26; $sp836a84++) { $sp7d079f = 128; for ($spd165b1 = 0; $spd165b1 < 8; $spd165b1++) { if ($sp38c5ae[$sp836a84] & $sp7d079f) { $sp6a8ed5->data[$sp617759] = 1; } else { $sp6a8ed5->data[$sp617759] = 0; } $sp617759++; $sp7d079f = $sp7d079f >> 1; } } return $sp6a8ed5; } public function append(QRbitstream $sp8e6d6f) { if (is_null($sp8e6d6f)) { return -1; } if ($sp8e6d6f->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $sp8e6d6f->data; return 0; } $this->data = array_values(array_merge($this->data, $sp8e6d6f->data)); return 0; } public function appendNum($spebb2c3, $sp260870) { if ($spebb2c3 == 0) { return 0; } $sp380c6e = QRbitstream::newFromNum($spebb2c3, $sp260870); if (is_null($sp380c6e)) { return -1; } $spec9b7c = $this->append($sp380c6e); unset($sp380c6e); return $spec9b7c; } public function appendBytes($sp74dd26, $sp38c5ae) { if ($sp74dd26 == 0) { return 0; } $sp380c6e = QRbitstream::newFromBytes($sp74dd26, $sp38c5ae); if (is_null($sp380c6e)) { return -1; } $spec9b7c = $this->append($sp380c6e); unset($sp380c6e); return $spec9b7c; } public function toByte() { $sp74dd26 = $this->size(); if ($sp74dd26 == 0) { return array(); } $sp38c5ae = array_fill(0, (int) (($sp74dd26 + 7) / 8), 0); $spf20964 = (int) ($sp74dd26 / 8); $sp617759 = 0; for ($sp836a84 = 0; $sp836a84 < $spf20964; $sp836a84++) { $sp398610 = 0; for ($spd165b1 = 0; $spd165b1 < 8; $spd165b1++) { $sp398610 = $sp398610 << 1; $sp398610 |= $this->data[$sp617759]; $sp617759++; } $sp38c5ae[$sp836a84] = $sp398610; } if ($sp74dd26 & 7) { $sp398610 = 0; for ($spd165b1 = 0; $spd165b1 < ($sp74dd26 & 7); $spd165b1++) { $sp398610 = $sp398610 << 1; $sp398610 |= $this->data[$sp617759]; $sp617759++; } $sp38c5ae[$spf20964] = $sp398610; } return $sp38c5ae; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($spe9399c, $sp11f4cb, $sp694c55) { $this->dataStr = $spe9399c; $this->input = $sp11f4cb; $this->modeHint = $sp694c55; } public static function isdigitat($spfcf742, $sp3a1f3c) { if ($sp3a1f3c >= strlen($spfcf742)) { return false; } return ord($spfcf742[$sp3a1f3c]) >= ord('0') && ord($spfcf742[$sp3a1f3c]) <= ord('9'); } public static function isalnumat($spfcf742, $sp3a1f3c) { if ($sp3a1f3c >= strlen($spfcf742)) { return false; } return QRinput::lookAnTable(ord($spfcf742[$sp3a1f3c])) >= 0; } public function identifyMode($sp3a1f3c) { if ($sp3a1f3c >= strlen($this->dataStr)) { return QR_MODE_NUL; } $sp994dfa = $this->dataStr[$sp3a1f3c]; if (self::isdigitat($this->dataStr, $sp3a1f3c)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $sp3a1f3c)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($sp3a1f3c + 1 < strlen($this->dataStr)) { $sp8b7b9f = $this->dataStr[$sp3a1f3c + 1]; $sp483434 = ord($sp994dfa) << 8 | ord($sp8b7b9f); if ($sp483434 >= 33088 && $sp483434 <= 40956 || $sp483434 >= 57408 && $sp483434 <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp7b8baf = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp617759 = 0; while (self::isdigitat($this->dataStr, $sp617759)) { $sp617759++; } $spbc80e0 = $sp617759; $sp87d99e = $this->identifyMode($sp617759); if ($sp87d99e == QR_MODE_8) { $spd76fa1 = QRinput::estimateBitsModeNum($spbc80e0) + 4 + $sp7b8baf + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($spbc80e0 + 1); if ($spd76fa1 > 0) { return $this->eat8(); } } if ($sp87d99e == QR_MODE_AN) { $spd76fa1 = QRinput::estimateBitsModeNum($spbc80e0) + 4 + $sp7b8baf + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($spbc80e0 + 1); if ($spd76fa1 > 0) { return $this->eatAn(); } } $spec9b7c = $this->input->append(QR_MODE_NUM, $spbc80e0, str_split($this->dataStr)); if ($spec9b7c < 0) { return -1; } return $spbc80e0; } public function eatAn() { $sp72c3ee = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp7b8baf = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp617759 = 0; while (self::isalnumat($this->dataStr, $sp617759)) { if (self::isdigitat($this->dataStr, $sp617759)) { $sp8ab1f4 = $sp617759; while (self::isdigitat($this->dataStr, $sp8ab1f4)) { $sp8ab1f4++; } $spd76fa1 = QRinput::estimateBitsModeAn($sp617759) + QRinput::estimateBitsModeNum($sp8ab1f4 - $sp617759) + 4 + $sp7b8baf - QRinput::estimateBitsModeAn($sp8ab1f4); if ($spd76fa1 < 0) { break; } else { $sp617759 = $sp8ab1f4; } } else { $sp617759++; } } $spbc80e0 = $sp617759; if (!self::isalnumat($this->dataStr, $sp617759)) { $spd76fa1 = QRinput::estimateBitsModeAn($spbc80e0) + 4 + $sp72c3ee + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($spbc80e0 + 1); if ($spd76fa1 > 0) { return $this->eat8(); } } $spec9b7c = $this->input->append(QR_MODE_AN, $spbc80e0, str_split($this->dataStr)); if ($spec9b7c < 0) { return -1; } return $spbc80e0; } public function eatKanji() { $sp617759 = 0; while ($this->identifyMode($sp617759) == QR_MODE_KANJI) { $sp617759 += 2; } $spec9b7c = $this->input->append(QR_MODE_KANJI, $sp617759, str_split($this->dataStr)); if ($spec9b7c < 0) { return -1; } return $spbc80e0; } public function eat8() { $sp72c3ee = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp7b8baf = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp617759 = 1; $sp62edb5 = strlen($this->dataStr); while ($sp617759 < $sp62edb5) { $sp87d99e = $this->identifyMode($sp617759); if ($sp87d99e == QR_MODE_KANJI) { break; } if ($sp87d99e == QR_MODE_NUM) { $sp8ab1f4 = $sp617759; while (self::isdigitat($this->dataStr, $sp8ab1f4)) { $sp8ab1f4++; } $spd76fa1 = QRinput::estimateBitsMode8($sp617759) + QRinput::estimateBitsModeNum($sp8ab1f4 - $sp617759) + 4 + $sp7b8baf - QRinput::estimateBitsMode8($sp8ab1f4); if ($spd76fa1 < 0) { break; } else { $sp617759 = $sp8ab1f4; } } else { if ($sp87d99e == QR_MODE_AN) { $sp8ab1f4 = $sp617759; while (self::isalnumat($this->dataStr, $sp8ab1f4)) { $sp8ab1f4++; } $spd76fa1 = QRinput::estimateBitsMode8($sp617759) + QRinput::estimateBitsModeAn($sp8ab1f4 - $sp617759) + 4 + $sp72c3ee - QRinput::estimateBitsMode8($sp8ab1f4); if ($spd76fa1 < 0) { break; } else { $sp617759 = $sp8ab1f4; } } else { $sp617759++; } } } $spbc80e0 = $sp617759; $spec9b7c = $this->input->append(QR_MODE_8, $spbc80e0, str_split($this->dataStr)); if ($spec9b7c < 0) { return -1; } return $spbc80e0; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp87d99e = $this->identifyMode(0); switch ($sp87d99e) { case QR_MODE_NUM: $sp287970 = $this->eatNum(); break; case QR_MODE_AN: $sp287970 = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp60ded7 == QR_MODE_KANJI) { $sp287970 = $this->eatKanji(); } else { $sp287970 = $this->eat8(); } break; default: $sp287970 = $this->eat8(); break; } if ($sp287970 == 0) { return 0; } if ($sp287970 < 0) { return -1; } $this->dataStr = substr($this->dataStr, $sp287970); } } public function toUpper() { $sp270fbb = strlen($this->dataStr); $sp617759 = 0; while ($sp617759 < $sp270fbb) { $sp87d99e = self::identifyMode(substr($this->dataStr, $sp617759), $this->modeHint); if ($sp87d99e == QR_MODE_KANJI) { $sp617759 += 2; } else { if (ord($this->dataStr[$sp617759]) >= ord('a') && ord($this->dataStr[$sp617759]) <= ord('z')) { $this->dataStr[$sp617759] = chr(ord($this->dataStr[$sp617759]) - 32); } $sp617759++; } } return $this->dataStr; } public static function splitStringToQRinput($spadab05, QRinput $sp11f4cb, $sp694c55, $sp8d2c12 = true) { if (is_null($spadab05) || $spadab05 == '\\0' || $spadab05 == '') { throw new Exception('empty string!!!'); } $spc1f980 = new QRsplit($spadab05, $sp11f4cb, $sp694c55); if (!$sp8d2c12) { $spc1f980->toUpper(); } return $spc1f980->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($sp8bb6f8) { while ($sp8bb6f8 >= $this->nn) { $sp8bb6f8 -= $this->nn; $sp8bb6f8 = ($sp8bb6f8 >> $this->mm) + ($sp8bb6f8 & $this->nn); } return $sp8bb6f8; } public static function init_rs_char($sp97a059, $sp5cbb6c, $sp8d34a6, $sp90015c, $sp5b5abf, $spe5a1f6) { $sp09af07 = null; if ($sp97a059 < 0 || $sp97a059 > 8) { return $sp09af07; } if ($sp8d34a6 < 0 || $sp8d34a6 >= 1 << $sp97a059) { return $sp09af07; } if ($sp90015c <= 0 || $sp90015c >= 1 << $sp97a059) { return $sp09af07; } if ($sp5b5abf < 0 || $sp5b5abf >= 1 << $sp97a059) { return $sp09af07; } if ($spe5a1f6 < 0 || $spe5a1f6 >= (1 << $sp97a059) - 1 - $sp5b5abf) { return $sp09af07; } $sp09af07 = new QRrsItem(); $sp09af07->mm = $sp97a059; $sp09af07->nn = (1 << $sp97a059) - 1; $sp09af07->pad = $spe5a1f6; $sp09af07->alpha_to = array_fill(0, $sp09af07->nn + 1, 0); $sp09af07->index_of = array_fill(0, $sp09af07->nn + 1, 0); $sp94143c =& $sp09af07->nn; $sp84573f =& $sp94143c; $sp09af07->index_of[0] = $sp84573f; $sp09af07->alpha_to[$sp84573f] = 0; $sp25d753 = 1; for ($sp836a84 = 0; $sp836a84 < $sp09af07->nn; $sp836a84++) { $sp09af07->index_of[$sp25d753] = $sp836a84; $sp09af07->alpha_to[$sp836a84] = $sp25d753; $sp25d753 <<= 1; if ($sp25d753 & 1 << $sp97a059) { $sp25d753 ^= $sp5cbb6c; } $sp25d753 &= $sp09af07->nn; } if ($sp25d753 != 1) { $sp09af07 = NULL; return $sp09af07; } $sp09af07->genpoly = array_fill(0, $sp5b5abf + 1, 0); $sp09af07->fcr = $sp8d34a6; $sp09af07->prim = $sp90015c; $sp09af07->nroots = $sp5b5abf; $sp09af07->gfpoly = $sp5cbb6c; for ($sp73331f = 1; $sp73331f % $sp90015c != 0; $sp73331f += $sp09af07->nn) { } $sp09af07->iprim = (int) ($sp73331f / $sp90015c); $sp09af07->genpoly[0] = 1; for ($sp836a84 = 0, $sp61804f = $sp8d34a6 * $sp90015c; $sp836a84 < $sp5b5abf; $sp836a84++, $sp61804f += $sp90015c) { $sp09af07->genpoly[$sp836a84 + 1] = 1; for ($spd165b1 = $sp836a84; $spd165b1 > 0; $spd165b1--) { if ($sp09af07->genpoly[$spd165b1] != 0) { $sp09af07->genpoly[$spd165b1] = $sp09af07->genpoly[$spd165b1 - 1] ^ $sp09af07->alpha_to[$sp09af07->modnn($sp09af07->index_of[$sp09af07->genpoly[$spd165b1]] + $sp61804f)]; } else { $sp09af07->genpoly[$spd165b1] = $sp09af07->genpoly[$spd165b1 - 1]; } } $sp09af07->genpoly[0] = $sp09af07->alpha_to[$sp09af07->modnn($sp09af07->index_of[$sp09af07->genpoly[0]] + $sp61804f)]; } for ($sp836a84 = 0; $sp836a84 <= $sp5b5abf; $sp836a84++) { $sp09af07->genpoly[$sp836a84] = $sp09af07->index_of[$sp09af07->genpoly[$sp836a84]]; } return $sp09af07; } public function encode_rs_char($sp38c5ae, &$sp70bef0) { $sp01cd4d =& $this->mm; $sp94143c =& $this->nn; $sp36763a =& $this->alpha_to; $sp684c46 =& $this->index_of; $sp9f7e78 =& $this->genpoly; $sp7e032f =& $this->nroots; $spf1923a =& $this->fcr; $spaf1413 =& $this->prim; $spf872be =& $this->iprim; $spa62a07 =& $this->pad; $sp84573f =& $sp94143c; $sp70bef0 = array_fill(0, $sp7e032f, 0); for ($sp836a84 = 0; $sp836a84 < $sp94143c - $sp7e032f - $spa62a07; $sp836a84++) { $spddc1b2 = $sp684c46[$sp38c5ae[$sp836a84] ^ $sp70bef0[0]]; if ($spddc1b2 != $sp84573f) { $spddc1b2 = $this->modnn($sp94143c - $sp9f7e78[$sp7e032f] + $spddc1b2); for ($spd165b1 = 1; $spd165b1 < $sp7e032f; $spd165b1++) { $sp70bef0[$spd165b1] ^= $sp36763a[$this->modnn($spddc1b2 + $sp9f7e78[$sp7e032f - $spd165b1])]; } } array_shift($sp70bef0); if ($spddc1b2 != $sp84573f) { array_push($sp70bef0, $sp36763a[$this->modnn($spddc1b2 + $sp9f7e78[0])]); } else { array_push($sp70bef0, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($sp97a059, $sp5cbb6c, $sp8d34a6, $sp90015c, $sp5b5abf, $spe5a1f6) { foreach (self::$items as $sp09af07) { if ($sp09af07->pad != $spe5a1f6) { continue; } if ($sp09af07->nroots != $sp5b5abf) { continue; } if ($sp09af07->mm != $sp97a059) { continue; } if ($sp09af07->gfpoly != $sp5cbb6c) { continue; } if ($sp09af07->fcr != $sp8d34a6) { continue; } if ($sp09af07->prim != $sp90015c) { continue; } return $sp09af07; } $sp09af07 = QRrsItem::init_rs_char($sp97a059, $sp5cbb6c, $sp8d34a6, $sp90015c, $sp5b5abf, $spe5a1f6); array_unshift(self::$items, $sp09af07); return $sp09af07; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($spe3910d, &$sp22ba36, $sp7d079f, $spde70db) { $sp0226b4 = 0; $spbbf2b0 = QRspec::getFormatInfo($sp7d079f, $spde70db); for ($sp836a84 = 0; $sp836a84 < 8; $sp836a84++) { if ($spbbf2b0 & 1) { $sp0226b4 += 2; $sp398610 = 133; } else { $sp398610 = 132; } $sp22ba36[8][$spe3910d - 1 - $sp836a84] = chr($sp398610); if ($sp836a84 < 6) { $sp22ba36[$sp836a84][8] = chr($sp398610); } else { $sp22ba36[$sp836a84 + 1][8] = chr($sp398610); } $spbbf2b0 = $spbbf2b0 >> 1; } for ($sp836a84 = 0; $sp836a84 < 7; $sp836a84++) { if ($spbbf2b0 & 1) { $sp0226b4 += 2; $sp398610 = 133; } else { $sp398610 = 132; } $sp22ba36[$spe3910d - 7 + $sp836a84][8] = chr($sp398610); if ($sp836a84 == 0) { $sp22ba36[8][7] = chr($sp398610); } else { $sp22ba36[8][6 - $sp836a84] = chr($sp398610); } $spbbf2b0 = $spbbf2b0 >> 1; } return $sp0226b4; } public function mask0($sp8bb6f8, $spa1efa3) { return $sp8bb6f8 + $spa1efa3 & 1; } public function mask1($sp8bb6f8, $spa1efa3) { return $spa1efa3 & 1; } public function mask2($sp8bb6f8, $spa1efa3) { return $sp8bb6f8 % 3; } public function mask3($sp8bb6f8, $spa1efa3) { return ($sp8bb6f8 + $spa1efa3) % 3; } public function mask4($sp8bb6f8, $spa1efa3) { return (int) ($spa1efa3 / 2) + (int) ($sp8bb6f8 / 3) & 1; } public function mask5($sp8bb6f8, $spa1efa3) { return ($sp8bb6f8 * $spa1efa3 & 1) + $sp8bb6f8 * $spa1efa3 % 3; } public function mask6($sp8bb6f8, $spa1efa3) { return ($sp8bb6f8 * $spa1efa3 & 1) + $sp8bb6f8 * $spa1efa3 % 3 & 1; } public function mask7($sp8bb6f8, $spa1efa3) { return $sp8bb6f8 * $spa1efa3 % 3 + ($sp8bb6f8 + $spa1efa3 & 1) & 1; } private function generateMaskNo($sp0570db, $spe3910d, $sp22ba36) { $sp69091c = array_fill(0, $spe3910d, array_fill(0, $spe3910d, 0)); for ($spa1efa3 = 0; $spa1efa3 < $spe3910d; $spa1efa3++) { for ($sp8bb6f8 = 0; $sp8bb6f8 < $spe3910d; $sp8bb6f8++) { if (ord($sp22ba36[$spa1efa3][$sp8bb6f8]) & 128) { $sp69091c[$spa1efa3][$sp8bb6f8] = 0; } else { $sp24aa43 = call_user_func(array($this, 'mask' . $sp0570db), $sp8bb6f8, $spa1efa3); $sp69091c[$spa1efa3][$sp8bb6f8] = $sp24aa43 == 0 ? 1 : 0; } } } return $sp69091c; } public static function serial($spee0bac) { $sp8dbdb2 = array(); foreach ($spee0bac as $spa3d810) { $sp8dbdb2[] = join('', $spa3d810); } return gzcompress(join('
', $sp8dbdb2), 9); } public static function unserial($sp808526) { $sp8dbdb2 = array(); $sp4f0f22 = explode('
', gzuncompress($sp808526)); foreach ($sp4f0f22 as $spa3d810) { $sp8dbdb2[] = str_split($spa3d810); } return $sp8dbdb2; } public function makeMaskNo($sp0570db, $spe3910d, $sp59d5e2, &$sp8b7b9f, $spe0f4ab = false) { $sp380c6e = 0; $sp69091c = array(); $spc63eef = QR_CACHE_DIR . 'mask_' . $sp0570db . DIRECTORY_SEPARATOR . 'mask_' . $spe3910d . '_' . $sp0570db . '.dat'; if (QR_CACHEABLE) { if (file_exists($spc63eef)) { $sp69091c = self::unserial(file_get_contents($spc63eef)); } else { $sp69091c = $this->generateMaskNo($sp0570db, $spe3910d, $sp59d5e2, $sp8b7b9f); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp0570db)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp0570db); } file_put_contents($spc63eef, self::serial($sp69091c)); } } else { $sp69091c = $this->generateMaskNo($sp0570db, $spe3910d, $sp59d5e2, $sp8b7b9f); } if ($spe0f4ab) { return; } $sp8b7b9f = $sp59d5e2; for ($spa1efa3 = 0; $spa1efa3 < $spe3910d; $spa1efa3++) { for ($sp8bb6f8 = 0; $sp8bb6f8 < $spe3910d; $sp8bb6f8++) { if ($sp69091c[$spa1efa3][$sp8bb6f8] == 1) { $sp8b7b9f[$spa1efa3][$sp8bb6f8] = chr(ord($sp59d5e2[$spa1efa3][$sp8bb6f8]) ^ (int) $sp69091c[$spa1efa3][$sp8bb6f8]); } $sp380c6e += (int) (ord($sp8b7b9f[$spa1efa3][$sp8bb6f8]) & 1); } } return $sp380c6e; } public function makeMask($spe3910d, $sp22ba36, $sp0570db, $spde70db) { $sp069039 = array_fill(0, $spe3910d, str_repeat(' ', $spe3910d)); $this->makeMaskNo($sp0570db, $spe3910d, $sp22ba36, $sp069039); $this->writeFormatInformation($spe3910d, $sp069039, $sp0570db, $spde70db); return $sp069039; } public function calcN1N3($sp287970) { $spa56003 = 0; for ($sp836a84 = 0; $sp836a84 < $sp287970; $sp836a84++) { if ($this->runLength[$sp836a84] >= 5) { $spa56003 += N1 + ($this->runLength[$sp836a84] - 5); } if ($sp836a84 & 1) { if ($sp836a84 >= 3 && $sp836a84 < $sp287970 - 2 && $this->runLength[$sp836a84] % 3 == 0) { $spb4842c = (int) ($this->runLength[$sp836a84] / 3); if ($this->runLength[$sp836a84 - 2] == $spb4842c && $this->runLength[$sp836a84 - 1] == $spb4842c && $this->runLength[$sp836a84 + 1] == $spb4842c && $this->runLength[$sp836a84 + 2] == $spb4842c) { if ($this->runLength[$sp836a84 - 3] < 0 || $this->runLength[$sp836a84 - 3] >= 4 * $spb4842c) { $spa56003 += N3; } else { if ($sp836a84 + 3 >= $sp287970 || $this->runLength[$sp836a84 + 3] >= 4 * $spb4842c) { $spa56003 += N3; } } } } } } return $spa56003; } public function evaluateSymbol($spe3910d, $sp22ba36) { $spb3c42d = 0; $spa56003 = 0; for ($spa1efa3 = 0; $spa1efa3 < $spe3910d; $spa1efa3++) { $spb3c42d = 0; $this->runLength[0] = 1; $sp970469 = $sp22ba36[$spa1efa3]; if ($spa1efa3 > 0) { $spaa8b4d = $sp22ba36[$spa1efa3 - 1]; } for ($sp8bb6f8 = 0; $sp8bb6f8 < $spe3910d; $sp8bb6f8++) { if ($sp8bb6f8 > 0 && $spa1efa3 > 0) { $sp212a70 = ord($sp970469[$sp8bb6f8]) & ord($sp970469[$sp8bb6f8 - 1]) & ord($spaa8b4d[$sp8bb6f8]) & ord($spaa8b4d[$sp8bb6f8 - 1]); $spb4bab6 = ord($sp970469[$sp8bb6f8]) | ord($sp970469[$sp8bb6f8 - 1]) | ord($spaa8b4d[$sp8bb6f8]) | ord($spaa8b4d[$sp8bb6f8 - 1]); if (($sp212a70 | $spb4bab6 ^ 1) & 1) { $spa56003 += N2; } } if ($sp8bb6f8 == 0 && ord($sp970469[$sp8bb6f8]) & 1) { $this->runLength[0] = -1; $spb3c42d = 1; $this->runLength[$spb3c42d] = 1; } else { if ($sp8bb6f8 > 0) { if ((ord($sp970469[$sp8bb6f8]) ^ ord($sp970469[$sp8bb6f8 - 1])) & 1) { $spb3c42d++; $this->runLength[$spb3c42d] = 1; } else { $this->runLength[$spb3c42d]++; } } } } $spa56003 += $this->calcN1N3($spb3c42d + 1); } for ($sp8bb6f8 = 0; $sp8bb6f8 < $spe3910d; $sp8bb6f8++) { $spb3c42d = 0; $this->runLength[0] = 1; for ($spa1efa3 = 0; $spa1efa3 < $spe3910d; $spa1efa3++) { if ($spa1efa3 == 0 && ord($sp22ba36[$spa1efa3][$sp8bb6f8]) & 1) { $this->runLength[0] = -1; $spb3c42d = 1; $this->runLength[$spb3c42d] = 1; } else { if ($spa1efa3 > 0) { if ((ord($sp22ba36[$spa1efa3][$sp8bb6f8]) ^ ord($sp22ba36[$spa1efa3 - 1][$sp8bb6f8])) & 1) { $spb3c42d++; $this->runLength[$spb3c42d] = 1; } else { $this->runLength[$spb3c42d]++; } } } } $spa56003 += $this->calcN1N3($spb3c42d + 1); } return $spa56003; } public function mask($spe3910d, $sp22ba36, $spde70db) { $spa6ac98 = PHP_INT_MAX; $spc8bab9 = 0; $sp1497f7 = array(); $sp494772 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp6a9de4 = 8 - QR_FIND_FROM_RANDOM % 9; for ($sp836a84 = 0; $sp836a84 < $sp6a9de4; $sp836a84++) { $sp61427e = rand(0, count($sp494772) - 1); unset($sp494772[$sp61427e]); $sp494772 = array_values($sp494772); } } $sp1497f7 = $sp22ba36; foreach ($sp494772 as $sp836a84) { $sp7d079f = array_fill(0, $spe3910d, str_repeat(' ', $spe3910d)); $spa56003 = 0; $sp0226b4 = 0; $sp0226b4 = $this->makeMaskNo($sp836a84, $spe3910d, $sp22ba36, $sp7d079f); $sp0226b4 += $this->writeFormatInformation($spe3910d, $sp7d079f, $sp836a84, $spde70db); $sp0226b4 = (int) (100 * $sp0226b4 / ($spe3910d * $spe3910d)); $spa56003 = (int) ((int) (abs($sp0226b4 - 50) / 5) * N4); $spa56003 += $this->evaluateSymbol($spe3910d, $sp7d079f); if ($spa56003 < $spa6ac98) { $spa6ac98 = $spa56003; $sp1497f7 = $sp7d079f; $spc8bab9 = $sp836a84; } } return $sp1497f7; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($spbb5e79, $sp38c5ae, $spe5023c, &$sp195f11, QRrsItem $sp09af07) { $sp09af07->encode_rs_char($sp38c5ae, $sp195f11); $this->dataLength = $spbb5e79; $this->data = $sp38c5ae; $this->eccLength = $spe5023c; $this->ecc = $sp195f11; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp11f4cb) { $sp4f9ad1 = array(0, 0, 0, 0, 0); $this->datacode = $sp11f4cb->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp11f4cb->getVersion(), $sp11f4cb->getErrorCorrectionLevel(), $sp4f9ad1); $this->version = $sp11f4cb->getVersion(); $this->b1 = QRspec::rsBlockNum1($sp4f9ad1); $this->dataLength = QRspec::rsDataLength($sp4f9ad1); $this->eccLength = QRspec::rsEccLength($sp4f9ad1); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($sp4f9ad1); $spec9b7c = $this->init($sp4f9ad1); if ($spec9b7c < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $sp4f9ad1) { $spbb5e79 = QRspec::rsDataCodes1($sp4f9ad1); $spe5023c = QRspec::rsEccCodes1($sp4f9ad1); $sp09af07 = QRrs::init_rs(8, 285, 0, 1, $spe5023c, 255 - $spbb5e79 - $spe5023c); $spf4d6e7 = 0; $spe7ecd7 = 0; $sp527b15 = 0; for ($sp836a84 = 0; $sp836a84 < QRspec::rsBlockNum1($sp4f9ad1); $sp836a84++) { $sp195f11 = array_slice($this->ecccode, $sp527b15); $this->rsblocks[$spf4d6e7] = new QRrsblock($spbb5e79, array_slice($this->datacode, $spe7ecd7), $spe5023c, $sp195f11, $sp09af07); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp527b15), $sp195f11); $spe7ecd7 += $spbb5e79; $sp527b15 += $spe5023c; $spf4d6e7++; } if (QRspec::rsBlockNum2($sp4f9ad1) == 0) { return 0; } $spbb5e79 = QRspec::rsDataCodes2($sp4f9ad1); $spe5023c = QRspec::rsEccCodes2($sp4f9ad1); $sp09af07 = QRrs::init_rs(8, 285, 0, 1, $spe5023c, 255 - $spbb5e79 - $spe5023c); if ($sp09af07 == NULL) { return -1; } for ($sp836a84 = 0; $sp836a84 < QRspec::rsBlockNum2($sp4f9ad1); $sp836a84++) { $sp195f11 = array_slice($this->ecccode, $sp527b15); $this->rsblocks[$spf4d6e7] = new QRrsblock($spbb5e79, array_slice($this->datacode, $spe7ecd7), $spe5023c, $sp195f11, $sp09af07); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp527b15), $sp195f11); $spe7ecd7 += $spbb5e79; $sp527b15 += $spe5023c; $spf4d6e7++; } return 0; } public function getCode() { $spec9b7c; if ($this->count < $this->dataLength) { $sp7ee2f5 = $this->count % $this->blocks; $sp071907 = $this->count / $this->blocks; if ($sp071907 >= $this->rsblocks[0]->dataLength) { $sp7ee2f5 += $this->b1; } $spec9b7c = $this->rsblocks[$sp7ee2f5]->data[$sp071907]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp7ee2f5 = ($this->count - $this->dataLength) % $this->blocks; $sp071907 = ($this->count - $this->dataLength) / $this->blocks; $spec9b7c = $this->rsblocks[$sp7ee2f5]->ecc[$sp071907]; } else { return 0; } } $this->count++; return $spec9b7c; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp11f4cb, $sp7d079f) { if ($sp11f4cb->getVersion() < 0 || $sp11f4cb->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp11f4cb->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $sp29a687 = new QRrawcode($sp11f4cb); QRtools::markTime('after_raw'); $sp1fa9d0 = $sp29a687->version; $spe3910d = QRspec::getWidth($sp1fa9d0); $sp22ba36 = QRspec::newFrame($sp1fa9d0); $spca915b = new FrameFiller($spe3910d, $sp22ba36); if (is_null($spca915b)) { return NULL; } for ($sp836a84 = 0; $sp836a84 < $sp29a687->dataLength + $sp29a687->eccLength; $sp836a84++) { $sp808526 = $sp29a687->getCode(); $sp67e4f8 = 128; for ($spd165b1 = 0; $spd165b1 < 8; $spd165b1++) { $sp622684 = $spca915b->next(); $spca915b->setFrameAt($sp622684, 2 | ($sp67e4f8 & $sp808526) != 0); $sp67e4f8 = $sp67e4f8 >> 1; } } QRtools::markTime('after_filler'); unset($sp29a687); $spd165b1 = QRspec::getRemainder($sp1fa9d0); for ($sp836a84 = 0; $sp836a84 < $spd165b1; $sp836a84++) { $sp622684 = $spca915b->next(); $spca915b->setFrameAt($sp622684, 2); } $sp22ba36 = $spca915b->frame; unset($spca915b); $spf56390 = new QRmask(); if ($sp7d079f < 0) { if (QR_FIND_BEST_MASK) { $sp069039 = $spf56390->mask($spe3910d, $sp22ba36, $sp11f4cb->getErrorCorrectionLevel()); } else { $sp069039 = $spf56390->makeMask($spe3910d, $sp22ba36, intval(QR_DEFAULT_MASK) % 8, $sp11f4cb->getErrorCorrectionLevel()); } } else { $sp069039 = $spf56390->makeMask($spe3910d, $sp22ba36, $sp7d079f, $sp11f4cb->getErrorCorrectionLevel()); } if ($sp069039 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $sp1fa9d0; $this->width = $spe3910d; $this->data = $sp069039; return $this; } public function encodeInput(QRinput $sp11f4cb) { return $this->encodeMask($sp11f4cb, -1); } public function encodeString8bit($spadab05, $sp1fa9d0, $spde70db) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp11f4cb = new QRinput($sp1fa9d0, $spde70db); if ($sp11f4cb == NULL) { return NULL; } $spec9b7c = $sp11f4cb->append($sp11f4cb, QR_MODE_8, strlen($spadab05), str_split($spadab05)); if ($spec9b7c < 0) { unset($sp11f4cb); return NULL; } return $this->encodeInput($sp11f4cb); } public function encodeString($spadab05, $sp1fa9d0, $spde70db, $sp60ded7, $sp8d2c12) { if ($sp60ded7 != QR_MODE_8 && $sp60ded7 != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp11f4cb = new QRinput($sp1fa9d0, $spde70db); if ($sp11f4cb == NULL) { return NULL; } $spec9b7c = QRsplit::splitStringToQRinput($spadab05, $sp11f4cb, $sp60ded7, $sp8d2c12); if ($spec9b7c < 0) { return NULL; } return $this->encodeInput($sp11f4cb); } public static function png($sp1ca772, $sp345ad4 = false, $spde70db = QR_ECLEVEL_L, $sp74dd26 = 3, $sp5b2950 = 4, $spcdd83a = false) { $spb627dd = QRencode::factory($spde70db, $sp74dd26, $sp5b2950); return $spb627dd->encodePNG($sp1ca772, $sp345ad4, $spcdd83a = false); } public static function text($sp1ca772, $sp345ad4 = false, $spde70db = QR_ECLEVEL_L, $sp74dd26 = 3, $sp5b2950 = 4) { $spb627dd = QRencode::factory($spde70db, $sp74dd26, $sp5b2950); return $spb627dd->encode($sp1ca772, $sp345ad4); } public static function raw($sp1ca772, $sp345ad4 = false, $spde70db = QR_ECLEVEL_L, $sp74dd26 = 3, $sp5b2950 = 4) { $spb627dd = QRencode::factory($spde70db, $sp74dd26, $sp5b2950); return $spb627dd->encodeRAW($sp1ca772, $sp345ad4); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($spe3910d, &$sp22ba36) { $this->width = $spe3910d; $this->frame = $sp22ba36; $this->x = $spe3910d - 1; $this->y = $spe3910d - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($spe128dd, $sp3172ba) { $this->frame[$spe128dd['y']][$spe128dd['x']] = chr($sp3172ba); } public function getFrameAt($spe128dd) { return ord($this->frame[$spe128dd['y']][$spe128dd['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $sp8bb6f8 = $this->x; $spa1efa3 = $this->y; $spee7918 = $this->width; if ($this->bit == 0) { $sp8bb6f8--; $this->bit++; } else { $sp8bb6f8++; $spa1efa3 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($spa1efa3 < 0) { $spa1efa3 = 0; $sp8bb6f8 -= 2; $this->dir = 1; if ($sp8bb6f8 == 6) { $sp8bb6f8--; $spa1efa3 = 9; } } } else { if ($spa1efa3 == $spee7918) { $spa1efa3 = $spee7918 - 1; $sp8bb6f8 -= 2; $this->dir = -1; if ($sp8bb6f8 == 6) { $sp8bb6f8--; $spa1efa3 -= 8; } } } if ($sp8bb6f8 < 0 || $spa1efa3 < 0) { return null; } $this->x = $sp8bb6f8; $this->y = $spa1efa3; } while (ord($this->frame[$spa1efa3][$sp8bb6f8]) & 128); return array('x' => $sp8bb6f8, 'y' => $spa1efa3); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($spde70db = QR_ECLEVEL_L, $sp74dd26 = 3, $sp5b2950 = 4) { $spb627dd = new QRencode(); $spb627dd->size = $sp74dd26; $spb627dd->margin = $sp5b2950; switch ($spde70db . '') { case '0': case '1': case '2': case '3': $spb627dd->level = $spde70db; break; case 'l': case 'L': $spb627dd->level = QR_ECLEVEL_L; break; case 'm': case 'M': $spb627dd->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $spb627dd->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $spb627dd->level = QR_ECLEVEL_H; break; } return $spb627dd; } public function encodeRAW($sp82fe48, $sp345ad4 = false) { $sp808526 = new QRcode(); if ($this->eightbit) { $sp808526->encodeString8bit($sp82fe48, $this->version, $this->level); } else { $sp808526->encodeString($sp82fe48, $this->version, $this->level, $this->hint, $this->casesensitive); } return $sp808526->data; } public function encode($sp82fe48, $sp345ad4 = false) { $sp808526 = new QRcode(); if ($this->eightbit) { $sp808526->encodeString8bit($sp82fe48, $this->version, $this->level); } else { $sp808526->encodeString($sp82fe48, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($sp345ad4 !== false) { file_put_contents($sp345ad4, join('
', QRtools::binarize($sp808526->data))); } else { return QRtools::binarize($sp808526->data); } } public function encodePNG($sp82fe48, $sp345ad4 = false, $spcdd83a = false) { try { ob_start(); $sp92fd65 = $this->encode($sp82fe48); $sp9e0e41 = ob_get_contents(); ob_end_clean(); if ($sp9e0e41 != '') { QRtools::log($sp345ad4, $sp9e0e41); } $sp6d9112 = (int) (QR_PNG_MAXIMUM_SIZE / (count($sp92fd65) + 2 * $this->margin)); QRimage::png($sp92fd65, $sp345ad4, min(max(1, $this->size), $sp6d9112), $this->margin, $spcdd83a); } catch (Exception $sp805d3e) { QRtools::log($sp345ad4, $sp805d3e->getMessage()); } } }