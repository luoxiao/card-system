<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$sp9aec7e, $spbfe79b, $spc4fa9c, $sp3d96e4, $sp3a6024 = false) { $sp9aec7e[$spc4fa9c] = substr_replace($sp9aec7e[$spc4fa9c], $sp3a6024 !== false ? substr($sp3d96e4, 0, $sp3a6024) : $sp3d96e4, $spbfe79b, $sp3a6024 !== false ? $sp3a6024 : strlen($sp3d96e4)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp2b5b09) { $spf7e730 = count($sp2b5b09); foreach ($sp2b5b09 as &$spada958) { for ($spfae064 = 0; $spfae064 < $spf7e730; $spfae064++) { $spada958[$spfae064] = ord($spada958[$spfae064]) & 1 ? '1' : '0'; } } return $sp2b5b09; } public static function tcpdfBarcodeArray($sp14e657, $sp165663 = 'QR,L', $sp01fce6 = '4.5.037') { $spe65b1f = array(); if (!is_array($sp165663)) { $sp165663 = explode(',', $sp165663); } $sp7b8845 = 'L'; if (count($sp165663) > 1) { $sp7b8845 = $sp165663[1]; } $spcf85b9 = QRcode::text($sp14e657, false, $sp7b8845); $spe9007c = count($spcf85b9); $spe65b1f['num_rows'] = $spe9007c; $spe65b1f['num_cols'] = $spe9007c; $spe65b1f['bcode'] = array(); foreach ($spcf85b9 as $spcb1023) { $spb570db = array(); foreach (str_split($spcb1023) as $spb9bbcf) { $spb570db[] = $spb9bbcf == '1' ? 1 : 0; } $spe65b1f['bcode'][] = $spb570db; } return $spe65b1f; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp8f5542 = new QRmask(); for ($spa6ef60 = 1; $spa6ef60 <= QRSPEC_VERSION_MAX; $spa6ef60++) { $sp2b5b09 = QRspec::newFrame($spa6ef60); if (QR_IMAGE) { $sp15804f = QR_CACHE_DIR . 'frame_' . $spa6ef60 . '.png'; QRimage::png(self::binarize($sp2b5b09), $sp15804f, 1, 0); } $sp9a4595 = count($sp2b5b09); $sp9b2d5a = array_fill(0, $sp9a4595, array_fill(0, $sp9a4595, 0)); for ($sp0982c2 = 0; $sp0982c2 < 8; $sp0982c2++) { $sp8f5542->makeMaskNo($sp0982c2, $sp9a4595, $sp2b5b09, $sp9b2d5a, true); } } QRtools::markTime('after_build_cache'); } public static function log($spbc3b15, $spc30934) { if (QR_LOG_DIR !== false) { if ($spc30934 != '') { if ($spbc3b15 !== false) { file_put_contents(QR_LOG_DIR . basename($spbc3b15) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $spc30934, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $spc30934, FILE_APPEND); } } } } public static function dumpMask($sp2b5b09) { $sp9a4595 = count($sp2b5b09); for ($spc4fa9c = 0; $spc4fa9c < $sp9a4595; $spc4fa9c++) { for ($spbfe79b = 0; $spbfe79b < $sp9a4595; $spbfe79b++) { echo ord($sp2b5b09[$spc4fa9c][$spbfe79b]) . ','; } } } public static function markTime($sp65982e) { list($spe93ea1, $sp380e68) = explode(' ', microtime()); $sp5cd2af = (double) $spe93ea1 + (double) $sp380e68; if (!isset($sp0b2ebe['qr_time_bench'])) { $sp0b2ebe['qr_time_bench'] = array(); } $sp0b2ebe['qr_time_bench'][$sp65982e] = $sp5cd2af; } public static function timeBenchmark() { self::markTime('finish'); $sp99214c = 0; $sp2bc7a6 = 0; $spf4bc73 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($sp0b2ebe['qr_time_bench'] as $sp65982e => $sp1c08e2) { if ($spf4bc73 > 0) { echo '<tr><th style="text-align:right">till ' . $sp65982e . ': </th><td>' . number_format($sp1c08e2 - $sp99214c, 6) . 's</td></tr>'; } else { $sp2bc7a6 = $sp1c08e2; } $spf4bc73++; $sp99214c = $sp1c08e2; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp99214c - $sp2bc7a6, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($sp283726, $spb10be8) { return self::$capacity[$sp283726][QRCAP_WORDS] - self::$capacity[$sp283726][QRCAP_EC][$spb10be8]; } public static function getECCLength($sp283726, $spb10be8) { return self::$capacity[$sp283726][QRCAP_EC][$spb10be8]; } public static function getWidth($sp283726) { return self::$capacity[$sp283726][QRCAP_WIDTH]; } public static function getRemainder($sp283726) { return self::$capacity[$sp283726][QRCAP_REMINDER]; } public static function getMinimumVersion($spe9007c, $spb10be8) { for ($spfae064 = 1; $spfae064 <= QRSPEC_VERSION_MAX; $spfae064++) { $spcc0fad = self::$capacity[$spfae064][QRCAP_WORDS] - self::$capacity[$spfae064][QRCAP_EC][$spb10be8]; if ($spcc0fad >= $spe9007c) { return $spfae064; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp165663, $sp283726) { if ($sp165663 == QR_MODE_STRUCTURE) { return 0; } if ($sp283726 <= 9) { $sp916b0c = 0; } else { if ($sp283726 <= 26) { $sp916b0c = 1; } else { $sp916b0c = 2; } } return self::$lengthTableBits[$sp165663][$sp916b0c]; } public static function maximumWords($sp165663, $sp283726) { if ($sp165663 == QR_MODE_STRUCTURE) { return 3; } if ($sp283726 <= 9) { $sp916b0c = 0; } else { if ($sp283726 <= 26) { $sp916b0c = 1; } else { $sp916b0c = 2; } } $sp5456df = self::$lengthTableBits[$sp165663][$sp916b0c]; $spcc0fad = (1 << $sp5456df) - 1; if ($sp165663 == QR_MODE_KANJI) { $spcc0fad *= 2; } return $spcc0fad; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($sp283726, $spb10be8, array &$sp7e5d5a) { if (count($sp7e5d5a) < 5) { $sp7e5d5a = array(0, 0, 0, 0, 0); } $spd56a96 = self::$eccTable[$sp283726][$spb10be8][0]; $sp0132e6 = self::$eccTable[$sp283726][$spb10be8][1]; $sp151100 = self::getDataLength($sp283726, $spb10be8); $sp147b88 = self::getECCLength($sp283726, $spb10be8); if ($sp0132e6 == 0) { $sp7e5d5a[0] = $spd56a96; $sp7e5d5a[1] = (int) ($sp151100 / $spd56a96); $sp7e5d5a[2] = (int) ($sp147b88 / $spd56a96); $sp7e5d5a[3] = 0; $sp7e5d5a[4] = 0; } else { $sp7e5d5a[0] = $spd56a96; $sp7e5d5a[1] = (int) ($sp151100 / ($spd56a96 + $sp0132e6)); $sp7e5d5a[2] = (int) ($sp147b88 / ($spd56a96 + $sp0132e6)); $sp7e5d5a[3] = $sp0132e6; $sp7e5d5a[4] = $sp7e5d5a[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp2b5b09, $sp93dd00, $sp57b24e) { $spd548be = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp1cf9d2 = $sp57b24e - 2; $sp9c7497 = $sp93dd00 - 2; for ($spc4fa9c = 0; $spc4fa9c < 5; $spc4fa9c++) { QRstr::set($sp2b5b09, $sp9c7497, $sp1cf9d2 + $spc4fa9c, $spd548be[$spc4fa9c]); } } public static function putAlignmentPattern($sp283726, &$sp2b5b09, $sp9a4595) { if ($sp283726 < 2) { return; } $sp421b5f = self::$alignmentPattern[$sp283726][1] - self::$alignmentPattern[$sp283726][0]; if ($sp421b5f < 0) { $sp69a68a = 2; } else { $sp69a68a = (int) (($sp9a4595 - self::$alignmentPattern[$sp283726][0]) / $sp421b5f + 2); } if ($sp69a68a * $sp69a68a - 3 == 1) { $spbfe79b = self::$alignmentPattern[$sp283726][0]; $spc4fa9c = self::$alignmentPattern[$sp283726][0]; self::putAlignmentMarker($sp2b5b09, $spbfe79b, $spc4fa9c); return; } $spa26ad5 = self::$alignmentPattern[$sp283726][0]; for ($spbfe79b = 1; $spbfe79b < $sp69a68a - 1; $spbfe79b++) { self::putAlignmentMarker($sp2b5b09, 6, $spa26ad5); self::putAlignmentMarker($sp2b5b09, $spa26ad5, 6); $spa26ad5 += $sp421b5f; } $spb37c4a = self::$alignmentPattern[$sp283726][0]; for ($spc4fa9c = 0; $spc4fa9c < $sp69a68a - 1; $spc4fa9c++) { $spa26ad5 = self::$alignmentPattern[$sp283726][0]; for ($spbfe79b = 0; $spbfe79b < $sp69a68a - 1; $spbfe79b++) { self::putAlignmentMarker($sp2b5b09, $spa26ad5, $spb37c4a); $spa26ad5 += $sp421b5f; } $spb37c4a += $sp421b5f; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($sp283726) { if ($sp283726 < 7 || $sp283726 > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$sp283726 - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp8f5542, $spb10be8) { if ($sp8f5542 < 0 || $sp8f5542 > 7) { return 0; } if ($spb10be8 < 0 || $spb10be8 > 3) { return 0; } return self::$formatInfo[$spb10be8][$sp8f5542]; } public static $frames = array(); public static function putFinderPattern(&$sp2b5b09, $sp93dd00, $sp57b24e) { $spd548be = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($spc4fa9c = 0; $spc4fa9c < 7; $spc4fa9c++) { QRstr::set($sp2b5b09, $sp93dd00, $sp57b24e + $spc4fa9c, $spd548be[$spc4fa9c]); } } public static function createFrame($sp283726) { $sp9a4595 = self::$capacity[$sp283726][QRCAP_WIDTH]; $spada958 = str_repeat(' ', $sp9a4595); $sp2b5b09 = array_fill(0, $sp9a4595, $spada958); self::putFinderPattern($sp2b5b09, 0, 0); self::putFinderPattern($sp2b5b09, $sp9a4595 - 7, 0); self::putFinderPattern($sp2b5b09, 0, $sp9a4595 - 7); $sp9fe9f4 = $sp9a4595 - 7; for ($spc4fa9c = 0; $spc4fa9c < 7; $spc4fa9c++) { $sp2b5b09[$spc4fa9c][7] = '¿'; $sp2b5b09[$spc4fa9c][$sp9a4595 - 8] = '¿'; $sp2b5b09[$sp9fe9f4][7] = '¿'; $sp9fe9f4++; } $sp6d566e = str_repeat('¿', 8); QRstr::set($sp2b5b09, 0, 7, $sp6d566e); QRstr::set($sp2b5b09, $sp9a4595 - 8, 7, $sp6d566e); QRstr::set($sp2b5b09, 0, $sp9a4595 - 8, $sp6d566e); $sp6d566e = str_repeat('Ñ', 9); QRstr::set($sp2b5b09, 0, 8, $sp6d566e); QRstr::set($sp2b5b09, $sp9a4595 - 8, 8, $sp6d566e, 8); $sp9fe9f4 = $sp9a4595 - 8; for ($spc4fa9c = 0; $spc4fa9c < 8; $spc4fa9c++, $sp9fe9f4++) { $sp2b5b09[$spc4fa9c][8] = 'Ñ'; $sp2b5b09[$sp9fe9f4][8] = 'Ñ'; } for ($spfae064 = 1; $spfae064 < $sp9a4595 - 15; $spfae064++) { $sp2b5b09[6][7 + $spfae064] = chr(144 | $spfae064 & 1); $sp2b5b09[7 + $spfae064][6] = chr(144 | $spfae064 & 1); } self::putAlignmentPattern($sp283726, $sp2b5b09, $sp9a4595); if ($sp283726 >= 7) { $spc13db1 = self::getVersionPattern($sp283726); $sp99652d = $spc13db1; for ($spbfe79b = 0; $spbfe79b < 6; $spbfe79b++) { for ($spc4fa9c = 0; $spc4fa9c < 3; $spc4fa9c++) { $sp2b5b09[$sp9a4595 - 11 + $spc4fa9c][$spbfe79b] = chr(136 | $sp99652d & 1); $sp99652d = $sp99652d >> 1; } } $sp99652d = $spc13db1; for ($spc4fa9c = 0; $spc4fa9c < 6; $spc4fa9c++) { for ($spbfe79b = 0; $spbfe79b < 3; $spbfe79b++) { $sp2b5b09[$spc4fa9c][$spbfe79b + ($sp9a4595 - 11)] = chr(136 | $sp99652d & 1); $sp99652d = $sp99652d >> 1; } } } $sp2b5b09[$sp9a4595 - 8][8] = 'Å'; return $sp2b5b09; } public static function debug($sp2b5b09, $sp5adf4c = false) { if ($sp5adf4c) { foreach ($sp2b5b09 as &$spada958) { $spada958 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $spada958)); $spada958 = join('&#9608;&#9608;', explode('1', $spada958)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp2b5b09); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp2b5b09 as &$spada958) { $spada958 = join('<span class="m">&nbsp;</span>', explode('¿', $spada958)); $spada958 = join('<span class="m">&#9618;</span>', explode('¡', $spada958)); $spada958 = join('<span class="p">&nbsp;</span>', explode('†', $spada958)); $spada958 = join('<span class="p">&#9618;</span>', explode('°', $spada958)); $spada958 = join('<span class="s">&#9671;</span>', explode('Ñ', $spada958)); $spada958 = join('<span class="s">&#9670;</span>', explode('Ö', $spada958)); $spada958 = join('<span class="x">&#9762;</span>', explode('Å', $spada958)); $spada958 = join('<span class="c">&nbsp;</span>', explode('ê', $spada958)); $spada958 = join('<span class="c">&#9719;</span>', explode('ë', $spada958)); $spada958 = join('<span class="f">&nbsp;</span>', explode('à', $spada958)); $spada958 = join('<span class="f">&#9618;</span>', explode('â', $spada958)); $spada958 = join('&#9830;', explode('', $spada958)); $spada958 = join('&#8901;', explode(' ', $spada958)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp2b5b09); echo '</tt></pre>'; } } public static function serial($sp2b5b09) { return gzcompress(join('
', $sp2b5b09), 9); } public static function unserial($sp14e657) { return explode('
', gzuncompress($sp14e657)); } public static function newFrame($sp283726) { if ($sp283726 < 1 || $sp283726 > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$sp283726])) { $sp15804f = QR_CACHE_DIR . 'frame_' . $sp283726 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp15804f)) { self::$frames[$sp283726] = self::unserial(file_get_contents($sp15804f)); } else { self::$frames[$sp283726] = self::createFrame($sp283726); file_put_contents($sp15804f, self::serial(self::$frames[$sp283726])); } } else { self::$frames[$sp283726] = self::createFrame($sp283726); } } if (is_null(self::$frames[$sp283726])) { return null; } return self::$frames[$sp283726]; } public static function rsBlockNum($sp7e5d5a) { return $sp7e5d5a[0] + $sp7e5d5a[3]; } public static function rsBlockNum1($sp7e5d5a) { return $sp7e5d5a[0]; } public static function rsDataCodes1($sp7e5d5a) { return $sp7e5d5a[1]; } public static function rsEccCodes1($sp7e5d5a) { return $sp7e5d5a[2]; } public static function rsBlockNum2($sp7e5d5a) { return $sp7e5d5a[3]; } public static function rsDataCodes2($sp7e5d5a) { return $sp7e5d5a[4]; } public static function rsEccCodes2($sp7e5d5a) { return $sp7e5d5a[2]; } public static function rsDataLength($sp7e5d5a) { return $sp7e5d5a[0] * $sp7e5d5a[1] + $sp7e5d5a[3] * $sp7e5d5a[4]; } public static function rsEccLength($sp7e5d5a) { return ($sp7e5d5a[0] + $sp7e5d5a[3]) * $sp7e5d5a[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp2b5b09, $spefa4a1 = false, $spcd5f0f = 4, $spb67278 = 4, $spd3d563 = FALSE) { $spdfabf7 = self::image($sp2b5b09, $spcd5f0f, $spb67278); if ($spefa4a1 === false) { Header('Content-type: image/png'); ImagePng($spdfabf7); } else { if ($spd3d563 === TRUE) { ImagePng($spdfabf7, $spefa4a1); header('Content-type: image/png'); ImagePng($spdfabf7); } else { ImagePng($spdfabf7, $spefa4a1); } } ImageDestroy($spdfabf7); } public static function jpg($sp2b5b09, $spefa4a1 = false, $spcd5f0f = 8, $spb67278 = 4, $sp92a472 = 85) { $spdfabf7 = self::image($sp2b5b09, $spcd5f0f, $spb67278); if ($spefa4a1 === false) { Header('Content-type: image/jpeg'); ImageJpeg($spdfabf7, null, $sp92a472); } else { ImageJpeg($spdfabf7, $spefa4a1, $sp92a472); } ImageDestroy($spdfabf7); } private static function image($sp2b5b09, $spcd5f0f = 4, $spb67278 = 4) { $spd3fe6a = count($sp2b5b09); $sp69a68a = strlen($sp2b5b09[0]); $spe23975 = $sp69a68a + 2 * $spb67278; $sp4988fc = $spd3fe6a + 2 * $spb67278; $spbcec70 = ImageCreate($spe23975, $sp4988fc); $sp30cb43[0] = ImageColorAllocate($spbcec70, 255, 255, 255); $sp30cb43[1] = ImageColorAllocate($spbcec70, 0, 0, 0); imagefill($spbcec70, 0, 0, $sp30cb43[0]); for ($spc4fa9c = 0; $spc4fa9c < $spd3fe6a; $spc4fa9c++) { for ($spbfe79b = 0; $spbfe79b < $sp69a68a; $spbfe79b++) { if ($sp2b5b09[$spc4fa9c][$spbfe79b] == '1') { ImageSetPixel($spbcec70, $spbfe79b + $spb67278, $spc4fa9c + $spb67278, $sp30cb43[1]); } } } $sp6700db = ImageCreate($spe23975 * $spcd5f0f, $sp4988fc * $spcd5f0f); ImageCopyResized($sp6700db, $spbcec70, 0, 0, 0, 0, $spe23975 * $spcd5f0f, $sp4988fc * $spcd5f0f, $spe23975, $sp4988fc); ImageDestroy($spbcec70); return $sp6700db; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp165663, $spe9007c, $sp151100, $sp377e0f = null) { $spdf038c = array_slice($sp151100, 0, $spe9007c); if (count($spdf038c) < $spe9007c) { $spdf038c = array_merge($spdf038c, array_fill(0, $spe9007c - count($spdf038c), 0)); } if (!QRinput::check($sp165663, $spe9007c, $spdf038c)) { throw new Exception('Error m:' . $sp165663 . ',s:' . $spe9007c . ',d:' . join(',', $spdf038c)); return null; } $this->mode = $sp165663; $this->size = $spe9007c; $this->data = $spdf038c; $this->bstream = $sp377e0f; } public function encodeModeNum($sp283726) { try { $spcc0fad = (int) ($this->size / 3); $sp5b08ba = new QRbitstream(); $sp1f05d8 = 1; $sp5b08ba->appendNum(4, $sp1f05d8); $sp5b08ba->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $sp283726), $this->size); for ($spfae064 = 0; $spfae064 < $spcc0fad; $spfae064++) { $sp1f05d8 = (ord($this->data[$spfae064 * 3]) - ord('0')) * 100; $sp1f05d8 += (ord($this->data[$spfae064 * 3 + 1]) - ord('0')) * 10; $sp1f05d8 += ord($this->data[$spfae064 * 3 + 2]) - ord('0'); $sp5b08ba->appendNum(10, $sp1f05d8); } if ($this->size - $spcc0fad * 3 == 1) { $sp1f05d8 = ord($this->data[$spcc0fad * 3]) - ord('0'); $sp5b08ba->appendNum(4, $sp1f05d8); } else { if ($this->size - $spcc0fad * 3 == 2) { $sp1f05d8 = (ord($this->data[$spcc0fad * 3]) - ord('0')) * 10; $sp1f05d8 += ord($this->data[$spcc0fad * 3 + 1]) - ord('0'); $sp5b08ba->appendNum(7, $sp1f05d8); } } $this->bstream = $sp5b08ba; return 0; } catch (Exception $sp9e5801) { return -1; } } public function encodeModeAn($sp283726) { try { $spcc0fad = (int) ($this->size / 2); $sp5b08ba = new QRbitstream(); $sp5b08ba->appendNum(4, 2); $sp5b08ba->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $sp283726), $this->size); for ($spfae064 = 0; $spfae064 < $spcc0fad; $spfae064++) { $sp1f05d8 = (int) QRinput::lookAnTable(ord($this->data[$spfae064 * 2])) * 45; $sp1f05d8 += (int) QRinput::lookAnTable(ord($this->data[$spfae064 * 2 + 1])); $sp5b08ba->appendNum(11, $sp1f05d8); } if ($this->size & 1) { $sp1f05d8 = QRinput::lookAnTable(ord($this->data[$spcc0fad * 2])); $sp5b08ba->appendNum(6, $sp1f05d8); } $this->bstream = $sp5b08ba; return 0; } catch (Exception $sp9e5801) { return -1; } } public function encodeMode8($sp283726) { try { $sp5b08ba = new QRbitstream(); $sp5b08ba->appendNum(4, 4); $sp5b08ba->appendNum(QRspec::lengthIndicator(QR_MODE_8, $sp283726), $this->size); for ($spfae064 = 0; $spfae064 < $this->size; $spfae064++) { $sp5b08ba->appendNum(8, ord($this->data[$spfae064])); } $this->bstream = $sp5b08ba; return 0; } catch (Exception $sp9e5801) { return -1; } } public function encodeModeKanji($sp283726) { try { $sp5b08ba = new QRbitrtream(); $sp5b08ba->appendNum(4, 8); $sp5b08ba->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $sp283726), (int) ($this->size / 2)); for ($spfae064 = 0; $spfae064 < $this->size; $spfae064 += 2) { $sp1f05d8 = ord($this->data[$spfae064]) << 8 | ord($this->data[$spfae064 + 1]); if ($sp1f05d8 <= 40956) { $sp1f05d8 -= 33088; } else { $sp1f05d8 -= 49472; } $spd3fe6a = ($sp1f05d8 >> 8) * 192; $sp1f05d8 = ($sp1f05d8 & 255) + $spd3fe6a; $sp5b08ba->appendNum(13, $sp1f05d8); } $this->bstream = $sp5b08ba; return 0; } catch (Exception $sp9e5801) { return -1; } } public function encodeModeStructure() { try { $sp5b08ba = new QRbitstream(); $sp5b08ba->appendNum(4, 3); $sp5b08ba->appendNum(4, ord($this->data[1]) - 1); $sp5b08ba->appendNum(4, ord($this->data[0]) - 1); $sp5b08ba->appendNum(8, ord($this->data[2])); $this->bstream = $sp5b08ba; return 0; } catch (Exception $sp9e5801) { return -1; } } public function estimateBitStreamSizeOfEntry($sp283726) { $sp5456df = 0; if ($sp283726 == 0) { $sp283726 = 1; } switch ($this->mode) { case QR_MODE_NUM: $sp5456df = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $sp5456df = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $sp5456df = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $sp5456df = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $sp916b0c = QRspec::lengthIndicator($this->mode, $sp283726); $sp34b113 = 1 << $sp916b0c; $sp05f3c8 = (int) (($this->size + $sp34b113 - 1) / $sp34b113); $sp5456df += $sp05f3c8 * (4 + $sp916b0c); return $sp5456df; } public function encodeBitStream($sp283726) { try { unset($this->bstream); $spcc0fad = QRspec::maximumWords($this->mode, $sp283726); if ($this->size > $spcc0fad) { $sp7086f0 = new QRinputItem($this->mode, $spcc0fad, $this->data); $sp4dda2c = new QRinputItem($this->mode, $this->size - $spcc0fad, array_slice($this->data, $spcc0fad)); $sp7086f0->encodeBitStream($sp283726); $sp4dda2c->encodeBitStream($sp283726); $this->bstream = new QRbitstream(); $this->bstream->append($sp7086f0->bstream); $this->bstream->append($sp4dda2c->bstream); unset($sp7086f0); unset($sp4dda2c); } else { $sp123706 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp123706 = $this->encodeModeNum($sp283726); break; case QR_MODE_AN: $sp123706 = $this->encodeModeAn($sp283726); break; case QR_MODE_8: $sp123706 = $this->encodeMode8($sp283726); break; case QR_MODE_KANJI: $sp123706 = $this->encodeModeKanji($sp283726); break; case QR_MODE_STRUCTURE: $sp123706 = $this->encodeModeStructure(); break; default: break; } if ($sp123706 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $sp9e5801) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($sp283726 = 0, $spb10be8 = QR_ECLEVEL_L) { if ($sp283726 < 0 || $sp283726 > QRSPEC_VERSION_MAX || $spb10be8 > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $sp283726; $this->level = $spb10be8; } public function getVersion() { return $this->version; } public function setVersion($sp283726) { if ($sp283726 < 0 || $sp283726 > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $sp283726; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($spb10be8) { if ($spb10be8 > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $spb10be8; return 0; } public function appendEntry(QRinputItem $spc2c0be) { $this->items[] = $spc2c0be; } public function append($sp165663, $spe9007c, $sp151100) { try { $spc2c0be = new QRinputItem($sp165663, $spe9007c, $sp151100); $this->items[] = $spc2c0be; return 0; } catch (Exception $sp9e5801) { return -1; } } public function insertStructuredAppendHeader($spe9007c, $spdc76e0, $sp28f47a) { if ($spe9007c > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($spdc76e0 <= 0 || $spdc76e0 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $sp5f536d = array($spe9007c, $spdc76e0, $sp28f47a); try { $spc2c0be = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $spc2c0be); return 0; } catch (Exception $sp9e5801) { return -1; } } public function calcParity() { $sp28f47a = 0; foreach ($this->items as $spa41ce4) { if ($spa41ce4->mode != QR_MODE_STRUCTURE) { for ($spfae064 = $spa41ce4->size - 1; $spfae064 >= 0; $spfae064--) { $sp28f47a ^= $spa41ce4->data[$spfae064]; } } } return $sp28f47a; } public static function checkModeNum($spe9007c, $sp151100) { for ($spfae064 = 0; $spfae064 < $spe9007c; $spfae064++) { if (ord($sp151100[$spfae064]) < ord('0') || ord($sp151100[$spfae064]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($spe9007c) { $sp69a68a = (int) $spe9007c / 3; $sp5456df = $sp69a68a * 10; switch ($spe9007c - $sp69a68a * 3) { case 1: $sp5456df += 4; break; case 2: $sp5456df += 7; break; default: break; } return $sp5456df; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($spe42bdc) { return $spe42bdc > 127 ? -1 : self::$anTable[$spe42bdc]; } public static function checkModeAn($spe9007c, $sp151100) { for ($spfae064 = 0; $spfae064 < $spe9007c; $spfae064++) { if (self::lookAnTable(ord($sp151100[$spfae064])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($spe9007c) { $sp69a68a = (int) ($spe9007c / 2); $sp5456df = $sp69a68a * 11; if ($spe9007c & 1) { $sp5456df += 6; } return $sp5456df; } public static function estimateBitsMode8($spe9007c) { return $spe9007c * 8; } public function estimateBitsModeKanji($spe9007c) { return (int) ($spe9007c / 2 * 13); } public static function checkModeKanji($spe9007c, $sp151100) { if ($spe9007c & 1) { return false; } for ($spfae064 = 0; $spfae064 < $spe9007c; $spfae064 += 2) { $sp1f05d8 = ord($sp151100[$spfae064]) << 8 | ord($sp151100[$spfae064 + 1]); if ($sp1f05d8 < 33088 || $sp1f05d8 > 40956 && $sp1f05d8 < 57408 || $sp1f05d8 > 60351) { return false; } } return true; } public static function check($sp165663, $spe9007c, $sp151100) { if ($spe9007c <= 0) { return false; } switch ($sp165663) { case QR_MODE_NUM: return self::checkModeNum($spe9007c, $sp151100); break; case QR_MODE_AN: return self::checkModeAn($spe9007c, $sp151100); break; case QR_MODE_KANJI: return self::checkModeKanji($spe9007c, $sp151100); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($sp283726) { $sp5456df = 0; foreach ($this->items as $spa41ce4) { $sp5456df += $spa41ce4->estimateBitStreamSizeOfEntry($sp283726); } return $sp5456df; } public function estimateVersion() { $sp283726 = 0; $sp061fca = 0; do { $sp061fca = $sp283726; $sp5456df = $this->estimateBitStreamSize($sp061fca); $sp283726 = QRspec::getMinimumVersion((int) (($sp5456df + 7) / 8), $this->level); if ($sp283726 < 0) { return -1; } } while ($sp283726 > $sp061fca); return $sp283726; } public static function lengthOfCode($sp165663, $sp283726, $sp5456df) { $sp229180 = $sp5456df - 4 - QRspec::lengthIndicator($sp165663, $sp283726); switch ($sp165663) { case QR_MODE_NUM: $spe98b61 = (int) ($sp229180 / 10); $spea1bf8 = $sp229180 - $spe98b61 * 10; $spe9007c = $spe98b61 * 3; if ($spea1bf8 >= 7) { $spe9007c += 2; } else { if ($spea1bf8 >= 4) { $spe9007c += 1; } } break; case QR_MODE_AN: $spe98b61 = (int) ($sp229180 / 11); $spea1bf8 = $sp229180 - $spe98b61 * 11; $spe9007c = $spe98b61 * 2; if ($spea1bf8 >= 6) { $spe9007c++; } break; case QR_MODE_8: $spe9007c = (int) ($sp229180 / 8); break; case QR_MODE_KANJI: $spe9007c = (int) ($sp229180 / 13 * 2); break; case QR_MODE_STRUCTURE: $spe9007c = (int) ($sp229180 / 8); break; default: $spe9007c = 0; break; } $sp6eb5e6 = QRspec::maximumWords($sp165663, $sp283726); if ($spe9007c < 0) { $spe9007c = 0; } if ($spe9007c > $sp6eb5e6) { $spe9007c = $sp6eb5e6; } return $spe9007c; } public function createBitStream() { $sp8d7983 = 0; foreach ($this->items as $spa41ce4) { $sp5456df = $spa41ce4->encodeBitStream($this->version); if ($sp5456df < 0) { return -1; } $sp8d7983 += $sp5456df; } return $sp8d7983; } public function convertData() { $spaf6885 = $this->estimateVersion(); if ($spaf6885 > $this->getVersion()) { $this->setVersion($spaf6885); } for (;;) { $sp5456df = $this->createBitStream(); if ($sp5456df < 0) { return -1; } $spaf6885 = QRspec::getMinimumVersion((int) (($sp5456df + 7) / 8), $this->level); if ($spaf6885 < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spaf6885 > $this->getVersion()) { $this->setVersion($spaf6885); } else { break; } } } return 0; } public function appendPaddingBit(&$sp377e0f) { $sp5456df = $sp377e0f->size(); $spd1ea80 = QRspec::getDataLength($this->version, $this->level); $sp3bc2a7 = $spd1ea80 * 8; if ($sp3bc2a7 == $sp5456df) { return 0; } if ($sp3bc2a7 - $sp5456df < 5) { return $sp377e0f->appendNum($sp3bc2a7 - $sp5456df, 0); } $sp5456df += 4; $spcc0fad = (int) (($sp5456df + 7) / 8); $sp4379e1 = new QRbitstream(); $sp123706 = $sp4379e1->appendNum($spcc0fad * 8 - $sp5456df + 4, 0); if ($sp123706 < 0) { return $sp123706; } $sp58643b = $spd1ea80 - $spcc0fad; if ($sp58643b > 0) { $sp573cb9 = array(); for ($spfae064 = 0; $spfae064 < $sp58643b; $spfae064++) { $sp573cb9[$spfae064] = $spfae064 & 1 ? 17 : 236; } $sp123706 = $sp4379e1->appendBytes($sp58643b, $sp573cb9); if ($sp123706 < 0) { return $sp123706; } } $sp123706 = $sp377e0f->append($sp4379e1); return $sp123706; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $sp377e0f = new QRbitstream(); foreach ($this->items as $spa41ce4) { $sp123706 = $sp377e0f->append($spa41ce4->bstream); if ($sp123706 < 0) { return null; } } return $sp377e0f; } public function getBitStream() { $sp377e0f = $this->mergeBitStream(); if ($sp377e0f == null) { return null; } $sp123706 = $this->appendPaddingBit($sp377e0f); if ($sp123706 < 0) { return null; } return $sp377e0f; } public function getByteStream() { $sp377e0f = $this->getBitStream(); if ($sp377e0f == null) { return null; } return $sp377e0f->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($sp5eea16) { $this->data = array_fill(0, $sp5eea16, 0); return 0; } public static function newFromNum($sp5456df, $sp05f3c8) { $sp377e0f = new QRbitstream(); $sp377e0f->allocate($sp5456df); $sp8f5542 = 1 << $sp5456df - 1; for ($spfae064 = 0; $spfae064 < $sp5456df; $spfae064++) { if ($sp05f3c8 & $sp8f5542) { $sp377e0f->data[$spfae064] = 1; } else { $sp377e0f->data[$spfae064] = 0; } $sp8f5542 = $sp8f5542 >> 1; } return $sp377e0f; } public static function newFromBytes($spe9007c, $sp151100) { $sp377e0f = new QRbitstream(); $sp377e0f->allocate($spe9007c * 8); $spf4bc73 = 0; for ($spfae064 = 0; $spfae064 < $spe9007c; $spfae064++) { $sp8f5542 = 128; for ($sp47ed96 = 0; $sp47ed96 < 8; $sp47ed96++) { if ($sp151100[$spfae064] & $sp8f5542) { $sp377e0f->data[$spf4bc73] = 1; } else { $sp377e0f->data[$spf4bc73] = 0; } $spf4bc73++; $sp8f5542 = $sp8f5542 >> 1; } } return $sp377e0f; } public function append(QRbitstream $sp1fcd9e) { if (is_null($sp1fcd9e)) { return -1; } if ($sp1fcd9e->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $sp1fcd9e->data; return 0; } $this->data = array_values(array_merge($this->data, $sp1fcd9e->data)); return 0; } public function appendNum($sp5456df, $sp05f3c8) { if ($sp5456df == 0) { return 0; } $sp36f572 = QRbitstream::newFromNum($sp5456df, $sp05f3c8); if (is_null($sp36f572)) { return -1; } $sp123706 = $this->append($sp36f572); unset($sp36f572); return $sp123706; } public function appendBytes($spe9007c, $sp151100) { if ($spe9007c == 0) { return 0; } $sp36f572 = QRbitstream::newFromBytes($spe9007c, $sp151100); if (is_null($sp36f572)) { return -1; } $sp123706 = $this->append($sp36f572); unset($sp36f572); return $sp123706; } public function toByte() { $spe9007c = $this->size(); if ($spe9007c == 0) { return array(); } $sp151100 = array_fill(0, (int) (($spe9007c + 7) / 8), 0); $sp8d12a6 = (int) ($spe9007c / 8); $spf4bc73 = 0; for ($spfae064 = 0; $spfae064 < $sp8d12a6; $spfae064++) { $sp99652d = 0; for ($sp47ed96 = 0; $sp47ed96 < 8; $sp47ed96++) { $sp99652d = $sp99652d << 1; $sp99652d |= $this->data[$spf4bc73]; $spf4bc73++; } $sp151100[$spfae064] = $sp99652d; } if ($spe9007c & 7) { $sp99652d = 0; for ($sp47ed96 = 0; $sp47ed96 < ($spe9007c & 7); $sp47ed96++) { $sp99652d = $sp99652d << 1; $sp99652d |= $this->data[$spf4bc73]; $spf4bc73++; } $sp151100[$sp8d12a6] = $sp99652d; } return $sp151100; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($sp8e53ea, $sp02dbf9, $spb93ea3) { $this->dataStr = $sp8e53ea; $this->input = $sp02dbf9; $this->modeHint = $spb93ea3; } public static function isdigitat($spdeb044, $spbfce4b) { if ($spbfce4b >= strlen($spdeb044)) { return false; } return ord($spdeb044[$spbfce4b]) >= ord('0') && ord($spdeb044[$spbfce4b]) <= ord('9'); } public static function isalnumat($spdeb044, $spbfce4b) { if ($spbfce4b >= strlen($spdeb044)) { return false; } return QRinput::lookAnTable(ord($spdeb044[$spbfce4b])) >= 0; } public function identifyMode($spbfce4b) { if ($spbfce4b >= strlen($this->dataStr)) { return QR_MODE_NUL; } $spe42bdc = $this->dataStr[$spbfce4b]; if (self::isdigitat($this->dataStr, $spbfce4b)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $spbfce4b)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($spbfce4b + 1 < strlen($this->dataStr)) { $sp421b5f = $this->dataStr[$spbfce4b + 1]; $sp415128 = ord($spe42bdc) << 8 | ord($sp421b5f); if ($sp415128 >= 33088 && $sp415128 <= 40956 || $sp415128 >= 57408 && $sp415128 <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $spe25198 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spf4bc73 = 0; while (self::isdigitat($this->dataStr, $spf4bc73)) { $spf4bc73++; } $sp1f6790 = $spf4bc73; $sp165663 = $this->identifyMode($spf4bc73); if ($sp165663 == QR_MODE_8) { $spfbdca7 = QRinput::estimateBitsModeNum($sp1f6790) + 4 + $spe25198 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp1f6790 + 1); if ($spfbdca7 > 0) { return $this->eat8(); } } if ($sp165663 == QR_MODE_AN) { $spfbdca7 = QRinput::estimateBitsModeNum($sp1f6790) + 4 + $spe25198 + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($sp1f6790 + 1); if ($spfbdca7 > 0) { return $this->eatAn(); } } $sp123706 = $this->input->append(QR_MODE_NUM, $sp1f6790, str_split($this->dataStr)); if ($sp123706 < 0) { return -1; } return $sp1f6790; } public function eatAn() { $sp9de55e = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $spe25198 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spf4bc73 = 0; while (self::isalnumat($this->dataStr, $spf4bc73)) { if (self::isdigitat($this->dataStr, $spf4bc73)) { $sp92a472 = $spf4bc73; while (self::isdigitat($this->dataStr, $sp92a472)) { $sp92a472++; } $spfbdca7 = QRinput::estimateBitsModeAn($spf4bc73) + QRinput::estimateBitsModeNum($sp92a472 - $spf4bc73) + 4 + $spe25198 - QRinput::estimateBitsModeAn($sp92a472); if ($spfbdca7 < 0) { break; } else { $spf4bc73 = $sp92a472; } } else { $spf4bc73++; } } $sp1f6790 = $spf4bc73; if (!self::isalnumat($this->dataStr, $spf4bc73)) { $spfbdca7 = QRinput::estimateBitsModeAn($sp1f6790) + 4 + $sp9de55e + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp1f6790 + 1); if ($spfbdca7 > 0) { return $this->eat8(); } } $sp123706 = $this->input->append(QR_MODE_AN, $sp1f6790, str_split($this->dataStr)); if ($sp123706 < 0) { return -1; } return $sp1f6790; } public function eatKanji() { $spf4bc73 = 0; while ($this->identifyMode($spf4bc73) == QR_MODE_KANJI) { $spf4bc73 += 2; } $sp123706 = $this->input->append(QR_MODE_KANJI, $spf4bc73, str_split($this->dataStr)); if ($sp123706 < 0) { return -1; } return $sp1f6790; } public function eat8() { $sp9de55e = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $spe25198 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spf4bc73 = 1; $spf51448 = strlen($this->dataStr); while ($spf4bc73 < $spf51448) { $sp165663 = $this->identifyMode($spf4bc73); if ($sp165663 == QR_MODE_KANJI) { break; } if ($sp165663 == QR_MODE_NUM) { $sp92a472 = $spf4bc73; while (self::isdigitat($this->dataStr, $sp92a472)) { $sp92a472++; } $spfbdca7 = QRinput::estimateBitsMode8($spf4bc73) + QRinput::estimateBitsModeNum($sp92a472 - $spf4bc73) + 4 + $spe25198 - QRinput::estimateBitsMode8($sp92a472); if ($spfbdca7 < 0) { break; } else { $spf4bc73 = $sp92a472; } } else { if ($sp165663 == QR_MODE_AN) { $sp92a472 = $spf4bc73; while (self::isalnumat($this->dataStr, $sp92a472)) { $sp92a472++; } $spfbdca7 = QRinput::estimateBitsMode8($spf4bc73) + QRinput::estimateBitsModeAn($sp92a472 - $spf4bc73) + 4 + $sp9de55e - QRinput::estimateBitsMode8($sp92a472); if ($spfbdca7 < 0) { break; } else { $spf4bc73 = $sp92a472; } } else { $spf4bc73++; } } } $sp1f6790 = $spf4bc73; $sp123706 = $this->input->append(QR_MODE_8, $sp1f6790, str_split($this->dataStr)); if ($sp123706 < 0) { return -1; } return $sp1f6790; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp165663 = $this->identifyMode(0); switch ($sp165663) { case QR_MODE_NUM: $spef2f8c = $this->eatNum(); break; case QR_MODE_AN: $spef2f8c = $this->eatAn(); break; case QR_MODE_KANJI: if ($spe0cf5e == QR_MODE_KANJI) { $spef2f8c = $this->eatKanji(); } else { $spef2f8c = $this->eat8(); } break; default: $spef2f8c = $this->eat8(); break; } if ($spef2f8c == 0) { return 0; } if ($spef2f8c < 0) { return -1; } $this->dataStr = substr($this->dataStr, $spef2f8c); } } public function toUpper() { $sp8727f8 = strlen($this->dataStr); $spf4bc73 = 0; while ($spf4bc73 < $sp8727f8) { $sp165663 = self::identifyMode(substr($this->dataStr, $spf4bc73), $this->modeHint); if ($sp165663 == QR_MODE_KANJI) { $spf4bc73 += 2; } else { if (ord($this->dataStr[$spf4bc73]) >= ord('a') && ord($this->dataStr[$spf4bc73]) <= ord('z')) { $this->dataStr[$spf4bc73] = chr(ord($this->dataStr[$spf4bc73]) - 32); } $spf4bc73++; } } return $this->dataStr; } public static function splitStringToQRinput($sp227000, QRinput $sp02dbf9, $spb93ea3, $sp9e8109 = true) { if (is_null($sp227000) || $sp227000 == '\\0' || $sp227000 == '') { throw new Exception('empty string!!!'); } $sp3b0ffe = new QRsplit($sp227000, $sp02dbf9, $spb93ea3); if (!$sp9e8109) { $sp3b0ffe->toUpper(); } return $sp3b0ffe->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($spbfe79b) { while ($spbfe79b >= $this->nn) { $spbfe79b -= $this->nn; $spbfe79b = ($spbfe79b >> $this->mm) + ($spbfe79b & $this->nn); } return $spbfe79b; } public static function init_rs_char($sp265c0c, $spa953a1, $sp340d7a, $sp969ec8, $spbebc47, $sp94d6d6) { $spd743b9 = null; if ($sp265c0c < 0 || $sp265c0c > 8) { return $spd743b9; } if ($sp340d7a < 0 || $sp340d7a >= 1 << $sp265c0c) { return $spd743b9; } if ($sp969ec8 <= 0 || $sp969ec8 >= 1 << $sp265c0c) { return $spd743b9; } if ($spbebc47 < 0 || $spbebc47 >= 1 << $sp265c0c) { return $spd743b9; } if ($sp94d6d6 < 0 || $sp94d6d6 >= (1 << $sp265c0c) - 1 - $spbebc47) { return $spd743b9; } $spd743b9 = new QRrsItem(); $spd743b9->mm = $sp265c0c; $spd743b9->nn = (1 << $sp265c0c) - 1; $spd743b9->pad = $sp94d6d6; $spd743b9->alpha_to = array_fill(0, $spd743b9->nn + 1, 0); $spd743b9->index_of = array_fill(0, $spd743b9->nn + 1, 0); $spd71493 =& $spd743b9->nn; $spccf843 =& $spd71493; $spd743b9->index_of[0] = $spccf843; $spd743b9->alpha_to[$spccf843] = 0; $sp2765bd = 1; for ($spfae064 = 0; $spfae064 < $spd743b9->nn; $spfae064++) { $spd743b9->index_of[$sp2765bd] = $spfae064; $spd743b9->alpha_to[$spfae064] = $sp2765bd; $sp2765bd <<= 1; if ($sp2765bd & 1 << $sp265c0c) { $sp2765bd ^= $spa953a1; } $sp2765bd &= $spd743b9->nn; } if ($sp2765bd != 1) { $spd743b9 = NULL; return $spd743b9; } $spd743b9->genpoly = array_fill(0, $spbebc47 + 1, 0); $spd743b9->fcr = $sp340d7a; $spd743b9->prim = $sp969ec8; $spd743b9->nroots = $spbebc47; $spd743b9->gfpoly = $spa953a1; for ($spc38712 = 1; $spc38712 % $sp969ec8 != 0; $spc38712 += $spd743b9->nn) { } $spd743b9->iprim = (int) ($spc38712 / $sp969ec8); $spd743b9->genpoly[0] = 1; for ($spfae064 = 0, $sp9e98e0 = $sp340d7a * $sp969ec8; $spfae064 < $spbebc47; $spfae064++, $sp9e98e0 += $sp969ec8) { $spd743b9->genpoly[$spfae064 + 1] = 1; for ($sp47ed96 = $spfae064; $sp47ed96 > 0; $sp47ed96--) { if ($spd743b9->genpoly[$sp47ed96] != 0) { $spd743b9->genpoly[$sp47ed96] = $spd743b9->genpoly[$sp47ed96 - 1] ^ $spd743b9->alpha_to[$spd743b9->modnn($spd743b9->index_of[$spd743b9->genpoly[$sp47ed96]] + $sp9e98e0)]; } else { $spd743b9->genpoly[$sp47ed96] = $spd743b9->genpoly[$sp47ed96 - 1]; } } $spd743b9->genpoly[0] = $spd743b9->alpha_to[$spd743b9->modnn($spd743b9->index_of[$spd743b9->genpoly[0]] + $sp9e98e0)]; } for ($spfae064 = 0; $spfae064 <= $spbebc47; $spfae064++) { $spd743b9->genpoly[$spfae064] = $spd743b9->index_of[$spd743b9->genpoly[$spfae064]]; } return $spd743b9; } public function encode_rs_char($sp151100, &$sp28f47a) { $sp021c5b =& $this->mm; $spd71493 =& $this->nn; $spa6d4e8 =& $this->alpha_to; $sp2857a7 =& $this->index_of; $spda928e =& $this->genpoly; $spe95585 =& $this->nroots; $sp7cf90e =& $this->fcr; $spbe49b5 =& $this->prim; $sp020846 =& $this->iprim; $spe10b11 =& $this->pad; $spccf843 =& $spd71493; $sp28f47a = array_fill(0, $spe95585, 0); for ($spfae064 = 0; $spfae064 < $spd71493 - $spe95585 - $spe10b11; $spfae064++) { $spf02c0e = $sp2857a7[$sp151100[$spfae064] ^ $sp28f47a[0]]; if ($spf02c0e != $spccf843) { $spf02c0e = $this->modnn($spd71493 - $spda928e[$spe95585] + $spf02c0e); for ($sp47ed96 = 1; $sp47ed96 < $spe95585; $sp47ed96++) { $sp28f47a[$sp47ed96] ^= $spa6d4e8[$this->modnn($spf02c0e + $spda928e[$spe95585 - $sp47ed96])]; } } array_shift($sp28f47a); if ($spf02c0e != $spccf843) { array_push($sp28f47a, $spa6d4e8[$this->modnn($spf02c0e + $spda928e[0])]); } else { array_push($sp28f47a, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($sp265c0c, $spa953a1, $sp340d7a, $sp969ec8, $spbebc47, $sp94d6d6) { foreach (self::$items as $spd743b9) { if ($spd743b9->pad != $sp94d6d6) { continue; } if ($spd743b9->nroots != $spbebc47) { continue; } if ($spd743b9->mm != $sp265c0c) { continue; } if ($spd743b9->gfpoly != $spa953a1) { continue; } if ($spd743b9->fcr != $sp340d7a) { continue; } if ($spd743b9->prim != $sp969ec8) { continue; } return $spd743b9; } $spd743b9 = QRrsItem::init_rs_char($sp265c0c, $spa953a1, $sp340d7a, $sp969ec8, $spbebc47, $sp94d6d6); array_unshift(self::$items, $spd743b9); return $spd743b9; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($sp9a4595, &$sp2b5b09, $sp8f5542, $spb10be8) { $sp5b1187 = 0; $sp002bbb = QRspec::getFormatInfo($sp8f5542, $spb10be8); for ($spfae064 = 0; $spfae064 < 8; $spfae064++) { if ($sp002bbb & 1) { $sp5b1187 += 2; $sp99652d = 133; } else { $sp99652d = 132; } $sp2b5b09[8][$sp9a4595 - 1 - $spfae064] = chr($sp99652d); if ($spfae064 < 6) { $sp2b5b09[$spfae064][8] = chr($sp99652d); } else { $sp2b5b09[$spfae064 + 1][8] = chr($sp99652d); } $sp002bbb = $sp002bbb >> 1; } for ($spfae064 = 0; $spfae064 < 7; $spfae064++) { if ($sp002bbb & 1) { $sp5b1187 += 2; $sp99652d = 133; } else { $sp99652d = 132; } $sp2b5b09[$sp9a4595 - 7 + $spfae064][8] = chr($sp99652d); if ($spfae064 == 0) { $sp2b5b09[8][7] = chr($sp99652d); } else { $sp2b5b09[8][6 - $spfae064] = chr($sp99652d); } $sp002bbb = $sp002bbb >> 1; } return $sp5b1187; } public function mask0($spbfe79b, $spc4fa9c) { return $spbfe79b + $spc4fa9c & 1; } public function mask1($spbfe79b, $spc4fa9c) { return $spc4fa9c & 1; } public function mask2($spbfe79b, $spc4fa9c) { return $spbfe79b % 3; } public function mask3($spbfe79b, $spc4fa9c) { return ($spbfe79b + $spc4fa9c) % 3; } public function mask4($spbfe79b, $spc4fa9c) { return (int) ($spc4fa9c / 2) + (int) ($spbfe79b / 3) & 1; } public function mask5($spbfe79b, $spc4fa9c) { return ($spbfe79b * $spc4fa9c & 1) + $spbfe79b * $spc4fa9c % 3; } public function mask6($spbfe79b, $spc4fa9c) { return ($spbfe79b * $spc4fa9c & 1) + $spbfe79b * $spc4fa9c % 3 & 1; } public function mask7($spbfe79b, $spc4fa9c) { return $spbfe79b * $spc4fa9c % 3 + ($spbfe79b + $spc4fa9c & 1) & 1; } private function generateMaskNo($sp0982c2, $sp9a4595, $sp2b5b09) { $sp9b2d5a = array_fill(0, $sp9a4595, array_fill(0, $sp9a4595, 0)); for ($spc4fa9c = 0; $spc4fa9c < $sp9a4595; $spc4fa9c++) { for ($spbfe79b = 0; $spbfe79b < $sp9a4595; $spbfe79b++) { if (ord($sp2b5b09[$spc4fa9c][$spbfe79b]) & 128) { $sp9b2d5a[$spc4fa9c][$spbfe79b] = 0; } else { $sp4568e6 = call_user_func(array($this, 'mask' . $sp0982c2), $spbfe79b, $spc4fa9c); $sp9b2d5a[$spc4fa9c][$spbfe79b] = $sp4568e6 == 0 ? 1 : 0; } } } return $sp9b2d5a; } public static function serial($sp053dcd) { $sp35c18b = array(); foreach ($sp053dcd as $spcb1023) { $sp35c18b[] = join('', $spcb1023); } return gzcompress(join('
', $sp35c18b), 9); } public static function unserial($sp14e657) { $sp35c18b = array(); $sp92bbd1 = explode('
', gzuncompress($sp14e657)); foreach ($sp92bbd1 as $spcb1023) { $sp35c18b[] = str_split($spcb1023); } return $sp35c18b; } public function makeMaskNo($sp0982c2, $sp9a4595, $spbed9b8, &$sp421b5f, $spe271c9 = false) { $sp36f572 = 0; $sp9b2d5a = array(); $sp15804f = QR_CACHE_DIR . 'mask_' . $sp0982c2 . DIRECTORY_SEPARATOR . 'mask_' . $sp9a4595 . '_' . $sp0982c2 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp15804f)) { $sp9b2d5a = self::unserial(file_get_contents($sp15804f)); } else { $sp9b2d5a = $this->generateMaskNo($sp0982c2, $sp9a4595, $spbed9b8, $sp421b5f); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp0982c2)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp0982c2); } file_put_contents($sp15804f, self::serial($sp9b2d5a)); } } else { $sp9b2d5a = $this->generateMaskNo($sp0982c2, $sp9a4595, $spbed9b8, $sp421b5f); } if ($spe271c9) { return; } $sp421b5f = $spbed9b8; for ($spc4fa9c = 0; $spc4fa9c < $sp9a4595; $spc4fa9c++) { for ($spbfe79b = 0; $spbfe79b < $sp9a4595; $spbfe79b++) { if ($sp9b2d5a[$spc4fa9c][$spbfe79b] == 1) { $sp421b5f[$spc4fa9c][$spbfe79b] = chr(ord($spbed9b8[$spc4fa9c][$spbfe79b]) ^ (int) $sp9b2d5a[$spc4fa9c][$spbfe79b]); } $sp36f572 += (int) (ord($sp421b5f[$spc4fa9c][$spbfe79b]) & 1); } } return $sp36f572; } public function makeMask($sp9a4595, $sp2b5b09, $sp0982c2, $spb10be8) { $spb07b3d = array_fill(0, $sp9a4595, str_repeat(' ', $sp9a4595)); $this->makeMaskNo($sp0982c2, $sp9a4595, $sp2b5b09, $spb07b3d); $this->writeFormatInformation($sp9a4595, $spb07b3d, $sp0982c2, $spb10be8); return $spb07b3d; } public function calcN1N3($spef2f8c) { $sp42e4e7 = 0; for ($spfae064 = 0; $spfae064 < $spef2f8c; $spfae064++) { if ($this->runLength[$spfae064] >= 5) { $sp42e4e7 += N1 + ($this->runLength[$spfae064] - 5); } if ($spfae064 & 1) { if ($spfae064 >= 3 && $spfae064 < $spef2f8c - 2 && $this->runLength[$spfae064] % 3 == 0) { $spf33aac = (int) ($this->runLength[$spfae064] / 3); if ($this->runLength[$spfae064 - 2] == $spf33aac && $this->runLength[$spfae064 - 1] == $spf33aac && $this->runLength[$spfae064 + 1] == $spf33aac && $this->runLength[$spfae064 + 2] == $spf33aac) { if ($this->runLength[$spfae064 - 3] < 0 || $this->runLength[$spfae064 - 3] >= 4 * $spf33aac) { $sp42e4e7 += N3; } else { if ($spfae064 + 3 >= $spef2f8c || $this->runLength[$spfae064 + 3] >= 4 * $spf33aac) { $sp42e4e7 += N3; } } } } } } return $sp42e4e7; } public function evaluateSymbol($sp9a4595, $sp2b5b09) { $spe399da = 0; $sp42e4e7 = 0; for ($spc4fa9c = 0; $spc4fa9c < $sp9a4595; $spc4fa9c++) { $spe399da = 0; $this->runLength[0] = 1; $spe6451f = $sp2b5b09[$spc4fa9c]; if ($spc4fa9c > 0) { $sp54afb9 = $sp2b5b09[$spc4fa9c - 1]; } for ($spbfe79b = 0; $spbfe79b < $sp9a4595; $spbfe79b++) { if ($spbfe79b > 0 && $spc4fa9c > 0) { $sp69783e = ord($spe6451f[$spbfe79b]) & ord($spe6451f[$spbfe79b - 1]) & ord($sp54afb9[$spbfe79b]) & ord($sp54afb9[$spbfe79b - 1]); $sp37e4e7 = ord($spe6451f[$spbfe79b]) | ord($spe6451f[$spbfe79b - 1]) | ord($sp54afb9[$spbfe79b]) | ord($sp54afb9[$spbfe79b - 1]); if (($sp69783e | $sp37e4e7 ^ 1) & 1) { $sp42e4e7 += N2; } } if ($spbfe79b == 0 && ord($spe6451f[$spbfe79b]) & 1) { $this->runLength[0] = -1; $spe399da = 1; $this->runLength[$spe399da] = 1; } else { if ($spbfe79b > 0) { if ((ord($spe6451f[$spbfe79b]) ^ ord($spe6451f[$spbfe79b - 1])) & 1) { $spe399da++; $this->runLength[$spe399da] = 1; } else { $this->runLength[$spe399da]++; } } } } $sp42e4e7 += $this->calcN1N3($spe399da + 1); } for ($spbfe79b = 0; $spbfe79b < $sp9a4595; $spbfe79b++) { $spe399da = 0; $this->runLength[0] = 1; for ($spc4fa9c = 0; $spc4fa9c < $sp9a4595; $spc4fa9c++) { if ($spc4fa9c == 0 && ord($sp2b5b09[$spc4fa9c][$spbfe79b]) & 1) { $this->runLength[0] = -1; $spe399da = 1; $this->runLength[$spe399da] = 1; } else { if ($spc4fa9c > 0) { if ((ord($sp2b5b09[$spc4fa9c][$spbfe79b]) ^ ord($sp2b5b09[$spc4fa9c - 1][$spbfe79b])) & 1) { $spe399da++; $this->runLength[$spe399da] = 1; } else { $this->runLength[$spe399da]++; } } } } $sp42e4e7 += $this->calcN1N3($spe399da + 1); } return $sp42e4e7; } public function mask($sp9a4595, $sp2b5b09, $spb10be8) { $sp96a2a9 = PHP_INT_MAX; $sp934541 = 0; $spe2dadd = array(); $spd27e76 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp196f55 = 8 - QR_FIND_FROM_RANDOM % 9; for ($spfae064 = 0; $spfae064 < $sp196f55; $spfae064++) { $sp34674e = rand(0, count($spd27e76) - 1); unset($spd27e76[$sp34674e]); $spd27e76 = array_values($spd27e76); } } $spe2dadd = $sp2b5b09; foreach ($spd27e76 as $spfae064) { $sp8f5542 = array_fill(0, $sp9a4595, str_repeat(' ', $sp9a4595)); $sp42e4e7 = 0; $sp5b1187 = 0; $sp5b1187 = $this->makeMaskNo($spfae064, $sp9a4595, $sp2b5b09, $sp8f5542); $sp5b1187 += $this->writeFormatInformation($sp9a4595, $sp8f5542, $spfae064, $spb10be8); $sp5b1187 = (int) (100 * $sp5b1187 / ($sp9a4595 * $sp9a4595)); $sp42e4e7 = (int) ((int) (abs($sp5b1187 - 50) / 5) * N4); $sp42e4e7 += $this->evaluateSymbol($sp9a4595, $sp8f5542); if ($sp42e4e7 < $sp96a2a9) { $sp96a2a9 = $sp42e4e7; $spe2dadd = $sp8f5542; $sp934541 = $spfae064; } } return $spe2dadd; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($sp5cade8, $sp151100, $sp894118, &$sp147b88, QRrsItem $spd743b9) { $spd743b9->encode_rs_char($sp151100, $sp147b88); $this->dataLength = $sp5cade8; $this->data = $sp151100; $this->eccLength = $sp894118; $this->ecc = $sp147b88; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp02dbf9) { $sp7e5d5a = array(0, 0, 0, 0, 0); $this->datacode = $sp02dbf9->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp02dbf9->getVersion(), $sp02dbf9->getErrorCorrectionLevel(), $sp7e5d5a); $this->version = $sp02dbf9->getVersion(); $this->b1 = QRspec::rsBlockNum1($sp7e5d5a); $this->dataLength = QRspec::rsDataLength($sp7e5d5a); $this->eccLength = QRspec::rsEccLength($sp7e5d5a); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($sp7e5d5a); $sp123706 = $this->init($sp7e5d5a); if ($sp123706 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $sp7e5d5a) { $sp5cade8 = QRspec::rsDataCodes1($sp7e5d5a); $sp894118 = QRspec::rsEccCodes1($sp7e5d5a); $spd743b9 = QRrs::init_rs(8, 285, 0, 1, $sp894118, 255 - $sp5cade8 - $sp894118); $spac72bd = 0; $sp4391b8 = 0; $spf8e47c = 0; for ($spfae064 = 0; $spfae064 < QRspec::rsBlockNum1($sp7e5d5a); $spfae064++) { $sp147b88 = array_slice($this->ecccode, $spf8e47c); $this->rsblocks[$spac72bd] = new QRrsblock($sp5cade8, array_slice($this->datacode, $sp4391b8), $sp894118, $sp147b88, $spd743b9); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $spf8e47c), $sp147b88); $sp4391b8 += $sp5cade8; $spf8e47c += $sp894118; $spac72bd++; } if (QRspec::rsBlockNum2($sp7e5d5a) == 0) { return 0; } $sp5cade8 = QRspec::rsDataCodes2($sp7e5d5a); $sp894118 = QRspec::rsEccCodes2($sp7e5d5a); $spd743b9 = QRrs::init_rs(8, 285, 0, 1, $sp894118, 255 - $sp5cade8 - $sp894118); if ($spd743b9 == NULL) { return -1; } for ($spfae064 = 0; $spfae064 < QRspec::rsBlockNum2($sp7e5d5a); $spfae064++) { $sp147b88 = array_slice($this->ecccode, $spf8e47c); $this->rsblocks[$spac72bd] = new QRrsblock($sp5cade8, array_slice($this->datacode, $sp4391b8), $sp894118, $sp147b88, $spd743b9); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $spf8e47c), $sp147b88); $sp4391b8 += $sp5cade8; $spf8e47c += $sp894118; $spac72bd++; } return 0; } public function getCode() { $sp123706; if ($this->count < $this->dataLength) { $sp25028f = $this->count % $this->blocks; $sp30cb43 = $this->count / $this->blocks; if ($sp30cb43 >= $this->rsblocks[0]->dataLength) { $sp25028f += $this->b1; } $sp123706 = $this->rsblocks[$sp25028f]->data[$sp30cb43]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp25028f = ($this->count - $this->dataLength) % $this->blocks; $sp30cb43 = ($this->count - $this->dataLength) / $this->blocks; $sp123706 = $this->rsblocks[$sp25028f]->ecc[$sp30cb43]; } else { return 0; } } $this->count++; return $sp123706; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp02dbf9, $sp8f5542) { if ($sp02dbf9->getVersion() < 0 || $sp02dbf9->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp02dbf9->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $sp67ec32 = new QRrawcode($sp02dbf9); QRtools::markTime('after_raw'); $sp283726 = $sp67ec32->version; $sp9a4595 = QRspec::getWidth($sp283726); $sp2b5b09 = QRspec::newFrame($sp283726); $sp620830 = new FrameFiller($sp9a4595, $sp2b5b09); if (is_null($sp620830)) { return NULL; } for ($spfae064 = 0; $spfae064 < $sp67ec32->dataLength + $sp67ec32->eccLength; $spfae064++) { $sp14e657 = $sp67ec32->getCode(); $sp2d45f8 = 128; for ($sp47ed96 = 0; $sp47ed96 < 8; $sp47ed96++) { $sp0d451d = $sp620830->next(); $sp620830->setFrameAt($sp0d451d, 2 | ($sp2d45f8 & $sp14e657) != 0); $sp2d45f8 = $sp2d45f8 >> 1; } } QRtools::markTime('after_filler'); unset($sp67ec32); $sp47ed96 = QRspec::getRemainder($sp283726); for ($spfae064 = 0; $spfae064 < $sp47ed96; $spfae064++) { $sp0d451d = $sp620830->next(); $sp620830->setFrameAt($sp0d451d, 2); } $sp2b5b09 = $sp620830->frame; unset($sp620830); $sp6ec4e7 = new QRmask(); if ($sp8f5542 < 0) { if (QR_FIND_BEST_MASK) { $spb07b3d = $sp6ec4e7->mask($sp9a4595, $sp2b5b09, $sp02dbf9->getErrorCorrectionLevel()); } else { $spb07b3d = $sp6ec4e7->makeMask($sp9a4595, $sp2b5b09, intval(QR_DEFAULT_MASK) % 8, $sp02dbf9->getErrorCorrectionLevel()); } } else { $spb07b3d = $sp6ec4e7->makeMask($sp9a4595, $sp2b5b09, $sp8f5542, $sp02dbf9->getErrorCorrectionLevel()); } if ($spb07b3d == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $sp283726; $this->width = $sp9a4595; $this->data = $spb07b3d; return $this; } public function encodeInput(QRinput $sp02dbf9) { return $this->encodeMask($sp02dbf9, -1); } public function encodeString8bit($sp227000, $sp283726, $spb10be8) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp02dbf9 = new QRinput($sp283726, $spb10be8); if ($sp02dbf9 == NULL) { return NULL; } $sp123706 = $sp02dbf9->append($sp02dbf9, QR_MODE_8, strlen($sp227000), str_split($sp227000)); if ($sp123706 < 0) { unset($sp02dbf9); return NULL; } return $this->encodeInput($sp02dbf9); } public function encodeString($sp227000, $sp283726, $spb10be8, $spe0cf5e, $sp9e8109) { if ($spe0cf5e != QR_MODE_8 && $spe0cf5e != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp02dbf9 = new QRinput($sp283726, $spb10be8); if ($sp02dbf9 == NULL) { return NULL; } $sp123706 = QRsplit::splitStringToQRinput($sp227000, $sp02dbf9, $spe0cf5e, $sp9e8109); if ($sp123706 < 0) { return NULL; } return $this->encodeInput($sp02dbf9); } public static function png($sp3dccb7, $spbc3b15 = false, $spb10be8 = QR_ECLEVEL_L, $spe9007c = 3, $spf2245b = 4, $spd3d563 = false) { $sp094240 = QRencode::factory($spb10be8, $spe9007c, $spf2245b); return $sp094240->encodePNG($sp3dccb7, $spbc3b15, $spd3d563 = false); } public static function text($sp3dccb7, $spbc3b15 = false, $spb10be8 = QR_ECLEVEL_L, $spe9007c = 3, $spf2245b = 4) { $sp094240 = QRencode::factory($spb10be8, $spe9007c, $spf2245b); return $sp094240->encode($sp3dccb7, $spbc3b15); } public static function raw($sp3dccb7, $spbc3b15 = false, $spb10be8 = QR_ECLEVEL_L, $spe9007c = 3, $spf2245b = 4) { $sp094240 = QRencode::factory($spb10be8, $spe9007c, $spf2245b); return $sp094240->encodeRAW($sp3dccb7, $spbc3b15); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($sp9a4595, &$sp2b5b09) { $this->width = $sp9a4595; $this->frame = $sp2b5b09; $this->x = $sp9a4595 - 1; $this->y = $sp9a4595 - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp128e53, $sp1f05d8) { $this->frame[$sp128e53['y']][$sp128e53['x']] = chr($sp1f05d8); } public function getFrameAt($sp128e53) { return ord($this->frame[$sp128e53['y']][$sp128e53['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $spbfe79b = $this->x; $spc4fa9c = $this->y; $sp69a68a = $this->width; if ($this->bit == 0) { $spbfe79b--; $this->bit++; } else { $spbfe79b++; $spc4fa9c += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($spc4fa9c < 0) { $spc4fa9c = 0; $spbfe79b -= 2; $this->dir = 1; if ($spbfe79b == 6) { $spbfe79b--; $spc4fa9c = 9; } } } else { if ($spc4fa9c == $sp69a68a) { $spc4fa9c = $sp69a68a - 1; $spbfe79b -= 2; $this->dir = -1; if ($spbfe79b == 6) { $spbfe79b--; $spc4fa9c -= 8; } } } if ($spbfe79b < 0 || $spc4fa9c < 0) { return null; } $this->x = $spbfe79b; $this->y = $spc4fa9c; } while (ord($this->frame[$spc4fa9c][$spbfe79b]) & 128); return array('x' => $spbfe79b, 'y' => $spc4fa9c); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($spb10be8 = QR_ECLEVEL_L, $spe9007c = 3, $spf2245b = 4) { $sp094240 = new QRencode(); $sp094240->size = $spe9007c; $sp094240->margin = $spf2245b; switch ($spb10be8 . '') { case '0': case '1': case '2': case '3': $sp094240->level = $spb10be8; break; case 'l': case 'L': $sp094240->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp094240->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp094240->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp094240->level = QR_ECLEVEL_H; break; } return $sp094240; } public function encodeRAW($spe2701f, $spbc3b15 = false) { $sp14e657 = new QRcode(); if ($this->eightbit) { $sp14e657->encodeString8bit($spe2701f, $this->version, $this->level); } else { $sp14e657->encodeString($spe2701f, $this->version, $this->level, $this->hint, $this->casesensitive); } return $sp14e657->data; } public function encode($spe2701f, $spbc3b15 = false) { $sp14e657 = new QRcode(); if ($this->eightbit) { $sp14e657->encodeString8bit($spe2701f, $this->version, $this->level); } else { $sp14e657->encodeString($spe2701f, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($spbc3b15 !== false) { file_put_contents($spbc3b15, join('
', QRtools::binarize($sp14e657->data))); } else { return QRtools::binarize($sp14e657->data); } } public function encodePNG($spe2701f, $spbc3b15 = false, $spd3d563 = false) { try { ob_start(); $spa7f4c4 = $this->encode($spe2701f); $spc30934 = ob_get_contents(); ob_end_clean(); if ($spc30934 != '') { QRtools::log($spbc3b15, $spc30934); } $spa72b22 = (int) (QR_PNG_MAXIMUM_SIZE / (count($spa7f4c4) + 2 * $this->margin)); QRimage::png($spa7f4c4, $spbc3b15, min(max(1, $this->size), $spa72b22), $this->margin, $spd3d563); } catch (Exception $sp9e5801) { QRtools::log($spbc3b15, $sp9e5801->getMessage()); } } }