<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$sp117c47, $spc8a6d0, $spf07083, $sp0bea4d, $sp2c19e9 = false) { $sp117c47[$spf07083] = substr_replace($sp117c47[$spf07083], $sp2c19e9 !== false ? substr($sp0bea4d, 0, $sp2c19e9) : $sp0bea4d, $spc8a6d0, $sp2c19e9 !== false ? $sp2c19e9 : strlen($sp0bea4d)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp689fd2) { $sp037d6e = count($sp689fd2); foreach ($sp689fd2 as &$spe8def8) { for ($sp3f53b5 = 0; $sp3f53b5 < $sp037d6e; $sp3f53b5++) { $spe8def8[$sp3f53b5] = ord($spe8def8[$sp3f53b5]) & 1 ? '1' : '0'; } } return $sp689fd2; } public static function tcpdfBarcodeArray($sp89b33d, $spa1845d = 'QR,L', $sp64020b = '4.5.037') { $sp40c426 = array(); if (!is_array($spa1845d)) { $spa1845d = explode(',', $spa1845d); } $spa1891e = 'L'; if (count($spa1845d) > 1) { $spa1891e = $spa1845d[1]; } $sp1e1b02 = QRcode::text($sp89b33d, false, $spa1891e); $spf9945d = count($sp1e1b02); $sp40c426['num_rows'] = $spf9945d; $sp40c426['num_cols'] = $spf9945d; $sp40c426['bcode'] = array(); foreach ($sp1e1b02 as $sp7c6222) { $sp381579 = array(); foreach (str_split($sp7c6222) as $spe643c6) { $sp381579[] = $spe643c6 == '1' ? 1 : 0; } $sp40c426['bcode'][] = $sp381579; } return $sp40c426; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $spdc543b = new QRmask(); for ($spd431f0 = 1; $spd431f0 <= QRSPEC_VERSION_MAX; $spd431f0++) { $sp689fd2 = QRspec::newFrame($spd431f0); if (QR_IMAGE) { $sp4f8b14 = QR_CACHE_DIR . 'frame_' . $spd431f0 . '.png'; QRimage::png(self::binarize($sp689fd2), $sp4f8b14, 1, 0); } $spda3f0e = count($sp689fd2); $sp4a56b4 = array_fill(0, $spda3f0e, array_fill(0, $spda3f0e, 0)); for ($sp066731 = 0; $sp066731 < 8; $sp066731++) { $spdc543b->makeMaskNo($sp066731, $spda3f0e, $sp689fd2, $sp4a56b4, true); } } QRtools::markTime('after_build_cache'); } public static function log($sp038257, $sp5c660e) { if (QR_LOG_DIR !== false) { if ($sp5c660e != '') { if ($sp038257 !== false) { file_put_contents(QR_LOG_DIR . basename($sp038257) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $sp5c660e, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $sp5c660e, FILE_APPEND); } } } } public static function dumpMask($sp689fd2) { $spda3f0e = count($sp689fd2); for ($spf07083 = 0; $spf07083 < $spda3f0e; $spf07083++) { for ($spc8a6d0 = 0; $spc8a6d0 < $spda3f0e; $spc8a6d0++) { echo ord($sp689fd2[$spf07083][$spc8a6d0]) . ','; } } } public static function markTime($sp3dd13a) { list($sp81961d, $sp5654ad) = explode(' ', microtime()); $sp6547f3 = (double) $sp81961d + (double) $sp5654ad; if (!isset($spf6ef53['qr_time_bench'])) { $spf6ef53['qr_time_bench'] = array(); } $spf6ef53['qr_time_bench'][$sp3dd13a] = $sp6547f3; } public static function timeBenchmark() { self::markTime('finish'); $sp217bdd = 0; $sp7f4213 = 0; $spdcd8e6 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($spf6ef53['qr_time_bench'] as $sp3dd13a => $spa56ef8) { if ($spdcd8e6 > 0) { echo '<tr><th style="text-align:right">till ' . $sp3dd13a . ': </th><td>' . number_format($spa56ef8 - $sp217bdd, 6) . 's</td></tr>'; } else { $sp7f4213 = $spa56ef8; } $spdcd8e6++; $sp217bdd = $spa56ef8; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp217bdd - $sp7f4213, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($spaa2e8b, $spd41c76) { return self::$capacity[$spaa2e8b][QRCAP_WORDS] - self::$capacity[$spaa2e8b][QRCAP_EC][$spd41c76]; } public static function getECCLength($spaa2e8b, $spd41c76) { return self::$capacity[$spaa2e8b][QRCAP_EC][$spd41c76]; } public static function getWidth($spaa2e8b) { return self::$capacity[$spaa2e8b][QRCAP_WIDTH]; } public static function getRemainder($spaa2e8b) { return self::$capacity[$spaa2e8b][QRCAP_REMINDER]; } public static function getMinimumVersion($spf9945d, $spd41c76) { for ($sp3f53b5 = 1; $sp3f53b5 <= QRSPEC_VERSION_MAX; $sp3f53b5++) { $sp70a70d = self::$capacity[$sp3f53b5][QRCAP_WORDS] - self::$capacity[$sp3f53b5][QRCAP_EC][$spd41c76]; if ($sp70a70d >= $spf9945d) { return $sp3f53b5; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($spa1845d, $spaa2e8b) { if ($spa1845d == QR_MODE_STRUCTURE) { return 0; } if ($spaa2e8b <= 9) { $sp535e8d = 0; } else { if ($spaa2e8b <= 26) { $sp535e8d = 1; } else { $sp535e8d = 2; } } return self::$lengthTableBits[$spa1845d][$sp535e8d]; } public static function maximumWords($spa1845d, $spaa2e8b) { if ($spa1845d == QR_MODE_STRUCTURE) { return 3; } if ($spaa2e8b <= 9) { $sp535e8d = 0; } else { if ($spaa2e8b <= 26) { $sp535e8d = 1; } else { $sp535e8d = 2; } } $sp1cf170 = self::$lengthTableBits[$spa1845d][$sp535e8d]; $sp70a70d = (1 << $sp1cf170) - 1; if ($spa1845d == QR_MODE_KANJI) { $sp70a70d *= 2; } return $sp70a70d; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($spaa2e8b, $spd41c76, array &$sp83c954) { if (count($sp83c954) < 5) { $sp83c954 = array(0, 0, 0, 0, 0); } $spb5de4b = self::$eccTable[$spaa2e8b][$spd41c76][0]; $sp639b59 = self::$eccTable[$spaa2e8b][$spd41c76][1]; $sp2bb3bd = self::getDataLength($spaa2e8b, $spd41c76); $sp038d66 = self::getECCLength($spaa2e8b, $spd41c76); if ($sp639b59 == 0) { $sp83c954[0] = $spb5de4b; $sp83c954[1] = (int) ($sp2bb3bd / $spb5de4b); $sp83c954[2] = (int) ($sp038d66 / $spb5de4b); $sp83c954[3] = 0; $sp83c954[4] = 0; } else { $sp83c954[0] = $spb5de4b; $sp83c954[1] = (int) ($sp2bb3bd / ($spb5de4b + $sp639b59)); $sp83c954[2] = (int) ($sp038d66 / ($spb5de4b + $sp639b59)); $sp83c954[3] = $sp639b59; $sp83c954[4] = $sp83c954[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp689fd2, $sp630976, $spceaa8c) { $spb37c4f = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $spbbb1e0 = $spceaa8c - 2; $spb89a51 = $sp630976 - 2; for ($spf07083 = 0; $spf07083 < 5; $spf07083++) { QRstr::set($sp689fd2, $spb89a51, $spbbb1e0 + $spf07083, $spb37c4f[$spf07083]); } } public static function putAlignmentPattern($spaa2e8b, &$sp689fd2, $spda3f0e) { if ($spaa2e8b < 2) { return; } $sp7830bb = self::$alignmentPattern[$spaa2e8b][1] - self::$alignmentPattern[$spaa2e8b][0]; if ($sp7830bb < 0) { $spfaa7df = 2; } else { $spfaa7df = (int) (($spda3f0e - self::$alignmentPattern[$spaa2e8b][0]) / $sp7830bb + 2); } if ($spfaa7df * $spfaa7df - 3 == 1) { $spc8a6d0 = self::$alignmentPattern[$spaa2e8b][0]; $spf07083 = self::$alignmentPattern[$spaa2e8b][0]; self::putAlignmentMarker($sp689fd2, $spc8a6d0, $spf07083); return; } $spcf9c59 = self::$alignmentPattern[$spaa2e8b][0]; for ($spc8a6d0 = 1; $spc8a6d0 < $spfaa7df - 1; $spc8a6d0++) { self::putAlignmentMarker($sp689fd2, 6, $spcf9c59); self::putAlignmentMarker($sp689fd2, $spcf9c59, 6); $spcf9c59 += $sp7830bb; } $sp3f3f7e = self::$alignmentPattern[$spaa2e8b][0]; for ($spf07083 = 0; $spf07083 < $spfaa7df - 1; $spf07083++) { $spcf9c59 = self::$alignmentPattern[$spaa2e8b][0]; for ($spc8a6d0 = 0; $spc8a6d0 < $spfaa7df - 1; $spc8a6d0++) { self::putAlignmentMarker($sp689fd2, $spcf9c59, $sp3f3f7e); $spcf9c59 += $sp7830bb; } $sp3f3f7e += $sp7830bb; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($spaa2e8b) { if ($spaa2e8b < 7 || $spaa2e8b > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$spaa2e8b - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($spdc543b, $spd41c76) { if ($spdc543b < 0 || $spdc543b > 7) { return 0; } if ($spd41c76 < 0 || $spd41c76 > 3) { return 0; } return self::$formatInfo[$spd41c76][$spdc543b]; } public static $frames = array(); public static function putFinderPattern(&$sp689fd2, $sp630976, $spceaa8c) { $spb37c4f = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($spf07083 = 0; $spf07083 < 7; $spf07083++) { QRstr::set($sp689fd2, $sp630976, $spceaa8c + $spf07083, $spb37c4f[$spf07083]); } } public static function createFrame($spaa2e8b) { $spda3f0e = self::$capacity[$spaa2e8b][QRCAP_WIDTH]; $spe8def8 = str_repeat(' ', $spda3f0e); $sp689fd2 = array_fill(0, $spda3f0e, $spe8def8); self::putFinderPattern($sp689fd2, 0, 0); self::putFinderPattern($sp689fd2, $spda3f0e - 7, 0); self::putFinderPattern($sp689fd2, 0, $spda3f0e - 7); $sp9089b4 = $spda3f0e - 7; for ($spf07083 = 0; $spf07083 < 7; $spf07083++) { $sp689fd2[$spf07083][7] = '¿'; $sp689fd2[$spf07083][$spda3f0e - 8] = '¿'; $sp689fd2[$sp9089b4][7] = '¿'; $sp9089b4++; } $sp138f43 = str_repeat('¿', 8); QRstr::set($sp689fd2, 0, 7, $sp138f43); QRstr::set($sp689fd2, $spda3f0e - 8, 7, $sp138f43); QRstr::set($sp689fd2, 0, $spda3f0e - 8, $sp138f43); $sp138f43 = str_repeat('Ñ', 9); QRstr::set($sp689fd2, 0, 8, $sp138f43); QRstr::set($sp689fd2, $spda3f0e - 8, 8, $sp138f43, 8); $sp9089b4 = $spda3f0e - 8; for ($spf07083 = 0; $spf07083 < 8; $spf07083++, $sp9089b4++) { $sp689fd2[$spf07083][8] = 'Ñ'; $sp689fd2[$sp9089b4][8] = 'Ñ'; } for ($sp3f53b5 = 1; $sp3f53b5 < $spda3f0e - 15; $sp3f53b5++) { $sp689fd2[6][7 + $sp3f53b5] = chr(144 | $sp3f53b5 & 1); $sp689fd2[7 + $sp3f53b5][6] = chr(144 | $sp3f53b5 & 1); } self::putAlignmentPattern($spaa2e8b, $sp689fd2, $spda3f0e); if ($spaa2e8b >= 7) { $spce1efb = self::getVersionPattern($spaa2e8b); $spc86f28 = $spce1efb; for ($spc8a6d0 = 0; $spc8a6d0 < 6; $spc8a6d0++) { for ($spf07083 = 0; $spf07083 < 3; $spf07083++) { $sp689fd2[$spda3f0e - 11 + $spf07083][$spc8a6d0] = chr(136 | $spc86f28 & 1); $spc86f28 = $spc86f28 >> 1; } } $spc86f28 = $spce1efb; for ($spf07083 = 0; $spf07083 < 6; $spf07083++) { for ($spc8a6d0 = 0; $spc8a6d0 < 3; $spc8a6d0++) { $sp689fd2[$spf07083][$spc8a6d0 + ($spda3f0e - 11)] = chr(136 | $spc86f28 & 1); $spc86f28 = $spc86f28 >> 1; } } } $sp689fd2[$spda3f0e - 8][8] = 'Å'; return $sp689fd2; } public static function debug($sp689fd2, $sp0431b7 = false) { if ($sp0431b7) { foreach ($sp689fd2 as &$spe8def8) { $spe8def8 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $spe8def8)); $spe8def8 = join('&#9608;&#9608;', explode('1', $spe8def8)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp689fd2); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp689fd2 as &$spe8def8) { $spe8def8 = join('<span class="m">&nbsp;</span>', explode('¿', $spe8def8)); $spe8def8 = join('<span class="m">&#9618;</span>', explode('¡', $spe8def8)); $spe8def8 = join('<span class="p">&nbsp;</span>', explode('†', $spe8def8)); $spe8def8 = join('<span class="p">&#9618;</span>', explode('°', $spe8def8)); $spe8def8 = join('<span class="s">&#9671;</span>', explode('Ñ', $spe8def8)); $spe8def8 = join('<span class="s">&#9670;</span>', explode('Ö', $spe8def8)); $spe8def8 = join('<span class="x">&#9762;</span>', explode('Å', $spe8def8)); $spe8def8 = join('<span class="c">&nbsp;</span>', explode('ê', $spe8def8)); $spe8def8 = join('<span class="c">&#9719;</span>', explode('ë', $spe8def8)); $spe8def8 = join('<span class="f">&nbsp;</span>', explode('à', $spe8def8)); $spe8def8 = join('<span class="f">&#9618;</span>', explode('â', $spe8def8)); $spe8def8 = join('&#9830;', explode('', $spe8def8)); $spe8def8 = join('&#8901;', explode(' ', $spe8def8)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp689fd2); echo '</tt></pre>'; } } public static function serial($sp689fd2) { return gzcompress(join('
', $sp689fd2), 9); } public static function unserial($sp89b33d) { return explode('
', gzuncompress($sp89b33d)); } public static function newFrame($spaa2e8b) { if ($spaa2e8b < 1 || $spaa2e8b > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$spaa2e8b])) { $sp4f8b14 = QR_CACHE_DIR . 'frame_' . $spaa2e8b . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp4f8b14)) { self::$frames[$spaa2e8b] = self::unserial(file_get_contents($sp4f8b14)); } else { self::$frames[$spaa2e8b] = self::createFrame($spaa2e8b); file_put_contents($sp4f8b14, self::serial(self::$frames[$spaa2e8b])); } } else { self::$frames[$spaa2e8b] = self::createFrame($spaa2e8b); } } if (is_null(self::$frames[$spaa2e8b])) { return null; } return self::$frames[$spaa2e8b]; } public static function rsBlockNum($sp83c954) { return $sp83c954[0] + $sp83c954[3]; } public static function rsBlockNum1($sp83c954) { return $sp83c954[0]; } public static function rsDataCodes1($sp83c954) { return $sp83c954[1]; } public static function rsEccCodes1($sp83c954) { return $sp83c954[2]; } public static function rsBlockNum2($sp83c954) { return $sp83c954[3]; } public static function rsDataCodes2($sp83c954) { return $sp83c954[4]; } public static function rsEccCodes2($sp83c954) { return $sp83c954[2]; } public static function rsDataLength($sp83c954) { return $sp83c954[0] * $sp83c954[1] + $sp83c954[3] * $sp83c954[4]; } public static function rsEccLength($sp83c954) { return ($sp83c954[0] + $sp83c954[3]) * $sp83c954[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp689fd2, $spc4ce88 = false, $sp72aa5d = 4, $spfed104 = 4, $sp180b5c = FALSE) { $spffacf2 = self::image($sp689fd2, $sp72aa5d, $spfed104); if ($spc4ce88 === false) { Header('Content-type: image/png'); ImagePng($spffacf2); } else { if ($sp180b5c === TRUE) { ImagePng($spffacf2, $spc4ce88); header('Content-type: image/png'); ImagePng($spffacf2); } else { ImagePng($spffacf2, $spc4ce88); } } ImageDestroy($spffacf2); } public static function jpg($sp689fd2, $spc4ce88 = false, $sp72aa5d = 8, $spfed104 = 4, $sp0e81b7 = 85) { $spffacf2 = self::image($sp689fd2, $sp72aa5d, $spfed104); if ($spc4ce88 === false) { Header('Content-type: image/jpeg'); ImageJpeg($spffacf2, null, $sp0e81b7); } else { ImageJpeg($spffacf2, $spc4ce88, $sp0e81b7); } ImageDestroy($spffacf2); } private static function image($sp689fd2, $sp72aa5d = 4, $spfed104 = 4) { $sp202e9b = count($sp689fd2); $spfaa7df = strlen($sp689fd2[0]); $spe7d80b = $spfaa7df + 2 * $spfed104; $spf98a4a = $sp202e9b + 2 * $spfed104; $sp0a3f04 = ImageCreate($spe7d80b, $spf98a4a); $sp40e087[0] = ImageColorAllocate($sp0a3f04, 255, 255, 255); $sp40e087[1] = ImageColorAllocate($sp0a3f04, 0, 0, 0); imagefill($sp0a3f04, 0, 0, $sp40e087[0]); for ($spf07083 = 0; $spf07083 < $sp202e9b; $spf07083++) { for ($spc8a6d0 = 0; $spc8a6d0 < $spfaa7df; $spc8a6d0++) { if ($sp689fd2[$spf07083][$spc8a6d0] == '1') { ImageSetPixel($sp0a3f04, $spc8a6d0 + $spfed104, $spf07083 + $spfed104, $sp40e087[1]); } } } $sp22d974 = ImageCreate($spe7d80b * $sp72aa5d, $spf98a4a * $sp72aa5d); ImageCopyResized($sp22d974, $sp0a3f04, 0, 0, 0, 0, $spe7d80b * $sp72aa5d, $spf98a4a * $sp72aa5d, $spe7d80b, $spf98a4a); ImageDestroy($sp0a3f04); return $sp22d974; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($spa1845d, $spf9945d, $sp2bb3bd, $sp822c7b = null) { $sp9c06e3 = array_slice($sp2bb3bd, 0, $spf9945d); if (count($sp9c06e3) < $spf9945d) { $sp9c06e3 = array_merge($sp9c06e3, array_fill(0, $spf9945d - count($sp9c06e3), 0)); } if (!QRinput::check($spa1845d, $spf9945d, $sp9c06e3)) { throw new Exception('Error m:' . $spa1845d . ',s:' . $spf9945d . ',d:' . join(',', $sp9c06e3)); return null; } $this->mode = $spa1845d; $this->size = $spf9945d; $this->data = $sp9c06e3; $this->bstream = $sp822c7b; } public function encodeModeNum($spaa2e8b) { try { $sp70a70d = (int) ($this->size / 3); $spbde5c5 = new QRbitstream(); $spfa4469 = 1; $spbde5c5->appendNum(4, $spfa4469); $spbde5c5->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $spaa2e8b), $this->size); for ($sp3f53b5 = 0; $sp3f53b5 < $sp70a70d; $sp3f53b5++) { $spfa4469 = (ord($this->data[$sp3f53b5 * 3]) - ord('0')) * 100; $spfa4469 += (ord($this->data[$sp3f53b5 * 3 + 1]) - ord('0')) * 10; $spfa4469 += ord($this->data[$sp3f53b5 * 3 + 2]) - ord('0'); $spbde5c5->appendNum(10, $spfa4469); } if ($this->size - $sp70a70d * 3 == 1) { $spfa4469 = ord($this->data[$sp70a70d * 3]) - ord('0'); $spbde5c5->appendNum(4, $spfa4469); } else { if ($this->size - $sp70a70d * 3 == 2) { $spfa4469 = (ord($this->data[$sp70a70d * 3]) - ord('0')) * 10; $spfa4469 += ord($this->data[$sp70a70d * 3 + 1]) - ord('0'); $spbde5c5->appendNum(7, $spfa4469); } } $this->bstream = $spbde5c5; return 0; } catch (Exception $spa0e498) { return -1; } } public function encodeModeAn($spaa2e8b) { try { $sp70a70d = (int) ($this->size / 2); $spbde5c5 = new QRbitstream(); $spbde5c5->appendNum(4, 2); $spbde5c5->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $spaa2e8b), $this->size); for ($sp3f53b5 = 0; $sp3f53b5 < $sp70a70d; $sp3f53b5++) { $spfa4469 = (int) QRinput::lookAnTable(ord($this->data[$sp3f53b5 * 2])) * 45; $spfa4469 += (int) QRinput::lookAnTable(ord($this->data[$sp3f53b5 * 2 + 1])); $spbde5c5->appendNum(11, $spfa4469); } if ($this->size & 1) { $spfa4469 = QRinput::lookAnTable(ord($this->data[$sp70a70d * 2])); $spbde5c5->appendNum(6, $spfa4469); } $this->bstream = $spbde5c5; return 0; } catch (Exception $spa0e498) { return -1; } } public function encodeMode8($spaa2e8b) { try { $spbde5c5 = new QRbitstream(); $spbde5c5->appendNum(4, 4); $spbde5c5->appendNum(QRspec::lengthIndicator(QR_MODE_8, $spaa2e8b), $this->size); for ($sp3f53b5 = 0; $sp3f53b5 < $this->size; $sp3f53b5++) { $spbde5c5->appendNum(8, ord($this->data[$sp3f53b5])); } $this->bstream = $spbde5c5; return 0; } catch (Exception $spa0e498) { return -1; } } public function encodeModeKanji($spaa2e8b) { try { $spbde5c5 = new QRbitrtream(); $spbde5c5->appendNum(4, 8); $spbde5c5->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $spaa2e8b), (int) ($this->size / 2)); for ($sp3f53b5 = 0; $sp3f53b5 < $this->size; $sp3f53b5 += 2) { $spfa4469 = ord($this->data[$sp3f53b5]) << 8 | ord($this->data[$sp3f53b5 + 1]); if ($spfa4469 <= 40956) { $spfa4469 -= 33088; } else { $spfa4469 -= 49472; } $sp202e9b = ($spfa4469 >> 8) * 192; $spfa4469 = ($spfa4469 & 255) + $sp202e9b; $spbde5c5->appendNum(13, $spfa4469); } $this->bstream = $spbde5c5; return 0; } catch (Exception $spa0e498) { return -1; } } public function encodeModeStructure() { try { $spbde5c5 = new QRbitstream(); $spbde5c5->appendNum(4, 3); $spbde5c5->appendNum(4, ord($this->data[1]) - 1); $spbde5c5->appendNum(4, ord($this->data[0]) - 1); $spbde5c5->appendNum(8, ord($this->data[2])); $this->bstream = $spbde5c5; return 0; } catch (Exception $spa0e498) { return -1; } } public function estimateBitStreamSizeOfEntry($spaa2e8b) { $sp1cf170 = 0; if ($spaa2e8b == 0) { $spaa2e8b = 1; } switch ($this->mode) { case QR_MODE_NUM: $sp1cf170 = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $sp1cf170 = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $sp1cf170 = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $sp1cf170 = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $sp535e8d = QRspec::lengthIndicator($this->mode, $spaa2e8b); $sp817c50 = 1 << $sp535e8d; $spe63642 = (int) (($this->size + $sp817c50 - 1) / $sp817c50); $sp1cf170 += $spe63642 * (4 + $sp535e8d); return $sp1cf170; } public function encodeBitStream($spaa2e8b) { try { unset($this->bstream); $sp70a70d = QRspec::maximumWords($this->mode, $spaa2e8b); if ($this->size > $sp70a70d) { $spcf4301 = new QRinputItem($this->mode, $sp70a70d, $this->data); $sp005f29 = new QRinputItem($this->mode, $this->size - $sp70a70d, array_slice($this->data, $sp70a70d)); $spcf4301->encodeBitStream($spaa2e8b); $sp005f29->encodeBitStream($spaa2e8b); $this->bstream = new QRbitstream(); $this->bstream->append($spcf4301->bstream); $this->bstream->append($sp005f29->bstream); unset($spcf4301); unset($sp005f29); } else { $sp27b5c4 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp27b5c4 = $this->encodeModeNum($spaa2e8b); break; case QR_MODE_AN: $sp27b5c4 = $this->encodeModeAn($spaa2e8b); break; case QR_MODE_8: $sp27b5c4 = $this->encodeMode8($spaa2e8b); break; case QR_MODE_KANJI: $sp27b5c4 = $this->encodeModeKanji($spaa2e8b); break; case QR_MODE_STRUCTURE: $sp27b5c4 = $this->encodeModeStructure(); break; default: break; } if ($sp27b5c4 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $spa0e498) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($spaa2e8b = 0, $spd41c76 = QR_ECLEVEL_L) { if ($spaa2e8b < 0 || $spaa2e8b > QRSPEC_VERSION_MAX || $spd41c76 > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $spaa2e8b; $this->level = $spd41c76; } public function getVersion() { return $this->version; } public function setVersion($spaa2e8b) { if ($spaa2e8b < 0 || $spaa2e8b > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $spaa2e8b; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($spd41c76) { if ($spd41c76 > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $spd41c76; return 0; } public function appendEntry(QRinputItem $spc5c295) { $this->items[] = $spc5c295; } public function append($spa1845d, $spf9945d, $sp2bb3bd) { try { $spc5c295 = new QRinputItem($spa1845d, $spf9945d, $sp2bb3bd); $this->items[] = $spc5c295; return 0; } catch (Exception $spa0e498) { return -1; } } public function insertStructuredAppendHeader($spf9945d, $sp74a832, $sp0a751d) { if ($spf9945d > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($sp74a832 <= 0 || $sp74a832 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $sp74dfa5 = array($spf9945d, $sp74a832, $sp0a751d); try { $spc5c295 = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $spc5c295); return 0; } catch (Exception $spa0e498) { return -1; } } public function calcParity() { $sp0a751d = 0; foreach ($this->items as $sp83d892) { if ($sp83d892->mode != QR_MODE_STRUCTURE) { for ($sp3f53b5 = $sp83d892->size - 1; $sp3f53b5 >= 0; $sp3f53b5--) { $sp0a751d ^= $sp83d892->data[$sp3f53b5]; } } } return $sp0a751d; } public static function checkModeNum($spf9945d, $sp2bb3bd) { for ($sp3f53b5 = 0; $sp3f53b5 < $spf9945d; $sp3f53b5++) { if (ord($sp2bb3bd[$sp3f53b5]) < ord('0') || ord($sp2bb3bd[$sp3f53b5]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($spf9945d) { $spfaa7df = (int) $spf9945d / 3; $sp1cf170 = $spfaa7df * 10; switch ($spf9945d - $spfaa7df * 3) { case 1: $sp1cf170 += 4; break; case 2: $sp1cf170 += 7; break; default: break; } return $sp1cf170; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($spc0e8c3) { return $spc0e8c3 > 127 ? -1 : self::$anTable[$spc0e8c3]; } public static function checkModeAn($spf9945d, $sp2bb3bd) { for ($sp3f53b5 = 0; $sp3f53b5 < $spf9945d; $sp3f53b5++) { if (self::lookAnTable(ord($sp2bb3bd[$sp3f53b5])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($spf9945d) { $spfaa7df = (int) ($spf9945d / 2); $sp1cf170 = $spfaa7df * 11; if ($spf9945d & 1) { $sp1cf170 += 6; } return $sp1cf170; } public static function estimateBitsMode8($spf9945d) { return $spf9945d * 8; } public function estimateBitsModeKanji($spf9945d) { return (int) ($spf9945d / 2 * 13); } public static function checkModeKanji($spf9945d, $sp2bb3bd) { if ($spf9945d & 1) { return false; } for ($sp3f53b5 = 0; $sp3f53b5 < $spf9945d; $sp3f53b5 += 2) { $spfa4469 = ord($sp2bb3bd[$sp3f53b5]) << 8 | ord($sp2bb3bd[$sp3f53b5 + 1]); if ($spfa4469 < 33088 || $spfa4469 > 40956 && $spfa4469 < 57408 || $spfa4469 > 60351) { return false; } } return true; } public static function check($spa1845d, $spf9945d, $sp2bb3bd) { if ($spf9945d <= 0) { return false; } switch ($spa1845d) { case QR_MODE_NUM: return self::checkModeNum($spf9945d, $sp2bb3bd); break; case QR_MODE_AN: return self::checkModeAn($spf9945d, $sp2bb3bd); break; case QR_MODE_KANJI: return self::checkModeKanji($spf9945d, $sp2bb3bd); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($spaa2e8b) { $sp1cf170 = 0; foreach ($this->items as $sp83d892) { $sp1cf170 += $sp83d892->estimateBitStreamSizeOfEntry($spaa2e8b); } return $sp1cf170; } public function estimateVersion() { $spaa2e8b = 0; $spc27d30 = 0; do { $spc27d30 = $spaa2e8b; $sp1cf170 = $this->estimateBitStreamSize($spc27d30); $spaa2e8b = QRspec::getMinimumVersion((int) (($sp1cf170 + 7) / 8), $this->level); if ($spaa2e8b < 0) { return -1; } } while ($spaa2e8b > $spc27d30); return $spaa2e8b; } public static function lengthOfCode($spa1845d, $spaa2e8b, $sp1cf170) { $sp6ef2e7 = $sp1cf170 - 4 - QRspec::lengthIndicator($spa1845d, $spaa2e8b); switch ($spa1845d) { case QR_MODE_NUM: $sp3b316d = (int) ($sp6ef2e7 / 10); $sp92bfc8 = $sp6ef2e7 - $sp3b316d * 10; $spf9945d = $sp3b316d * 3; if ($sp92bfc8 >= 7) { $spf9945d += 2; } else { if ($sp92bfc8 >= 4) { $spf9945d += 1; } } break; case QR_MODE_AN: $sp3b316d = (int) ($sp6ef2e7 / 11); $sp92bfc8 = $sp6ef2e7 - $sp3b316d * 11; $spf9945d = $sp3b316d * 2; if ($sp92bfc8 >= 6) { $spf9945d++; } break; case QR_MODE_8: $spf9945d = (int) ($sp6ef2e7 / 8); break; case QR_MODE_KANJI: $spf9945d = (int) ($sp6ef2e7 / 13 * 2); break; case QR_MODE_STRUCTURE: $spf9945d = (int) ($sp6ef2e7 / 8); break; default: $spf9945d = 0; break; } $sp66021b = QRspec::maximumWords($spa1845d, $spaa2e8b); if ($spf9945d < 0) { $spf9945d = 0; } if ($spf9945d > $sp66021b) { $spf9945d = $sp66021b; } return $spf9945d; } public function createBitStream() { $sp67d6db = 0; foreach ($this->items as $sp83d892) { $sp1cf170 = $sp83d892->encodeBitStream($this->version); if ($sp1cf170 < 0) { return -1; } $sp67d6db += $sp1cf170; } return $sp67d6db; } public function convertData() { $sp871685 = $this->estimateVersion(); if ($sp871685 > $this->getVersion()) { $this->setVersion($sp871685); } for (;;) { $sp1cf170 = $this->createBitStream(); if ($sp1cf170 < 0) { return -1; } $sp871685 = QRspec::getMinimumVersion((int) (($sp1cf170 + 7) / 8), $this->level); if ($sp871685 < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($sp871685 > $this->getVersion()) { $this->setVersion($sp871685); } else { break; } } } return 0; } public function appendPaddingBit(&$sp822c7b) { $sp1cf170 = $sp822c7b->size(); $sp4ef206 = QRspec::getDataLength($this->version, $this->level); $spcad177 = $sp4ef206 * 8; if ($spcad177 == $sp1cf170) { return 0; } if ($spcad177 - $sp1cf170 < 5) { return $sp822c7b->appendNum($spcad177 - $sp1cf170, 0); } $sp1cf170 += 4; $sp70a70d = (int) (($sp1cf170 + 7) / 8); $spb57938 = new QRbitstream(); $sp27b5c4 = $spb57938->appendNum($sp70a70d * 8 - $sp1cf170 + 4, 0); if ($sp27b5c4 < 0) { return $sp27b5c4; } $spd0ae39 = $sp4ef206 - $sp70a70d; if ($spd0ae39 > 0) { $spacef00 = array(); for ($sp3f53b5 = 0; $sp3f53b5 < $spd0ae39; $sp3f53b5++) { $spacef00[$sp3f53b5] = $sp3f53b5 & 1 ? 17 : 236; } $sp27b5c4 = $spb57938->appendBytes($spd0ae39, $spacef00); if ($sp27b5c4 < 0) { return $sp27b5c4; } } $sp27b5c4 = $sp822c7b->append($spb57938); return $sp27b5c4; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $sp822c7b = new QRbitstream(); foreach ($this->items as $sp83d892) { $sp27b5c4 = $sp822c7b->append($sp83d892->bstream); if ($sp27b5c4 < 0) { return null; } } return $sp822c7b; } public function getBitStream() { $sp822c7b = $this->mergeBitStream(); if ($sp822c7b == null) { return null; } $sp27b5c4 = $this->appendPaddingBit($sp822c7b); if ($sp27b5c4 < 0) { return null; } return $sp822c7b; } public function getByteStream() { $sp822c7b = $this->getBitStream(); if ($sp822c7b == null) { return null; } return $sp822c7b->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($spc13388) { $this->data = array_fill(0, $spc13388, 0); return 0; } public static function newFromNum($sp1cf170, $spe63642) { $sp822c7b = new QRbitstream(); $sp822c7b->allocate($sp1cf170); $spdc543b = 1 << $sp1cf170 - 1; for ($sp3f53b5 = 0; $sp3f53b5 < $sp1cf170; $sp3f53b5++) { if ($spe63642 & $spdc543b) { $sp822c7b->data[$sp3f53b5] = 1; } else { $sp822c7b->data[$sp3f53b5] = 0; } $spdc543b = $spdc543b >> 1; } return $sp822c7b; } public static function newFromBytes($spf9945d, $sp2bb3bd) { $sp822c7b = new QRbitstream(); $sp822c7b->allocate($spf9945d * 8); $spdcd8e6 = 0; for ($sp3f53b5 = 0; $sp3f53b5 < $spf9945d; $sp3f53b5++) { $spdc543b = 128; for ($spf894b1 = 0; $spf894b1 < 8; $spf894b1++) { if ($sp2bb3bd[$sp3f53b5] & $spdc543b) { $sp822c7b->data[$spdcd8e6] = 1; } else { $sp822c7b->data[$spdcd8e6] = 0; } $spdcd8e6++; $spdc543b = $spdc543b >> 1; } } return $sp822c7b; } public function append(QRbitstream $spd74277) { if (is_null($spd74277)) { return -1; } if ($spd74277->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $spd74277->data; return 0; } $this->data = array_values(array_merge($this->data, $spd74277->data)); return 0; } public function appendNum($sp1cf170, $spe63642) { if ($sp1cf170 == 0) { return 0; } $sp69e010 = QRbitstream::newFromNum($sp1cf170, $spe63642); if (is_null($sp69e010)) { return -1; } $sp27b5c4 = $this->append($sp69e010); unset($sp69e010); return $sp27b5c4; } public function appendBytes($spf9945d, $sp2bb3bd) { if ($spf9945d == 0) { return 0; } $sp69e010 = QRbitstream::newFromBytes($spf9945d, $sp2bb3bd); if (is_null($sp69e010)) { return -1; } $sp27b5c4 = $this->append($sp69e010); unset($sp69e010); return $sp27b5c4; } public function toByte() { $spf9945d = $this->size(); if ($spf9945d == 0) { return array(); } $sp2bb3bd = array_fill(0, (int) (($spf9945d + 7) / 8), 0); $sp232575 = (int) ($spf9945d / 8); $spdcd8e6 = 0; for ($sp3f53b5 = 0; $sp3f53b5 < $sp232575; $sp3f53b5++) { $spc86f28 = 0; for ($spf894b1 = 0; $spf894b1 < 8; $spf894b1++) { $spc86f28 = $spc86f28 << 1; $spc86f28 |= $this->data[$spdcd8e6]; $spdcd8e6++; } $sp2bb3bd[$sp3f53b5] = $spc86f28; } if ($spf9945d & 7) { $spc86f28 = 0; for ($spf894b1 = 0; $spf894b1 < ($spf9945d & 7); $spf894b1++) { $spc86f28 = $spc86f28 << 1; $spc86f28 |= $this->data[$spdcd8e6]; $spdcd8e6++; } $sp2bb3bd[$sp232575] = $spc86f28; } return $sp2bb3bd; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($sp736a5f, $sp63ca0e, $spc862f4) { $this->dataStr = $sp736a5f; $this->input = $sp63ca0e; $this->modeHint = $spc862f4; } public static function isdigitat($spba2cdb, $sp32b999) { if ($sp32b999 >= strlen($spba2cdb)) { return false; } return ord($spba2cdb[$sp32b999]) >= ord('0') && ord($spba2cdb[$sp32b999]) <= ord('9'); } public static function isalnumat($spba2cdb, $sp32b999) { if ($sp32b999 >= strlen($spba2cdb)) { return false; } return QRinput::lookAnTable(ord($spba2cdb[$sp32b999])) >= 0; } public function identifyMode($sp32b999) { if ($sp32b999 >= strlen($this->dataStr)) { return QR_MODE_NUL; } $spc0e8c3 = $this->dataStr[$sp32b999]; if (self::isdigitat($this->dataStr, $sp32b999)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $sp32b999)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($sp32b999 + 1 < strlen($this->dataStr)) { $sp7830bb = $this->dataStr[$sp32b999 + 1]; $sp6adb52 = ord($spc0e8c3) << 8 | ord($sp7830bb); if ($sp6adb52 >= 33088 && $sp6adb52 <= 40956 || $sp6adb52 >= 57408 && $sp6adb52 <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp7be39f = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spdcd8e6 = 0; while (self::isdigitat($this->dataStr, $spdcd8e6)) { $spdcd8e6++; } $sp13f6fc = $spdcd8e6; $spa1845d = $this->identifyMode($spdcd8e6); if ($spa1845d == QR_MODE_8) { $sp3943d5 = QRinput::estimateBitsModeNum($sp13f6fc) + 4 + $sp7be39f + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp13f6fc + 1); if ($sp3943d5 > 0) { return $this->eat8(); } } if ($spa1845d == QR_MODE_AN) { $sp3943d5 = QRinput::estimateBitsModeNum($sp13f6fc) + 4 + $sp7be39f + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($sp13f6fc + 1); if ($sp3943d5 > 0) { return $this->eatAn(); } } $sp27b5c4 = $this->input->append(QR_MODE_NUM, $sp13f6fc, str_split($this->dataStr)); if ($sp27b5c4 < 0) { return -1; } return $sp13f6fc; } public function eatAn() { $sp0dfb0f = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp7be39f = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spdcd8e6 = 0; while (self::isalnumat($this->dataStr, $spdcd8e6)) { if (self::isdigitat($this->dataStr, $spdcd8e6)) { $sp0e81b7 = $spdcd8e6; while (self::isdigitat($this->dataStr, $sp0e81b7)) { $sp0e81b7++; } $sp3943d5 = QRinput::estimateBitsModeAn($spdcd8e6) + QRinput::estimateBitsModeNum($sp0e81b7 - $spdcd8e6) + 4 + $sp7be39f - QRinput::estimateBitsModeAn($sp0e81b7); if ($sp3943d5 < 0) { break; } else { $spdcd8e6 = $sp0e81b7; } } else { $spdcd8e6++; } } $sp13f6fc = $spdcd8e6; if (!self::isalnumat($this->dataStr, $spdcd8e6)) { $sp3943d5 = QRinput::estimateBitsModeAn($sp13f6fc) + 4 + $sp0dfb0f + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp13f6fc + 1); if ($sp3943d5 > 0) { return $this->eat8(); } } $sp27b5c4 = $this->input->append(QR_MODE_AN, $sp13f6fc, str_split($this->dataStr)); if ($sp27b5c4 < 0) { return -1; } return $sp13f6fc; } public function eatKanji() { $spdcd8e6 = 0; while ($this->identifyMode($spdcd8e6) == QR_MODE_KANJI) { $spdcd8e6 += 2; } $sp27b5c4 = $this->input->append(QR_MODE_KANJI, $spdcd8e6, str_split($this->dataStr)); if ($sp27b5c4 < 0) { return -1; } return $sp13f6fc; } public function eat8() { $sp0dfb0f = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp7be39f = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $spdcd8e6 = 1; $sp3304b9 = strlen($this->dataStr); while ($spdcd8e6 < $sp3304b9) { $spa1845d = $this->identifyMode($spdcd8e6); if ($spa1845d == QR_MODE_KANJI) { break; } if ($spa1845d == QR_MODE_NUM) { $sp0e81b7 = $spdcd8e6; while (self::isdigitat($this->dataStr, $sp0e81b7)) { $sp0e81b7++; } $sp3943d5 = QRinput::estimateBitsMode8($spdcd8e6) + QRinput::estimateBitsModeNum($sp0e81b7 - $spdcd8e6) + 4 + $sp7be39f - QRinput::estimateBitsMode8($sp0e81b7); if ($sp3943d5 < 0) { break; } else { $spdcd8e6 = $sp0e81b7; } } else { if ($spa1845d == QR_MODE_AN) { $sp0e81b7 = $spdcd8e6; while (self::isalnumat($this->dataStr, $sp0e81b7)) { $sp0e81b7++; } $sp3943d5 = QRinput::estimateBitsMode8($spdcd8e6) + QRinput::estimateBitsModeAn($sp0e81b7 - $spdcd8e6) + 4 + $sp0dfb0f - QRinput::estimateBitsMode8($sp0e81b7); if ($sp3943d5 < 0) { break; } else { $spdcd8e6 = $sp0e81b7; } } else { $spdcd8e6++; } } } $sp13f6fc = $spdcd8e6; $sp27b5c4 = $this->input->append(QR_MODE_8, $sp13f6fc, str_split($this->dataStr)); if ($sp27b5c4 < 0) { return -1; } return $sp13f6fc; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $spa1845d = $this->identifyMode(0); switch ($spa1845d) { case QR_MODE_NUM: $spf9d313 = $this->eatNum(); break; case QR_MODE_AN: $spf9d313 = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp92d3d8 == QR_MODE_KANJI) { $spf9d313 = $this->eatKanji(); } else { $spf9d313 = $this->eat8(); } break; default: $spf9d313 = $this->eat8(); break; } if ($spf9d313 == 0) { return 0; } if ($spf9d313 < 0) { return -1; } $this->dataStr = substr($this->dataStr, $spf9d313); } } public function toUpper() { $spbf9489 = strlen($this->dataStr); $spdcd8e6 = 0; while ($spdcd8e6 < $spbf9489) { $spa1845d = self::identifyMode(substr($this->dataStr, $spdcd8e6), $this->modeHint); if ($spa1845d == QR_MODE_KANJI) { $spdcd8e6 += 2; } else { if (ord($this->dataStr[$spdcd8e6]) >= ord('a') && ord($this->dataStr[$spdcd8e6]) <= ord('z')) { $this->dataStr[$spdcd8e6] = chr(ord($this->dataStr[$spdcd8e6]) - 32); } $spdcd8e6++; } } return $this->dataStr; } public static function splitStringToQRinput($sp0af8e2, QRinput $sp63ca0e, $spc862f4, $spf11278 = true) { if (is_null($sp0af8e2) || $sp0af8e2 == '\\0' || $sp0af8e2 == '') { throw new Exception('empty string!!!'); } $sp0ab210 = new QRsplit($sp0af8e2, $sp63ca0e, $spc862f4); if (!$spf11278) { $sp0ab210->toUpper(); } return $sp0ab210->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($spc8a6d0) { while ($spc8a6d0 >= $this->nn) { $spc8a6d0 -= $this->nn; $spc8a6d0 = ($spc8a6d0 >> $this->mm) + ($spc8a6d0 & $this->nn); } return $spc8a6d0; } public static function init_rs_char($speae267, $sp9d4f2a, $sp7e5416, $sp03e329, $sp1e8a62, $sp25fa7e) { $sp0f622b = null; if ($speae267 < 0 || $speae267 > 8) { return $sp0f622b; } if ($sp7e5416 < 0 || $sp7e5416 >= 1 << $speae267) { return $sp0f622b; } if ($sp03e329 <= 0 || $sp03e329 >= 1 << $speae267) { return $sp0f622b; } if ($sp1e8a62 < 0 || $sp1e8a62 >= 1 << $speae267) { return $sp0f622b; } if ($sp25fa7e < 0 || $sp25fa7e >= (1 << $speae267) - 1 - $sp1e8a62) { return $sp0f622b; } $sp0f622b = new QRrsItem(); $sp0f622b->mm = $speae267; $sp0f622b->nn = (1 << $speae267) - 1; $sp0f622b->pad = $sp25fa7e; $sp0f622b->alpha_to = array_fill(0, $sp0f622b->nn + 1, 0); $sp0f622b->index_of = array_fill(0, $sp0f622b->nn + 1, 0); $spcb04e8 =& $sp0f622b->nn; $spb1fade =& $spcb04e8; $sp0f622b->index_of[0] = $spb1fade; $sp0f622b->alpha_to[$spb1fade] = 0; $sp016028 = 1; for ($sp3f53b5 = 0; $sp3f53b5 < $sp0f622b->nn; $sp3f53b5++) { $sp0f622b->index_of[$sp016028] = $sp3f53b5; $sp0f622b->alpha_to[$sp3f53b5] = $sp016028; $sp016028 <<= 1; if ($sp016028 & 1 << $speae267) { $sp016028 ^= $sp9d4f2a; } $sp016028 &= $sp0f622b->nn; } if ($sp016028 != 1) { $sp0f622b = NULL; return $sp0f622b; } $sp0f622b->genpoly = array_fill(0, $sp1e8a62 + 1, 0); $sp0f622b->fcr = $sp7e5416; $sp0f622b->prim = $sp03e329; $sp0f622b->nroots = $sp1e8a62; $sp0f622b->gfpoly = $sp9d4f2a; for ($sp3a1af5 = 1; $sp3a1af5 % $sp03e329 != 0; $sp3a1af5 += $sp0f622b->nn) { } $sp0f622b->iprim = (int) ($sp3a1af5 / $sp03e329); $sp0f622b->genpoly[0] = 1; for ($sp3f53b5 = 0, $sp5cf090 = $sp7e5416 * $sp03e329; $sp3f53b5 < $sp1e8a62; $sp3f53b5++, $sp5cf090 += $sp03e329) { $sp0f622b->genpoly[$sp3f53b5 + 1] = 1; for ($spf894b1 = $sp3f53b5; $spf894b1 > 0; $spf894b1--) { if ($sp0f622b->genpoly[$spf894b1] != 0) { $sp0f622b->genpoly[$spf894b1] = $sp0f622b->genpoly[$spf894b1 - 1] ^ $sp0f622b->alpha_to[$sp0f622b->modnn($sp0f622b->index_of[$sp0f622b->genpoly[$spf894b1]] + $sp5cf090)]; } else { $sp0f622b->genpoly[$spf894b1] = $sp0f622b->genpoly[$spf894b1 - 1]; } } $sp0f622b->genpoly[0] = $sp0f622b->alpha_to[$sp0f622b->modnn($sp0f622b->index_of[$sp0f622b->genpoly[0]] + $sp5cf090)]; } for ($sp3f53b5 = 0; $sp3f53b5 <= $sp1e8a62; $sp3f53b5++) { $sp0f622b->genpoly[$sp3f53b5] = $sp0f622b->index_of[$sp0f622b->genpoly[$sp3f53b5]]; } return $sp0f622b; } public function encode_rs_char($sp2bb3bd, &$sp0a751d) { $sp201463 =& $this->mm; $spcb04e8 =& $this->nn; $sp007251 =& $this->alpha_to; $sp6b4430 =& $this->index_of; $sp18de61 =& $this->genpoly; $spb165db =& $this->nroots; $spbf5546 =& $this->fcr; $sp616e72 =& $this->prim; $sp0cbdc3 =& $this->iprim; $sp88851b =& $this->pad; $spb1fade =& $spcb04e8; $sp0a751d = array_fill(0, $spb165db, 0); for ($sp3f53b5 = 0; $sp3f53b5 < $spcb04e8 - $spb165db - $sp88851b; $sp3f53b5++) { $spd3c66b = $sp6b4430[$sp2bb3bd[$sp3f53b5] ^ $sp0a751d[0]]; if ($spd3c66b != $spb1fade) { $spd3c66b = $this->modnn($spcb04e8 - $sp18de61[$spb165db] + $spd3c66b); for ($spf894b1 = 1; $spf894b1 < $spb165db; $spf894b1++) { $sp0a751d[$spf894b1] ^= $sp007251[$this->modnn($spd3c66b + $sp18de61[$spb165db - $spf894b1])]; } } array_shift($sp0a751d); if ($spd3c66b != $spb1fade) { array_push($sp0a751d, $sp007251[$this->modnn($spd3c66b + $sp18de61[0])]); } else { array_push($sp0a751d, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($speae267, $sp9d4f2a, $sp7e5416, $sp03e329, $sp1e8a62, $sp25fa7e) { foreach (self::$items as $sp0f622b) { if ($sp0f622b->pad != $sp25fa7e) { continue; } if ($sp0f622b->nroots != $sp1e8a62) { continue; } if ($sp0f622b->mm != $speae267) { continue; } if ($sp0f622b->gfpoly != $sp9d4f2a) { continue; } if ($sp0f622b->fcr != $sp7e5416) { continue; } if ($sp0f622b->prim != $sp03e329) { continue; } return $sp0f622b; } $sp0f622b = QRrsItem::init_rs_char($speae267, $sp9d4f2a, $sp7e5416, $sp03e329, $sp1e8a62, $sp25fa7e); array_unshift(self::$items, $sp0f622b); return $sp0f622b; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($spda3f0e, &$sp689fd2, $spdc543b, $spd41c76) { $spfac245 = 0; $sp5e1fb8 = QRspec::getFormatInfo($spdc543b, $spd41c76); for ($sp3f53b5 = 0; $sp3f53b5 < 8; $sp3f53b5++) { if ($sp5e1fb8 & 1) { $spfac245 += 2; $spc86f28 = 133; } else { $spc86f28 = 132; } $sp689fd2[8][$spda3f0e - 1 - $sp3f53b5] = chr($spc86f28); if ($sp3f53b5 < 6) { $sp689fd2[$sp3f53b5][8] = chr($spc86f28); } else { $sp689fd2[$sp3f53b5 + 1][8] = chr($spc86f28); } $sp5e1fb8 = $sp5e1fb8 >> 1; } for ($sp3f53b5 = 0; $sp3f53b5 < 7; $sp3f53b5++) { if ($sp5e1fb8 & 1) { $spfac245 += 2; $spc86f28 = 133; } else { $spc86f28 = 132; } $sp689fd2[$spda3f0e - 7 + $sp3f53b5][8] = chr($spc86f28); if ($sp3f53b5 == 0) { $sp689fd2[8][7] = chr($spc86f28); } else { $sp689fd2[8][6 - $sp3f53b5] = chr($spc86f28); } $sp5e1fb8 = $sp5e1fb8 >> 1; } return $spfac245; } public function mask0($spc8a6d0, $spf07083) { return $spc8a6d0 + $spf07083 & 1; } public function mask1($spc8a6d0, $spf07083) { return $spf07083 & 1; } public function mask2($spc8a6d0, $spf07083) { return $spc8a6d0 % 3; } public function mask3($spc8a6d0, $spf07083) { return ($spc8a6d0 + $spf07083) % 3; } public function mask4($spc8a6d0, $spf07083) { return (int) ($spf07083 / 2) + (int) ($spc8a6d0 / 3) & 1; } public function mask5($spc8a6d0, $spf07083) { return ($spc8a6d0 * $spf07083 & 1) + $spc8a6d0 * $spf07083 % 3; } public function mask6($spc8a6d0, $spf07083) { return ($spc8a6d0 * $spf07083 & 1) + $spc8a6d0 * $spf07083 % 3 & 1; } public function mask7($spc8a6d0, $spf07083) { return $spc8a6d0 * $spf07083 % 3 + ($spc8a6d0 + $spf07083 & 1) & 1; } private function generateMaskNo($sp066731, $spda3f0e, $sp689fd2) { $sp4a56b4 = array_fill(0, $spda3f0e, array_fill(0, $spda3f0e, 0)); for ($spf07083 = 0; $spf07083 < $spda3f0e; $spf07083++) { for ($spc8a6d0 = 0; $spc8a6d0 < $spda3f0e; $spc8a6d0++) { if (ord($sp689fd2[$spf07083][$spc8a6d0]) & 128) { $sp4a56b4[$spf07083][$spc8a6d0] = 0; } else { $sp05a773 = call_user_func(array($this, 'mask' . $sp066731), $spc8a6d0, $spf07083); $sp4a56b4[$spf07083][$spc8a6d0] = $sp05a773 == 0 ? 1 : 0; } } } return $sp4a56b4; } public static function serial($sp36dad5) { $sp06a43c = array(); foreach ($sp36dad5 as $sp7c6222) { $sp06a43c[] = join('', $sp7c6222); } return gzcompress(join('
', $sp06a43c), 9); } public static function unserial($sp89b33d) { $sp06a43c = array(); $specd3bd = explode('
', gzuncompress($sp89b33d)); foreach ($specd3bd as $sp7c6222) { $sp06a43c[] = str_split($sp7c6222); } return $sp06a43c; } public function makeMaskNo($sp066731, $spda3f0e, $sp7fb208, &$sp7830bb, $spc80efe = false) { $sp69e010 = 0; $sp4a56b4 = array(); $sp4f8b14 = QR_CACHE_DIR . 'mask_' . $sp066731 . DIRECTORY_SEPARATOR . 'mask_' . $spda3f0e . '_' . $sp066731 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp4f8b14)) { $sp4a56b4 = self::unserial(file_get_contents($sp4f8b14)); } else { $sp4a56b4 = $this->generateMaskNo($sp066731, $spda3f0e, $sp7fb208, $sp7830bb); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp066731)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp066731); } file_put_contents($sp4f8b14, self::serial($sp4a56b4)); } } else { $sp4a56b4 = $this->generateMaskNo($sp066731, $spda3f0e, $sp7fb208, $sp7830bb); } if ($spc80efe) { return; } $sp7830bb = $sp7fb208; for ($spf07083 = 0; $spf07083 < $spda3f0e; $spf07083++) { for ($spc8a6d0 = 0; $spc8a6d0 < $spda3f0e; $spc8a6d0++) { if ($sp4a56b4[$spf07083][$spc8a6d0] == 1) { $sp7830bb[$spf07083][$spc8a6d0] = chr(ord($sp7fb208[$spf07083][$spc8a6d0]) ^ (int) $sp4a56b4[$spf07083][$spc8a6d0]); } $sp69e010 += (int) (ord($sp7830bb[$spf07083][$spc8a6d0]) & 1); } } return $sp69e010; } public function makeMask($spda3f0e, $sp689fd2, $sp066731, $spd41c76) { $sp6dded6 = array_fill(0, $spda3f0e, str_repeat(' ', $spda3f0e)); $this->makeMaskNo($sp066731, $spda3f0e, $sp689fd2, $sp6dded6); $this->writeFormatInformation($spda3f0e, $sp6dded6, $sp066731, $spd41c76); return $sp6dded6; } public function calcN1N3($spf9d313) { $spca9137 = 0; for ($sp3f53b5 = 0; $sp3f53b5 < $spf9d313; $sp3f53b5++) { if ($this->runLength[$sp3f53b5] >= 5) { $spca9137 += N1 + ($this->runLength[$sp3f53b5] - 5); } if ($sp3f53b5 & 1) { if ($sp3f53b5 >= 3 && $sp3f53b5 < $spf9d313 - 2 && $this->runLength[$sp3f53b5] % 3 == 0) { $spebc723 = (int) ($this->runLength[$sp3f53b5] / 3); if ($this->runLength[$sp3f53b5 - 2] == $spebc723 && $this->runLength[$sp3f53b5 - 1] == $spebc723 && $this->runLength[$sp3f53b5 + 1] == $spebc723 && $this->runLength[$sp3f53b5 + 2] == $spebc723) { if ($this->runLength[$sp3f53b5 - 3] < 0 || $this->runLength[$sp3f53b5 - 3] >= 4 * $spebc723) { $spca9137 += N3; } else { if ($sp3f53b5 + 3 >= $spf9d313 || $this->runLength[$sp3f53b5 + 3] >= 4 * $spebc723) { $spca9137 += N3; } } } } } } return $spca9137; } public function evaluateSymbol($spda3f0e, $sp689fd2) { $spd3b547 = 0; $spca9137 = 0; for ($spf07083 = 0; $spf07083 < $spda3f0e; $spf07083++) { $spd3b547 = 0; $this->runLength[0] = 1; $sp67f076 = $sp689fd2[$spf07083]; if ($spf07083 > 0) { $sp23af22 = $sp689fd2[$spf07083 - 1]; } for ($spc8a6d0 = 0; $spc8a6d0 < $spda3f0e; $spc8a6d0++) { if ($spc8a6d0 > 0 && $spf07083 > 0) { $sp1acf0e = ord($sp67f076[$spc8a6d0]) & ord($sp67f076[$spc8a6d0 - 1]) & ord($sp23af22[$spc8a6d0]) & ord($sp23af22[$spc8a6d0 - 1]); $spa2fe37 = ord($sp67f076[$spc8a6d0]) | ord($sp67f076[$spc8a6d0 - 1]) | ord($sp23af22[$spc8a6d0]) | ord($sp23af22[$spc8a6d0 - 1]); if (($sp1acf0e | $spa2fe37 ^ 1) & 1) { $spca9137 += N2; } } if ($spc8a6d0 == 0 && ord($sp67f076[$spc8a6d0]) & 1) { $this->runLength[0] = -1; $spd3b547 = 1; $this->runLength[$spd3b547] = 1; } else { if ($spc8a6d0 > 0) { if ((ord($sp67f076[$spc8a6d0]) ^ ord($sp67f076[$spc8a6d0 - 1])) & 1) { $spd3b547++; $this->runLength[$spd3b547] = 1; } else { $this->runLength[$spd3b547]++; } } } } $spca9137 += $this->calcN1N3($spd3b547 + 1); } for ($spc8a6d0 = 0; $spc8a6d0 < $spda3f0e; $spc8a6d0++) { $spd3b547 = 0; $this->runLength[0] = 1; for ($spf07083 = 0; $spf07083 < $spda3f0e; $spf07083++) { if ($spf07083 == 0 && ord($sp689fd2[$spf07083][$spc8a6d0]) & 1) { $this->runLength[0] = -1; $spd3b547 = 1; $this->runLength[$spd3b547] = 1; } else { if ($spf07083 > 0) { if ((ord($sp689fd2[$spf07083][$spc8a6d0]) ^ ord($sp689fd2[$spf07083 - 1][$spc8a6d0])) & 1) { $spd3b547++; $this->runLength[$spd3b547] = 1; } else { $this->runLength[$spd3b547]++; } } } } $spca9137 += $this->calcN1N3($spd3b547 + 1); } return $spca9137; } public function mask($spda3f0e, $sp689fd2, $spd41c76) { $sp2b11c9 = PHP_INT_MAX; $spf2452e = 0; $spf5032c = array(); $spc7aacb = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp8aceef = 8 - QR_FIND_FROM_RANDOM % 9; for ($sp3f53b5 = 0; $sp3f53b5 < $sp8aceef; $sp3f53b5++) { $sp103399 = rand(0, count($spc7aacb) - 1); unset($spc7aacb[$sp103399]); $spc7aacb = array_values($spc7aacb); } } $spf5032c = $sp689fd2; foreach ($spc7aacb as $sp3f53b5) { $spdc543b = array_fill(0, $spda3f0e, str_repeat(' ', $spda3f0e)); $spca9137 = 0; $spfac245 = 0; $spfac245 = $this->makeMaskNo($sp3f53b5, $spda3f0e, $sp689fd2, $spdc543b); $spfac245 += $this->writeFormatInformation($spda3f0e, $spdc543b, $sp3f53b5, $spd41c76); $spfac245 = (int) (100 * $spfac245 / ($spda3f0e * $spda3f0e)); $spca9137 = (int) ((int) (abs($spfac245 - 50) / 5) * N4); $spca9137 += $this->evaluateSymbol($spda3f0e, $spdc543b); if ($spca9137 < $sp2b11c9) { $sp2b11c9 = $spca9137; $spf5032c = $spdc543b; $spf2452e = $sp3f53b5; } } return $spf5032c; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($spf9ff2b, $sp2bb3bd, $sp28cf86, &$sp038d66, QRrsItem $sp0f622b) { $sp0f622b->encode_rs_char($sp2bb3bd, $sp038d66); $this->dataLength = $spf9ff2b; $this->data = $sp2bb3bd; $this->eccLength = $sp28cf86; $this->ecc = $sp038d66; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp63ca0e) { $sp83c954 = array(0, 0, 0, 0, 0); $this->datacode = $sp63ca0e->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp63ca0e->getVersion(), $sp63ca0e->getErrorCorrectionLevel(), $sp83c954); $this->version = $sp63ca0e->getVersion(); $this->b1 = QRspec::rsBlockNum1($sp83c954); $this->dataLength = QRspec::rsDataLength($sp83c954); $this->eccLength = QRspec::rsEccLength($sp83c954); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($sp83c954); $sp27b5c4 = $this->init($sp83c954); if ($sp27b5c4 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $sp83c954) { $spf9ff2b = QRspec::rsDataCodes1($sp83c954); $sp28cf86 = QRspec::rsEccCodes1($sp83c954); $sp0f622b = QRrs::init_rs(8, 285, 0, 1, $sp28cf86, 255 - $spf9ff2b - $sp28cf86); $sp40c9c3 = 0; $spa36e04 = 0; $spd201b0 = 0; for ($sp3f53b5 = 0; $sp3f53b5 < QRspec::rsBlockNum1($sp83c954); $sp3f53b5++) { $sp038d66 = array_slice($this->ecccode, $spd201b0); $this->rsblocks[$sp40c9c3] = new QRrsblock($spf9ff2b, array_slice($this->datacode, $spa36e04), $sp28cf86, $sp038d66, $sp0f622b); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $spd201b0), $sp038d66); $spa36e04 += $spf9ff2b; $spd201b0 += $sp28cf86; $sp40c9c3++; } if (QRspec::rsBlockNum2($sp83c954) == 0) { return 0; } $spf9ff2b = QRspec::rsDataCodes2($sp83c954); $sp28cf86 = QRspec::rsEccCodes2($sp83c954); $sp0f622b = QRrs::init_rs(8, 285, 0, 1, $sp28cf86, 255 - $spf9ff2b - $sp28cf86); if ($sp0f622b == NULL) { return -1; } for ($sp3f53b5 = 0; $sp3f53b5 < QRspec::rsBlockNum2($sp83c954); $sp3f53b5++) { $sp038d66 = array_slice($this->ecccode, $spd201b0); $this->rsblocks[$sp40c9c3] = new QRrsblock($spf9ff2b, array_slice($this->datacode, $spa36e04), $sp28cf86, $sp038d66, $sp0f622b); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $spd201b0), $sp038d66); $spa36e04 += $spf9ff2b; $spd201b0 += $sp28cf86; $sp40c9c3++; } return 0; } public function getCode() { $sp27b5c4; if ($this->count < $this->dataLength) { $spbb7cc4 = $this->count % $this->blocks; $sp40e087 = $this->count / $this->blocks; if ($sp40e087 >= $this->rsblocks[0]->dataLength) { $spbb7cc4 += $this->b1; } $sp27b5c4 = $this->rsblocks[$spbb7cc4]->data[$sp40e087]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $spbb7cc4 = ($this->count - $this->dataLength) % $this->blocks; $sp40e087 = ($this->count - $this->dataLength) / $this->blocks; $sp27b5c4 = $this->rsblocks[$spbb7cc4]->ecc[$sp40e087]; } else { return 0; } } $this->count++; return $sp27b5c4; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp63ca0e, $spdc543b) { if ($sp63ca0e->getVersion() < 0 || $sp63ca0e->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp63ca0e->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $sp436334 = new QRrawcode($sp63ca0e); QRtools::markTime('after_raw'); $spaa2e8b = $sp436334->version; $spda3f0e = QRspec::getWidth($spaa2e8b); $sp689fd2 = QRspec::newFrame($spaa2e8b); $spf220e3 = new FrameFiller($spda3f0e, $sp689fd2); if (is_null($spf220e3)) { return NULL; } for ($sp3f53b5 = 0; $sp3f53b5 < $sp436334->dataLength + $sp436334->eccLength; $sp3f53b5++) { $sp89b33d = $sp436334->getCode(); $sp07e076 = 128; for ($spf894b1 = 0; $spf894b1 < 8; $spf894b1++) { $spe93919 = $spf220e3->next(); $spf220e3->setFrameAt($spe93919, 2 | ($sp07e076 & $sp89b33d) != 0); $sp07e076 = $sp07e076 >> 1; } } QRtools::markTime('after_filler'); unset($sp436334); $spf894b1 = QRspec::getRemainder($spaa2e8b); for ($sp3f53b5 = 0; $sp3f53b5 < $spf894b1; $sp3f53b5++) { $spe93919 = $spf220e3->next(); $spf220e3->setFrameAt($spe93919, 2); } $sp689fd2 = $spf220e3->frame; unset($spf220e3); $sp33b6bb = new QRmask(); if ($spdc543b < 0) { if (QR_FIND_BEST_MASK) { $sp6dded6 = $sp33b6bb->mask($spda3f0e, $sp689fd2, $sp63ca0e->getErrorCorrectionLevel()); } else { $sp6dded6 = $sp33b6bb->makeMask($spda3f0e, $sp689fd2, intval(QR_DEFAULT_MASK) % 8, $sp63ca0e->getErrorCorrectionLevel()); } } else { $sp6dded6 = $sp33b6bb->makeMask($spda3f0e, $sp689fd2, $spdc543b, $sp63ca0e->getErrorCorrectionLevel()); } if ($sp6dded6 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $spaa2e8b; $this->width = $spda3f0e; $this->data = $sp6dded6; return $this; } public function encodeInput(QRinput $sp63ca0e) { return $this->encodeMask($sp63ca0e, -1); } public function encodeString8bit($sp0af8e2, $spaa2e8b, $spd41c76) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp63ca0e = new QRinput($spaa2e8b, $spd41c76); if ($sp63ca0e == NULL) { return NULL; } $sp27b5c4 = $sp63ca0e->append($sp63ca0e, QR_MODE_8, strlen($sp0af8e2), str_split($sp0af8e2)); if ($sp27b5c4 < 0) { unset($sp63ca0e); return NULL; } return $this->encodeInput($sp63ca0e); } public function encodeString($sp0af8e2, $spaa2e8b, $spd41c76, $sp92d3d8, $spf11278) { if ($sp92d3d8 != QR_MODE_8 && $sp92d3d8 != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp63ca0e = new QRinput($spaa2e8b, $spd41c76); if ($sp63ca0e == NULL) { return NULL; } $sp27b5c4 = QRsplit::splitStringToQRinput($sp0af8e2, $sp63ca0e, $sp92d3d8, $spf11278); if ($sp27b5c4 < 0) { return NULL; } return $this->encodeInput($sp63ca0e); } public static function png($speaf35f, $sp038257 = false, $spd41c76 = QR_ECLEVEL_L, $spf9945d = 3, $spc9d8ae = 4, $sp180b5c = false) { $spc98a20 = QRencode::factory($spd41c76, $spf9945d, $spc9d8ae); return $spc98a20->encodePNG($speaf35f, $sp038257, $sp180b5c = false); } public static function text($speaf35f, $sp038257 = false, $spd41c76 = QR_ECLEVEL_L, $spf9945d = 3, $spc9d8ae = 4) { $spc98a20 = QRencode::factory($spd41c76, $spf9945d, $spc9d8ae); return $spc98a20->encode($speaf35f, $sp038257); } public static function raw($speaf35f, $sp038257 = false, $spd41c76 = QR_ECLEVEL_L, $spf9945d = 3, $spc9d8ae = 4) { $spc98a20 = QRencode::factory($spd41c76, $spf9945d, $spc9d8ae); return $spc98a20->encodeRAW($speaf35f, $sp038257); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($spda3f0e, &$sp689fd2) { $this->width = $spda3f0e; $this->frame = $sp689fd2; $this->x = $spda3f0e - 1; $this->y = $spda3f0e - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp9b5793, $spfa4469) { $this->frame[$sp9b5793['y']][$sp9b5793['x']] = chr($spfa4469); } public function getFrameAt($sp9b5793) { return ord($this->frame[$sp9b5793['y']][$sp9b5793['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $spc8a6d0 = $this->x; $spf07083 = $this->y; $spfaa7df = $this->width; if ($this->bit == 0) { $spc8a6d0--; $this->bit++; } else { $spc8a6d0++; $spf07083 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($spf07083 < 0) { $spf07083 = 0; $spc8a6d0 -= 2; $this->dir = 1; if ($spc8a6d0 == 6) { $spc8a6d0--; $spf07083 = 9; } } } else { if ($spf07083 == $spfaa7df) { $spf07083 = $spfaa7df - 1; $spc8a6d0 -= 2; $this->dir = -1; if ($spc8a6d0 == 6) { $spc8a6d0--; $spf07083 -= 8; } } } if ($spc8a6d0 < 0 || $spf07083 < 0) { return null; } $this->x = $spc8a6d0; $this->y = $spf07083; } while (ord($this->frame[$spf07083][$spc8a6d0]) & 128); return array('x' => $spc8a6d0, 'y' => $spf07083); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($spd41c76 = QR_ECLEVEL_L, $spf9945d = 3, $spc9d8ae = 4) { $spc98a20 = new QRencode(); $spc98a20->size = $spf9945d; $spc98a20->margin = $spc9d8ae; switch ($spd41c76 . '') { case '0': case '1': case '2': case '3': $spc98a20->level = $spd41c76; break; case 'l': case 'L': $spc98a20->level = QR_ECLEVEL_L; break; case 'm': case 'M': $spc98a20->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $spc98a20->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $spc98a20->level = QR_ECLEVEL_H; break; } return $spc98a20; } public function encodeRAW($sp0c52ea, $sp038257 = false) { $sp89b33d = new QRcode(); if ($this->eightbit) { $sp89b33d->encodeString8bit($sp0c52ea, $this->version, $this->level); } else { $sp89b33d->encodeString($sp0c52ea, $this->version, $this->level, $this->hint, $this->casesensitive); } return $sp89b33d->data; } public function encode($sp0c52ea, $sp038257 = false) { $sp89b33d = new QRcode(); if ($this->eightbit) { $sp89b33d->encodeString8bit($sp0c52ea, $this->version, $this->level); } else { $sp89b33d->encodeString($sp0c52ea, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($sp038257 !== false) { file_put_contents($sp038257, join('
', QRtools::binarize($sp89b33d->data))); } else { return QRtools::binarize($sp89b33d->data); } } public function encodePNG($sp0c52ea, $sp038257 = false, $sp180b5c = false) { try { ob_start(); $sp15fc00 = $this->encode($sp0c52ea); $sp5c660e = ob_get_contents(); ob_end_clean(); if ($sp5c660e != '') { QRtools::log($sp038257, $sp5c660e); } $sp854470 = (int) (QR_PNG_MAXIMUM_SIZE / (count($sp15fc00) + 2 * $this->margin)); QRimage::png($sp15fc00, $sp038257, min(max(1, $this->size), $sp854470), $this->margin, $sp180b5c); } catch (Exception $spa0e498) { QRtools::log($sp038257, $spa0e498->getMessage()); } } }