<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$sp4994a6, $spc9afe1, $sp75b385, $sp577702, $sp483829 = false) { $sp4994a6[$sp75b385] = substr_replace($sp4994a6[$sp75b385], $sp483829 !== false ? substr($sp577702, 0, $sp483829) : $sp577702, $spc9afe1, $sp483829 !== false ? $sp483829 : strlen($sp577702)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp3c0683) { $sp0761bc = count($sp3c0683); foreach ($sp3c0683 as &$spc10920) { for ($spcecaa9 = 0; $spcecaa9 < $sp0761bc; $spcecaa9++) { $spc10920[$spcecaa9] = ord($spc10920[$spcecaa9]) & 1 ? '1' : '0'; } } return $sp3c0683; } public static function tcpdfBarcodeArray($spc8e60b, $sp1058d9 = 'QR,L', $sp009d1c = '4.5.037') { $spaba152 = array(); if (!is_array($sp1058d9)) { $sp1058d9 = explode(',', $sp1058d9); } $sp259eef = 'L'; if (count($sp1058d9) > 1) { $sp259eef = $sp1058d9[1]; } $sp1f9691 = QRcode::text($spc8e60b, false, $sp259eef); $sp6b1313 = count($sp1f9691); $spaba152['num_rows'] = $sp6b1313; $spaba152['num_cols'] = $sp6b1313; $spaba152['bcode'] = array(); foreach ($sp1f9691 as $sp4a1a5b) { $spbc7dc1 = array(); foreach (str_split($sp4a1a5b) as $spe5f8e5) { $spbc7dc1[] = $spe5f8e5 == '1' ? 1 : 0; } $spaba152['bcode'][] = $spbc7dc1; } return $spaba152; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp52bf47 = new QRmask(); for ($sp1293dc = 1; $sp1293dc <= QRSPEC_VERSION_MAX; $sp1293dc++) { $sp3c0683 = QRspec::newFrame($sp1293dc); if (QR_IMAGE) { $sp83202a = QR_CACHE_DIR . 'frame_' . $sp1293dc . '.png'; QRimage::png(self::binarize($sp3c0683), $sp83202a, 1, 0); } $spa5f6c8 = count($sp3c0683); $spb51db8 = array_fill(0, $spa5f6c8, array_fill(0, $spa5f6c8, 0)); for ($sp65681f = 0; $sp65681f < 8; $sp65681f++) { $sp52bf47->makeMaskNo($sp65681f, $spa5f6c8, $sp3c0683, $spb51db8, true); } } QRtools::markTime('after_build_cache'); } public static function log($sp77616a, $spbbc15d) { if (QR_LOG_DIR !== false) { if ($spbbc15d != '') { if ($sp77616a !== false) { file_put_contents(QR_LOG_DIR . basename($sp77616a) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $spbbc15d, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $spbbc15d, FILE_APPEND); } } } } public static function dumpMask($sp3c0683) { $spa5f6c8 = count($sp3c0683); for ($sp75b385 = 0; $sp75b385 < $spa5f6c8; $sp75b385++) { for ($spc9afe1 = 0; $spc9afe1 < $spa5f6c8; $spc9afe1++) { echo ord($sp3c0683[$sp75b385][$spc9afe1]) . ','; } } } public static function markTime($sp435f54) { list($sp04f0a9, $sp8d9966) = explode(' ', microtime()); $spaa00eb = (double) $sp04f0a9 + (double) $sp8d9966; if (!isset($sp279d11['qr_time_bench'])) { $sp279d11['qr_time_bench'] = array(); } $sp279d11['qr_time_bench'][$sp435f54] = $spaa00eb; } public static function timeBenchmark() { self::markTime('finish'); $sp8f1044 = 0; $sp65dd66 = 0; $sp2c8368 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($sp279d11['qr_time_bench'] as $sp435f54 => $sp4907ee) { if ($sp2c8368 > 0) { echo '<tr><th style="text-align:right">till ' . $sp435f54 . ': </th><td>' . number_format($sp4907ee - $sp8f1044, 6) . 's</td></tr>'; } else { $sp65dd66 = $sp4907ee; } $sp2c8368++; $sp8f1044 = $sp4907ee; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp8f1044 - $sp65dd66, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($sp6735ba, $sp1a0725) { return self::$capacity[$sp6735ba][QRCAP_WORDS] - self::$capacity[$sp6735ba][QRCAP_EC][$sp1a0725]; } public static function getECCLength($sp6735ba, $sp1a0725) { return self::$capacity[$sp6735ba][QRCAP_EC][$sp1a0725]; } public static function getWidth($sp6735ba) { return self::$capacity[$sp6735ba][QRCAP_WIDTH]; } public static function getRemainder($sp6735ba) { return self::$capacity[$sp6735ba][QRCAP_REMINDER]; } public static function getMinimumVersion($sp6b1313, $sp1a0725) { for ($spcecaa9 = 1; $spcecaa9 <= QRSPEC_VERSION_MAX; $spcecaa9++) { $sp1bc521 = self::$capacity[$spcecaa9][QRCAP_WORDS] - self::$capacity[$spcecaa9][QRCAP_EC][$sp1a0725]; if ($sp1bc521 >= $sp6b1313) { return $spcecaa9; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp1058d9, $sp6735ba) { if ($sp1058d9 == QR_MODE_STRUCTURE) { return 0; } if ($sp6735ba <= 9) { $sp78bc21 = 0; } else { if ($sp6735ba <= 26) { $sp78bc21 = 1; } else { $sp78bc21 = 2; } } return self::$lengthTableBits[$sp1058d9][$sp78bc21]; } public static function maximumWords($sp1058d9, $sp6735ba) { if ($sp1058d9 == QR_MODE_STRUCTURE) { return 3; } if ($sp6735ba <= 9) { $sp78bc21 = 0; } else { if ($sp6735ba <= 26) { $sp78bc21 = 1; } else { $sp78bc21 = 2; } } $spd4ae66 = self::$lengthTableBits[$sp1058d9][$sp78bc21]; $sp1bc521 = (1 << $spd4ae66) - 1; if ($sp1058d9 == QR_MODE_KANJI) { $sp1bc521 *= 2; } return $sp1bc521; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($sp6735ba, $sp1a0725, array &$spb0a94c) { if (count($spb0a94c) < 5) { $spb0a94c = array(0, 0, 0, 0, 0); } $sp714d76 = self::$eccTable[$sp6735ba][$sp1a0725][0]; $sp41e326 = self::$eccTable[$sp6735ba][$sp1a0725][1]; $sp94131d = self::getDataLength($sp6735ba, $sp1a0725); $sp9af759 = self::getECCLength($sp6735ba, $sp1a0725); if ($sp41e326 == 0) { $spb0a94c[0] = $sp714d76; $spb0a94c[1] = (int) ($sp94131d / $sp714d76); $spb0a94c[2] = (int) ($sp9af759 / $sp714d76); $spb0a94c[3] = 0; $spb0a94c[4] = 0; } else { $spb0a94c[0] = $sp714d76; $spb0a94c[1] = (int) ($sp94131d / ($sp714d76 + $sp41e326)); $spb0a94c[2] = (int) ($sp9af759 / ($sp714d76 + $sp41e326)); $spb0a94c[3] = $sp41e326; $spb0a94c[4] = $spb0a94c[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp3c0683, $sp89c5e8, $sp797e18) { $sp9d28d3 = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp206c5a = $sp797e18 - 2; $spd0db74 = $sp89c5e8 - 2; for ($sp75b385 = 0; $sp75b385 < 5; $sp75b385++) { QRstr::set($sp3c0683, $spd0db74, $sp206c5a + $sp75b385, $sp9d28d3[$sp75b385]); } } public static function putAlignmentPattern($sp6735ba, &$sp3c0683, $spa5f6c8) { if ($sp6735ba < 2) { return; } $spaccea6 = self::$alignmentPattern[$sp6735ba][1] - self::$alignmentPattern[$sp6735ba][0]; if ($spaccea6 < 0) { $sp76ac0e = 2; } else { $sp76ac0e = (int) (($spa5f6c8 - self::$alignmentPattern[$sp6735ba][0]) / $spaccea6 + 2); } if ($sp76ac0e * $sp76ac0e - 3 == 1) { $spc9afe1 = self::$alignmentPattern[$sp6735ba][0]; $sp75b385 = self::$alignmentPattern[$sp6735ba][0]; self::putAlignmentMarker($sp3c0683, $spc9afe1, $sp75b385); return; } $sp43dbe4 = self::$alignmentPattern[$sp6735ba][0]; for ($spc9afe1 = 1; $spc9afe1 < $sp76ac0e - 1; $spc9afe1++) { self::putAlignmentMarker($sp3c0683, 6, $sp43dbe4); self::putAlignmentMarker($sp3c0683, $sp43dbe4, 6); $sp43dbe4 += $spaccea6; } $spa7c423 = self::$alignmentPattern[$sp6735ba][0]; for ($sp75b385 = 0; $sp75b385 < $sp76ac0e - 1; $sp75b385++) { $sp43dbe4 = self::$alignmentPattern[$sp6735ba][0]; for ($spc9afe1 = 0; $spc9afe1 < $sp76ac0e - 1; $spc9afe1++) { self::putAlignmentMarker($sp3c0683, $sp43dbe4, $spa7c423); $sp43dbe4 += $spaccea6; } $spa7c423 += $spaccea6; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($sp6735ba) { if ($sp6735ba < 7 || $sp6735ba > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$sp6735ba - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp52bf47, $sp1a0725) { if ($sp52bf47 < 0 || $sp52bf47 > 7) { return 0; } if ($sp1a0725 < 0 || $sp1a0725 > 3) { return 0; } return self::$formatInfo[$sp1a0725][$sp52bf47]; } public static $frames = array(); public static function putFinderPattern(&$sp3c0683, $sp89c5e8, $sp797e18) { $sp9d28d3 = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($sp75b385 = 0; $sp75b385 < 7; $sp75b385++) { QRstr::set($sp3c0683, $sp89c5e8, $sp797e18 + $sp75b385, $sp9d28d3[$sp75b385]); } } public static function createFrame($sp6735ba) { $spa5f6c8 = self::$capacity[$sp6735ba][QRCAP_WIDTH]; $spc10920 = str_repeat(' ', $spa5f6c8); $sp3c0683 = array_fill(0, $spa5f6c8, $spc10920); self::putFinderPattern($sp3c0683, 0, 0); self::putFinderPattern($sp3c0683, $spa5f6c8 - 7, 0); self::putFinderPattern($sp3c0683, 0, $spa5f6c8 - 7); $spf1650c = $spa5f6c8 - 7; for ($sp75b385 = 0; $sp75b385 < 7; $sp75b385++) { $sp3c0683[$sp75b385][7] = '¿'; $sp3c0683[$sp75b385][$spa5f6c8 - 8] = '¿'; $sp3c0683[$spf1650c][7] = '¿'; $spf1650c++; } $spd33e71 = str_repeat('¿', 8); QRstr::set($sp3c0683, 0, 7, $spd33e71); QRstr::set($sp3c0683, $spa5f6c8 - 8, 7, $spd33e71); QRstr::set($sp3c0683, 0, $spa5f6c8 - 8, $spd33e71); $spd33e71 = str_repeat('Ñ', 9); QRstr::set($sp3c0683, 0, 8, $spd33e71); QRstr::set($sp3c0683, $spa5f6c8 - 8, 8, $spd33e71, 8); $spf1650c = $spa5f6c8 - 8; for ($sp75b385 = 0; $sp75b385 < 8; $sp75b385++, $spf1650c++) { $sp3c0683[$sp75b385][8] = 'Ñ'; $sp3c0683[$spf1650c][8] = 'Ñ'; } for ($spcecaa9 = 1; $spcecaa9 < $spa5f6c8 - 15; $spcecaa9++) { $sp3c0683[6][7 + $spcecaa9] = chr(144 | $spcecaa9 & 1); $sp3c0683[7 + $spcecaa9][6] = chr(144 | $spcecaa9 & 1); } self::putAlignmentPattern($sp6735ba, $sp3c0683, $spa5f6c8); if ($sp6735ba >= 7) { $sp0a0ae4 = self::getVersionPattern($sp6735ba); $spb83a69 = $sp0a0ae4; for ($spc9afe1 = 0; $spc9afe1 < 6; $spc9afe1++) { for ($sp75b385 = 0; $sp75b385 < 3; $sp75b385++) { $sp3c0683[$spa5f6c8 - 11 + $sp75b385][$spc9afe1] = chr(136 | $spb83a69 & 1); $spb83a69 = $spb83a69 >> 1; } } $spb83a69 = $sp0a0ae4; for ($sp75b385 = 0; $sp75b385 < 6; $sp75b385++) { for ($spc9afe1 = 0; $spc9afe1 < 3; $spc9afe1++) { $sp3c0683[$sp75b385][$spc9afe1 + ($spa5f6c8 - 11)] = chr(136 | $spb83a69 & 1); $spb83a69 = $spb83a69 >> 1; } } } $sp3c0683[$spa5f6c8 - 8][8] = 'Å'; return $sp3c0683; } public static function debug($sp3c0683, $sp8f09d4 = false) { if ($sp8f09d4) { foreach ($sp3c0683 as &$spc10920) { $spc10920 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $spc10920)); $spc10920 = join('&#9608;&#9608;', explode('1', $spc10920)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp3c0683); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp3c0683 as &$spc10920) { $spc10920 = join('<span class="m">&nbsp;</span>', explode('¿', $spc10920)); $spc10920 = join('<span class="m">&#9618;</span>', explode('¡', $spc10920)); $spc10920 = join('<span class="p">&nbsp;</span>', explode('†', $spc10920)); $spc10920 = join('<span class="p">&#9618;</span>', explode('°', $spc10920)); $spc10920 = join('<span class="s">&#9671;</span>', explode('Ñ', $spc10920)); $spc10920 = join('<span class="s">&#9670;</span>', explode('Ö', $spc10920)); $spc10920 = join('<span class="x">&#9762;</span>', explode('Å', $spc10920)); $spc10920 = join('<span class="c">&nbsp;</span>', explode('ê', $spc10920)); $spc10920 = join('<span class="c">&#9719;</span>', explode('ë', $spc10920)); $spc10920 = join('<span class="f">&nbsp;</span>', explode('à', $spc10920)); $spc10920 = join('<span class="f">&#9618;</span>', explode('â', $spc10920)); $spc10920 = join('&#9830;', explode('', $spc10920)); $spc10920 = join('&#8901;', explode(' ', $spc10920)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp3c0683); echo '</tt></pre>'; } } public static function serial($sp3c0683) { return gzcompress(join('
', $sp3c0683), 9); } public static function unserial($spc8e60b) { return explode('
', gzuncompress($spc8e60b)); } public static function newFrame($sp6735ba) { if ($sp6735ba < 1 || $sp6735ba > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$sp6735ba])) { $sp83202a = QR_CACHE_DIR . 'frame_' . $sp6735ba . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp83202a)) { self::$frames[$sp6735ba] = self::unserial(file_get_contents($sp83202a)); } else { self::$frames[$sp6735ba] = self::createFrame($sp6735ba); file_put_contents($sp83202a, self::serial(self::$frames[$sp6735ba])); } } else { self::$frames[$sp6735ba] = self::createFrame($sp6735ba); } } if (is_null(self::$frames[$sp6735ba])) { return null; } return self::$frames[$sp6735ba]; } public static function rsBlockNum($spb0a94c) { return $spb0a94c[0] + $spb0a94c[3]; } public static function rsBlockNum1($spb0a94c) { return $spb0a94c[0]; } public static function rsDataCodes1($spb0a94c) { return $spb0a94c[1]; } public static function rsEccCodes1($spb0a94c) { return $spb0a94c[2]; } public static function rsBlockNum2($spb0a94c) { return $spb0a94c[3]; } public static function rsDataCodes2($spb0a94c) { return $spb0a94c[4]; } public static function rsEccCodes2($spb0a94c) { return $spb0a94c[2]; } public static function rsDataLength($spb0a94c) { return $spb0a94c[0] * $spb0a94c[1] + $spb0a94c[3] * $spb0a94c[4]; } public static function rsEccLength($spb0a94c) { return ($spb0a94c[0] + $spb0a94c[3]) * $spb0a94c[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp3c0683, $specd56e = false, $spa3214c = 4, $sp650cc2 = 4, $sp3c9645 = FALSE) { $sp958d50 = self::image($sp3c0683, $spa3214c, $sp650cc2); if ($specd56e === false) { Header('Content-type: image/png'); ImagePng($sp958d50); } else { if ($sp3c9645 === TRUE) { ImagePng($sp958d50, $specd56e); header('Content-type: image/png'); ImagePng($sp958d50); } else { ImagePng($sp958d50, $specd56e); } } ImageDestroy($sp958d50); } public static function jpg($sp3c0683, $specd56e = false, $spa3214c = 8, $sp650cc2 = 4, $sp83899a = 85) { $sp958d50 = self::image($sp3c0683, $spa3214c, $sp650cc2); if ($specd56e === false) { Header('Content-type: image/jpeg'); ImageJpeg($sp958d50, null, $sp83899a); } else { ImageJpeg($sp958d50, $specd56e, $sp83899a); } ImageDestroy($sp958d50); } private static function image($sp3c0683, $spa3214c = 4, $sp650cc2 = 4) { $sp0514ca = count($sp3c0683); $sp76ac0e = strlen($sp3c0683[0]); $spa3b760 = $sp76ac0e + 2 * $sp650cc2; $spfe3588 = $sp0514ca + 2 * $sp650cc2; $sp88ee3f = ImageCreate($spa3b760, $spfe3588); $spbe5ab0[0] = ImageColorAllocate($sp88ee3f, 255, 255, 255); $spbe5ab0[1] = ImageColorAllocate($sp88ee3f, 0, 0, 0); imagefill($sp88ee3f, 0, 0, $spbe5ab0[0]); for ($sp75b385 = 0; $sp75b385 < $sp0514ca; $sp75b385++) { for ($spc9afe1 = 0; $spc9afe1 < $sp76ac0e; $spc9afe1++) { if ($sp3c0683[$sp75b385][$spc9afe1] == '1') { ImageSetPixel($sp88ee3f, $spc9afe1 + $sp650cc2, $sp75b385 + $sp650cc2, $spbe5ab0[1]); } } } $sp2ecfd1 = ImageCreate($spa3b760 * $spa3214c, $spfe3588 * $spa3214c); ImageCopyResized($sp2ecfd1, $sp88ee3f, 0, 0, 0, 0, $spa3b760 * $spa3214c, $spfe3588 * $spa3214c, $spa3b760, $spfe3588); ImageDestroy($sp88ee3f); return $sp2ecfd1; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp1058d9, $sp6b1313, $sp94131d, $spa3f922 = null) { $sp538df7 = array_slice($sp94131d, 0, $sp6b1313); if (count($sp538df7) < $sp6b1313) { $sp538df7 = array_merge($sp538df7, array_fill(0, $sp6b1313 - count($sp538df7), 0)); } if (!QRinput::check($sp1058d9, $sp6b1313, $sp538df7)) { throw new Exception('Error m:' . $sp1058d9 . ',s:' . $sp6b1313 . ',d:' . join(',', $sp538df7)); return null; } $this->mode = $sp1058d9; $this->size = $sp6b1313; $this->data = $sp538df7; $this->bstream = $spa3f922; } public function encodeModeNum($sp6735ba) { try { $sp1bc521 = (int) ($this->size / 3); $sp5e4fee = new QRbitstream(); $sp679ba2 = 1; $sp5e4fee->appendNum(4, $sp679ba2); $sp5e4fee->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $sp6735ba), $this->size); for ($spcecaa9 = 0; $spcecaa9 < $sp1bc521; $spcecaa9++) { $sp679ba2 = (ord($this->data[$spcecaa9 * 3]) - ord('0')) * 100; $sp679ba2 += (ord($this->data[$spcecaa9 * 3 + 1]) - ord('0')) * 10; $sp679ba2 += ord($this->data[$spcecaa9 * 3 + 2]) - ord('0'); $sp5e4fee->appendNum(10, $sp679ba2); } if ($this->size - $sp1bc521 * 3 == 1) { $sp679ba2 = ord($this->data[$sp1bc521 * 3]) - ord('0'); $sp5e4fee->appendNum(4, $sp679ba2); } else { if ($this->size - $sp1bc521 * 3 == 2) { $sp679ba2 = (ord($this->data[$sp1bc521 * 3]) - ord('0')) * 10; $sp679ba2 += ord($this->data[$sp1bc521 * 3 + 1]) - ord('0'); $sp5e4fee->appendNum(7, $sp679ba2); } } $this->bstream = $sp5e4fee; return 0; } catch (Exception $spfda1c7) { return -1; } } public function encodeModeAn($sp6735ba) { try { $sp1bc521 = (int) ($this->size / 2); $sp5e4fee = new QRbitstream(); $sp5e4fee->appendNum(4, 2); $sp5e4fee->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $sp6735ba), $this->size); for ($spcecaa9 = 0; $spcecaa9 < $sp1bc521; $spcecaa9++) { $sp679ba2 = (int) QRinput::lookAnTable(ord($this->data[$spcecaa9 * 2])) * 45; $sp679ba2 += (int) QRinput::lookAnTable(ord($this->data[$spcecaa9 * 2 + 1])); $sp5e4fee->appendNum(11, $sp679ba2); } if ($this->size & 1) { $sp679ba2 = QRinput::lookAnTable(ord($this->data[$sp1bc521 * 2])); $sp5e4fee->appendNum(6, $sp679ba2); } $this->bstream = $sp5e4fee; return 0; } catch (Exception $spfda1c7) { return -1; } } public function encodeMode8($sp6735ba) { try { $sp5e4fee = new QRbitstream(); $sp5e4fee->appendNum(4, 4); $sp5e4fee->appendNum(QRspec::lengthIndicator(QR_MODE_8, $sp6735ba), $this->size); for ($spcecaa9 = 0; $spcecaa9 < $this->size; $spcecaa9++) { $sp5e4fee->appendNum(8, ord($this->data[$spcecaa9])); } $this->bstream = $sp5e4fee; return 0; } catch (Exception $spfda1c7) { return -1; } } public function encodeModeKanji($sp6735ba) { try { $sp5e4fee = new QRbitrtream(); $sp5e4fee->appendNum(4, 8); $sp5e4fee->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $sp6735ba), (int) ($this->size / 2)); for ($spcecaa9 = 0; $spcecaa9 < $this->size; $spcecaa9 += 2) { $sp679ba2 = ord($this->data[$spcecaa9]) << 8 | ord($this->data[$spcecaa9 + 1]); if ($sp679ba2 <= 40956) { $sp679ba2 -= 33088; } else { $sp679ba2 -= 49472; } $sp0514ca = ($sp679ba2 >> 8) * 192; $sp679ba2 = ($sp679ba2 & 255) + $sp0514ca; $sp5e4fee->appendNum(13, $sp679ba2); } $this->bstream = $sp5e4fee; return 0; } catch (Exception $spfda1c7) { return -1; } } public function encodeModeStructure() { try { $sp5e4fee = new QRbitstream(); $sp5e4fee->appendNum(4, 3); $sp5e4fee->appendNum(4, ord($this->data[1]) - 1); $sp5e4fee->appendNum(4, ord($this->data[0]) - 1); $sp5e4fee->appendNum(8, ord($this->data[2])); $this->bstream = $sp5e4fee; return 0; } catch (Exception $spfda1c7) { return -1; } } public function estimateBitStreamSizeOfEntry($sp6735ba) { $spd4ae66 = 0; if ($sp6735ba == 0) { $sp6735ba = 1; } switch ($this->mode) { case QR_MODE_NUM: $spd4ae66 = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $spd4ae66 = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $spd4ae66 = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $spd4ae66 = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $sp78bc21 = QRspec::lengthIndicator($this->mode, $sp6735ba); $sp790bcd = 1 << $sp78bc21; $sp5a6595 = (int) (($this->size + $sp790bcd - 1) / $sp790bcd); $spd4ae66 += $sp5a6595 * (4 + $sp78bc21); return $spd4ae66; } public function encodeBitStream($sp6735ba) { try { unset($this->bstream); $sp1bc521 = QRspec::maximumWords($this->mode, $sp6735ba); if ($this->size > $sp1bc521) { $spe610de = new QRinputItem($this->mode, $sp1bc521, $this->data); $spbc21a7 = new QRinputItem($this->mode, $this->size - $sp1bc521, array_slice($this->data, $sp1bc521)); $spe610de->encodeBitStream($sp6735ba); $spbc21a7->encodeBitStream($sp6735ba); $this->bstream = new QRbitstream(); $this->bstream->append($spe610de->bstream); $this->bstream->append($spbc21a7->bstream); unset($spe610de); unset($spbc21a7); } else { $sp46dd86 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp46dd86 = $this->encodeModeNum($sp6735ba); break; case QR_MODE_AN: $sp46dd86 = $this->encodeModeAn($sp6735ba); break; case QR_MODE_8: $sp46dd86 = $this->encodeMode8($sp6735ba); break; case QR_MODE_KANJI: $sp46dd86 = $this->encodeModeKanji($sp6735ba); break; case QR_MODE_STRUCTURE: $sp46dd86 = $this->encodeModeStructure(); break; default: break; } if ($sp46dd86 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $spfda1c7) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($sp6735ba = 0, $sp1a0725 = QR_ECLEVEL_L) { if ($sp6735ba < 0 || $sp6735ba > QRSPEC_VERSION_MAX || $sp1a0725 > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $sp6735ba; $this->level = $sp1a0725; } public function getVersion() { return $this->version; } public function setVersion($sp6735ba) { if ($sp6735ba < 0 || $sp6735ba > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $sp6735ba; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($sp1a0725) { if ($sp1a0725 > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $sp1a0725; return 0; } public function appendEntry(QRinputItem $sp9080c6) { $this->items[] = $sp9080c6; } public function append($sp1058d9, $sp6b1313, $sp94131d) { try { $sp9080c6 = new QRinputItem($sp1058d9, $sp6b1313, $sp94131d); $this->items[] = $sp9080c6; return 0; } catch (Exception $spfda1c7) { return -1; } } public function insertStructuredAppendHeader($sp6b1313, $sp307ccc, $sp29b96c) { if ($sp6b1313 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($sp307ccc <= 0 || $sp307ccc > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $spe17c36 = array($sp6b1313, $sp307ccc, $sp29b96c); try { $sp9080c6 = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $sp9080c6); return 0; } catch (Exception $spfda1c7) { return -1; } } public function calcParity() { $sp29b96c = 0; foreach ($this->items as $sp8f5e71) { if ($sp8f5e71->mode != QR_MODE_STRUCTURE) { for ($spcecaa9 = $sp8f5e71->size - 1; $spcecaa9 >= 0; $spcecaa9--) { $sp29b96c ^= $sp8f5e71->data[$spcecaa9]; } } } return $sp29b96c; } public static function checkModeNum($sp6b1313, $sp94131d) { for ($spcecaa9 = 0; $spcecaa9 < $sp6b1313; $spcecaa9++) { if (ord($sp94131d[$spcecaa9]) < ord('0') || ord($sp94131d[$spcecaa9]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($sp6b1313) { $sp76ac0e = (int) $sp6b1313 / 3; $spd4ae66 = $sp76ac0e * 10; switch ($sp6b1313 - $sp76ac0e * 3) { case 1: $spd4ae66 += 4; break; case 2: $spd4ae66 += 7; break; default: break; } return $spd4ae66; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($sp1c59c9) { return $sp1c59c9 > 127 ? -1 : self::$anTable[$sp1c59c9]; } public static function checkModeAn($sp6b1313, $sp94131d) { for ($spcecaa9 = 0; $spcecaa9 < $sp6b1313; $spcecaa9++) { if (self::lookAnTable(ord($sp94131d[$spcecaa9])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($sp6b1313) { $sp76ac0e = (int) ($sp6b1313 / 2); $spd4ae66 = $sp76ac0e * 11; if ($sp6b1313 & 1) { $spd4ae66 += 6; } return $spd4ae66; } public static function estimateBitsMode8($sp6b1313) { return $sp6b1313 * 8; } public function estimateBitsModeKanji($sp6b1313) { return (int) ($sp6b1313 / 2 * 13); } public static function checkModeKanji($sp6b1313, $sp94131d) { if ($sp6b1313 & 1) { return false; } for ($spcecaa9 = 0; $spcecaa9 < $sp6b1313; $spcecaa9 += 2) { $sp679ba2 = ord($sp94131d[$spcecaa9]) << 8 | ord($sp94131d[$spcecaa9 + 1]); if ($sp679ba2 < 33088 || $sp679ba2 > 40956 && $sp679ba2 < 57408 || $sp679ba2 > 60351) { return false; } } return true; } public static function check($sp1058d9, $sp6b1313, $sp94131d) { if ($sp6b1313 <= 0) { return false; } switch ($sp1058d9) { case QR_MODE_NUM: return self::checkModeNum($sp6b1313, $sp94131d); break; case QR_MODE_AN: return self::checkModeAn($sp6b1313, $sp94131d); break; case QR_MODE_KANJI: return self::checkModeKanji($sp6b1313, $sp94131d); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($sp6735ba) { $spd4ae66 = 0; foreach ($this->items as $sp8f5e71) { $spd4ae66 += $sp8f5e71->estimateBitStreamSizeOfEntry($sp6735ba); } return $spd4ae66; } public function estimateVersion() { $sp6735ba = 0; $sp077d8d = 0; do { $sp077d8d = $sp6735ba; $spd4ae66 = $this->estimateBitStreamSize($sp077d8d); $sp6735ba = QRspec::getMinimumVersion((int) (($spd4ae66 + 7) / 8), $this->level); if ($sp6735ba < 0) { return -1; } } while ($sp6735ba > $sp077d8d); return $sp6735ba; } public static function lengthOfCode($sp1058d9, $sp6735ba, $spd4ae66) { $spfaddf7 = $spd4ae66 - 4 - QRspec::lengthIndicator($sp1058d9, $sp6735ba); switch ($sp1058d9) { case QR_MODE_NUM: $sp4cc008 = (int) ($spfaddf7 / 10); $sp48a507 = $spfaddf7 - $sp4cc008 * 10; $sp6b1313 = $sp4cc008 * 3; if ($sp48a507 >= 7) { $sp6b1313 += 2; } else { if ($sp48a507 >= 4) { $sp6b1313 += 1; } } break; case QR_MODE_AN: $sp4cc008 = (int) ($spfaddf7 / 11); $sp48a507 = $spfaddf7 - $sp4cc008 * 11; $sp6b1313 = $sp4cc008 * 2; if ($sp48a507 >= 6) { $sp6b1313++; } break; case QR_MODE_8: $sp6b1313 = (int) ($spfaddf7 / 8); break; case QR_MODE_KANJI: $sp6b1313 = (int) ($spfaddf7 / 13 * 2); break; case QR_MODE_STRUCTURE: $sp6b1313 = (int) ($spfaddf7 / 8); break; default: $sp6b1313 = 0; break; } $spd2091e = QRspec::maximumWords($sp1058d9, $sp6735ba); if ($sp6b1313 < 0) { $sp6b1313 = 0; } if ($sp6b1313 > $spd2091e) { $sp6b1313 = $spd2091e; } return $sp6b1313; } public function createBitStream() { $sp5d9c12 = 0; foreach ($this->items as $sp8f5e71) { $spd4ae66 = $sp8f5e71->encodeBitStream($this->version); if ($spd4ae66 < 0) { return -1; } $sp5d9c12 += $spd4ae66; } return $sp5d9c12; } public function convertData() { $spf5502a = $this->estimateVersion(); if ($spf5502a > $this->getVersion()) { $this->setVersion($spf5502a); } for (;;) { $spd4ae66 = $this->createBitStream(); if ($spd4ae66 < 0) { return -1; } $spf5502a = QRspec::getMinimumVersion((int) (($spd4ae66 + 7) / 8), $this->level); if ($spf5502a < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spf5502a > $this->getVersion()) { $this->setVersion($spf5502a); } else { break; } } } return 0; } public function appendPaddingBit(&$spa3f922) { $spd4ae66 = $spa3f922->size(); $spb19a69 = QRspec::getDataLength($this->version, $this->level); $sp38363d = $spb19a69 * 8; if ($sp38363d == $spd4ae66) { return 0; } if ($sp38363d - $spd4ae66 < 5) { return $spa3f922->appendNum($sp38363d - $spd4ae66, 0); } $spd4ae66 += 4; $sp1bc521 = (int) (($spd4ae66 + 7) / 8); $sp059c48 = new QRbitstream(); $sp46dd86 = $sp059c48->appendNum($sp1bc521 * 8 - $spd4ae66 + 4, 0); if ($sp46dd86 < 0) { return $sp46dd86; } $spd0765f = $spb19a69 - $sp1bc521; if ($spd0765f > 0) { $spc8d402 = array(); for ($spcecaa9 = 0; $spcecaa9 < $spd0765f; $spcecaa9++) { $spc8d402[$spcecaa9] = $spcecaa9 & 1 ? 17 : 236; } $sp46dd86 = $sp059c48->appendBytes($spd0765f, $spc8d402); if ($sp46dd86 < 0) { return $sp46dd86; } } $sp46dd86 = $spa3f922->append($sp059c48); return $sp46dd86; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $spa3f922 = new QRbitstream(); foreach ($this->items as $sp8f5e71) { $sp46dd86 = $spa3f922->append($sp8f5e71->bstream); if ($sp46dd86 < 0) { return null; } } return $spa3f922; } public function getBitStream() { $spa3f922 = $this->mergeBitStream(); if ($spa3f922 == null) { return null; } $sp46dd86 = $this->appendPaddingBit($spa3f922); if ($sp46dd86 < 0) { return null; } return $spa3f922; } public function getByteStream() { $spa3f922 = $this->getBitStream(); if ($spa3f922 == null) { return null; } return $spa3f922->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($sp1ee680) { $this->data = array_fill(0, $sp1ee680, 0); return 0; } public static function newFromNum($spd4ae66, $sp5a6595) { $spa3f922 = new QRbitstream(); $spa3f922->allocate($spd4ae66); $sp52bf47 = 1 << $spd4ae66 - 1; for ($spcecaa9 = 0; $spcecaa9 < $spd4ae66; $spcecaa9++) { if ($sp5a6595 & $sp52bf47) { $spa3f922->data[$spcecaa9] = 1; } else { $spa3f922->data[$spcecaa9] = 0; } $sp52bf47 = $sp52bf47 >> 1; } return $spa3f922; } public static function newFromBytes($sp6b1313, $sp94131d) { $spa3f922 = new QRbitstream(); $spa3f922->allocate($sp6b1313 * 8); $sp2c8368 = 0; for ($spcecaa9 = 0; $spcecaa9 < $sp6b1313; $spcecaa9++) { $sp52bf47 = 128; for ($sp0d7cb6 = 0; $sp0d7cb6 < 8; $sp0d7cb6++) { if ($sp94131d[$spcecaa9] & $sp52bf47) { $spa3f922->data[$sp2c8368] = 1; } else { $spa3f922->data[$sp2c8368] = 0; } $sp2c8368++; $sp52bf47 = $sp52bf47 >> 1; } } return $spa3f922; } public function append(QRbitstream $sp7b40bd) { if (is_null($sp7b40bd)) { return -1; } if ($sp7b40bd->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $sp7b40bd->data; return 0; } $this->data = array_values(array_merge($this->data, $sp7b40bd->data)); return 0; } public function appendNum($spd4ae66, $sp5a6595) { if ($spd4ae66 == 0) { return 0; } $sp191fe2 = QRbitstream::newFromNum($spd4ae66, $sp5a6595); if (is_null($sp191fe2)) { return -1; } $sp46dd86 = $this->append($sp191fe2); unset($sp191fe2); return $sp46dd86; } public function appendBytes($sp6b1313, $sp94131d) { if ($sp6b1313 == 0) { return 0; } $sp191fe2 = QRbitstream::newFromBytes($sp6b1313, $sp94131d); if (is_null($sp191fe2)) { return -1; } $sp46dd86 = $this->append($sp191fe2); unset($sp191fe2); return $sp46dd86; } public function toByte() { $sp6b1313 = $this->size(); if ($sp6b1313 == 0) { return array(); } $sp94131d = array_fill(0, (int) (($sp6b1313 + 7) / 8), 0); $spccf9a4 = (int) ($sp6b1313 / 8); $sp2c8368 = 0; for ($spcecaa9 = 0; $spcecaa9 < $spccf9a4; $spcecaa9++) { $spb83a69 = 0; for ($sp0d7cb6 = 0; $sp0d7cb6 < 8; $sp0d7cb6++) { $spb83a69 = $spb83a69 << 1; $spb83a69 |= $this->data[$sp2c8368]; $sp2c8368++; } $sp94131d[$spcecaa9] = $spb83a69; } if ($sp6b1313 & 7) { $spb83a69 = 0; for ($sp0d7cb6 = 0; $sp0d7cb6 < ($sp6b1313 & 7); $sp0d7cb6++) { $spb83a69 = $spb83a69 << 1; $spb83a69 |= $this->data[$sp2c8368]; $sp2c8368++; } $sp94131d[$spccf9a4] = $spb83a69; } return $sp94131d; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($spb1098b, $sp106469, $sp85ff7c) { $this->dataStr = $spb1098b; $this->input = $sp106469; $this->modeHint = $sp85ff7c; } public static function isdigitat($spf6683b, $spffbde5) { if ($spffbde5 >= strlen($spf6683b)) { return false; } return ord($spf6683b[$spffbde5]) >= ord('0') && ord($spf6683b[$spffbde5]) <= ord('9'); } public static function isalnumat($spf6683b, $spffbde5) { if ($spffbde5 >= strlen($spf6683b)) { return false; } return QRinput::lookAnTable(ord($spf6683b[$spffbde5])) >= 0; } public function identifyMode($spffbde5) { if ($spffbde5 >= strlen($this->dataStr)) { return QR_MODE_NUL; } $sp1c59c9 = $this->dataStr[$spffbde5]; if (self::isdigitat($this->dataStr, $spffbde5)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $spffbde5)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($spffbde5 + 1 < strlen($this->dataStr)) { $spaccea6 = $this->dataStr[$spffbde5 + 1]; $sp73f9fe = ord($sp1c59c9) << 8 | ord($spaccea6); if ($sp73f9fe >= 33088 && $sp73f9fe <= 40956 || $sp73f9fe >= 57408 && $sp73f9fe <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp1337ba = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp2c8368 = 0; while (self::isdigitat($this->dataStr, $sp2c8368)) { $sp2c8368++; } $spc46519 = $sp2c8368; $sp1058d9 = $this->identifyMode($sp2c8368); if ($sp1058d9 == QR_MODE_8) { $spea936e = QRinput::estimateBitsModeNum($spc46519) + 4 + $sp1337ba + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($spc46519 + 1); if ($spea936e > 0) { return $this->eat8(); } } if ($sp1058d9 == QR_MODE_AN) { $spea936e = QRinput::estimateBitsModeNum($spc46519) + 4 + $sp1337ba + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($spc46519 + 1); if ($spea936e > 0) { return $this->eatAn(); } } $sp46dd86 = $this->input->append(QR_MODE_NUM, $spc46519, str_split($this->dataStr)); if ($sp46dd86 < 0) { return -1; } return $spc46519; } public function eatAn() { $sp9f3c5a = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp1337ba = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp2c8368 = 0; while (self::isalnumat($this->dataStr, $sp2c8368)) { if (self::isdigitat($this->dataStr, $sp2c8368)) { $sp83899a = $sp2c8368; while (self::isdigitat($this->dataStr, $sp83899a)) { $sp83899a++; } $spea936e = QRinput::estimateBitsModeAn($sp2c8368) + QRinput::estimateBitsModeNum($sp83899a - $sp2c8368) + 4 + $sp1337ba - QRinput::estimateBitsModeAn($sp83899a); if ($spea936e < 0) { break; } else { $sp2c8368 = $sp83899a; } } else { $sp2c8368++; } } $spc46519 = $sp2c8368; if (!self::isalnumat($this->dataStr, $sp2c8368)) { $spea936e = QRinput::estimateBitsModeAn($spc46519) + 4 + $sp9f3c5a + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($spc46519 + 1); if ($spea936e > 0) { return $this->eat8(); } } $sp46dd86 = $this->input->append(QR_MODE_AN, $spc46519, str_split($this->dataStr)); if ($sp46dd86 < 0) { return -1; } return $spc46519; } public function eatKanji() { $sp2c8368 = 0; while ($this->identifyMode($sp2c8368) == QR_MODE_KANJI) { $sp2c8368 += 2; } $sp46dd86 = $this->input->append(QR_MODE_KANJI, $sp2c8368, str_split($this->dataStr)); if ($sp46dd86 < 0) { return -1; } return $spc46519; } public function eat8() { $sp9f3c5a = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp1337ba = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp2c8368 = 1; $sp67dcf1 = strlen($this->dataStr); while ($sp2c8368 < $sp67dcf1) { $sp1058d9 = $this->identifyMode($sp2c8368); if ($sp1058d9 == QR_MODE_KANJI) { break; } if ($sp1058d9 == QR_MODE_NUM) { $sp83899a = $sp2c8368; while (self::isdigitat($this->dataStr, $sp83899a)) { $sp83899a++; } $spea936e = QRinput::estimateBitsMode8($sp2c8368) + QRinput::estimateBitsModeNum($sp83899a - $sp2c8368) + 4 + $sp1337ba - QRinput::estimateBitsMode8($sp83899a); if ($spea936e < 0) { break; } else { $sp2c8368 = $sp83899a; } } else { if ($sp1058d9 == QR_MODE_AN) { $sp83899a = $sp2c8368; while (self::isalnumat($this->dataStr, $sp83899a)) { $sp83899a++; } $spea936e = QRinput::estimateBitsMode8($sp2c8368) + QRinput::estimateBitsModeAn($sp83899a - $sp2c8368) + 4 + $sp9f3c5a - QRinput::estimateBitsMode8($sp83899a); if ($spea936e < 0) { break; } else { $sp2c8368 = $sp83899a; } } else { $sp2c8368++; } } } $spc46519 = $sp2c8368; $sp46dd86 = $this->input->append(QR_MODE_8, $spc46519, str_split($this->dataStr)); if ($sp46dd86 < 0) { return -1; } return $spc46519; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp1058d9 = $this->identifyMode(0); switch ($sp1058d9) { case QR_MODE_NUM: $sp6f7e8a = $this->eatNum(); break; case QR_MODE_AN: $sp6f7e8a = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp1162fe == QR_MODE_KANJI) { $sp6f7e8a = $this->eatKanji(); } else { $sp6f7e8a = $this->eat8(); } break; default: $sp6f7e8a = $this->eat8(); break; } if ($sp6f7e8a == 0) { return 0; } if ($sp6f7e8a < 0) { return -1; } $this->dataStr = substr($this->dataStr, $sp6f7e8a); } } public function toUpper() { $spffe30d = strlen($this->dataStr); $sp2c8368 = 0; while ($sp2c8368 < $spffe30d) { $sp1058d9 = self::identifyMode(substr($this->dataStr, $sp2c8368), $this->modeHint); if ($sp1058d9 == QR_MODE_KANJI) { $sp2c8368 += 2; } else { if (ord($this->dataStr[$sp2c8368]) >= ord('a') && ord($this->dataStr[$sp2c8368]) <= ord('z')) { $this->dataStr[$sp2c8368] = chr(ord($this->dataStr[$sp2c8368]) - 32); } $sp2c8368++; } } return $this->dataStr; } public static function splitStringToQRinput($sp5ebef2, QRinput $sp106469, $sp85ff7c, $sp9a89ae = true) { if (is_null($sp5ebef2) || $sp5ebef2 == '\\0' || $sp5ebef2 == '') { throw new Exception('empty string!!!'); } $sp10f906 = new QRsplit($sp5ebef2, $sp106469, $sp85ff7c); if (!$sp9a89ae) { $sp10f906->toUpper(); } return $sp10f906->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($spc9afe1) { while ($spc9afe1 >= $this->nn) { $spc9afe1 -= $this->nn; $spc9afe1 = ($spc9afe1 >> $this->mm) + ($spc9afe1 & $this->nn); } return $spc9afe1; } public static function init_rs_char($sp853621, $spa973fa, $spa5a2de, $sp921c72, $spa8014b, $sp90fc1b) { $sp6e23c7 = null; if ($sp853621 < 0 || $sp853621 > 8) { return $sp6e23c7; } if ($spa5a2de < 0 || $spa5a2de >= 1 << $sp853621) { return $sp6e23c7; } if ($sp921c72 <= 0 || $sp921c72 >= 1 << $sp853621) { return $sp6e23c7; } if ($spa8014b < 0 || $spa8014b >= 1 << $sp853621) { return $sp6e23c7; } if ($sp90fc1b < 0 || $sp90fc1b >= (1 << $sp853621) - 1 - $spa8014b) { return $sp6e23c7; } $sp6e23c7 = new QRrsItem(); $sp6e23c7->mm = $sp853621; $sp6e23c7->nn = (1 << $sp853621) - 1; $sp6e23c7->pad = $sp90fc1b; $sp6e23c7->alpha_to = array_fill(0, $sp6e23c7->nn + 1, 0); $sp6e23c7->index_of = array_fill(0, $sp6e23c7->nn + 1, 0); $sp3c0481 =& $sp6e23c7->nn; $sp8653ac =& $sp3c0481; $sp6e23c7->index_of[0] = $sp8653ac; $sp6e23c7->alpha_to[$sp8653ac] = 0; $sp0de517 = 1; for ($spcecaa9 = 0; $spcecaa9 < $sp6e23c7->nn; $spcecaa9++) { $sp6e23c7->index_of[$sp0de517] = $spcecaa9; $sp6e23c7->alpha_to[$spcecaa9] = $sp0de517; $sp0de517 <<= 1; if ($sp0de517 & 1 << $sp853621) { $sp0de517 ^= $spa973fa; } $sp0de517 &= $sp6e23c7->nn; } if ($sp0de517 != 1) { $sp6e23c7 = NULL; return $sp6e23c7; } $sp6e23c7->genpoly = array_fill(0, $spa8014b + 1, 0); $sp6e23c7->fcr = $spa5a2de; $sp6e23c7->prim = $sp921c72; $sp6e23c7->nroots = $spa8014b; $sp6e23c7->gfpoly = $spa973fa; for ($sp3a2efc = 1; $sp3a2efc % $sp921c72 != 0; $sp3a2efc += $sp6e23c7->nn) { } $sp6e23c7->iprim = (int) ($sp3a2efc / $sp921c72); $sp6e23c7->genpoly[0] = 1; for ($spcecaa9 = 0, $spb3c326 = $spa5a2de * $sp921c72; $spcecaa9 < $spa8014b; $spcecaa9++, $spb3c326 += $sp921c72) { $sp6e23c7->genpoly[$spcecaa9 + 1] = 1; for ($sp0d7cb6 = $spcecaa9; $sp0d7cb6 > 0; $sp0d7cb6--) { if ($sp6e23c7->genpoly[$sp0d7cb6] != 0) { $sp6e23c7->genpoly[$sp0d7cb6] = $sp6e23c7->genpoly[$sp0d7cb6 - 1] ^ $sp6e23c7->alpha_to[$sp6e23c7->modnn($sp6e23c7->index_of[$sp6e23c7->genpoly[$sp0d7cb6]] + $spb3c326)]; } else { $sp6e23c7->genpoly[$sp0d7cb6] = $sp6e23c7->genpoly[$sp0d7cb6 - 1]; } } $sp6e23c7->genpoly[0] = $sp6e23c7->alpha_to[$sp6e23c7->modnn($sp6e23c7->index_of[$sp6e23c7->genpoly[0]] + $spb3c326)]; } for ($spcecaa9 = 0; $spcecaa9 <= $spa8014b; $spcecaa9++) { $sp6e23c7->genpoly[$spcecaa9] = $sp6e23c7->index_of[$sp6e23c7->genpoly[$spcecaa9]]; } return $sp6e23c7; } public function encode_rs_char($sp94131d, &$sp29b96c) { $spb9cfc7 =& $this->mm; $sp3c0481 =& $this->nn; $sp4d9287 =& $this->alpha_to; $sp50a15b =& $this->index_of; $sp6c581a =& $this->genpoly; $sp4daef1 =& $this->nroots; $spa9f24b =& $this->fcr; $sp38f7b4 =& $this->prim; $sp9026c2 =& $this->iprim; $speb5a60 =& $this->pad; $sp8653ac =& $sp3c0481; $sp29b96c = array_fill(0, $sp4daef1, 0); for ($spcecaa9 = 0; $spcecaa9 < $sp3c0481 - $sp4daef1 - $speb5a60; $spcecaa9++) { $sp0e8602 = $sp50a15b[$sp94131d[$spcecaa9] ^ $sp29b96c[0]]; if ($sp0e8602 != $sp8653ac) { $sp0e8602 = $this->modnn($sp3c0481 - $sp6c581a[$sp4daef1] + $sp0e8602); for ($sp0d7cb6 = 1; $sp0d7cb6 < $sp4daef1; $sp0d7cb6++) { $sp29b96c[$sp0d7cb6] ^= $sp4d9287[$this->modnn($sp0e8602 + $sp6c581a[$sp4daef1 - $sp0d7cb6])]; } } array_shift($sp29b96c); if ($sp0e8602 != $sp8653ac) { array_push($sp29b96c, $sp4d9287[$this->modnn($sp0e8602 + $sp6c581a[0])]); } else { array_push($sp29b96c, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($sp853621, $spa973fa, $spa5a2de, $sp921c72, $spa8014b, $sp90fc1b) { foreach (self::$items as $sp6e23c7) { if ($sp6e23c7->pad != $sp90fc1b) { continue; } if ($sp6e23c7->nroots != $spa8014b) { continue; } if ($sp6e23c7->mm != $sp853621) { continue; } if ($sp6e23c7->gfpoly != $spa973fa) { continue; } if ($sp6e23c7->fcr != $spa5a2de) { continue; } if ($sp6e23c7->prim != $sp921c72) { continue; } return $sp6e23c7; } $sp6e23c7 = QRrsItem::init_rs_char($sp853621, $spa973fa, $spa5a2de, $sp921c72, $spa8014b, $sp90fc1b); array_unshift(self::$items, $sp6e23c7); return $sp6e23c7; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($spa5f6c8, &$sp3c0683, $sp52bf47, $sp1a0725) { $sp2c63d6 = 0; $sp76cfc0 = QRspec::getFormatInfo($sp52bf47, $sp1a0725); for ($spcecaa9 = 0; $spcecaa9 < 8; $spcecaa9++) { if ($sp76cfc0 & 1) { $sp2c63d6 += 2; $spb83a69 = 133; } else { $spb83a69 = 132; } $sp3c0683[8][$spa5f6c8 - 1 - $spcecaa9] = chr($spb83a69); if ($spcecaa9 < 6) { $sp3c0683[$spcecaa9][8] = chr($spb83a69); } else { $sp3c0683[$spcecaa9 + 1][8] = chr($spb83a69); } $sp76cfc0 = $sp76cfc0 >> 1; } for ($spcecaa9 = 0; $spcecaa9 < 7; $spcecaa9++) { if ($sp76cfc0 & 1) { $sp2c63d6 += 2; $spb83a69 = 133; } else { $spb83a69 = 132; } $sp3c0683[$spa5f6c8 - 7 + $spcecaa9][8] = chr($spb83a69); if ($spcecaa9 == 0) { $sp3c0683[8][7] = chr($spb83a69); } else { $sp3c0683[8][6 - $spcecaa9] = chr($spb83a69); } $sp76cfc0 = $sp76cfc0 >> 1; } return $sp2c63d6; } public function mask0($spc9afe1, $sp75b385) { return $spc9afe1 + $sp75b385 & 1; } public function mask1($spc9afe1, $sp75b385) { return $sp75b385 & 1; } public function mask2($spc9afe1, $sp75b385) { return $spc9afe1 % 3; } public function mask3($spc9afe1, $sp75b385) { return ($spc9afe1 + $sp75b385) % 3; } public function mask4($spc9afe1, $sp75b385) { return (int) ($sp75b385 / 2) + (int) ($spc9afe1 / 3) & 1; } public function mask5($spc9afe1, $sp75b385) { return ($spc9afe1 * $sp75b385 & 1) + $spc9afe1 * $sp75b385 % 3; } public function mask6($spc9afe1, $sp75b385) { return ($spc9afe1 * $sp75b385 & 1) + $spc9afe1 * $sp75b385 % 3 & 1; } public function mask7($spc9afe1, $sp75b385) { return $spc9afe1 * $sp75b385 % 3 + ($spc9afe1 + $sp75b385 & 1) & 1; } private function generateMaskNo($sp65681f, $spa5f6c8, $sp3c0683) { $spb51db8 = array_fill(0, $spa5f6c8, array_fill(0, $spa5f6c8, 0)); for ($sp75b385 = 0; $sp75b385 < $spa5f6c8; $sp75b385++) { for ($spc9afe1 = 0; $spc9afe1 < $spa5f6c8; $spc9afe1++) { if (ord($sp3c0683[$sp75b385][$spc9afe1]) & 128) { $spb51db8[$sp75b385][$spc9afe1] = 0; } else { $sp36b9c1 = call_user_func(array($this, 'mask' . $sp65681f), $spc9afe1, $sp75b385); $spb51db8[$sp75b385][$spc9afe1] = $sp36b9c1 == 0 ? 1 : 0; } } } return $spb51db8; } public static function serial($sp356a46) { $sp140e1f = array(); foreach ($sp356a46 as $sp4a1a5b) { $sp140e1f[] = join('', $sp4a1a5b); } return gzcompress(join('
', $sp140e1f), 9); } public static function unserial($spc8e60b) { $sp140e1f = array(); $sp1b8aa0 = explode('
', gzuncompress($spc8e60b)); foreach ($sp1b8aa0 as $sp4a1a5b) { $sp140e1f[] = str_split($sp4a1a5b); } return $sp140e1f; } public function makeMaskNo($sp65681f, $spa5f6c8, $spf82996, &$spaccea6, $spa8bffb = false) { $sp191fe2 = 0; $spb51db8 = array(); $sp83202a = QR_CACHE_DIR . 'mask_' . $sp65681f . DIRECTORY_SEPARATOR . 'mask_' . $spa5f6c8 . '_' . $sp65681f . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp83202a)) { $spb51db8 = self::unserial(file_get_contents($sp83202a)); } else { $spb51db8 = $this->generateMaskNo($sp65681f, $spa5f6c8, $spf82996, $spaccea6); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp65681f)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp65681f); } file_put_contents($sp83202a, self::serial($spb51db8)); } } else { $spb51db8 = $this->generateMaskNo($sp65681f, $spa5f6c8, $spf82996, $spaccea6); } if ($spa8bffb) { return; } $spaccea6 = $spf82996; for ($sp75b385 = 0; $sp75b385 < $spa5f6c8; $sp75b385++) { for ($spc9afe1 = 0; $spc9afe1 < $spa5f6c8; $spc9afe1++) { if ($spb51db8[$sp75b385][$spc9afe1] == 1) { $spaccea6[$sp75b385][$spc9afe1] = chr(ord($spf82996[$sp75b385][$spc9afe1]) ^ (int) $spb51db8[$sp75b385][$spc9afe1]); } $sp191fe2 += (int) (ord($spaccea6[$sp75b385][$spc9afe1]) & 1); } } return $sp191fe2; } public function makeMask($spa5f6c8, $sp3c0683, $sp65681f, $sp1a0725) { $sp568272 = array_fill(0, $spa5f6c8, str_repeat(' ', $spa5f6c8)); $this->makeMaskNo($sp65681f, $spa5f6c8, $sp3c0683, $sp568272); $this->writeFormatInformation($spa5f6c8, $sp568272, $sp65681f, $sp1a0725); return $sp568272; } public function calcN1N3($sp6f7e8a) { $sp36e2f4 = 0; for ($spcecaa9 = 0; $spcecaa9 < $sp6f7e8a; $spcecaa9++) { if ($this->runLength[$spcecaa9] >= 5) { $sp36e2f4 += N1 + ($this->runLength[$spcecaa9] - 5); } if ($spcecaa9 & 1) { if ($spcecaa9 >= 3 && $spcecaa9 < $sp6f7e8a - 2 && $this->runLength[$spcecaa9] % 3 == 0) { $spea8b84 = (int) ($this->runLength[$spcecaa9] / 3); if ($this->runLength[$spcecaa9 - 2] == $spea8b84 && $this->runLength[$spcecaa9 - 1] == $spea8b84 && $this->runLength[$spcecaa9 + 1] == $spea8b84 && $this->runLength[$spcecaa9 + 2] == $spea8b84) { if ($this->runLength[$spcecaa9 - 3] < 0 || $this->runLength[$spcecaa9 - 3] >= 4 * $spea8b84) { $sp36e2f4 += N3; } else { if ($spcecaa9 + 3 >= $sp6f7e8a || $this->runLength[$spcecaa9 + 3] >= 4 * $spea8b84) { $sp36e2f4 += N3; } } } } } } return $sp36e2f4; } public function evaluateSymbol($spa5f6c8, $sp3c0683) { $sp6f5739 = 0; $sp36e2f4 = 0; for ($sp75b385 = 0; $sp75b385 < $spa5f6c8; $sp75b385++) { $sp6f5739 = 0; $this->runLength[0] = 1; $sp016e2c = $sp3c0683[$sp75b385]; if ($sp75b385 > 0) { $sp854738 = $sp3c0683[$sp75b385 - 1]; } for ($spc9afe1 = 0; $spc9afe1 < $spa5f6c8; $spc9afe1++) { if ($spc9afe1 > 0 && $sp75b385 > 0) { $sp525cbe = ord($sp016e2c[$spc9afe1]) & ord($sp016e2c[$spc9afe1 - 1]) & ord($sp854738[$spc9afe1]) & ord($sp854738[$spc9afe1 - 1]); $sp82116c = ord($sp016e2c[$spc9afe1]) | ord($sp016e2c[$spc9afe1 - 1]) | ord($sp854738[$spc9afe1]) | ord($sp854738[$spc9afe1 - 1]); if (($sp525cbe | $sp82116c ^ 1) & 1) { $sp36e2f4 += N2; } } if ($spc9afe1 == 0 && ord($sp016e2c[$spc9afe1]) & 1) { $this->runLength[0] = -1; $sp6f5739 = 1; $this->runLength[$sp6f5739] = 1; } else { if ($spc9afe1 > 0) { if ((ord($sp016e2c[$spc9afe1]) ^ ord($sp016e2c[$spc9afe1 - 1])) & 1) { $sp6f5739++; $this->runLength[$sp6f5739] = 1; } else { $this->runLength[$sp6f5739]++; } } } } $sp36e2f4 += $this->calcN1N3($sp6f5739 + 1); } for ($spc9afe1 = 0; $spc9afe1 < $spa5f6c8; $spc9afe1++) { $sp6f5739 = 0; $this->runLength[0] = 1; for ($sp75b385 = 0; $sp75b385 < $spa5f6c8; $sp75b385++) { if ($sp75b385 == 0 && ord($sp3c0683[$sp75b385][$spc9afe1]) & 1) { $this->runLength[0] = -1; $sp6f5739 = 1; $this->runLength[$sp6f5739] = 1; } else { if ($sp75b385 > 0) { if ((ord($sp3c0683[$sp75b385][$spc9afe1]) ^ ord($sp3c0683[$sp75b385 - 1][$spc9afe1])) & 1) { $sp6f5739++; $this->runLength[$sp6f5739] = 1; } else { $this->runLength[$sp6f5739]++; } } } } $sp36e2f4 += $this->calcN1N3($sp6f5739 + 1); } return $sp36e2f4; } public function mask($spa5f6c8, $sp3c0683, $sp1a0725) { $sp829a70 = PHP_INT_MAX; $sp6dc6c7 = 0; $spa3800d = array(); $sp94ec99 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp8718b4 = 8 - QR_FIND_FROM_RANDOM % 9; for ($spcecaa9 = 0; $spcecaa9 < $sp8718b4; $spcecaa9++) { $spa26465 = rand(0, count($sp94ec99) - 1); unset($sp94ec99[$spa26465]); $sp94ec99 = array_values($sp94ec99); } } $spa3800d = $sp3c0683; foreach ($sp94ec99 as $spcecaa9) { $sp52bf47 = array_fill(0, $spa5f6c8, str_repeat(' ', $spa5f6c8)); $sp36e2f4 = 0; $sp2c63d6 = 0; $sp2c63d6 = $this->makeMaskNo($spcecaa9, $spa5f6c8, $sp3c0683, $sp52bf47); $sp2c63d6 += $this->writeFormatInformation($spa5f6c8, $sp52bf47, $spcecaa9, $sp1a0725); $sp2c63d6 = (int) (100 * $sp2c63d6 / ($spa5f6c8 * $spa5f6c8)); $sp36e2f4 = (int) ((int) (abs($sp2c63d6 - 50) / 5) * N4); $sp36e2f4 += $this->evaluateSymbol($spa5f6c8, $sp52bf47); if ($sp36e2f4 < $sp829a70) { $sp829a70 = $sp36e2f4; $spa3800d = $sp52bf47; $sp6dc6c7 = $spcecaa9; } } return $spa3800d; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($sp40f4b0, $sp94131d, $sp05a58a, &$sp9af759, QRrsItem $sp6e23c7) { $sp6e23c7->encode_rs_char($sp94131d, $sp9af759); $this->dataLength = $sp40f4b0; $this->data = $sp94131d; $this->eccLength = $sp05a58a; $this->ecc = $sp9af759; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $sp106469) { $spb0a94c = array(0, 0, 0, 0, 0); $this->datacode = $sp106469->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($sp106469->getVersion(), $sp106469->getErrorCorrectionLevel(), $spb0a94c); $this->version = $sp106469->getVersion(); $this->b1 = QRspec::rsBlockNum1($spb0a94c); $this->dataLength = QRspec::rsDataLength($spb0a94c); $this->eccLength = QRspec::rsEccLength($spb0a94c); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($spb0a94c); $sp46dd86 = $this->init($spb0a94c); if ($sp46dd86 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $spb0a94c) { $sp40f4b0 = QRspec::rsDataCodes1($spb0a94c); $sp05a58a = QRspec::rsEccCodes1($spb0a94c); $sp6e23c7 = QRrs::init_rs(8, 285, 0, 1, $sp05a58a, 255 - $sp40f4b0 - $sp05a58a); $sp6b8e2c = 0; $sp677176 = 0; $speea889 = 0; for ($spcecaa9 = 0; $spcecaa9 < QRspec::rsBlockNum1($spb0a94c); $spcecaa9++) { $sp9af759 = array_slice($this->ecccode, $speea889); $this->rsblocks[$sp6b8e2c] = new QRrsblock($sp40f4b0, array_slice($this->datacode, $sp677176), $sp05a58a, $sp9af759, $sp6e23c7); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $speea889), $sp9af759); $sp677176 += $sp40f4b0; $speea889 += $sp05a58a; $sp6b8e2c++; } if (QRspec::rsBlockNum2($spb0a94c) == 0) { return 0; } $sp40f4b0 = QRspec::rsDataCodes2($spb0a94c); $sp05a58a = QRspec::rsEccCodes2($spb0a94c); $sp6e23c7 = QRrs::init_rs(8, 285, 0, 1, $sp05a58a, 255 - $sp40f4b0 - $sp05a58a); if ($sp6e23c7 == NULL) { return -1; } for ($spcecaa9 = 0; $spcecaa9 < QRspec::rsBlockNum2($spb0a94c); $spcecaa9++) { $sp9af759 = array_slice($this->ecccode, $speea889); $this->rsblocks[$sp6b8e2c] = new QRrsblock($sp40f4b0, array_slice($this->datacode, $sp677176), $sp05a58a, $sp9af759, $sp6e23c7); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $speea889), $sp9af759); $sp677176 += $sp40f4b0; $speea889 += $sp05a58a; $sp6b8e2c++; } return 0; } public function getCode() { $sp46dd86; if ($this->count < $this->dataLength) { $sp88832e = $this->count % $this->blocks; $spbe5ab0 = $this->count / $this->blocks; if ($spbe5ab0 >= $this->rsblocks[0]->dataLength) { $sp88832e += $this->b1; } $sp46dd86 = $this->rsblocks[$sp88832e]->data[$spbe5ab0]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp88832e = ($this->count - $this->dataLength) % $this->blocks; $spbe5ab0 = ($this->count - $this->dataLength) / $this->blocks; $sp46dd86 = $this->rsblocks[$sp88832e]->ecc[$spbe5ab0]; } else { return 0; } } $this->count++; return $sp46dd86; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $sp106469, $sp52bf47) { if ($sp106469->getVersion() < 0 || $sp106469->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($sp106469->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $spda68c5 = new QRrawcode($sp106469); QRtools::markTime('after_raw'); $sp6735ba = $spda68c5->version; $spa5f6c8 = QRspec::getWidth($sp6735ba); $sp3c0683 = QRspec::newFrame($sp6735ba); $sp2d2a16 = new FrameFiller($spa5f6c8, $sp3c0683); if (is_null($sp2d2a16)) { return NULL; } for ($spcecaa9 = 0; $spcecaa9 < $spda68c5->dataLength + $spda68c5->eccLength; $spcecaa9++) { $spc8e60b = $spda68c5->getCode(); $sp74df63 = 128; for ($sp0d7cb6 = 0; $sp0d7cb6 < 8; $sp0d7cb6++) { $spdc453b = $sp2d2a16->next(); $sp2d2a16->setFrameAt($spdc453b, 2 | ($sp74df63 & $spc8e60b) != 0); $sp74df63 = $sp74df63 >> 1; } } QRtools::markTime('after_filler'); unset($spda68c5); $sp0d7cb6 = QRspec::getRemainder($sp6735ba); for ($spcecaa9 = 0; $spcecaa9 < $sp0d7cb6; $spcecaa9++) { $spdc453b = $sp2d2a16->next(); $sp2d2a16->setFrameAt($spdc453b, 2); } $sp3c0683 = $sp2d2a16->frame; unset($sp2d2a16); $spce6054 = new QRmask(); if ($sp52bf47 < 0) { if (QR_FIND_BEST_MASK) { $sp568272 = $spce6054->mask($spa5f6c8, $sp3c0683, $sp106469->getErrorCorrectionLevel()); } else { $sp568272 = $spce6054->makeMask($spa5f6c8, $sp3c0683, intval(QR_DEFAULT_MASK) % 8, $sp106469->getErrorCorrectionLevel()); } } else { $sp568272 = $spce6054->makeMask($spa5f6c8, $sp3c0683, $sp52bf47, $sp106469->getErrorCorrectionLevel()); } if ($sp568272 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $sp6735ba; $this->width = $spa5f6c8; $this->data = $sp568272; return $this; } public function encodeInput(QRinput $sp106469) { return $this->encodeMask($sp106469, -1); } public function encodeString8bit($sp5ebef2, $sp6735ba, $sp1a0725) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $sp106469 = new QRinput($sp6735ba, $sp1a0725); if ($sp106469 == NULL) { return NULL; } $sp46dd86 = $sp106469->append($sp106469, QR_MODE_8, strlen($sp5ebef2), str_split($sp5ebef2)); if ($sp46dd86 < 0) { unset($sp106469); return NULL; } return $this->encodeInput($sp106469); } public function encodeString($sp5ebef2, $sp6735ba, $sp1a0725, $sp1162fe, $sp9a89ae) { if ($sp1162fe != QR_MODE_8 && $sp1162fe != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $sp106469 = new QRinput($sp6735ba, $sp1a0725); if ($sp106469 == NULL) { return NULL; } $sp46dd86 = QRsplit::splitStringToQRinput($sp5ebef2, $sp106469, $sp1162fe, $sp9a89ae); if ($sp46dd86 < 0) { return NULL; } return $this->encodeInput($sp106469); } public static function png($sp6be7b9, $sp77616a = false, $sp1a0725 = QR_ECLEVEL_L, $sp6b1313 = 3, $spbb9927 = 4, $sp3c9645 = false) { $sp0dc071 = QRencode::factory($sp1a0725, $sp6b1313, $spbb9927); return $sp0dc071->encodePNG($sp6be7b9, $sp77616a, $sp3c9645 = false); } public static function text($sp6be7b9, $sp77616a = false, $sp1a0725 = QR_ECLEVEL_L, $sp6b1313 = 3, $spbb9927 = 4) { $sp0dc071 = QRencode::factory($sp1a0725, $sp6b1313, $spbb9927); return $sp0dc071->encode($sp6be7b9, $sp77616a); } public static function raw($sp6be7b9, $sp77616a = false, $sp1a0725 = QR_ECLEVEL_L, $sp6b1313 = 3, $spbb9927 = 4) { $sp0dc071 = QRencode::factory($sp1a0725, $sp6b1313, $spbb9927); return $sp0dc071->encodeRAW($sp6be7b9, $sp77616a); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($spa5f6c8, &$sp3c0683) { $this->width = $spa5f6c8; $this->frame = $sp3c0683; $this->x = $spa5f6c8 - 1; $this->y = $spa5f6c8 - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp05d5c2, $sp679ba2) { $this->frame[$sp05d5c2['y']][$sp05d5c2['x']] = chr($sp679ba2); } public function getFrameAt($sp05d5c2) { return ord($this->frame[$sp05d5c2['y']][$sp05d5c2['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $spc9afe1 = $this->x; $sp75b385 = $this->y; $sp76ac0e = $this->width; if ($this->bit == 0) { $spc9afe1--; $this->bit++; } else { $spc9afe1++; $sp75b385 += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($sp75b385 < 0) { $sp75b385 = 0; $spc9afe1 -= 2; $this->dir = 1; if ($spc9afe1 == 6) { $spc9afe1--; $sp75b385 = 9; } } } else { if ($sp75b385 == $sp76ac0e) { $sp75b385 = $sp76ac0e - 1; $spc9afe1 -= 2; $this->dir = -1; if ($spc9afe1 == 6) { $spc9afe1--; $sp75b385 -= 8; } } } if ($spc9afe1 < 0 || $sp75b385 < 0) { return null; } $this->x = $spc9afe1; $this->y = $sp75b385; } while (ord($this->frame[$sp75b385][$spc9afe1]) & 128); return array('x' => $spc9afe1, 'y' => $sp75b385); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($sp1a0725 = QR_ECLEVEL_L, $sp6b1313 = 3, $spbb9927 = 4) { $sp0dc071 = new QRencode(); $sp0dc071->size = $sp6b1313; $sp0dc071->margin = $spbb9927; switch ($sp1a0725 . '') { case '0': case '1': case '2': case '3': $sp0dc071->level = $sp1a0725; break; case 'l': case 'L': $sp0dc071->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp0dc071->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp0dc071->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp0dc071->level = QR_ECLEVEL_H; break; } return $sp0dc071; } public function encodeRAW($spcf5fad, $sp77616a = false) { $spc8e60b = new QRcode(); if ($this->eightbit) { $spc8e60b->encodeString8bit($spcf5fad, $this->version, $this->level); } else { $spc8e60b->encodeString($spcf5fad, $this->version, $this->level, $this->hint, $this->casesensitive); } return $spc8e60b->data; } public function encode($spcf5fad, $sp77616a = false) { $spc8e60b = new QRcode(); if ($this->eightbit) { $spc8e60b->encodeString8bit($spcf5fad, $this->version, $this->level); } else { $spc8e60b->encodeString($spcf5fad, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($sp77616a !== false) { file_put_contents($sp77616a, join('
', QRtools::binarize($spc8e60b->data))); } else { return QRtools::binarize($spc8e60b->data); } } public function encodePNG($spcf5fad, $sp77616a = false, $sp3c9645 = false) { try { ob_start(); $spc32701 = $this->encode($spcf5fad); $spbbc15d = ob_get_contents(); ob_end_clean(); if ($spbbc15d != '') { QRtools::log($sp77616a, $spbbc15d); } $sp6d2360 = (int) (QR_PNG_MAXIMUM_SIZE / (count($spc32701) + 2 * $this->margin)); QRimage::png($spc32701, $sp77616a, min(max(1, $this->size), $sp6d2360), $this->margin, $sp3c9645); } catch (Exception $spfda1c7) { QRtools::log($sp77616a, $spfda1c7->getMessage()); } } }