<?php
define('QR_MODE_NUL', -1); define('QR_MODE_NUM', 0); define('QR_MODE_AN', 1); define('QR_MODE_8', 2); define('QR_MODE_KANJI', 3); define('QR_MODE_STRUCTURE', 4); define('QR_ECLEVEL_L', 0); define('QR_ECLEVEL_M', 1); define('QR_ECLEVEL_Q', 2); define('QR_ECLEVEL_H', 3); define('QR_FORMAT_TEXT', 0); define('QR_FORMAT_PNG', 1); class qrstr { public static function set(&$sp766db1, $sp5a2ed4, $spb9fd0a, $sped6a29, $sp28df05 = false) { $sp766db1[$spb9fd0a] = substr_replace($sp766db1[$spb9fd0a], $sp28df05 !== false ? substr($sped6a29, 0, $sp28df05) : $sped6a29, $sp5a2ed4, $sp28df05 !== false ? $sp28df05 : strlen($sped6a29)); } } define('QR_CACHEABLE', false); define('QR_CACHE_DIR', false); define('QR_LOG_DIR', false); define('QR_FIND_BEST_MASK', true); define('QR_FIND_FROM_RANDOM', 2); define('QR_DEFAULT_MASK', 2); define('QR_PNG_MAXIMUM_SIZE', 1024); class QRtools { public static function binarize($sp368f30) { $sp20213c = count($sp368f30); foreach ($sp368f30 as &$sp8912b8) { for ($sp3deb2c = 0; $sp3deb2c < $sp20213c; $sp3deb2c++) { $sp8912b8[$sp3deb2c] = ord($sp8912b8[$sp3deb2c]) & 1 ? '1' : '0'; } } return $sp368f30; } public static function tcpdfBarcodeArray($spa40a85, $sp840ef2 = 'QR,L', $sp86571f = '4.5.037') { $sp70b763 = array(); if (!is_array($sp840ef2)) { $sp840ef2 = explode(',', $sp840ef2); } $sp407607 = 'L'; if (count($sp840ef2) > 1) { $sp407607 = $sp840ef2[1]; } $specce38 = QRcode::text($spa40a85, false, $sp407607); $spca33a2 = count($specce38); $sp70b763['num_rows'] = $spca33a2; $sp70b763['num_cols'] = $spca33a2; $sp70b763['bcode'] = array(); foreach ($specce38 as $spcdf3ae) { $sp7e2d73 = array(); foreach (str_split($spcdf3ae) as $sp1b6bac) { $sp7e2d73[] = $sp1b6bac == '1' ? 1 : 0; } $sp70b763['bcode'][] = $sp7e2d73; } return $sp70b763; } public static function clearCache() { self::$frames = array(); } public static function buildCache() { QRtools::markTime('before_build_cache'); $sp1bed24 = new QRmask(); for ($sp8deb4d = 1; $sp8deb4d <= QRSPEC_VERSION_MAX; $sp8deb4d++) { $sp368f30 = QRspec::newFrame($sp8deb4d); if (QR_IMAGE) { $sp73b80d = QR_CACHE_DIR . 'frame_' . $sp8deb4d . '.png'; QRimage::png(self::binarize($sp368f30), $sp73b80d, 1, 0); } $sp2a5137 = count($sp368f30); $sp5be2c5 = array_fill(0, $sp2a5137, array_fill(0, $sp2a5137, 0)); for ($sp446843 = 0; $sp446843 < 8; $sp446843++) { $sp1bed24->makeMaskNo($sp446843, $sp2a5137, $sp368f30, $sp5be2c5, true); } } QRtools::markTime('after_build_cache'); } public static function log($spc775b2, $spca1206) { if (QR_LOG_DIR !== false) { if ($spca1206 != '') { if ($spc775b2 !== false) { file_put_contents(QR_LOG_DIR . basename($spc775b2) . '-errors.txt', date('Y-m-d H:i:s') . ': ' . $spca1206, FILE_APPEND); } else { file_put_contents(QR_LOG_DIR . 'errors.txt', date('Y-m-d H:i:s') . ': ' . $spca1206, FILE_APPEND); } } } } public static function dumpMask($sp368f30) { $sp2a5137 = count($sp368f30); for ($spb9fd0a = 0; $spb9fd0a < $sp2a5137; $spb9fd0a++) { for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp2a5137; $sp5a2ed4++) { echo ord($sp368f30[$spb9fd0a][$sp5a2ed4]) . ','; } } } public static function markTime($sp9028f5) { list($spddfdd6, $sp5bcab1) = explode(' ', microtime()); $sp0df43e = (double) $spddfdd6 + (double) $sp5bcab1; if (!isset($spe37314['qr_time_bench'])) { $spe37314['qr_time_bench'] = array(); } $spe37314['qr_time_bench'][$sp9028f5] = $sp0df43e; } public static function timeBenchmark() { self::markTime('finish'); $sp9f31c0 = 0; $spb36e43 = 0; $sp0a1153 = 0; echo '<table cellpadding="3" cellspacing="1">
                    <thead><tr style="border-bottom:1px solid silver"><td colspan="2" style="text-align:center">BENCHMARK</td></tr></thead>
                    <tbody>'; foreach ($spe37314['qr_time_bench'] as $sp9028f5 => $spff8467) { if ($sp0a1153 > 0) { echo '<tr><th style="text-align:right">till ' . $sp9028f5 . ': </th><td>' . number_format($spff8467 - $sp9f31c0, 6) . 's</td></tr>'; } else { $spb36e43 = $spff8467; } $sp0a1153++; $sp9f31c0 = $spff8467; } echo '</tbody><tfoot>
                <tr style="border-top:2px solid black"><th style="text-align:right">TOTAL: </th><td>' . number_format($sp9f31c0 - $spb36e43, 6) . 's</td></tr>
            </tfoot>
            </table>'; } } QRtools::markTime('start'); define('QRSPEC_VERSION_MAX', 40); define('QRSPEC_WIDTH_MAX', 177); define('QRCAP_WIDTH', 0); define('QRCAP_WORDS', 1); define('QRCAP_REMINDER', 2); define('QRCAP_EC', 3); class QRspec { public static $capacity = array(array(0, 0, 0, array(0, 0, 0, 0)), array(21, 26, 0, array(7, 10, 13, 17)), array(25, 44, 7, array(10, 16, 22, 28)), array(29, 70, 7, array(15, 26, 36, 44)), array(33, 100, 7, array(20, 36, 52, 64)), array(37, 134, 7, array(26, 48, 72, 88)), array(41, 172, 7, array(36, 64, 96, 112)), array(45, 196, 0, array(40, 72, 108, 130)), array(49, 242, 0, array(48, 88, 132, 156)), array(53, 292, 0, array(60, 110, 160, 192)), array(57, 346, 0, array(72, 130, 192, 224)), array(61, 404, 0, array(80, 150, 224, 264)), array(65, 466, 0, array(96, 176, 260, 308)), array(69, 532, 0, array(104, 198, 288, 352)), array(73, 581, 3, array(120, 216, 320, 384)), array(77, 655, 3, array(132, 240, 360, 432)), array(81, 733, 3, array(144, 280, 408, 480)), array(85, 815, 3, array(168, 308, 448, 532)), array(89, 901, 3, array(180, 338, 504, 588)), array(93, 991, 3, array(196, 364, 546, 650)), array(97, 1085, 3, array(224, 416, 600, 700)), array(101, 1156, 4, array(224, 442, 644, 750)), array(105, 1258, 4, array(252, 476, 690, 816)), array(109, 1364, 4, array(270, 504, 750, 900)), array(113, 1474, 4, array(300, 560, 810, 960)), array(117, 1588, 4, array(312, 588, 870, 1050)), array(121, 1706, 4, array(336, 644, 952, 1110)), array(125, 1828, 4, array(360, 700, 1020, 1200)), array(129, 1921, 3, array(390, 728, 1050, 1260)), array(133, 2051, 3, array(420, 784, 1140, 1350)), array(137, 2185, 3, array(450, 812, 1200, 1440)), array(141, 2323, 3, array(480, 868, 1290, 1530)), array(145, 2465, 3, array(510, 924, 1350, 1620)), array(149, 2611, 3, array(540, 980, 1440, 1710)), array(153, 2761, 3, array(570, 1036, 1530, 1800)), array(157, 2876, 0, array(570, 1064, 1590, 1890)), array(161, 3034, 0, array(600, 1120, 1680, 1980)), array(165, 3196, 0, array(630, 1204, 1770, 2100)), array(169, 3362, 0, array(660, 1260, 1860, 2220)), array(173, 3532, 0, array(720, 1316, 1950, 2310)), array(177, 3706, 0, array(750, 1372, 2040, 2430))); public static function getDataLength($spf21bb0, $spd3dda9) { return self::$capacity[$spf21bb0][QRCAP_WORDS] - self::$capacity[$spf21bb0][QRCAP_EC][$spd3dda9]; } public static function getECCLength($spf21bb0, $spd3dda9) { return self::$capacity[$spf21bb0][QRCAP_EC][$spd3dda9]; } public static function getWidth($spf21bb0) { return self::$capacity[$spf21bb0][QRCAP_WIDTH]; } public static function getRemainder($spf21bb0) { return self::$capacity[$spf21bb0][QRCAP_REMINDER]; } public static function getMinimumVersion($spca33a2, $spd3dda9) { for ($sp3deb2c = 1; $sp3deb2c <= QRSPEC_VERSION_MAX; $sp3deb2c++) { $sp62a480 = self::$capacity[$sp3deb2c][QRCAP_WORDS] - self::$capacity[$sp3deb2c][QRCAP_EC][$spd3dda9]; if ($sp62a480 >= $spca33a2) { return $sp3deb2c; } } return -1; } public static $lengthTableBits = array(array(10, 12, 14), array(9, 11, 13), array(8, 16, 16), array(8, 10, 12)); public static function lengthIndicator($sp840ef2, $spf21bb0) { if ($sp840ef2 == QR_MODE_STRUCTURE) { return 0; } if ($spf21bb0 <= 9) { $sp69bf69 = 0; } else { if ($spf21bb0 <= 26) { $sp69bf69 = 1; } else { $sp69bf69 = 2; } } return self::$lengthTableBits[$sp840ef2][$sp69bf69]; } public static function maximumWords($sp840ef2, $spf21bb0) { if ($sp840ef2 == QR_MODE_STRUCTURE) { return 3; } if ($spf21bb0 <= 9) { $sp69bf69 = 0; } else { if ($spf21bb0 <= 26) { $sp69bf69 = 1; } else { $sp69bf69 = 2; } } $sp5cd69d = self::$lengthTableBits[$sp840ef2][$sp69bf69]; $sp62a480 = (1 << $sp5cd69d) - 1; if ($sp840ef2 == QR_MODE_KANJI) { $sp62a480 *= 2; } return $sp62a480; } public static $eccTable = array(array(array(0, 0), array(0, 0), array(0, 0), array(0, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(1, 0), array(1, 0)), array(array(1, 0), array(1, 0), array(2, 0), array(2, 0)), array(array(1, 0), array(2, 0), array(2, 0), array(4, 0)), array(array(1, 0), array(2, 0), array(2, 2), array(2, 2)), array(array(2, 0), array(4, 0), array(4, 0), array(4, 0)), array(array(2, 0), array(4, 0), array(2, 4), array(4, 1)), array(array(2, 0), array(2, 2), array(4, 2), array(4, 2)), array(array(2, 0), array(3, 2), array(4, 4), array(4, 4)), array(array(2, 2), array(4, 1), array(6, 2), array(6, 2)), array(array(4, 0), array(1, 4), array(4, 4), array(3, 8)), array(array(2, 2), array(6, 2), array(4, 6), array(7, 4)), array(array(4, 0), array(8, 1), array(8, 4), array(12, 4)), array(array(3, 1), array(4, 5), array(11, 5), array(11, 5)), array(array(5, 1), array(5, 5), array(5, 7), array(11, 7)), array(array(5, 1), array(7, 3), array(15, 2), array(3, 13)), array(array(1, 5), array(10, 1), array(1, 15), array(2, 17)), array(array(5, 1), array(9, 4), array(17, 1), array(2, 19)), array(array(3, 4), array(3, 11), array(17, 4), array(9, 16)), array(array(3, 5), array(3, 13), array(15, 5), array(15, 10)), array(array(4, 4), array(17, 0), array(17, 6), array(19, 6)), array(array(2, 7), array(17, 0), array(7, 16), array(34, 0)), array(array(4, 5), array(4, 14), array(11, 14), array(16, 14)), array(array(6, 4), array(6, 14), array(11, 16), array(30, 2)), array(array(8, 4), array(8, 13), array(7, 22), array(22, 13)), array(array(10, 2), array(19, 4), array(28, 6), array(33, 4)), array(array(8, 4), array(22, 3), array(8, 26), array(12, 28)), array(array(3, 10), array(3, 23), array(4, 31), array(11, 31)), array(array(7, 7), array(21, 7), array(1, 37), array(19, 26)), array(array(5, 10), array(19, 10), array(15, 25), array(23, 25)), array(array(13, 3), array(2, 29), array(42, 1), array(23, 28)), array(array(17, 0), array(10, 23), array(10, 35), array(19, 35)), array(array(17, 1), array(14, 21), array(29, 19), array(11, 46)), array(array(13, 6), array(14, 23), array(44, 7), array(59, 1)), array(array(12, 7), array(12, 26), array(39, 14), array(22, 41)), array(array(6, 14), array(6, 34), array(46, 10), array(2, 64)), array(array(17, 4), array(29, 14), array(49, 10), array(24, 46)), array(array(4, 18), array(13, 32), array(48, 14), array(42, 32)), array(array(20, 4), array(40, 7), array(43, 22), array(10, 67)), array(array(19, 6), array(18, 31), array(34, 34), array(20, 61))); public static function getEccSpec($spf21bb0, $spd3dda9, array &$sp151b1e) { if (count($sp151b1e) < 5) { $sp151b1e = array(0, 0, 0, 0, 0); } $spe721b3 = self::$eccTable[$spf21bb0][$spd3dda9][0]; $spa5b261 = self::$eccTable[$spf21bb0][$spd3dda9][1]; $sp631d11 = self::getDataLength($spf21bb0, $spd3dda9); $spab82f2 = self::getECCLength($spf21bb0, $spd3dda9); if ($spa5b261 == 0) { $sp151b1e[0] = $spe721b3; $sp151b1e[1] = (int) ($sp631d11 / $spe721b3); $sp151b1e[2] = (int) ($spab82f2 / $spe721b3); $sp151b1e[3] = 0; $sp151b1e[4] = 0; } else { $sp151b1e[0] = $spe721b3; $sp151b1e[1] = (int) ($sp631d11 / ($spe721b3 + $spa5b261)); $sp151b1e[2] = (int) ($spab82f2 / ($spe721b3 + $spa5b261)); $sp151b1e[3] = $spa5b261; $sp151b1e[4] = $sp151b1e[1] + 1; } } public static $alignmentPattern = array(array(0, 0), array(0, 0), array(18, 0), array(22, 0), array(26, 0), array(30, 0), array(34, 0), array(22, 38), array(24, 42), array(26, 46), array(28, 50), array(30, 54), array(32, 58), array(34, 62), array(26, 46), array(26, 48), array(26, 50), array(30, 54), array(30, 56), array(30, 58), array(34, 62), array(28, 50), array(26, 50), array(30, 54), array(28, 54), array(32, 58), array(30, 58), array(34, 62), array(26, 50), array(30, 54), array(26, 52), array(30, 56), array(34, 60), array(30, 58), array(34, 62), array(30, 54), array(24, 50), array(28, 54), array(32, 58), array(26, 54), array(30, 58)); public static function putAlignmentMarker(array &$sp368f30, $spaeca5c, $sp2ee203) { $spcc9001 = array('°°°°°', '°†††°', '°†°†°', '°†††°', '°°°°°'); $sp2df453 = $sp2ee203 - 2; $sp65496c = $spaeca5c - 2; for ($spb9fd0a = 0; $spb9fd0a < 5; $spb9fd0a++) { QRstr::set($sp368f30, $sp65496c, $sp2df453 + $spb9fd0a, $spcc9001[$spb9fd0a]); } } public static function putAlignmentPattern($spf21bb0, &$sp368f30, $sp2a5137) { if ($spf21bb0 < 2) { return; } $speb7a04 = self::$alignmentPattern[$spf21bb0][1] - self::$alignmentPattern[$spf21bb0][0]; if ($speb7a04 < 0) { $sp1945cb = 2; } else { $sp1945cb = (int) (($sp2a5137 - self::$alignmentPattern[$spf21bb0][0]) / $speb7a04 + 2); } if ($sp1945cb * $sp1945cb - 3 == 1) { $sp5a2ed4 = self::$alignmentPattern[$spf21bb0][0]; $spb9fd0a = self::$alignmentPattern[$spf21bb0][0]; self::putAlignmentMarker($sp368f30, $sp5a2ed4, $spb9fd0a); return; } $sp38d71e = self::$alignmentPattern[$spf21bb0][0]; for ($sp5a2ed4 = 1; $sp5a2ed4 < $sp1945cb - 1; $sp5a2ed4++) { self::putAlignmentMarker($sp368f30, 6, $sp38d71e); self::putAlignmentMarker($sp368f30, $sp38d71e, 6); $sp38d71e += $speb7a04; } $sp5c2e79 = self::$alignmentPattern[$spf21bb0][0]; for ($spb9fd0a = 0; $spb9fd0a < $sp1945cb - 1; $spb9fd0a++) { $sp38d71e = self::$alignmentPattern[$spf21bb0][0]; for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp1945cb - 1; $sp5a2ed4++) { self::putAlignmentMarker($sp368f30, $sp38d71e, $sp5c2e79); $sp38d71e += $speb7a04; } $sp5c2e79 += $speb7a04; } } public static $versionPattern = array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); public static function getVersionPattern($spf21bb0) { if ($spf21bb0 < 7 || $spf21bb0 > QRSPEC_VERSION_MAX) { return 0; } return self::$versionPattern[$spf21bb0 - 7]; } public static $formatInfo = array(array(30660, 29427, 32170, 30877, 26159, 25368, 27713, 26998), array(21522, 20773, 24188, 23371, 17913, 16590, 20375, 19104), array(13663, 12392, 16177, 14854, 9396, 8579, 11994, 11245), array(5769, 5054, 7399, 6608, 1890, 597, 3340, 2107)); public static function getFormatInfo($sp1bed24, $spd3dda9) { if ($sp1bed24 < 0 || $sp1bed24 > 7) { return 0; } if ($spd3dda9 < 0 || $spd3dda9 > 3) { return 0; } return self::$formatInfo[$spd3dda9][$sp1bed24]; } public static $frames = array(); public static function putFinderPattern(&$sp368f30, $spaeca5c, $sp2ee203) { $spcc9001 = array('¡¡¡¡¡¡¡', '¡¿¿¿¿¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¡¡¡¿¡', '¡¿¿¿¿¿¡', '¡¡¡¡¡¡¡'); for ($spb9fd0a = 0; $spb9fd0a < 7; $spb9fd0a++) { QRstr::set($sp368f30, $spaeca5c, $sp2ee203 + $spb9fd0a, $spcc9001[$spb9fd0a]); } } public static function createFrame($spf21bb0) { $sp2a5137 = self::$capacity[$spf21bb0][QRCAP_WIDTH]; $sp8912b8 = str_repeat(' ', $sp2a5137); $sp368f30 = array_fill(0, $sp2a5137, $sp8912b8); self::putFinderPattern($sp368f30, 0, 0); self::putFinderPattern($sp368f30, $sp2a5137 - 7, 0); self::putFinderPattern($sp368f30, 0, $sp2a5137 - 7); $spa35da5 = $sp2a5137 - 7; for ($spb9fd0a = 0; $spb9fd0a < 7; $spb9fd0a++) { $sp368f30[$spb9fd0a][7] = '¿'; $sp368f30[$spb9fd0a][$sp2a5137 - 8] = '¿'; $sp368f30[$spa35da5][7] = '¿'; $spa35da5++; } $spfab295 = str_repeat('¿', 8); QRstr::set($sp368f30, 0, 7, $spfab295); QRstr::set($sp368f30, $sp2a5137 - 8, 7, $spfab295); QRstr::set($sp368f30, 0, $sp2a5137 - 8, $spfab295); $spfab295 = str_repeat('Ñ', 9); QRstr::set($sp368f30, 0, 8, $spfab295); QRstr::set($sp368f30, $sp2a5137 - 8, 8, $spfab295, 8); $spa35da5 = $sp2a5137 - 8; for ($spb9fd0a = 0; $spb9fd0a < 8; $spb9fd0a++, $spa35da5++) { $sp368f30[$spb9fd0a][8] = 'Ñ'; $sp368f30[$spa35da5][8] = 'Ñ'; } for ($sp3deb2c = 1; $sp3deb2c < $sp2a5137 - 15; $sp3deb2c++) { $sp368f30[6][7 + $sp3deb2c] = chr(144 | $sp3deb2c & 1); $sp368f30[7 + $sp3deb2c][6] = chr(144 | $sp3deb2c & 1); } self::putAlignmentPattern($spf21bb0, $sp368f30, $sp2a5137); if ($spf21bb0 >= 7) { $spa10866 = self::getVersionPattern($spf21bb0); $sp06d9c9 = $spa10866; for ($sp5a2ed4 = 0; $sp5a2ed4 < 6; $sp5a2ed4++) { for ($spb9fd0a = 0; $spb9fd0a < 3; $spb9fd0a++) { $sp368f30[$sp2a5137 - 11 + $spb9fd0a][$sp5a2ed4] = chr(136 | $sp06d9c9 & 1); $sp06d9c9 = $sp06d9c9 >> 1; } } $sp06d9c9 = $spa10866; for ($spb9fd0a = 0; $spb9fd0a < 6; $spb9fd0a++) { for ($sp5a2ed4 = 0; $sp5a2ed4 < 3; $sp5a2ed4++) { $sp368f30[$spb9fd0a][$sp5a2ed4 + ($sp2a5137 - 11)] = chr(136 | $sp06d9c9 & 1); $sp06d9c9 = $sp06d9c9 >> 1; } } } $sp368f30[$sp2a5137 - 8][8] = 'Å'; return $sp368f30; } public static function debug($sp368f30, $spe331a4 = false) { if ($spe331a4) { foreach ($sp368f30 as &$sp8912b8) { $sp8912b8 = join('<span class="m">&nbsp;&nbsp;</span>', explode('0', $sp8912b8)); $sp8912b8 = join('&#9608;&#9608;', explode('1', $sp8912b8)); } ?>
                <style>
                    .m { background-color: white; }
                </style>
                <?php  echo '<pre><tt><br/ ><br/ ><br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'; echo join('<br/ >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;', $sp368f30); echo '</tt></pre><br/ ><br/ ><br/ ><br/ ><br/ ><br/ >'; } else { foreach ($sp368f30 as &$sp8912b8) { $sp8912b8 = join('<span class="m">&nbsp;</span>', explode('¿', $sp8912b8)); $sp8912b8 = join('<span class="m">&#9618;</span>', explode('¡', $sp8912b8)); $sp8912b8 = join('<span class="p">&nbsp;</span>', explode('†', $sp8912b8)); $sp8912b8 = join('<span class="p">&#9618;</span>', explode('°', $sp8912b8)); $sp8912b8 = join('<span class="s">&#9671;</span>', explode('Ñ', $sp8912b8)); $sp8912b8 = join('<span class="s">&#9670;</span>', explode('Ö', $sp8912b8)); $sp8912b8 = join('<span class="x">&#9762;</span>', explode('Å', $sp8912b8)); $sp8912b8 = join('<span class="c">&nbsp;</span>', explode('ê', $sp8912b8)); $sp8912b8 = join('<span class="c">&#9719;</span>', explode('ë', $sp8912b8)); $sp8912b8 = join('<span class="f">&nbsp;</span>', explode('à', $sp8912b8)); $sp8912b8 = join('<span class="f">&#9618;</span>', explode('â', $sp8912b8)); $sp8912b8 = join('&#9830;', explode('', $sp8912b8)); $sp8912b8 = join('&#8901;', explode(' ', $sp8912b8)); } ?>
                <style>
                    .p { background-color: yellow; }
                    .m { background-color: #00FF00; }
                    .s { background-color: #FF0000; }
                    .c { background-color: aqua; }
                    .x { background-color: pink; }
                    .f { background-color: gold; }
                </style>
                <?php  echo '<pre><tt>'; echo join('<br/ >', $sp368f30); echo '</tt></pre>'; } } public static function serial($sp368f30) { return gzcompress(join('
', $sp368f30), 9); } public static function unserial($spa40a85) { return explode('
', gzuncompress($spa40a85)); } public static function newFrame($spf21bb0) { if ($spf21bb0 < 1 || $spf21bb0 > QRSPEC_VERSION_MAX) { return null; } if (!isset(self::$frames[$spf21bb0])) { $sp73b80d = QR_CACHE_DIR . 'frame_' . $spf21bb0 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp73b80d)) { self::$frames[$spf21bb0] = self::unserial(file_get_contents($sp73b80d)); } else { self::$frames[$spf21bb0] = self::createFrame($spf21bb0); file_put_contents($sp73b80d, self::serial(self::$frames[$spf21bb0])); } } else { self::$frames[$spf21bb0] = self::createFrame($spf21bb0); } } if (is_null(self::$frames[$spf21bb0])) { return null; } return self::$frames[$spf21bb0]; } public static function rsBlockNum($sp151b1e) { return $sp151b1e[0] + $sp151b1e[3]; } public static function rsBlockNum1($sp151b1e) { return $sp151b1e[0]; } public static function rsDataCodes1($sp151b1e) { return $sp151b1e[1]; } public static function rsEccCodes1($sp151b1e) { return $sp151b1e[2]; } public static function rsBlockNum2($sp151b1e) { return $sp151b1e[3]; } public static function rsDataCodes2($sp151b1e) { return $sp151b1e[4]; } public static function rsEccCodes2($sp151b1e) { return $sp151b1e[2]; } public static function rsDataLength($sp151b1e) { return $sp151b1e[0] * $sp151b1e[1] + $sp151b1e[3] * $sp151b1e[4]; } public static function rsEccLength($sp151b1e) { return ($sp151b1e[0] + $sp151b1e[3]) * $sp151b1e[2]; } } define('QR_IMAGE', true); class QRimage { public static function png($sp368f30, $sp52f712 = false, $spd1cfc5 = 4, $sp769a2b = 4, $sp511b88 = FALSE) { $sp189aa0 = self::image($sp368f30, $spd1cfc5, $sp769a2b); if ($sp52f712 === false) { Header('Content-type: image/png'); ImagePng($sp189aa0); } else { if ($sp511b88 === TRUE) { ImagePng($sp189aa0, $sp52f712); header('Content-type: image/png'); ImagePng($sp189aa0); } else { ImagePng($sp189aa0, $sp52f712); } } ImageDestroy($sp189aa0); } public static function jpg($sp368f30, $sp52f712 = false, $spd1cfc5 = 8, $sp769a2b = 4, $spe707fa = 85) { $sp189aa0 = self::image($sp368f30, $spd1cfc5, $sp769a2b); if ($sp52f712 === false) { Header('Content-type: image/jpeg'); ImageJpeg($sp189aa0, null, $spe707fa); } else { ImageJpeg($sp189aa0, $sp52f712, $spe707fa); } ImageDestroy($sp189aa0); } private static function image($sp368f30, $spd1cfc5 = 4, $sp769a2b = 4) { $sp012036 = count($sp368f30); $sp1945cb = strlen($sp368f30[0]); $spad9e44 = $sp1945cb + 2 * $sp769a2b; $spe28c29 = $sp012036 + 2 * $sp769a2b; $sp930466 = ImageCreate($spad9e44, $spe28c29); $sp5c27aa[0] = ImageColorAllocate($sp930466, 255, 255, 255); $sp5c27aa[1] = ImageColorAllocate($sp930466, 0, 0, 0); imagefill($sp930466, 0, 0, $sp5c27aa[0]); for ($spb9fd0a = 0; $spb9fd0a < $sp012036; $spb9fd0a++) { for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp1945cb; $sp5a2ed4++) { if ($sp368f30[$spb9fd0a][$sp5a2ed4] == '1') { ImageSetPixel($sp930466, $sp5a2ed4 + $sp769a2b, $spb9fd0a + $sp769a2b, $sp5c27aa[1]); } } } $sp1da6c4 = ImageCreate($spad9e44 * $spd1cfc5, $spe28c29 * $spd1cfc5); ImageCopyResized($sp1da6c4, $sp930466, 0, 0, 0, 0, $spad9e44 * $spd1cfc5, $spe28c29 * $spd1cfc5, $spad9e44, $spe28c29); ImageDestroy($sp930466); return $sp1da6c4; } } define('STRUCTURE_HEADER_BITS', 20); define('MAX_STRUCTURED_SYMBOLS', 16); class QRinputItem { public $mode; public $size; public $data; public $bstream; public function __construct($sp840ef2, $spca33a2, $sp631d11, $sp231124 = null) { $sp28446a = array_slice($sp631d11, 0, $spca33a2); if (count($sp28446a) < $spca33a2) { $sp28446a = array_merge($sp28446a, array_fill(0, $spca33a2 - count($sp28446a), 0)); } if (!QRinput::check($sp840ef2, $spca33a2, $sp28446a)) { throw new Exception('Error m:' . $sp840ef2 . ',s:' . $spca33a2 . ',d:' . join(',', $sp28446a)); return null; } $this->mode = $sp840ef2; $this->size = $spca33a2; $this->data = $sp28446a; $this->bstream = $sp231124; } public function encodeModeNum($spf21bb0) { try { $sp62a480 = (int) ($this->size / 3); $spf57948 = new QRbitstream(); $spe3999d = 1; $spf57948->appendNum(4, $spe3999d); $spf57948->appendNum(QRspec::lengthIndicator(QR_MODE_NUM, $spf21bb0), $this->size); for ($sp3deb2c = 0; $sp3deb2c < $sp62a480; $sp3deb2c++) { $spe3999d = (ord($this->data[$sp3deb2c * 3]) - ord('0')) * 100; $spe3999d += (ord($this->data[$sp3deb2c * 3 + 1]) - ord('0')) * 10; $spe3999d += ord($this->data[$sp3deb2c * 3 + 2]) - ord('0'); $spf57948->appendNum(10, $spe3999d); } if ($this->size - $sp62a480 * 3 == 1) { $spe3999d = ord($this->data[$sp62a480 * 3]) - ord('0'); $spf57948->appendNum(4, $spe3999d); } else { if ($this->size - $sp62a480 * 3 == 2) { $spe3999d = (ord($this->data[$sp62a480 * 3]) - ord('0')) * 10; $spe3999d += ord($this->data[$sp62a480 * 3 + 1]) - ord('0'); $spf57948->appendNum(7, $spe3999d); } } $this->bstream = $spf57948; return 0; } catch (Exception $spa9e936) { return -1; } } public function encodeModeAn($spf21bb0) { try { $sp62a480 = (int) ($this->size / 2); $spf57948 = new QRbitstream(); $spf57948->appendNum(4, 2); $spf57948->appendNum(QRspec::lengthIndicator(QR_MODE_AN, $spf21bb0), $this->size); for ($sp3deb2c = 0; $sp3deb2c < $sp62a480; $sp3deb2c++) { $spe3999d = (int) QRinput::lookAnTable(ord($this->data[$sp3deb2c * 2])) * 45; $spe3999d += (int) QRinput::lookAnTable(ord($this->data[$sp3deb2c * 2 + 1])); $spf57948->appendNum(11, $spe3999d); } if ($this->size & 1) { $spe3999d = QRinput::lookAnTable(ord($this->data[$sp62a480 * 2])); $spf57948->appendNum(6, $spe3999d); } $this->bstream = $spf57948; return 0; } catch (Exception $spa9e936) { return -1; } } public function encodeMode8($spf21bb0) { try { $spf57948 = new QRbitstream(); $spf57948->appendNum(4, 4); $spf57948->appendNum(QRspec::lengthIndicator(QR_MODE_8, $spf21bb0), $this->size); for ($sp3deb2c = 0; $sp3deb2c < $this->size; $sp3deb2c++) { $spf57948->appendNum(8, ord($this->data[$sp3deb2c])); } $this->bstream = $spf57948; return 0; } catch (Exception $spa9e936) { return -1; } } public function encodeModeKanji($spf21bb0) { try { $spf57948 = new QRbitrtream(); $spf57948->appendNum(4, 8); $spf57948->appendNum(QRspec::lengthIndicator(QR_MODE_KANJI, $spf21bb0), (int) ($this->size / 2)); for ($sp3deb2c = 0; $sp3deb2c < $this->size; $sp3deb2c += 2) { $spe3999d = ord($this->data[$sp3deb2c]) << 8 | ord($this->data[$sp3deb2c + 1]); if ($spe3999d <= 40956) { $spe3999d -= 33088; } else { $spe3999d -= 49472; } $sp012036 = ($spe3999d >> 8) * 192; $spe3999d = ($spe3999d & 255) + $sp012036; $spf57948->appendNum(13, $spe3999d); } $this->bstream = $spf57948; return 0; } catch (Exception $spa9e936) { return -1; } } public function encodeModeStructure() { try { $spf57948 = new QRbitstream(); $spf57948->appendNum(4, 3); $spf57948->appendNum(4, ord($this->data[1]) - 1); $spf57948->appendNum(4, ord($this->data[0]) - 1); $spf57948->appendNum(8, ord($this->data[2])); $this->bstream = $spf57948; return 0; } catch (Exception $spa9e936) { return -1; } } public function estimateBitStreamSizeOfEntry($spf21bb0) { $sp5cd69d = 0; if ($spf21bb0 == 0) { $spf21bb0 = 1; } switch ($this->mode) { case QR_MODE_NUM: $sp5cd69d = QRinput::estimateBitsModeNum($this->size); break; case QR_MODE_AN: $sp5cd69d = QRinput::estimateBitsModeAn($this->size); break; case QR_MODE_8: $sp5cd69d = QRinput::estimateBitsMode8($this->size); break; case QR_MODE_KANJI: $sp5cd69d = QRinput::estimateBitsModeKanji($this->size); break; case QR_MODE_STRUCTURE: return STRUCTURE_HEADER_BITS; default: return 0; } $sp69bf69 = QRspec::lengthIndicator($this->mode, $spf21bb0); $sp65c648 = 1 << $sp69bf69; $sp936a13 = (int) (($this->size + $sp65c648 - 1) / $sp65c648); $sp5cd69d += $sp936a13 * (4 + $sp69bf69); return $sp5cd69d; } public function encodeBitStream($spf21bb0) { try { unset($this->bstream); $sp62a480 = QRspec::maximumWords($this->mode, $spf21bb0); if ($this->size > $sp62a480) { $sp0c7ffc = new QRinputItem($this->mode, $sp62a480, $this->data); $sp1918a2 = new QRinputItem($this->mode, $this->size - $sp62a480, array_slice($this->data, $sp62a480)); $sp0c7ffc->encodeBitStream($spf21bb0); $sp1918a2->encodeBitStream($spf21bb0); $this->bstream = new QRbitstream(); $this->bstream->append($sp0c7ffc->bstream); $this->bstream->append($sp1918a2->bstream); unset($sp0c7ffc); unset($sp1918a2); } else { $sp7210a9 = 0; switch ($this->mode) { case QR_MODE_NUM: $sp7210a9 = $this->encodeModeNum($spf21bb0); break; case QR_MODE_AN: $sp7210a9 = $this->encodeModeAn($spf21bb0); break; case QR_MODE_8: $sp7210a9 = $this->encodeMode8($spf21bb0); break; case QR_MODE_KANJI: $sp7210a9 = $this->encodeModeKanji($spf21bb0); break; case QR_MODE_STRUCTURE: $sp7210a9 = $this->encodeModeStructure(); break; default: break; } if ($sp7210a9 < 0) { return -1; } } return $this->bstream->size(); } catch (Exception $spa9e936) { return -1; } } } class QRinput { public $items; private $version; private $level; public function __construct($spf21bb0 = 0, $spd3dda9 = QR_ECLEVEL_L) { if ($spf21bb0 < 0 || $spf21bb0 > QRSPEC_VERSION_MAX || $spd3dda9 > QR_ECLEVEL_H) { throw new Exception('Invalid version no'); return NULL; } $this->version = $spf21bb0; $this->level = $spd3dda9; } public function getVersion() { return $this->version; } public function setVersion($spf21bb0) { if ($spf21bb0 < 0 || $spf21bb0 > QRSPEC_VERSION_MAX) { throw new Exception('Invalid version no'); return -1; } $this->version = $spf21bb0; return 0; } public function getErrorCorrectionLevel() { return $this->level; } public function setErrorCorrectionLevel($spd3dda9) { if ($spd3dda9 > QR_ECLEVEL_H) { throw new Exception('Invalid ECLEVEL'); return -1; } $this->level = $spd3dda9; return 0; } public function appendEntry(QRinputItem $sp3399a2) { $this->items[] = $sp3399a2; } public function append($sp840ef2, $spca33a2, $sp631d11) { try { $sp3399a2 = new QRinputItem($sp840ef2, $spca33a2, $sp631d11); $this->items[] = $sp3399a2; return 0; } catch (Exception $spa9e936) { return -1; } } public function insertStructuredAppendHeader($spca33a2, $sp086150, $spcd1fd7) { if ($spca33a2 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong size'); } if ($sp086150 <= 0 || $sp086150 > MAX_STRUCTURED_SYMBOLS) { throw new Exception('insertStructuredAppendHeader wrong index'); } $spaf6b19 = array($spca33a2, $sp086150, $spcd1fd7); try { $sp3399a2 = new QRinputItem(QR_MODE_STRUCTURE, 3, buf); array_unshift($this->items, $sp3399a2); return 0; } catch (Exception $spa9e936) { return -1; } } public function calcParity() { $spcd1fd7 = 0; foreach ($this->items as $sp795ea1) { if ($sp795ea1->mode != QR_MODE_STRUCTURE) { for ($sp3deb2c = $sp795ea1->size - 1; $sp3deb2c >= 0; $sp3deb2c--) { $spcd1fd7 ^= $sp795ea1->data[$sp3deb2c]; } } } return $spcd1fd7; } public static function checkModeNum($spca33a2, $sp631d11) { for ($sp3deb2c = 0; $sp3deb2c < $spca33a2; $sp3deb2c++) { if (ord($sp631d11[$sp3deb2c]) < ord('0') || ord($sp631d11[$sp3deb2c]) > ord('9')) { return false; } } return true; } public static function estimateBitsModeNum($spca33a2) { $sp1945cb = (int) $spca33a2 / 3; $sp5cd69d = $sp1945cb * 10; switch ($spca33a2 - $sp1945cb * 3) { case 1: $sp5cd69d += 4; break; case 2: $sp5cd69d += 7; break; default: break; } return $sp5cd69d; } public static $anTable = array(-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 36, -1, -1, -1, 37, 38, -1, -1, -1, -1, 39, 40, -1, 41, 42, 43, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 44, -1, -1, -1, -1, -1, -1, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1); public static function lookAnTable($sp1d157c) { return $sp1d157c > 127 ? -1 : self::$anTable[$sp1d157c]; } public static function checkModeAn($spca33a2, $sp631d11) { for ($sp3deb2c = 0; $sp3deb2c < $spca33a2; $sp3deb2c++) { if (self::lookAnTable(ord($sp631d11[$sp3deb2c])) == -1) { return false; } } return true; } public static function estimateBitsModeAn($spca33a2) { $sp1945cb = (int) ($spca33a2 / 2); $sp5cd69d = $sp1945cb * 11; if ($spca33a2 & 1) { $sp5cd69d += 6; } return $sp5cd69d; } public static function estimateBitsMode8($spca33a2) { return $spca33a2 * 8; } public function estimateBitsModeKanji($spca33a2) { return (int) ($spca33a2 / 2 * 13); } public static function checkModeKanji($spca33a2, $sp631d11) { if ($spca33a2 & 1) { return false; } for ($sp3deb2c = 0; $sp3deb2c < $spca33a2; $sp3deb2c += 2) { $spe3999d = ord($sp631d11[$sp3deb2c]) << 8 | ord($sp631d11[$sp3deb2c + 1]); if ($spe3999d < 33088 || $spe3999d > 40956 && $spe3999d < 57408 || $spe3999d > 60351) { return false; } } return true; } public static function check($sp840ef2, $spca33a2, $sp631d11) { if ($spca33a2 <= 0) { return false; } switch ($sp840ef2) { case QR_MODE_NUM: return self::checkModeNum($spca33a2, $sp631d11); break; case QR_MODE_AN: return self::checkModeAn($spca33a2, $sp631d11); break; case QR_MODE_KANJI: return self::checkModeKanji($spca33a2, $sp631d11); break; case QR_MODE_8: return true; break; case QR_MODE_STRUCTURE: return true; break; default: break; } return false; } public function estimateBitStreamSize($spf21bb0) { $sp5cd69d = 0; foreach ($this->items as $sp795ea1) { $sp5cd69d += $sp795ea1->estimateBitStreamSizeOfEntry($spf21bb0); } return $sp5cd69d; } public function estimateVersion() { $spf21bb0 = 0; $sp9ca2d1 = 0; do { $sp9ca2d1 = $spf21bb0; $sp5cd69d = $this->estimateBitStreamSize($sp9ca2d1); $spf21bb0 = QRspec::getMinimumVersion((int) (($sp5cd69d + 7) / 8), $this->level); if ($spf21bb0 < 0) { return -1; } } while ($spf21bb0 > $sp9ca2d1); return $spf21bb0; } public static function lengthOfCode($sp840ef2, $spf21bb0, $sp5cd69d) { $sp0be38e = $sp5cd69d - 4 - QRspec::lengthIndicator($sp840ef2, $spf21bb0); switch ($sp840ef2) { case QR_MODE_NUM: $sp51e5a0 = (int) ($sp0be38e / 10); $sp314954 = $sp0be38e - $sp51e5a0 * 10; $spca33a2 = $sp51e5a0 * 3; if ($sp314954 >= 7) { $spca33a2 += 2; } else { if ($sp314954 >= 4) { $spca33a2 += 1; } } break; case QR_MODE_AN: $sp51e5a0 = (int) ($sp0be38e / 11); $sp314954 = $sp0be38e - $sp51e5a0 * 11; $spca33a2 = $sp51e5a0 * 2; if ($sp314954 >= 6) { $spca33a2++; } break; case QR_MODE_8: $spca33a2 = (int) ($sp0be38e / 8); break; case QR_MODE_KANJI: $spca33a2 = (int) ($sp0be38e / 13 * 2); break; case QR_MODE_STRUCTURE: $spca33a2 = (int) ($sp0be38e / 8); break; default: $spca33a2 = 0; break; } $sp7b36c5 = QRspec::maximumWords($sp840ef2, $spf21bb0); if ($spca33a2 < 0) { $spca33a2 = 0; } if ($spca33a2 > $sp7b36c5) { $spca33a2 = $sp7b36c5; } return $spca33a2; } public function createBitStream() { $sp82f84d = 0; foreach ($this->items as $sp795ea1) { $sp5cd69d = $sp795ea1->encodeBitStream($this->version); if ($sp5cd69d < 0) { return -1; } $sp82f84d += $sp5cd69d; } return $sp82f84d; } public function convertData() { $spb3c5f3 = $this->estimateVersion(); if ($spb3c5f3 > $this->getVersion()) { $this->setVersion($spb3c5f3); } for (;;) { $sp5cd69d = $this->createBitStream(); if ($sp5cd69d < 0) { return -1; } $spb3c5f3 = QRspec::getMinimumVersion((int) (($sp5cd69d + 7) / 8), $this->level); if ($spb3c5f3 < 0) { throw new Exception('WRONG VERSION'); return -1; } else { if ($spb3c5f3 > $this->getVersion()) { $this->setVersion($spb3c5f3); } else { break; } } } return 0; } public function appendPaddingBit(&$sp231124) { $sp5cd69d = $sp231124->size(); $sp9d18d0 = QRspec::getDataLength($this->version, $this->level); $sp336f5d = $sp9d18d0 * 8; if ($sp336f5d == $sp5cd69d) { return 0; } if ($sp336f5d - $sp5cd69d < 5) { return $sp231124->appendNum($sp336f5d - $sp5cd69d, 0); } $sp5cd69d += 4; $sp62a480 = (int) (($sp5cd69d + 7) / 8); $sp071c5d = new QRbitstream(); $sp7210a9 = $sp071c5d->appendNum($sp62a480 * 8 - $sp5cd69d + 4, 0); if ($sp7210a9 < 0) { return $sp7210a9; } $sp83a269 = $sp9d18d0 - $sp62a480; if ($sp83a269 > 0) { $sp1f2b96 = array(); for ($sp3deb2c = 0; $sp3deb2c < $sp83a269; $sp3deb2c++) { $sp1f2b96[$sp3deb2c] = $sp3deb2c & 1 ? 17 : 236; } $sp7210a9 = $sp071c5d->appendBytes($sp83a269, $sp1f2b96); if ($sp7210a9 < 0) { return $sp7210a9; } } $sp7210a9 = $sp231124->append($sp071c5d); return $sp7210a9; } public function mergeBitStream() { if ($this->convertData() < 0) { return null; } $sp231124 = new QRbitstream(); foreach ($this->items as $sp795ea1) { $sp7210a9 = $sp231124->append($sp795ea1->bstream); if ($sp7210a9 < 0) { return null; } } return $sp231124; } public function getBitStream() { $sp231124 = $this->mergeBitStream(); if ($sp231124 == null) { return null; } $sp7210a9 = $this->appendPaddingBit($sp231124); if ($sp7210a9 < 0) { return null; } return $sp231124; } public function getByteStream() { $sp231124 = $this->getBitStream(); if ($sp231124 == null) { return null; } return $sp231124->toByte(); } } class QRbitstream { public $data = array(); public function size() { return count($this->data); } public function allocate($sp86d997) { $this->data = array_fill(0, $sp86d997, 0); return 0; } public static function newFromNum($sp5cd69d, $sp936a13) { $sp231124 = new QRbitstream(); $sp231124->allocate($sp5cd69d); $sp1bed24 = 1 << $sp5cd69d - 1; for ($sp3deb2c = 0; $sp3deb2c < $sp5cd69d; $sp3deb2c++) { if ($sp936a13 & $sp1bed24) { $sp231124->data[$sp3deb2c] = 1; } else { $sp231124->data[$sp3deb2c] = 0; } $sp1bed24 = $sp1bed24 >> 1; } return $sp231124; } public static function newFromBytes($spca33a2, $sp631d11) { $sp231124 = new QRbitstream(); $sp231124->allocate($spca33a2 * 8); $sp0a1153 = 0; for ($sp3deb2c = 0; $sp3deb2c < $spca33a2; $sp3deb2c++) { $sp1bed24 = 128; for ($spbb97a7 = 0; $spbb97a7 < 8; $spbb97a7++) { if ($sp631d11[$sp3deb2c] & $sp1bed24) { $sp231124->data[$sp0a1153] = 1; } else { $sp231124->data[$sp0a1153] = 0; } $sp0a1153++; $sp1bed24 = $sp1bed24 >> 1; } } return $sp231124; } public function append(QRbitstream $sp4d0971) { if (is_null($sp4d0971)) { return -1; } if ($sp4d0971->size() == 0) { return 0; } if ($this->size() == 0) { $this->data = $sp4d0971->data; return 0; } $this->data = array_values(array_merge($this->data, $sp4d0971->data)); return 0; } public function appendNum($sp5cd69d, $sp936a13) { if ($sp5cd69d == 0) { return 0; } $sp854b92 = QRbitstream::newFromNum($sp5cd69d, $sp936a13); if (is_null($sp854b92)) { return -1; } $sp7210a9 = $this->append($sp854b92); unset($sp854b92); return $sp7210a9; } public function appendBytes($spca33a2, $sp631d11) { if ($spca33a2 == 0) { return 0; } $sp854b92 = QRbitstream::newFromBytes($spca33a2, $sp631d11); if (is_null($sp854b92)) { return -1; } $sp7210a9 = $this->append($sp854b92); unset($sp854b92); return $sp7210a9; } public function toByte() { $spca33a2 = $this->size(); if ($spca33a2 == 0) { return array(); } $sp631d11 = array_fill(0, (int) (($spca33a2 + 7) / 8), 0); $sp5fa925 = (int) ($spca33a2 / 8); $sp0a1153 = 0; for ($sp3deb2c = 0; $sp3deb2c < $sp5fa925; $sp3deb2c++) { $sp06d9c9 = 0; for ($spbb97a7 = 0; $spbb97a7 < 8; $spbb97a7++) { $sp06d9c9 = $sp06d9c9 << 1; $sp06d9c9 |= $this->data[$sp0a1153]; $sp0a1153++; } $sp631d11[$sp3deb2c] = $sp06d9c9; } if ($spca33a2 & 7) { $sp06d9c9 = 0; for ($spbb97a7 = 0; $spbb97a7 < ($spca33a2 & 7); $spbb97a7++) { $sp06d9c9 = $sp06d9c9 << 1; $sp06d9c9 |= $this->data[$sp0a1153]; $sp0a1153++; } $sp631d11[$sp5fa925] = $sp06d9c9; } return $sp631d11; } } class QRsplit { public $dataStr = ''; public $input; public $modeHint; public function __construct($sp34f376, $spf7fa80, $spf40468) { $this->dataStr = $sp34f376; $this->input = $spf7fa80; $this->modeHint = $spf40468; } public static function isdigitat($spf2d586, $spf420ba) { if ($spf420ba >= strlen($spf2d586)) { return false; } return ord($spf2d586[$spf420ba]) >= ord('0') && ord($spf2d586[$spf420ba]) <= ord('9'); } public static function isalnumat($spf2d586, $spf420ba) { if ($spf420ba >= strlen($spf2d586)) { return false; } return QRinput::lookAnTable(ord($spf2d586[$spf420ba])) >= 0; } public function identifyMode($spf420ba) { if ($spf420ba >= strlen($this->dataStr)) { return QR_MODE_NUL; } $sp1d157c = $this->dataStr[$spf420ba]; if (self::isdigitat($this->dataStr, $spf420ba)) { return QR_MODE_NUM; } else { if (self::isalnumat($this->dataStr, $spf420ba)) { return QR_MODE_AN; } else { if ($this->modeHint == QR_MODE_KANJI) { if ($spf420ba + 1 < strlen($this->dataStr)) { $speb7a04 = $this->dataStr[$spf420ba + 1]; $sp871a5b = ord($sp1d157c) << 8 | ord($speb7a04); if ($sp871a5b >= 33088 && $sp871a5b <= 40956 || $sp871a5b >= 57408 && $sp871a5b <= 60351) { return QR_MODE_KANJI; } } } } } return QR_MODE_8; } public function eatNum() { $sp433149 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp0a1153 = 0; while (self::isdigitat($this->dataStr, $sp0a1153)) { $sp0a1153++; } $sp4b64d9 = $sp0a1153; $sp840ef2 = $this->identifyMode($sp0a1153); if ($sp840ef2 == QR_MODE_8) { $spd4ea12 = QRinput::estimateBitsModeNum($sp4b64d9) + 4 + $sp433149 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp4b64d9 + 1); if ($spd4ea12 > 0) { return $this->eat8(); } } if ($sp840ef2 == QR_MODE_AN) { $spd4ea12 = QRinput::estimateBitsModeNum($sp4b64d9) + 4 + $sp433149 + QRinput::estimateBitsModeAn(1) - QRinput::estimateBitsModeAn($sp4b64d9 + 1); if ($spd4ea12 > 0) { return $this->eatAn(); } } $sp7210a9 = $this->input->append(QR_MODE_NUM, $sp4b64d9, str_split($this->dataStr)); if ($sp7210a9 < 0) { return -1; } return $sp4b64d9; } public function eatAn() { $sp87c3c2 = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp433149 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp0a1153 = 0; while (self::isalnumat($this->dataStr, $sp0a1153)) { if (self::isdigitat($this->dataStr, $sp0a1153)) { $spe707fa = $sp0a1153; while (self::isdigitat($this->dataStr, $spe707fa)) { $spe707fa++; } $spd4ea12 = QRinput::estimateBitsModeAn($sp0a1153) + QRinput::estimateBitsModeNum($spe707fa - $sp0a1153) + 4 + $sp433149 - QRinput::estimateBitsModeAn($spe707fa); if ($spd4ea12 < 0) { break; } else { $sp0a1153 = $spe707fa; } } else { $sp0a1153++; } } $sp4b64d9 = $sp0a1153; if (!self::isalnumat($this->dataStr, $sp0a1153)) { $spd4ea12 = QRinput::estimateBitsModeAn($sp4b64d9) + 4 + $sp87c3c2 + QRinput::estimateBitsMode8(1) - QRinput::estimateBitsMode8($sp4b64d9 + 1); if ($spd4ea12 > 0) { return $this->eat8(); } } $sp7210a9 = $this->input->append(QR_MODE_AN, $sp4b64d9, str_split($this->dataStr)); if ($sp7210a9 < 0) { return -1; } return $sp4b64d9; } public function eatKanji() { $sp0a1153 = 0; while ($this->identifyMode($sp0a1153) == QR_MODE_KANJI) { $sp0a1153 += 2; } $sp7210a9 = $this->input->append(QR_MODE_KANJI, $sp0a1153, str_split($this->dataStr)); if ($sp7210a9 < 0) { return -1; } return $sp4b64d9; } public function eat8() { $sp87c3c2 = QRspec::lengthIndicator(QR_MODE_AN, $this->input->getVersion()); $sp433149 = QRspec::lengthIndicator(QR_MODE_NUM, $this->input->getVersion()); $sp0a1153 = 1; $sp0ecd3c = strlen($this->dataStr); while ($sp0a1153 < $sp0ecd3c) { $sp840ef2 = $this->identifyMode($sp0a1153); if ($sp840ef2 == QR_MODE_KANJI) { break; } if ($sp840ef2 == QR_MODE_NUM) { $spe707fa = $sp0a1153; while (self::isdigitat($this->dataStr, $spe707fa)) { $spe707fa++; } $spd4ea12 = QRinput::estimateBitsMode8($sp0a1153) + QRinput::estimateBitsModeNum($spe707fa - $sp0a1153) + 4 + $sp433149 - QRinput::estimateBitsMode8($spe707fa); if ($spd4ea12 < 0) { break; } else { $sp0a1153 = $spe707fa; } } else { if ($sp840ef2 == QR_MODE_AN) { $spe707fa = $sp0a1153; while (self::isalnumat($this->dataStr, $spe707fa)) { $spe707fa++; } $spd4ea12 = QRinput::estimateBitsMode8($sp0a1153) + QRinput::estimateBitsModeAn($spe707fa - $sp0a1153) + 4 + $sp87c3c2 - QRinput::estimateBitsMode8($spe707fa); if ($spd4ea12 < 0) { break; } else { $sp0a1153 = $spe707fa; } } else { $sp0a1153++; } } } $sp4b64d9 = $sp0a1153; $sp7210a9 = $this->input->append(QR_MODE_8, $sp4b64d9, str_split($this->dataStr)); if ($sp7210a9 < 0) { return -1; } return $sp4b64d9; } public function splitString() { while (strlen($this->dataStr) > 0) { if ($this->dataStr == '') { return 0; } $sp840ef2 = $this->identifyMode(0); switch ($sp840ef2) { case QR_MODE_NUM: $sp46bdd0 = $this->eatNum(); break; case QR_MODE_AN: $sp46bdd0 = $this->eatAn(); break; case QR_MODE_KANJI: if ($sp01ef96 == QR_MODE_KANJI) { $sp46bdd0 = $this->eatKanji(); } else { $sp46bdd0 = $this->eat8(); } break; default: $sp46bdd0 = $this->eat8(); break; } if ($sp46bdd0 == 0) { return 0; } if ($sp46bdd0 < 0) { return -1; } $this->dataStr = substr($this->dataStr, $sp46bdd0); } } public function toUpper() { $sp48a516 = strlen($this->dataStr); $sp0a1153 = 0; while ($sp0a1153 < $sp48a516) { $sp840ef2 = self::identifyMode(substr($this->dataStr, $sp0a1153), $this->modeHint); if ($sp840ef2 == QR_MODE_KANJI) { $sp0a1153 += 2; } else { if (ord($this->dataStr[$sp0a1153]) >= ord('a') && ord($this->dataStr[$sp0a1153]) <= ord('z')) { $this->dataStr[$sp0a1153] = chr(ord($this->dataStr[$sp0a1153]) - 32); } $sp0a1153++; } } return $this->dataStr; } public static function splitStringToQRinput($spe68576, QRinput $spf7fa80, $spf40468, $spcc83ae = true) { if (is_null($spe68576) || $spe68576 == '\\0' || $spe68576 == '') { throw new Exception('empty string!!!'); } $spe0d617 = new QRsplit($spe68576, $spf7fa80, $spf40468); if (!$spcc83ae) { $spe0d617->toUpper(); } return $spe0d617->splitString(); } } class QRrsItem { public $mm; public $nn; public $alpha_to = array(); public $index_of = array(); public $genpoly = array(); public $nroots; public $fcr; public $prim; public $iprim; public $pad; public $gfpoly; public function modnn($sp5a2ed4) { while ($sp5a2ed4 >= $this->nn) { $sp5a2ed4 -= $this->nn; $sp5a2ed4 = ($sp5a2ed4 >> $this->mm) + ($sp5a2ed4 & $this->nn); } return $sp5a2ed4; } public static function init_rs_char($sp5a3e67, $sp2848a0, $sp3e1769, $spb2a0e3, $spe55b11, $spd79055) { $spb16f60 = null; if ($sp5a3e67 < 0 || $sp5a3e67 > 8) { return $spb16f60; } if ($sp3e1769 < 0 || $sp3e1769 >= 1 << $sp5a3e67) { return $spb16f60; } if ($spb2a0e3 <= 0 || $spb2a0e3 >= 1 << $sp5a3e67) { return $spb16f60; } if ($spe55b11 < 0 || $spe55b11 >= 1 << $sp5a3e67) { return $spb16f60; } if ($spd79055 < 0 || $spd79055 >= (1 << $sp5a3e67) - 1 - $spe55b11) { return $spb16f60; } $spb16f60 = new QRrsItem(); $spb16f60->mm = $sp5a3e67; $spb16f60->nn = (1 << $sp5a3e67) - 1; $spb16f60->pad = $spd79055; $spb16f60->alpha_to = array_fill(0, $spb16f60->nn + 1, 0); $spb16f60->index_of = array_fill(0, $spb16f60->nn + 1, 0); $spf97c4d =& $spb16f60->nn; $spf4cb0f =& $spf97c4d; $spb16f60->index_of[0] = $spf4cb0f; $spb16f60->alpha_to[$spf4cb0f] = 0; $sp4994c3 = 1; for ($sp3deb2c = 0; $sp3deb2c < $spb16f60->nn; $sp3deb2c++) { $spb16f60->index_of[$sp4994c3] = $sp3deb2c; $spb16f60->alpha_to[$sp3deb2c] = $sp4994c3; $sp4994c3 <<= 1; if ($sp4994c3 & 1 << $sp5a3e67) { $sp4994c3 ^= $sp2848a0; } $sp4994c3 &= $spb16f60->nn; } if ($sp4994c3 != 1) { $spb16f60 = NULL; return $spb16f60; } $spb16f60->genpoly = array_fill(0, $spe55b11 + 1, 0); $spb16f60->fcr = $sp3e1769; $spb16f60->prim = $spb2a0e3; $spb16f60->nroots = $spe55b11; $spb16f60->gfpoly = $sp2848a0; for ($sp78e03c = 1; $sp78e03c % $spb2a0e3 != 0; $sp78e03c += $spb16f60->nn) { } $spb16f60->iprim = (int) ($sp78e03c / $spb2a0e3); $spb16f60->genpoly[0] = 1; for ($sp3deb2c = 0, $spd42969 = $sp3e1769 * $spb2a0e3; $sp3deb2c < $spe55b11; $sp3deb2c++, $spd42969 += $spb2a0e3) { $spb16f60->genpoly[$sp3deb2c + 1] = 1; for ($spbb97a7 = $sp3deb2c; $spbb97a7 > 0; $spbb97a7--) { if ($spb16f60->genpoly[$spbb97a7] != 0) { $spb16f60->genpoly[$spbb97a7] = $spb16f60->genpoly[$spbb97a7 - 1] ^ $spb16f60->alpha_to[$spb16f60->modnn($spb16f60->index_of[$spb16f60->genpoly[$spbb97a7]] + $spd42969)]; } else { $spb16f60->genpoly[$spbb97a7] = $spb16f60->genpoly[$spbb97a7 - 1]; } } $spb16f60->genpoly[0] = $spb16f60->alpha_to[$spb16f60->modnn($spb16f60->index_of[$spb16f60->genpoly[0]] + $spd42969)]; } for ($sp3deb2c = 0; $sp3deb2c <= $spe55b11; $sp3deb2c++) { $spb16f60->genpoly[$sp3deb2c] = $spb16f60->index_of[$spb16f60->genpoly[$sp3deb2c]]; } return $spb16f60; } public function encode_rs_char($sp631d11, &$spcd1fd7) { $spc1aed5 =& $this->mm; $spf97c4d =& $this->nn; $spf5a201 =& $this->alpha_to; $sp60ce6c =& $this->index_of; $sp413e94 =& $this->genpoly; $spe166a0 =& $this->nroots; $sp5d38b8 =& $this->fcr; $sp1440bb =& $this->prim; $spfad9eb =& $this->iprim; $sp3fa977 =& $this->pad; $spf4cb0f =& $spf97c4d; $spcd1fd7 = array_fill(0, $spe166a0, 0); for ($sp3deb2c = 0; $sp3deb2c < $spf97c4d - $spe166a0 - $sp3fa977; $sp3deb2c++) { $sp5ac9a7 = $sp60ce6c[$sp631d11[$sp3deb2c] ^ $spcd1fd7[0]]; if ($sp5ac9a7 != $spf4cb0f) { $sp5ac9a7 = $this->modnn($spf97c4d - $sp413e94[$spe166a0] + $sp5ac9a7); for ($spbb97a7 = 1; $spbb97a7 < $spe166a0; $spbb97a7++) { $spcd1fd7[$spbb97a7] ^= $spf5a201[$this->modnn($sp5ac9a7 + $sp413e94[$spe166a0 - $spbb97a7])]; } } array_shift($spcd1fd7); if ($sp5ac9a7 != $spf4cb0f) { array_push($spcd1fd7, $spf5a201[$this->modnn($sp5ac9a7 + $sp413e94[0])]); } else { array_push($spcd1fd7, 0); } } } } class QRrs { public static $items = array(); public static function init_rs($sp5a3e67, $sp2848a0, $sp3e1769, $spb2a0e3, $spe55b11, $spd79055) { foreach (self::$items as $spb16f60) { if ($spb16f60->pad != $spd79055) { continue; } if ($spb16f60->nroots != $spe55b11) { continue; } if ($spb16f60->mm != $sp5a3e67) { continue; } if ($spb16f60->gfpoly != $sp2848a0) { continue; } if ($spb16f60->fcr != $sp3e1769) { continue; } if ($spb16f60->prim != $spb2a0e3) { continue; } return $spb16f60; } $spb16f60 = QRrsItem::init_rs_char($sp5a3e67, $sp2848a0, $sp3e1769, $spb2a0e3, $spe55b11, $spd79055); array_unshift(self::$items, $spb16f60); return $spb16f60; } } define('N1', 3); define('N2', 3); define('N3', 40); define('N4', 10); class QRmask { public $runLength = array(); public function __construct() { $this->runLength = array_fill(0, QRSPEC_WIDTH_MAX + 1, 0); } public function writeFormatInformation($sp2a5137, &$sp368f30, $sp1bed24, $spd3dda9) { $spfb7bdb = 0; $spd977f3 = QRspec::getFormatInfo($sp1bed24, $spd3dda9); for ($sp3deb2c = 0; $sp3deb2c < 8; $sp3deb2c++) { if ($spd977f3 & 1) { $spfb7bdb += 2; $sp06d9c9 = 133; } else { $sp06d9c9 = 132; } $sp368f30[8][$sp2a5137 - 1 - $sp3deb2c] = chr($sp06d9c9); if ($sp3deb2c < 6) { $sp368f30[$sp3deb2c][8] = chr($sp06d9c9); } else { $sp368f30[$sp3deb2c + 1][8] = chr($sp06d9c9); } $spd977f3 = $spd977f3 >> 1; } for ($sp3deb2c = 0; $sp3deb2c < 7; $sp3deb2c++) { if ($spd977f3 & 1) { $spfb7bdb += 2; $sp06d9c9 = 133; } else { $sp06d9c9 = 132; } $sp368f30[$sp2a5137 - 7 + $sp3deb2c][8] = chr($sp06d9c9); if ($sp3deb2c == 0) { $sp368f30[8][7] = chr($sp06d9c9); } else { $sp368f30[8][6 - $sp3deb2c] = chr($sp06d9c9); } $spd977f3 = $spd977f3 >> 1; } return $spfb7bdb; } public function mask0($sp5a2ed4, $spb9fd0a) { return $sp5a2ed4 + $spb9fd0a & 1; } public function mask1($sp5a2ed4, $spb9fd0a) { return $spb9fd0a & 1; } public function mask2($sp5a2ed4, $spb9fd0a) { return $sp5a2ed4 % 3; } public function mask3($sp5a2ed4, $spb9fd0a) { return ($sp5a2ed4 + $spb9fd0a) % 3; } public function mask4($sp5a2ed4, $spb9fd0a) { return (int) ($spb9fd0a / 2) + (int) ($sp5a2ed4 / 3) & 1; } public function mask5($sp5a2ed4, $spb9fd0a) { return ($sp5a2ed4 * $spb9fd0a & 1) + $sp5a2ed4 * $spb9fd0a % 3; } public function mask6($sp5a2ed4, $spb9fd0a) { return ($sp5a2ed4 * $spb9fd0a & 1) + $sp5a2ed4 * $spb9fd0a % 3 & 1; } public function mask7($sp5a2ed4, $spb9fd0a) { return $sp5a2ed4 * $spb9fd0a % 3 + ($sp5a2ed4 + $spb9fd0a & 1) & 1; } private function generateMaskNo($sp446843, $sp2a5137, $sp368f30) { $sp5be2c5 = array_fill(0, $sp2a5137, array_fill(0, $sp2a5137, 0)); for ($spb9fd0a = 0; $spb9fd0a < $sp2a5137; $spb9fd0a++) { for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp2a5137; $sp5a2ed4++) { if (ord($sp368f30[$spb9fd0a][$sp5a2ed4]) & 128) { $sp5be2c5[$spb9fd0a][$sp5a2ed4] = 0; } else { $spd0990a = call_user_func(array($this, 'mask' . $sp446843), $sp5a2ed4, $spb9fd0a); $sp5be2c5[$spb9fd0a][$sp5a2ed4] = $spd0990a == 0 ? 1 : 0; } } } return $sp5be2c5; } public static function serial($sp175d89) { $spe06f30 = array(); foreach ($sp175d89 as $spcdf3ae) { $spe06f30[] = join('', $spcdf3ae); } return gzcompress(join('
', $spe06f30), 9); } public static function unserial($spa40a85) { $spe06f30 = array(); $sp0fba43 = explode('
', gzuncompress($spa40a85)); foreach ($sp0fba43 as $spcdf3ae) { $spe06f30[] = str_split($spcdf3ae); } return $spe06f30; } public function makeMaskNo($sp446843, $sp2a5137, $sp4d4402, &$speb7a04, $spbbc02d = false) { $sp854b92 = 0; $sp5be2c5 = array(); $sp73b80d = QR_CACHE_DIR . 'mask_' . $sp446843 . DIRECTORY_SEPARATOR . 'mask_' . $sp2a5137 . '_' . $sp446843 . '.dat'; if (QR_CACHEABLE) { if (file_exists($sp73b80d)) { $sp5be2c5 = self::unserial(file_get_contents($sp73b80d)); } else { $sp5be2c5 = $this->generateMaskNo($sp446843, $sp2a5137, $sp4d4402, $speb7a04); if (!file_exists(QR_CACHE_DIR . 'mask_' . $sp446843)) { mkdir(QR_CACHE_DIR . 'mask_' . $sp446843); } file_put_contents($sp73b80d, self::serial($sp5be2c5)); } } else { $sp5be2c5 = $this->generateMaskNo($sp446843, $sp2a5137, $sp4d4402, $speb7a04); } if ($spbbc02d) { return; } $speb7a04 = $sp4d4402; for ($spb9fd0a = 0; $spb9fd0a < $sp2a5137; $spb9fd0a++) { for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp2a5137; $sp5a2ed4++) { if ($sp5be2c5[$spb9fd0a][$sp5a2ed4] == 1) { $speb7a04[$spb9fd0a][$sp5a2ed4] = chr(ord($sp4d4402[$spb9fd0a][$sp5a2ed4]) ^ (int) $sp5be2c5[$spb9fd0a][$sp5a2ed4]); } $sp854b92 += (int) (ord($speb7a04[$spb9fd0a][$sp5a2ed4]) & 1); } } return $sp854b92; } public function makeMask($sp2a5137, $sp368f30, $sp446843, $spd3dda9) { $sp39b725 = array_fill(0, $sp2a5137, str_repeat(' ', $sp2a5137)); $this->makeMaskNo($sp446843, $sp2a5137, $sp368f30, $sp39b725); $this->writeFormatInformation($sp2a5137, $sp39b725, $sp446843, $spd3dda9); return $sp39b725; } public function calcN1N3($sp46bdd0) { $sp7540e2 = 0; for ($sp3deb2c = 0; $sp3deb2c < $sp46bdd0; $sp3deb2c++) { if ($this->runLength[$sp3deb2c] >= 5) { $sp7540e2 += N1 + ($this->runLength[$sp3deb2c] - 5); } if ($sp3deb2c & 1) { if ($sp3deb2c >= 3 && $sp3deb2c < $sp46bdd0 - 2 && $this->runLength[$sp3deb2c] % 3 == 0) { $spa00993 = (int) ($this->runLength[$sp3deb2c] / 3); if ($this->runLength[$sp3deb2c - 2] == $spa00993 && $this->runLength[$sp3deb2c - 1] == $spa00993 && $this->runLength[$sp3deb2c + 1] == $spa00993 && $this->runLength[$sp3deb2c + 2] == $spa00993) { if ($this->runLength[$sp3deb2c - 3] < 0 || $this->runLength[$sp3deb2c - 3] >= 4 * $spa00993) { $sp7540e2 += N3; } else { if ($sp3deb2c + 3 >= $sp46bdd0 || $this->runLength[$sp3deb2c + 3] >= 4 * $spa00993) { $sp7540e2 += N3; } } } } } } return $sp7540e2; } public function evaluateSymbol($sp2a5137, $sp368f30) { $sp664ac6 = 0; $sp7540e2 = 0; for ($spb9fd0a = 0; $spb9fd0a < $sp2a5137; $spb9fd0a++) { $sp664ac6 = 0; $this->runLength[0] = 1; $sp53eee4 = $sp368f30[$spb9fd0a]; if ($spb9fd0a > 0) { $spf4b57f = $sp368f30[$spb9fd0a - 1]; } for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp2a5137; $sp5a2ed4++) { if ($sp5a2ed4 > 0 && $spb9fd0a > 0) { $spf7f45f = ord($sp53eee4[$sp5a2ed4]) & ord($sp53eee4[$sp5a2ed4 - 1]) & ord($spf4b57f[$sp5a2ed4]) & ord($spf4b57f[$sp5a2ed4 - 1]); $sp9b635f = ord($sp53eee4[$sp5a2ed4]) | ord($sp53eee4[$sp5a2ed4 - 1]) | ord($spf4b57f[$sp5a2ed4]) | ord($spf4b57f[$sp5a2ed4 - 1]); if (($spf7f45f | $sp9b635f ^ 1) & 1) { $sp7540e2 += N2; } } if ($sp5a2ed4 == 0 && ord($sp53eee4[$sp5a2ed4]) & 1) { $this->runLength[0] = -1; $sp664ac6 = 1; $this->runLength[$sp664ac6] = 1; } else { if ($sp5a2ed4 > 0) { if ((ord($sp53eee4[$sp5a2ed4]) ^ ord($sp53eee4[$sp5a2ed4 - 1])) & 1) { $sp664ac6++; $this->runLength[$sp664ac6] = 1; } else { $this->runLength[$sp664ac6]++; } } } } $sp7540e2 += $this->calcN1N3($sp664ac6 + 1); } for ($sp5a2ed4 = 0; $sp5a2ed4 < $sp2a5137; $sp5a2ed4++) { $sp664ac6 = 0; $this->runLength[0] = 1; for ($spb9fd0a = 0; $spb9fd0a < $sp2a5137; $spb9fd0a++) { if ($spb9fd0a == 0 && ord($sp368f30[$spb9fd0a][$sp5a2ed4]) & 1) { $this->runLength[0] = -1; $sp664ac6 = 1; $this->runLength[$sp664ac6] = 1; } else { if ($spb9fd0a > 0) { if ((ord($sp368f30[$spb9fd0a][$sp5a2ed4]) ^ ord($sp368f30[$spb9fd0a - 1][$sp5a2ed4])) & 1) { $sp664ac6++; $this->runLength[$sp664ac6] = 1; } else { $this->runLength[$sp664ac6]++; } } } } $sp7540e2 += $this->calcN1N3($sp664ac6 + 1); } return $sp7540e2; } public function mask($sp2a5137, $sp368f30, $spd3dda9) { $sp8d9d27 = PHP_INT_MAX; $sp3ff4e3 = 0; $sp5a6755 = array(); $sp976458 = array(0, 1, 2, 3, 4, 5, 6, 7); if (QR_FIND_FROM_RANDOM !== false) { $sp69f945 = 8 - QR_FIND_FROM_RANDOM % 9; for ($sp3deb2c = 0; $sp3deb2c < $sp69f945; $sp3deb2c++) { $sp8d452c = rand(0, count($sp976458) - 1); unset($sp976458[$sp8d452c]); $sp976458 = array_values($sp976458); } } $sp5a6755 = $sp368f30; foreach ($sp976458 as $sp3deb2c) { $sp1bed24 = array_fill(0, $sp2a5137, str_repeat(' ', $sp2a5137)); $sp7540e2 = 0; $spfb7bdb = 0; $spfb7bdb = $this->makeMaskNo($sp3deb2c, $sp2a5137, $sp368f30, $sp1bed24); $spfb7bdb += $this->writeFormatInformation($sp2a5137, $sp1bed24, $sp3deb2c, $spd3dda9); $spfb7bdb = (int) (100 * $spfb7bdb / ($sp2a5137 * $sp2a5137)); $sp7540e2 = (int) ((int) (abs($spfb7bdb - 50) / 5) * N4); $sp7540e2 += $this->evaluateSymbol($sp2a5137, $sp1bed24); if ($sp7540e2 < $sp8d9d27) { $sp8d9d27 = $sp7540e2; $sp5a6755 = $sp1bed24; $sp3ff4e3 = $sp3deb2c; } } return $sp5a6755; } } class QRrsblock { public $dataLength; public $data = array(); public $eccLength; public $ecc = array(); public function __construct($sp83e8f5, $sp631d11, $sp129dde, &$spab82f2, QRrsItem $spb16f60) { $spb16f60->encode_rs_char($sp631d11, $spab82f2); $this->dataLength = $sp83e8f5; $this->data = $sp631d11; $this->eccLength = $sp129dde; $this->ecc = $spab82f2; } } class QRrawcode { public $version; public $datacode = array(); public $ecccode = array(); public $blocks; public $rsblocks = array(); public $count; public $dataLength; public $eccLength; public $b1; public function __construct(QRinput $spf7fa80) { $sp151b1e = array(0, 0, 0, 0, 0); $this->datacode = $spf7fa80->getByteStream(); if (is_null($this->datacode)) { throw new Exception('null imput string'); } QRspec::getEccSpec($spf7fa80->getVersion(), $spf7fa80->getErrorCorrectionLevel(), $sp151b1e); $this->version = $spf7fa80->getVersion(); $this->b1 = QRspec::rsBlockNum1($sp151b1e); $this->dataLength = QRspec::rsDataLength($sp151b1e); $this->eccLength = QRspec::rsEccLength($sp151b1e); $this->ecccode = array_fill(0, $this->eccLength, 0); $this->blocks = QRspec::rsBlockNum($sp151b1e); $sp7210a9 = $this->init($sp151b1e); if ($sp7210a9 < 0) { throw new Exception('block alloc error'); return null; } $this->count = 0; } public function init(array $sp151b1e) { $sp83e8f5 = QRspec::rsDataCodes1($sp151b1e); $sp129dde = QRspec::rsEccCodes1($sp151b1e); $spb16f60 = QRrs::init_rs(8, 285, 0, 1, $sp129dde, 255 - $sp83e8f5 - $sp129dde); $spd862b3 = 0; $sp2ff28d = 0; $sp84117f = 0; for ($sp3deb2c = 0; $sp3deb2c < QRspec::rsBlockNum1($sp151b1e); $sp3deb2c++) { $spab82f2 = array_slice($this->ecccode, $sp84117f); $this->rsblocks[$spd862b3] = new QRrsblock($sp83e8f5, array_slice($this->datacode, $sp2ff28d), $sp129dde, $spab82f2, $spb16f60); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp84117f), $spab82f2); $sp2ff28d += $sp83e8f5; $sp84117f += $sp129dde; $spd862b3++; } if (QRspec::rsBlockNum2($sp151b1e) == 0) { return 0; } $sp83e8f5 = QRspec::rsDataCodes2($sp151b1e); $sp129dde = QRspec::rsEccCodes2($sp151b1e); $spb16f60 = QRrs::init_rs(8, 285, 0, 1, $sp129dde, 255 - $sp83e8f5 - $sp129dde); if ($spb16f60 == NULL) { return -1; } for ($sp3deb2c = 0; $sp3deb2c < QRspec::rsBlockNum2($sp151b1e); $sp3deb2c++) { $spab82f2 = array_slice($this->ecccode, $sp84117f); $this->rsblocks[$spd862b3] = new QRrsblock($sp83e8f5, array_slice($this->datacode, $sp2ff28d), $sp129dde, $spab82f2, $spb16f60); $this->ecccode = array_merge(array_slice($this->ecccode, 0, $sp84117f), $spab82f2); $sp2ff28d += $sp83e8f5; $sp84117f += $sp129dde; $spd862b3++; } return 0; } public function getCode() { $sp7210a9; if ($this->count < $this->dataLength) { $sp849248 = $this->count % $this->blocks; $sp5c27aa = $this->count / $this->blocks; if ($sp5c27aa >= $this->rsblocks[0]->dataLength) { $sp849248 += $this->b1; } $sp7210a9 = $this->rsblocks[$sp849248]->data[$sp5c27aa]; } else { if ($this->count < $this->dataLength + $this->eccLength) { $sp849248 = ($this->count - $this->dataLength) % $this->blocks; $sp5c27aa = ($this->count - $this->dataLength) / $this->blocks; $sp7210a9 = $this->rsblocks[$sp849248]->ecc[$sp5c27aa]; } else { return 0; } } $this->count++; return $sp7210a9; } } class QRcode { public $version; public $width; public $data; public function encodeMask(QRinput $spf7fa80, $sp1bed24) { if ($spf7fa80->getVersion() < 0 || $spf7fa80->getVersion() > QRSPEC_VERSION_MAX) { throw new Exception('wrong version'); } if ($spf7fa80->getErrorCorrectionLevel() > QR_ECLEVEL_H) { throw new Exception('wrong level'); } $spe0a134 = new QRrawcode($spf7fa80); QRtools::markTime('after_raw'); $spf21bb0 = $spe0a134->version; $sp2a5137 = QRspec::getWidth($spf21bb0); $sp368f30 = QRspec::newFrame($spf21bb0); $sp5c626d = new FrameFiller($sp2a5137, $sp368f30); if (is_null($sp5c626d)) { return NULL; } for ($sp3deb2c = 0; $sp3deb2c < $spe0a134->dataLength + $spe0a134->eccLength; $sp3deb2c++) { $spa40a85 = $spe0a134->getCode(); $spe7425d = 128; for ($spbb97a7 = 0; $spbb97a7 < 8; $spbb97a7++) { $spc965ce = $sp5c626d->next(); $sp5c626d->setFrameAt($spc965ce, 2 | ($spe7425d & $spa40a85) != 0); $spe7425d = $spe7425d >> 1; } } QRtools::markTime('after_filler'); unset($spe0a134); $spbb97a7 = QRspec::getRemainder($spf21bb0); for ($sp3deb2c = 0; $sp3deb2c < $spbb97a7; $sp3deb2c++) { $spc965ce = $sp5c626d->next(); $sp5c626d->setFrameAt($spc965ce, 2); } $sp368f30 = $sp5c626d->frame; unset($sp5c626d); $sp75137f = new QRmask(); if ($sp1bed24 < 0) { if (QR_FIND_BEST_MASK) { $sp39b725 = $sp75137f->mask($sp2a5137, $sp368f30, $spf7fa80->getErrorCorrectionLevel()); } else { $sp39b725 = $sp75137f->makeMask($sp2a5137, $sp368f30, intval(QR_DEFAULT_MASK) % 8, $spf7fa80->getErrorCorrectionLevel()); } } else { $sp39b725 = $sp75137f->makeMask($sp2a5137, $sp368f30, $sp1bed24, $spf7fa80->getErrorCorrectionLevel()); } if ($sp39b725 == NULL) { return NULL; } QRtools::markTime('after_mask'); $this->version = $spf21bb0; $this->width = $sp2a5137; $this->data = $sp39b725; return $this; } public function encodeInput(QRinput $spf7fa80) { return $this->encodeMask($spf7fa80, -1); } public function encodeString8bit($spe68576, $spf21bb0, $spd3dda9) { if (string == NULL) { throw new Exception('empty string!'); return NULL; } $spf7fa80 = new QRinput($spf21bb0, $spd3dda9); if ($spf7fa80 == NULL) { return NULL; } $sp7210a9 = $spf7fa80->append($spf7fa80, QR_MODE_8, strlen($spe68576), str_split($spe68576)); if ($sp7210a9 < 0) { unset($spf7fa80); return NULL; } return $this->encodeInput($spf7fa80); } public function encodeString($spe68576, $spf21bb0, $spd3dda9, $sp01ef96, $spcc83ae) { if ($sp01ef96 != QR_MODE_8 && $sp01ef96 != QR_MODE_KANJI) { throw new Exception('bad hint'); return NULL; } $spf7fa80 = new QRinput($spf21bb0, $spd3dda9); if ($spf7fa80 == NULL) { return NULL; } $sp7210a9 = QRsplit::splitStringToQRinput($spe68576, $spf7fa80, $sp01ef96, $spcc83ae); if ($sp7210a9 < 0) { return NULL; } return $this->encodeInput($spf7fa80); } public static function png($sp30dc6c, $spc775b2 = false, $spd3dda9 = QR_ECLEVEL_L, $spca33a2 = 3, $spe232b0 = 4, $sp511b88 = false) { $sp833768 = QRencode::factory($spd3dda9, $spca33a2, $spe232b0); return $sp833768->encodePNG($sp30dc6c, $spc775b2, $sp511b88 = false); } public static function text($sp30dc6c, $spc775b2 = false, $spd3dda9 = QR_ECLEVEL_L, $spca33a2 = 3, $spe232b0 = 4) { $sp833768 = QRencode::factory($spd3dda9, $spca33a2, $spe232b0); return $sp833768->encode($sp30dc6c, $spc775b2); } public static function raw($sp30dc6c, $spc775b2 = false, $spd3dda9 = QR_ECLEVEL_L, $spca33a2 = 3, $spe232b0 = 4) { $sp833768 = QRencode::factory($spd3dda9, $spca33a2, $spe232b0); return $sp833768->encodeRAW($sp30dc6c, $spc775b2); } } class FrameFiller { public $width; public $frame; public $x; public $y; public $dir; public $bit; public function __construct($sp2a5137, &$sp368f30) { $this->width = $sp2a5137; $this->frame = $sp368f30; $this->x = $sp2a5137 - 1; $this->y = $sp2a5137 - 1; $this->dir = -1; $this->bit = -1; } public function setFrameAt($sp843170, $spe3999d) { $this->frame[$sp843170['y']][$sp843170['x']] = chr($spe3999d); } public function getFrameAt($sp843170) { return ord($this->frame[$sp843170['y']][$sp843170['x']]); } public function next() { do { if ($this->bit == -1) { $this->bit = 0; return array('x' => $this->x, 'y' => $this->y); } $sp5a2ed4 = $this->x; $spb9fd0a = $this->y; $sp1945cb = $this->width; if ($this->bit == 0) { $sp5a2ed4--; $this->bit++; } else { $sp5a2ed4++; $spb9fd0a += $this->dir; $this->bit--; } if ($this->dir < 0) { if ($spb9fd0a < 0) { $spb9fd0a = 0; $sp5a2ed4 -= 2; $this->dir = 1; if ($sp5a2ed4 == 6) { $sp5a2ed4--; $spb9fd0a = 9; } } } else { if ($spb9fd0a == $sp1945cb) { $spb9fd0a = $sp1945cb - 1; $sp5a2ed4 -= 2; $this->dir = -1; if ($sp5a2ed4 == 6) { $sp5a2ed4--; $spb9fd0a -= 8; } } } if ($sp5a2ed4 < 0 || $spb9fd0a < 0) { return null; } $this->x = $sp5a2ed4; $this->y = $spb9fd0a; } while (ord($this->frame[$spb9fd0a][$sp5a2ed4]) & 128); return array('x' => $sp5a2ed4, 'y' => $spb9fd0a); } } class QRencode { public $casesensitive = true; public $eightbit = false; public $version = 0; public $size = 3; public $margin = 4; public $structured = 0; public $level = QR_ECLEVEL_L; public $hint = QR_MODE_8; public static function factory($spd3dda9 = QR_ECLEVEL_L, $spca33a2 = 3, $spe232b0 = 4) { $sp833768 = new QRencode(); $sp833768->size = $spca33a2; $sp833768->margin = $spe232b0; switch ($spd3dda9 . '') { case '0': case '1': case '2': case '3': $sp833768->level = $spd3dda9; break; case 'l': case 'L': $sp833768->level = QR_ECLEVEL_L; break; case 'm': case 'M': $sp833768->level = QR_ECLEVEL_M; break; case 'q': case 'Q': $sp833768->level = QR_ECLEVEL_Q; break; case 'h': case 'H': $sp833768->level = QR_ECLEVEL_H; break; } return $sp833768; } public function encodeRAW($spf02082, $spc775b2 = false) { $spa40a85 = new QRcode(); if ($this->eightbit) { $spa40a85->encodeString8bit($spf02082, $this->version, $this->level); } else { $spa40a85->encodeString($spf02082, $this->version, $this->level, $this->hint, $this->casesensitive); } return $spa40a85->data; } public function encode($spf02082, $spc775b2 = false) { $spa40a85 = new QRcode(); if ($this->eightbit) { $spa40a85->encodeString8bit($spf02082, $this->version, $this->level); } else { $spa40a85->encodeString($spf02082, $this->version, $this->level, $this->hint, $this->casesensitive); } QRtools::markTime('after_encode'); if ($spc775b2 !== false) { file_put_contents($spc775b2, join('
', QRtools::binarize($spa40a85->data))); } else { return QRtools::binarize($spa40a85->data); } } public function encodePNG($spf02082, $spc775b2 = false, $sp511b88 = false) { try { ob_start(); $sp3e3c94 = $this->encode($spf02082); $spca1206 = ob_get_contents(); ob_end_clean(); if ($spca1206 != '') { QRtools::log($spc775b2, $spca1206); } $sp95ff59 = (int) (QR_PNG_MAXIMUM_SIZE / (count($sp3e3c94) + 2 * $this->margin)); QRimage::png($sp3e3c94, $spc775b2, min(max(1, $this->size), $sp95ff59), $this->margin, $sp511b88); } catch (Exception $spa9e936) { QRtools::log($spc775b2, $spa9e936->getMessage()); } } }