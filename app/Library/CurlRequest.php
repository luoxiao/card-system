<?php
namespace App\Library; class CurlRequest { private static function curl($spaf19c1, $spd92fdb = 0, $sp52b1f8 = '', &$spf4f2b2 = '', $sp71f60e = array(), $spbc7565 = 5) { if (!isset($sp71f60e['Accept'])) { $sp71f60e['Accept'] = '*/*'; } if (!isset($sp71f60e['Referer'])) { $sp71f60e['Referer'] = $spaf19c1; } if (!isset($sp71f60e['Content-Type'])) { $sp71f60e['Content-Type'] = 'application/x-www-form-urlencoded'; } if (!isset($sp71f60e['User-Agent'])) { $sp71f60e['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'; } if ($spf4f2b2 != '') { $sp71f60e['Cookie'] = $spf4f2b2; } $sp99987e = array(); foreach ($sp71f60e as $spc697fb => $sp1ab181) { $sp99987e[] = $spc697fb . ': ' . $sp1ab181; } $sp99987e[] = 'Expect:'; $sp03f466 = curl_init(); curl_setopt($sp03f466, CURLOPT_URL, $spaf19c1); if ($spd92fdb == 1) { curl_setopt($sp03f466, CURLOPT_POST, 1); if ($sp52b1f8 != '') { curl_setopt($sp03f466, CURLOPT_POSTFIELDS, $sp52b1f8); } } if (defined('MY_PROXY')) { curl_setopt($sp03f466, CURLOPT_PROXY, MY_PROXY); } if (defined('MY_PROXY_PASS')) { curl_setopt($sp03f466, CURLOPT_PROXYUSERPWD, MY_PROXY_PASS); } curl_setopt($sp03f466, CURLOPT_TIMEOUT, $spbc7565); curl_setopt($sp03f466, CURLOPT_CONNECTTIMEOUT, $spbc7565); curl_setopt($sp03f466, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp03f466, CURLOPT_HEADER, 1); curl_setopt($sp03f466, CURLOPT_HTTPHEADER, $sp99987e); $spf1d2fd = curl_exec($sp03f466); $spe53a61 = curl_getinfo($sp03f466, CURLINFO_HEADER_SIZE); $sp3ec8c0 = substr($spf1d2fd, 0, $spe53a61); $spa1a573 = substr($spf1d2fd, $spe53a61); curl_close($sp03f466); $sp71f60e = explode('
', $sp3ec8c0); $sp745a97 = ''; foreach ($sp71f60e as $sp3ec8c0) { if (strpos($sp3ec8c0, 'Set-Cookie') !== false) { if (strpos($sp3ec8c0, ';') !== false) { $sp745a97 = $sp745a97 . trim(Helper::str_between($sp3ec8c0, 'Set-Cookie:', ';')) . ';'; } else { $sp745a97 = $sp745a97 . trim(str_replace('Set-Cookie:', '', $sp3ec8c0)) . ';'; } } } $spf4f2b2 = self::combineCookie($spf4f2b2, $sp745a97); return $spa1a573; } public static function get($spaf19c1, &$spf4f2b2 = '', $sp71f60e = array(), $spbc7565 = 5) { return self::curl($spaf19c1, 0, '', $spf4f2b2, $sp71f60e, $spbc7565); } public static function post($spaf19c1, $sp52b1f8 = '', &$spf4f2b2 = '', $sp71f60e = array(), $spbc7565 = 5) { return self::curl($spaf19c1, 1, $sp52b1f8, $spf4f2b2, $sp71f60e, $spbc7565); } public static function combineCookie($sp406cfb, $sp5142f5) { $spb329bb = explode(';', $sp406cfb); $spabd52c = explode(';', $sp5142f5); foreach ($spb329bb as $spcdf3ae) { if (self::cookieIsExists($spabd52c, self::cookieGetName($spcdf3ae)) == false) { array_push($spabd52c, $spcdf3ae); } } $spd8699b = ''; foreach ($spabd52c as $spcdf3ae) { if (substr($spcdf3ae, -8, 8) != '=deleted' && strlen($spcdf3ae) > 1) { $spd8699b .= $spcdf3ae . '; '; } } return substr($spd8699b, 0, strlen($spd8699b) - 2); } public static function cookieGetName($sp1afb9b) { $sp086150 = strpos($sp1afb9b, '='); return substr($sp1afb9b, 0, $sp086150); } public static function cookieGetValue($sp1afb9b) { $sp086150 = strpos($sp1afb9b, '='); $sp854b92 = substr($sp1afb9b, $sp086150 + 1, strlen($sp1afb9b) - $sp086150); return $sp854b92; } public static function cookieGet($spf4f2b2, $spdbb9e7, $sp1793ca = false) { $spf4f2b2 = str_replace(' ', '', $spf4f2b2); if (substr($spf4f2b2, -1, 1) != ';') { $spf4f2b2 = ';' . $spf4f2b2 . ';'; } else { $spf4f2b2 = ';' . $spf4f2b2; } $sp02c363 = Helper::str_between($spf4f2b2, ';' . $spdbb9e7 . '=', ';'); if (!$sp1793ca || $sp02c363 == '') { return $sp02c363; } else { return $spdbb9e7 . '=' . $sp02c363; } } private static function cookieIsExists($spab431b, $spf00246) { foreach ($spab431b as $spcdf3ae) { if (self::cookieGetName($spcdf3ae) == $spf00246) { return true; } } return false; } function test() { $sp854b92 = self::combineCookie('a=1;b=2;c=3', 'c=5'); var_dump($sp854b92); } }